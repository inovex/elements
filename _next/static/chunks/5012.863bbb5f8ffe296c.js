"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5012],{89:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{a:function(){return commonjsGlobal},c:function(){return createCommonjsModule},g:function(){return getDefaultExportFromCjs}});/*!
 * Crafted with ❤ by inovex GmbH
 */ var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}function createCommonjsModule(fn,basedir,module){return fn(module={path:basedir,exports:{},require:function(path,base){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},module.exports),module.exports}},939:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{c:function(){return classnames}});/*!
 * Crafted with ❤ by inovex GmbH
 */ var classnames=(0,__webpack_require__(89).c)(function(module){!function(){var hasOwn={}.hasOwnProperty;function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg)){if(arg.length){var inner=classNames.apply(null,arg);inner&&classes.push(inner)}}else if("object"===argType){if(arg.toString!==Object.prototype.toString&&!arg.toString.toString().includes("[native code]")){classes.push(arg.toString());continue}for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}}return classes.join(" ")}module.exports?(classNames.default=classNames,module.exports=classNames):window.classNames=classNames}()})},5012:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ino_markdown_editor:function(){return MarkdownEditor}});var splitNode,ViewMode,Actions,ViewMode1,Actions1,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5895),_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(939),_commonjsHelpers_212d567a_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(89);/*!
 * Crafted with ❤ by inovex GmbH
 */ function OrderedMap(content){this.content=content}OrderedMap.prototype={constructor:OrderedMap,find:function(key){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===key)return i;return -1},get:function(key){var found=this.find(key);return -1==found?void 0:this.content[found+1]},update:function(key,value,newKey){var self1=newKey&&newKey!=key?this.remove(newKey):this,found=self1.find(key),content=self1.content.slice();return -1==found?content.push(newKey||key,value):(content[found+1]=value,newKey&&(content[found]=newKey)),new OrderedMap(content)},remove:function(key){var found=this.find(key);if(-1==found)return this;var content=this.content.slice();return content.splice(found,2),new OrderedMap(content)},addToStart:function(key,value){return new OrderedMap([key,value].concat(this.remove(key).content))},addToEnd:function(key,value){var content=this.remove(key).content.slice();return content.push(key,value),new OrderedMap(content)},addBefore:function(place,key,value){var without=this.remove(key),content=without.content.slice(),found=without.find(place);return content.splice(-1==found?content.length:found,0,key,value),new OrderedMap(content)},forEach:function(f){for(var i=0;i<this.content.length;i+=2)f(this.content[i],this.content[i+1])},prepend:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(map.content.concat(this.subtract(map).content)):this},append:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(this.subtract(map).content.concat(map.content)):this},subtract:function(map){var result=this;map=OrderedMap.from(map);for(var i=0;i<map.content.length;i+=2)result=result.remove(map.content[i]);return result},toObject:function(){var result={};return this.forEach(function(key,value){result[key]=value}),result},get size(){return this.content.length>>1}},OrderedMap.from=function(value){if(value instanceof OrderedMap)return value;var content=[];if(value)for(var prop in value)content.push(prop,value[prop]);return new OrderedMap(content)};class Fragment$2{constructor(content,size){if(this.content=content,this.size=size||0,null==size)for(let i=0;i<content.length;i++)this.size+=content[i].nodeSize}nodesBetween(from,to,f,nodeStart=0,parent){for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;if(end>from&&!1!==f(child,nodeStart+pos,parent||null,i)&&child.content.size){let start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}}descendants(f){this.nodesBetween(0,this.size,f)}textBetween(from,to,blockSeparator,leafText){let text="",separated=!0;return this.nodesBetween(from,to,(node,pos)=>{node.isText?(text+=node.text.slice(Math.max(from,pos)-pos,to-pos),separated=!blockSeparator):node.isLeaf?(leafText?text+="function"==typeof leafText?leafText(node):leafText:node.type.spec.leafText&&(text+=node.type.spec.leafText(node)),separated=!blockSeparator):!separated&&node.isBlock&&(text+=blockSeparator,separated=!0)},0),text}append(other){if(!other.size)return this;if(!this.size)return other;let last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment$2(content,this.size+other.size)}cut(from,to=this.size){if(0==from&&to==this.size)return this;let result=[],size=0;if(to>from)for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child=child.isText?child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment$2(result,size)}cutByIndex(from,to){return from==to?Fragment$2.empty:0==from&&to==this.content.length?this:new Fragment$2(this.content.slice(from,to))}replaceChild(index,node){let current=this.content[index];if(current==node)return this;let copy=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy[index]=node,new Fragment$2(copy,size)}addToStart(node){return new Fragment$2([node].concat(this.content),this.size+node.nodeSize)}addToEnd(node){return new Fragment$2(this.content.concat(node),this.size+node.nodeSize)}eq(other){if(this.content.length!=other.content.length)return!1;for(let i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(index){let found=this.content[index];if(!found)throw RangeError("Index "+index+" out of range for "+this);return found}maybeChild(index){return this.content[index]||null}forEach(f){for(let i=0,p=0;i<this.content.length;i++){let child=this.content[i];f(child,p,i),p+=child.nodeSize}}findDiffStart(other,pos=0){return function findDiffStart$2(a,b,pos){for(let i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;let childA=a.child(i),childB=b.child(i);if(childA==childB){pos+=childA.nodeSize;continue}if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(let j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){let inner=findDiffStart$2(childA.content,childB.content,pos+1);if(null!=inner)return inner}pos+=childA.nodeSize}}(this,other,pos)}findDiffEnd(other,pos=this.size,otherPos=other.size){return function findDiffEnd$2(a,b,posA,posB){for(let iA=a.childCount,iB=b.childCount;;){if(0==iA||0==iB)return iA==iB?null:{a:posA,b:posB};let childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA==childB){posA-=size,posB-=size;continue}if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){let same=0,minSize=Math.min(childA.text.length,childB.text.length);for(;same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){let inner=findDiffEnd$2(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}}(this,other,pos,otherPos)}findIndex(pos,round=-1){if(0==pos)return retIndex$2(0,pos);if(pos==this.size)return retIndex$2(this.content.length,pos);if(pos>this.size||pos<0)throw RangeError(`Position ${pos} outside of fragment (${this})`);for(let i=0,curPos=0;;i++){let end=curPos+this.child(i).nodeSize;if(end>=pos){if(end==pos||round>0)return retIndex$2(i+1,end);return retIndex$2(i,curPos)}curPos=end}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(n=>n.toJSON()):null}static fromJSON(schema,value){if(!value)return Fragment$2.empty;if(!Array.isArray(value))throw RangeError("Invalid input for Fragment.fromJSON");return new Fragment$2(value.map(schema.nodeFromJSON))}static fromArray(array){if(!array.length)return Fragment$2.empty;let joined,size=0;for(let i=0;i<array.length;i++){let node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment$2(joined||array,size)}static from(nodes){if(!nodes)return Fragment$2.empty;if(nodes instanceof Fragment$2)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment$2([nodes],nodes.nodeSize);throw RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment$2.empty=new Fragment$2([],0);let found$2={index:0,offset:0};function retIndex$2(index,offset){return found$2.index=index,found$2.offset=offset,found$2}function compareDeep$2(a,b){if(a===b)return!0;if(!(a&&"object"==typeof a)||!(b&&"object"==typeof b))return!1;let array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compareDeep$2(a[i],b[i]))return!1}else{for(let p in a)if(!(p in b)||!compareDeep$2(a[p],b[p]))return!1;for(let p1 in b)if(!(p1 in a))return!1}return!0}class Mark$3{constructor(type,attrs){this.type=type,this.attrs=attrs}addToSet(set){let copy,placed=!1;for(let i=0;i<set.length;i++){let other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy||(copy=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy||(copy=set.slice(0,i)),copy.push(this),placed=!0),copy&&copy.push(other)}}return copy||(copy=set.slice()),placed||copy.push(this),copy}removeFromSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}isInSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}eq(other){return this==other||this.type==other.type&&compareDeep$2(this.attrs,other.attrs)}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return obj}static fromJSON(schema,json){if(!json)throw RangeError("Invalid input for Mark.fromJSON");let type=schema.marks[json.type];if(!type)throw RangeError(`There is no mark type ${json.type} in this schema`);return type.create(json.attrs)}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}static setFrom(marks){if(!marks||Array.isArray(marks)&&0==marks.length)return Mark$3.none;if(marks instanceof Mark$3)return[marks];let copy=marks.slice();return copy.sort((a,b)=>a.type.rank-b.type.rank),copy}}Mark$3.none=[];class ReplaceError$1 extends Error{}class Slice$2{constructor(content,openStart,openEnd){this.content=content,this.openStart=openStart,this.openEnd=openEnd}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(pos,fragment){let content=function insertInto$2(content,dist,insert,parent){let{index,offset}=content.findIndex(dist),child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));let inner=insertInto$2(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}(this.content,pos+this.openStart,fragment);return content&&new Slice$2(content,this.openStart,this.openEnd)}removeBetween(from,to){return new Slice$2(function removeRange$2(content,from,to){let{index,offset}=content.findIndex(from),child=content.maybeChild(index),{index:indexTo,offset:offsetTo}=content.findIndex(to);if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange$2(child.content,from-offset-1,to-offset-1)))}(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)}eq(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json}static fromJSON(schema,json){if(!json)return Slice$2.empty;let openStart=json.openStart||0,openEnd=json.openEnd||0;if("number"!=typeof openStart||"number"!=typeof openEnd)throw RangeError("Invalid input for Slice.fromJSON");return new Slice$2(Fragment$2.fromJSON(schema,json.content),openStart,openEnd)}static maxOpen(fragment,openIsolating=!0){let openStart=0,openEnd=0;for(let n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(let n1=fragment.lastChild;n1&&!n1.isLeaf&&(openIsolating||!n1.type.spec.isolating);n1=n1.lastChild)openEnd++;return new Slice$2(fragment,openStart,openEnd)}}function checkJoin$1(main,sub){if(!sub.type.compatibleContent(main.type))throw new ReplaceError$1("Cannot join "+sub.type.name+" onto "+main.type.name)}function joinable$2($before,$after,depth){let node=$before.node(depth);return checkJoin$1(node,$after.node(depth)),node}function addNode$1(child,target){let last=target.length-1;last>=0&&child.isText&&child.sameMarkup(target[last])?target[last]=child.withText(target[last].text+child.text):target.push(child)}function addRange$1($start,$end,depth,target){let node=($end||$start).node(depth),startIndex=0,endIndex=$end?$end.index(depth):node.childCount;$start&&(startIndex=$start.index(depth),$start.depth>depth?startIndex++:$start.textOffset&&(addNode$1($start.nodeAfter,target),startIndex++));for(let i=startIndex;i<endIndex;i++)addNode$1(node.child(i),target);$end&&$end.depth==depth&&$end.textOffset&&addNode$1($end.nodeBefore,target)}function close$1(node,content){return node.type.checkContent(content),node.copy(content)}function replaceTwoWay$1($from,$to,depth){let content=[];return addRange$1(null,$from,depth,content),$from.depth>depth&&addNode$1(close$1(joinable$2($from,$to,depth+1),replaceTwoWay$1($from,$to,depth+1)),content),addRange$1($to,null,depth,content),new Fragment$2(content)}Slice$2.empty=new Slice$2(Fragment$2.empty,0,0);class ResolvedPos$1{constructor(pos,path,parentOffset){this.pos=pos,this.path=path,this.parentOffset=parentOffset,this.depth=path.length/3-1}resolveDepth(val){return null==val?this.depth:val<0?this.depth+val:val}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(depth){return this.path[3*this.resolveDepth(depth)]}index(depth){return this.path[3*this.resolveDepth(depth)+1]}indexAfter(depth){return depth=this.resolveDepth(depth),this.index(depth)+(depth!=this.depth||this.textOffset?1:0)}start(depth){return 0==(depth=this.resolveDepth(depth))?0:this.path[3*depth-1]+1}end(depth){return depth=this.resolveDepth(depth),this.start(depth)+this.node(depth).content.size}before(depth){if(!(depth=this.resolveDepth(depth)))throw RangeError("There is no position before the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]}after(depth){if(!(depth=this.resolveDepth(depth)))throw RangeError("There is no position after the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]+this.path[3*depth].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let parent=this.parent,index=this.index(this.depth);if(index==parent.childCount)return null;let dOff=this.pos-this.path[this.path.length-1],child=parent.child(index);return dOff?parent.child(index).cut(dOff):child}get nodeBefore(){let index=this.index(this.depth),dOff=this.pos-this.path[this.path.length-1];return dOff?this.parent.child(index).cut(0,dOff):0==index?null:this.parent.child(index-1)}posAtIndex(index,depth){depth=this.resolveDepth(depth);let node=this.path[3*depth],pos=0==depth?0:this.path[3*depth-1]+1;for(let i=0;i<index;i++)pos+=node.child(i).nodeSize;return pos}marks(){let parent=this.parent,index=this.index();if(0==parent.content.size)return Mark$3.none;if(this.textOffset)return parent.child(index).marks;let main=parent.maybeChild(index-1),other=parent.maybeChild(index);if(!main){let tmp=main;main=other,other=tmp}let marks=main.marks;for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||other&&marks[i].isInSet(other.marks)||(marks=marks[i--].removeFromSet(marks));return marks}marksAcross($end){let after=this.parent.maybeChild(this.index());if(!after||!after.isInline)return null;let marks=after.marks,next=$end.parent.maybeChild($end.index());for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||next&&marks[i].isInSet(next.marks)||(marks=marks[i--].removeFromSet(marks));return marks}sharedDepth(pos){for(let depth=this.depth;depth>0;depth--)if(this.start(depth)<=pos&&this.end(depth)>=pos)return depth;return 0}blockRange(other=this,pred){if(other.pos<this.pos)return other.blockRange(this);for(let d=this.depth-(this.parent.inlineContent||this.pos==other.pos?1:0);d>=0;d--)if(other.pos<=this.end(d)&&(!pred||pred(this.node(d))))return new NodeRange$1(this,other,d);return null}sameParent(other){return this.pos-this.parentOffset==other.pos-other.parentOffset}max(other){return other.pos>this.pos?other:this}min(other){return other.pos<this.pos?other:this}toString(){let str="";for(let i=1;i<=this.depth;i++)str+=(str?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return str+":"+this.parentOffset}static resolve(doc,pos){if(!(pos>=0&&pos<=doc.content.size))throw RangeError("Position "+pos+" out of range");let path=[],start=0,parentOffset=pos;for(let node=doc;;){let{index,offset}=node.content.findIndex(parentOffset),rem=parentOffset-offset;if(path.push(node,index,start+offset),!rem||(node=node.child(index)).isText)break;parentOffset=rem-1,start+=offset+1}return new ResolvedPos$1(pos,path,parentOffset)}static resolveCached(doc,pos){for(let i=0;i<resolveCache$1.length;i++){let cached=resolveCache$1[i];if(cached.pos==pos&&cached.doc==doc)return cached}let result=resolveCache$1[resolveCachePos$1]=ResolvedPos$1.resolve(doc,pos);return resolveCachePos$1=(resolveCachePos$1+1)%resolveCacheSize$1,result}}let resolveCache$1=[],resolveCachePos$1=0,resolveCacheSize$1=12;class NodeRange$1{constructor($from,$to,depth){this.$from=$from,this.$to=$to,this.depth=depth}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}let emptyAttrs$1=Object.create(null);class Node$2{constructor(type,attrs,content,marks=Mark$3.none){this.type=type,this.attrs=attrs,this.marks=marks,this.content=content||Fragment$2.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(index){return this.content.child(index)}maybeChild(index){return this.content.maybeChild(index)}forEach(f){this.content.forEach(f)}nodesBetween(from,to,f,startPos=0){this.content.nodesBetween(from,to,f,startPos,this)}descendants(f){this.nodesBetween(0,this.content.size,f)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(from,to,blockSeparator,leafText){return this.content.textBetween(from,to,blockSeparator,leafText)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(other){return this==other||this.sameMarkup(other)&&this.content.eq(other.content)}sameMarkup(other){return this.hasMarkup(other.type,other.attrs,other.marks)}hasMarkup(type,attrs,marks){return this.type==type&&compareDeep$2(this.attrs,attrs||type.defaultAttrs||emptyAttrs$1)&&Mark$3.sameSet(this.marks,marks||Mark$3.none)}copy(content=null){return content==this.content?this:new Node$2(this.type,this.attrs,content,this.marks)}mark(marks){return marks==this.marks?this:new Node$2(this.type,this.attrs,this.content,marks)}cut(from,to=this.content.size){return 0==from&&to==this.content.size?this:this.copy(this.content.cut(from,to))}slice(from,to=this.content.size,includeParents=!1){if(from==to)return Slice$2.empty;let $from=this.resolve(from),$to=this.resolve(to),depth=includeParents?0:$from.sharedDepth(to),start=$from.start(depth),content=$from.node(depth).content.cut($from.pos-start,$to.pos-start);return new Slice$2(content,$from.depth-depth,$to.depth-depth)}replace(from,to,slice){return function($from,$to,slice){if(slice.openStart>$from.depth)throw new ReplaceError$1("Inserted content deeper than insertion position");if($from.depth-slice.openStart!=$to.depth-slice.openEnd)throw new ReplaceError$1("Inconsistent open depths");return function replaceOuter$1($from,$to,slice,depth){let index=$from.index(depth),node=$from.node(depth);if(index==$to.index(depth)&&depth<$from.depth-slice.openStart){let inner=replaceOuter$1($from,$to,slice,depth+1);return node.copy(node.content.replaceChild(index,inner))}if(!slice.content.size)return close$1(node,replaceTwoWay$1($from,$to,depth));if(slice.openStart||slice.openEnd||$from.depth!=depth||$to.depth!=depth){let{start,end}=function(slice,$along){let extra=$along.depth-slice.openStart,node=$along.node(extra).copy(slice.content);for(let i=extra-1;i>=0;i--)node=$along.node(i).copy(Fragment$2.from(node));return{start:node.resolveNoCache(slice.openStart+extra),end:node.resolveNoCache(node.content.size-slice.openEnd-extra)}}(slice,$from);return close$1(node,function replaceThreeWay$1($from,$start,$end,$to,depth){let openStart=$from.depth>depth&&joinable$2($from,$start,depth+1),openEnd=$to.depth>depth&&joinable$2($end,$to,depth+1),content=[];return addRange$1(null,$from,depth,content),openStart&&openEnd&&$start.index(depth)==$end.index(depth)?(checkJoin$1(openStart,openEnd),addNode$1(close$1(openStart,replaceThreeWay$1($from,$start,$end,$to,depth+1)),content)):(openStart&&addNode$1(close$1(openStart,replaceTwoWay$1($from,$start,depth+1)),content),addRange$1($start,$end,depth,content),openEnd&&addNode$1(close$1(openEnd,replaceTwoWay$1($end,$to,depth+1)),content)),addRange$1($to,null,depth,content),new Fragment$2(content)}($from,start,end,$to,depth))}{let parent=$from.parent,content=parent.content;return close$1(parent,content.cut(0,$from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))}}($from,$to,slice,0)}(this.resolve(from),this.resolve(to),slice)}nodeAt(pos){for(let node=this;;){let{index,offset}=node.content.findIndex(pos);if(!(node=node.maybeChild(index)))return null;if(offset==pos||node.isText)return node;pos-=offset+1}}childAfter(pos){let{index,offset}=this.content.findIndex(pos);return{node:this.content.maybeChild(index),index,offset}}childBefore(pos){if(0==pos)return{node:null,index:0,offset:0};let{index,offset}=this.content.findIndex(pos);if(offset<pos)return{node:this.content.child(index),index,offset};let node=this.content.child(index-1);return{node,index:index-1,offset:offset-node.nodeSize}}resolve(pos){return ResolvedPos$1.resolveCached(this,pos)}resolveNoCache(pos){return ResolvedPos$1.resolve(this,pos)}rangeHasMark(from,to,type){let found=!1;return to>from&&this.nodesBetween(from,to,node=>(type.isInSet(node.marks)&&(found=!0),!found)),found}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let name=this.type.name;return this.content.size&&(name+="("+this.content.toStringInner()+")"),wrapMarks$1(this.marks,name)}contentMatchAt(index){let match=this.type.contentMatch.matchFragment(this.content,0,index);if(!match)throw Error("Called contentMatchAt on a node with invalid content");return match}canReplace(from,to,replacement=Fragment$2.empty,start=0,end=replacement.childCount){let one=this.contentMatchAt(from).matchFragment(replacement,start,end),two=one&&one.matchFragment(this.content,to);if(!two||!two.validEnd)return!1;for(let i=start;i<end;i++)if(!this.type.allowsMarks(replacement.child(i).marks))return!1;return!0}canReplaceWith(from,to,type,marks){if(marks&&!this.type.allowsMarks(marks))return!1;let start=this.contentMatchAt(from).matchType(type),end=start&&start.matchFragment(this.content,to);return!!end&&end.validEnd}canAppend(other){return other.content.size?this.canReplace(this.childCount,this.childCount,other.content):this.type.compatibleContent(other.type)}check(){this.type.checkContent(this.content);let copy=Mark$3.none;for(let i=0;i<this.marks.length;i++)copy=this.marks[i].addToSet(copy);if(!Mark$3.sameSet(copy,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(m=>m.type.name)}`);this.content.forEach(node=>node.check())}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return this.content.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map(n=>n.toJSON())),obj}static fromJSON(schema,json){if(!json)throw RangeError("Invalid input for Node.fromJSON");let marks=null;if(json.marks){if(!Array.isArray(json.marks))throw RangeError("Invalid mark data for Node.fromJSON");marks=json.marks.map(schema.markFromJSON)}if("text"==json.type){if("string"!=typeof json.text)throw RangeError("Invalid text node in JSON");return schema.text(json.text,marks)}let content=Fragment$2.fromJSON(schema,json.content);return schema.nodeType(json.type).create(json.attrs,content,marks)}}Node$2.prototype.text=void 0;class TextNode$1 extends Node$2{constructor(type,attrs,content,marks){if(super(type,attrs,null,marks),!content)throw RangeError("Empty text nodes are not allowed");this.text=content}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks$1(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(from,to){return this.text.slice(from,to)}get nodeSize(){return this.text.length}mark(marks){return marks==this.marks?this:new TextNode$1(this.type,this.attrs,this.text,marks)}withText(text){return text==this.text?this:new TextNode$1(this.type,this.attrs,text,this.marks)}cut(from=0,to=this.text.length){return 0==from&&to==this.text.length?this:this.withText(this.text.slice(from,to))}eq(other){return this.sameMarkup(other)&&this.text==other.text}toJSON(){let base=super.toJSON();return base.text=this.text,base}}function wrapMarks$1(marks,str){for(let i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}class ContentMatch$1{constructor(validEnd){this.validEnd=validEnd,this.next=[],this.wrapCache=[]}static parse(string,nodeTypes){var nfa;let labeled,stream=new TokenStream$1(string,nodeTypes);if(null==stream.next)return ContentMatch$1.empty;let expr=function parseExpr$1(stream){let exprs=[];do exprs.push(function(stream){let exprs=[];do exprs.push(function(stream){let expr=function(stream){if(stream.eat("(")){let expr=parseExpr$1(stream);return stream.eat(")")||stream.err("Missing closing paren"),expr}if(/\W/.test(stream.next))stream.err("Unexpected token '"+stream.next+"'");else{let exprs=(function(stream,name){let types=stream.nodeTypes,type=types[name];if(type)return[type];let result=[];for(let typeName in types){let type1=types[typeName];type1.groups.indexOf(name)>-1&&result.push(type1)}return 0==result.length&&stream.err("No node type or group '"+name+"' found"),result})(stream,stream.next).map(type=>(null==stream.inline?stream.inline=type.isInline:stream.inline!=type.isInline&&stream.err("Mixing inline and block content"),{type:"name",value:type}));return stream.pos++,1==exprs.length?exprs[0]:{type:"choice",exprs}}}(stream);for(;;)if(stream.eat("+"))expr={type:"plus",expr};else if(stream.eat("*"))expr={type:"star",expr};else if(stream.eat("?"))expr={type:"opt",expr};else if(stream.eat("{"))expr=function(stream,expr){let min=parseNum$1(stream),max=min;return stream.eat(",")&&(max="}"!=stream.next?parseNum$1(stream):-1),stream.eat("}")||stream.err("Unclosed braced range"),{type:"range",min,max,expr}}(stream,expr);else break;return expr}(stream));while(stream.next&&")"!=stream.next&&"|"!=stream.next);return 1==exprs.length?exprs[0]:{type:"seq",exprs}}(stream));while(stream.eat("|"));return 1==exprs.length?exprs[0]:{type:"choice",exprs}}(stream);stream.next&&stream.err("Unexpected trailing text");let match=(nfa=function(expr){let nfa=[[]];return connect(function compile(expr,from){if("choice"==expr.type)return expr.exprs.reduce((out,expr)=>out.concat(compile(expr,from)),[]);if("seq"==expr.type)for(let i=0;;i++){let next=compile(expr.exprs[i],from);if(i==expr.exprs.length-1)return next;connect(next,from=node())}else if("star"==expr.type){let loop=node();return edge(from,loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}else if("plus"==expr.type){let loop1=node();return connect(compile(expr.expr,from),loop1),connect(compile(expr.expr,loop1),loop1),[edge(loop1)]}else if("opt"==expr.type)return[edge(from)].concat(compile(expr.expr,from));else if("range"==expr.type){let cur=from;for(let i1=0;i1<expr.min;i1++){let next1=node();connect(compile(expr.expr,cur),next1),cur=next1}if(-1==expr.max)connect(compile(expr.expr,cur),cur);else for(let i2=expr.min;i2<expr.max;i2++){let next2=node();edge(cur,next2),connect(compile(expr.expr,cur),next2),cur=next2}return[edge(cur)]}else if("name"==expr.type)return[edge(from,void 0,expr.value)];else throw Error("Unknown expr type")}(expr,0),node()),nfa;function node(){return nfa.push([])-1}function edge(from,to,term){let edge={term,to};return nfa[from].push(edge),edge}function connect(edges,to){edges.forEach(edge=>edge.to=to)}}(expr),labeled=Object.create(null),function explore(states){let out=[];states.forEach(node=>{nfa[node].forEach(({term,to})=>{let set;if(term){for(let i=0;i<out.length;i++)out[i][0]==term&&(set=out[i][1]);nullFrom$1(nfa,to).forEach(node=>{set||out.push([term,set=[]]),-1==set.indexOf(node)&&set.push(node)})}})});let state=labeled[states.join(",")]=new ContentMatch$1(states.indexOf(nfa.length-1)>-1);for(let i=0;i<out.length;i++){let states1=out[i][1].sort(cmp$1);state.next.push({type:out[i][0],next:labeled[states1.join(",")]||explore(states1)})}return state}(nullFrom$1(nfa,0)));return function(match,stream){for(let i=0,work=[match];i<work.length;i++){let state=work[i],dead=!state.validEnd,nodes=[];for(let j=0;j<state.next.length;j++){let{type,next}=state.next[j];nodes.push(type.name),dead&&!(type.isText||type.hasRequiredAttrs())&&(dead=!1),-1==work.indexOf(next)&&work.push(next)}dead&&stream.err("Only non-generatable nodes ("+nodes.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(match,stream),match}matchType(type){for(let i=0;i<this.next.length;i++)if(this.next[i].type==type)return this.next[i].next;return null}matchFragment(frag,start=0,end=frag.childCount){let cur=this;for(let i=start;cur&&i<end;i++)cur=cur.matchType(frag.child(i).type);return cur}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let i=0;i<this.next.length;i++){let{type}=this.next[i];if(!(type.isText||type.hasRequiredAttrs()))return type}return null}compatible(other){for(let i=0;i<this.next.length;i++)for(let j=0;j<other.next.length;j++)if(this.next[i].type==other.next[j].type)return!0;return!1}fillBefore(after,toEnd=!1,startIndex=0){let seen=[this];return function search(match,types){let finished=match.matchFragment(after,startIndex);if(finished&&(!toEnd||finished.validEnd))return Fragment$2.from(types.map(tp=>tp.createAndFill()));for(let i=0;i<match.next.length;i++){let{type,next}=match.next[i];if(!(type.isText||type.hasRequiredAttrs())&&-1==seen.indexOf(next)){seen.push(next);let found=search(next,types.concat(type));if(found)return found}}return null}(this,[])}findWrapping(target){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==target)return this.wrapCache[i+1];let computed=this.computeWrapping(target);return this.wrapCache.push(target,computed),computed}computeWrapping(target){let seen=Object.create(null),active=[{match:this,type:null,via:null}];for(;active.length;){let current=active.shift(),match=current.match;if(match.matchType(target)){let result=[];for(let obj=current;obj.type;obj=obj.via)result.push(obj.type);return result.reverse()}for(let i=0;i<match.next.length;i++){let{type,next}=match.next[i];type.isLeaf||type.hasRequiredAttrs()||type.name in seen||current.type&&!next.validEnd||(active.push({match:type.contentMatch,type,via:current}),seen[type.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(n){if(n>=this.next.length)throw RangeError(`There's no ${n}th edge in this content match`);return this.next[n]}toString(){let seen=[];return!function scan(m){seen.push(m);for(let i=0;i<m.next.length;i++)-1==seen.indexOf(m.next[i].next)&&scan(m.next[i].next)}(this),seen.map((m,i)=>{let out=i+(m.validEnd?"*":" ")+" ";for(let i1=0;i1<m.next.length;i1++)out+=(i1?", ":"")+m.next[i1].type.name+"->"+seen.indexOf(m.next[i1].next);return out}).join("\n")}}ContentMatch$1.empty=new ContentMatch$1(!0);class TokenStream$1{constructor(string,nodeTypes){this.string=string,this.nodeTypes=nodeTypes,this.inline=null,this.pos=0,this.tokens=string.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(tok){return this.next==tok&&(this.pos++||!0)}err(str){throw SyntaxError(str+" (in content expression '"+this.string+"')")}}function parseNum$1(stream){/\D/.test(stream.next)&&stream.err("Expected number, got '"+stream.next+"'");let result=Number(stream.next);return stream.pos++,result}function cmp$1(a,b){return b-a}function nullFrom$1(nfa,node){let result=[];return function scan(node){let edges=nfa[node];if(1==edges.length&&!edges[0].term)return scan(edges[0].to);result.push(node);for(let i=0;i<edges.length;i++){let{term,to}=edges[i];term||-1!=result.indexOf(to)||scan(to)}}(node),result.sort(cmp$1)}function defaultAttrs$1(attrs){let defaults=Object.create(null);for(let attrName in attrs){let attr=attrs[attrName];if(!attr.hasDefault)return null;defaults[attrName]=attr.default}return defaults}function computeAttrs$1(attrs,value){let built=Object.create(null);for(let name in attrs){let given=value&&value[name];if(void 0===given){let attr=attrs[name];if(attr.hasDefault)given=attr.default;else throw RangeError("No value supplied for attribute "+name)}built[name]=given}return built}function initAttrs$1(attrs){let result=Object.create(null);if(attrs)for(let name in attrs)result[name]=new Attribute$1(attrs[name]);return result}class NodeType$2{constructor(name,schema,spec){this.name=name,this.schema=schema,this.spec=spec,this.markSet=null,this.groups=spec.group?spec.group.split(" "):[],this.attrs=initAttrs$1(spec.attrs),this.defaultAttrs=defaultAttrs$1(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(spec.inline||"text"==name),this.isText="text"==name}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch$1.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1}compatibleContent(other){return this==other||this.contentMatch.compatible(other.contentMatch)}computeAttrs(attrs){return!attrs&&this.defaultAttrs?this.defaultAttrs:computeAttrs$1(this.attrs,attrs)}create(attrs=null,content,marks){if(this.isText)throw Error("NodeType.create can't construct text nodes");return new Node$2(this,this.computeAttrs(attrs),Fragment$2.from(content),Mark$3.setFrom(marks))}createChecked(attrs=null,content,marks){return content=Fragment$2.from(content),this.checkContent(content),new Node$2(this,this.computeAttrs(attrs),content,Mark$3.setFrom(marks))}createAndFill(attrs=null,content,marks){if(attrs=this.computeAttrs(attrs),(content=Fragment$2.from(content)).size){let before=this.contentMatch.fillBefore(content);if(!before)return null;content=before.append(content)}let matched=this.contentMatch.matchFragment(content),after=matched&&matched.fillBefore(Fragment$2.empty,!0);return after?new Node$2(this,attrs,content.append(after),Mark$3.setFrom(marks)):null}validContent(content){let result=this.contentMatch.matchFragment(content);if(!result||!result.validEnd)return!1;for(let i=0;i<content.childCount;i++)if(!this.allowsMarks(content.child(i).marks))return!1;return!0}checkContent(content){if(!this.validContent(content))throw RangeError(`Invalid content for node ${this.name}: ${content.toString().slice(0,50)}`)}allowsMarkType(markType){return null==this.markSet||this.markSet.indexOf(markType)>-1}allowsMarks(marks){if(null==this.markSet)return!0;for(let i=0;i<marks.length;i++)if(!this.allowsMarkType(marks[i].type))return!1;return!0}allowedMarks(marks){let copy;if(null==this.markSet)return marks;for(let i=0;i<marks.length;i++)this.allowsMarkType(marks[i].type)?copy&&copy.push(marks[i]):copy||(copy=marks.slice(0,i));return copy?copy.length?copy:Mark$3.none:marks}static compile(nodes,schema){let result=Object.create(null);nodes.forEach((name,spec)=>result[name]=new NodeType$2(name,schema,spec));let topType=schema.spec.topNode||"doc";if(!result[topType])throw RangeError("Schema is missing its top node type ('"+topType+"')");if(!result.text)throw RangeError("Every schema needs a 'text' type");for(let _ in result.text.attrs)throw RangeError("The text node type should not have attributes");return result}}class Attribute$1{constructor(options){this.hasDefault=Object.prototype.hasOwnProperty.call(options,"default"),this.default=options.default}get isRequired(){return!this.hasDefault}}class MarkType$1{constructor(name,rank,schema,spec){this.name=name,this.rank=rank,this.schema=schema,this.spec=spec,this.attrs=initAttrs$1(spec.attrs),this.excluded=null;let defaults=defaultAttrs$1(this.attrs);this.instance=defaults?new Mark$3(this,defaults):null}create(attrs=null){return!attrs&&this.instance?this.instance:new Mark$3(this,computeAttrs$1(this.attrs,attrs))}static compile(marks,schema){let result=Object.create(null),rank=0;return marks.forEach((name,spec)=>result[name]=new MarkType$1(name,rank++,schema,spec)),result}removeFromSet(set){for(var i=0;i<set.length;i++)set[i].type==this&&(set=set.slice(0,i).concat(set.slice(i+1)),i--);return set}isInSet(set){for(let i=0;i<set.length;i++)if(set[i].type==this)return set[i]}excludes(other){return this.excluded.indexOf(other)>-1}}function gatherMarks$1(schema,marks){let found=[];for(let i=0;i<marks.length;i++){let name=marks[i],mark=schema.marks[name],ok=mark;if(mark)found.push(mark);else for(let prop in schema.marks){let mark1=schema.marks[prop];("_"==name||mark1.spec.group&&mark1.spec.group.split(" ").indexOf(name)>-1)&&found.push(ok=mark1)}if(!ok)throw SyntaxError("Unknown mark type: '"+marks[i]+"'")}return found}class MapResult{constructor(pos,delInfo,recover){this.pos=pos,this.delInfo=delInfo,this.recover=recover}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class StepMap{constructor(ranges,inverted=!1){if(this.ranges=ranges,this.inverted=inverted,!ranges.length&&StepMap.empty)return StepMap.empty}recover(value){let diff=0,index=65535&value;if(!this.inverted)for(let i=0;i<index;i++)diff+=this.ranges[3*i+2]-this.ranges[3*i+1];return this.ranges[3*index]+diff+(value-(65535&value))/65536}mapResult(pos,assoc=1){return this._map(pos,assoc,!1)}map(pos,assoc=1){return this._map(pos,assoc,!0)}_map(pos,assoc,simple){let diff=0,oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;let oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex],end=start+oldSize;if(pos<=end){let side=oldSize?pos==start?-1:pos==end?1:assoc:assoc,result=start+diff+(side<0?0:newSize);if(simple)return result;let recover=pos==(assoc<0?start:end)?null:i/3+(pos-start)*65536,del=pos==start?2:pos==end?1:4;return(assoc<0?pos!=start:pos!=end)&&(del|=8),new MapResult(result,del,recover)}diff+=newSize-oldSize}return simple?pos+diff:new MapResult(pos+diff,0,null)}touches(pos,recover){let diff=0,index=65535&recover,oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;let oldSize=this.ranges[i+oldIndex];if(pos<=start+oldSize&&i==3*index)return!0;diff+=this.ranges[i+newIndex]-oldSize}return!1}forEach(f){let oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0,diff=0;i<this.ranges.length;i+=3){let start=this.ranges[i],oldStart=start-(this.inverted?diff:0),newStart=start+(this.inverted?0:diff),oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex];f(oldStart,oldStart+oldSize,newStart,newStart+newSize),diff+=newSize-oldSize}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(n){return 0==n?StepMap.empty:new StepMap(n<0?[0,-n,0]:[0,0,n])}}StepMap.empty=new StepMap([]);class Mapping{constructor(maps=[],mirror,from=0,to=maps.length){this.maps=maps,this.mirror=mirror,this.from=from,this.to=to}slice(from=0,to=this.maps.length){return new Mapping(this.maps,this.mirror,from,to)}copy(){return new Mapping(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(map,mirrors){this.to=this.maps.push(map),null!=mirrors&&this.setMirror(this.maps.length-1,mirrors)}appendMapping(mapping){for(let i=0,startSize=this.maps.length;i<mapping.maps.length;i++){let mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i],null!=mirr&&mirr<i?startSize+mirr:void 0)}}getMirror(n){if(this.mirror){for(let i=0;i<this.mirror.length;i++)if(this.mirror[i]==n)return this.mirror[i+(i%2?-1:1)]}}setMirror(n,m){this.mirror||(this.mirror=[]),this.mirror.push(n,m)}appendMappingInverted(mapping){for(let i=mapping.maps.length-1,totalSize=this.maps.length+mapping.maps.length;i>=0;i--){let mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i].invert(),null!=mirr&&mirr>i?totalSize-mirr-1:void 0)}}invert(){let inverse=new Mapping;return inverse.appendMappingInverted(this),inverse}map(pos,assoc=1){if(this.mirror)return this._map(pos,assoc,!0);for(let i=this.from;i<this.to;i++)pos=this.maps[i].map(pos,assoc);return pos}mapResult(pos,assoc=1){return this._map(pos,assoc,!1)}_map(pos,assoc,simple){let delInfo=0;for(let i=this.from;i<this.to;i++){let result=this.maps[i].mapResult(pos,assoc);if(null!=result.recover){let corr=this.getMirror(i);if(null!=corr&&corr>i&&corr<this.to){i=corr,pos=this.maps[corr].recover(result.recover);continue}}delInfo|=result.delInfo,pos=result.pos}return simple?pos:new MapResult(pos,delInfo,null)}}let stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(other){return null}static fromJSON(schema,json){if(!json||!json.stepType)throw RangeError("Invalid input for Step.fromJSON");let type=stepsByID[json.stepType];if(!type)throw RangeError(`No step type ${json.stepType} defined`);return type.fromJSON(schema,json)}static jsonID(id,stepClass){if(id in stepsByID)throw RangeError("Duplicate use of step JSON ID "+id);return stepsByID[id]=stepClass,stepClass.prototype.jsonID=id,stepClass}}class StepResult{constructor(doc,failed){this.doc=doc,this.failed=failed}static ok(doc){return new StepResult(doc,null)}static fail(message){return new StepResult(null,message)}static fromReplace(doc,from,to,slice){try{return StepResult.ok(doc.replace(from,to,slice))}catch(e){if(e instanceof ReplaceError$1)return StepResult.fail(e.message);throw e}}}function mapFragment(fragment,f,parent){let mapped=[];for(let i=0;i<fragment.childCount;i++){let child=fragment.child(i);child.content.size&&(child=child.copy(mapFragment(child.content,f,child))),child.isInline&&(child=f(child,parent,i)),mapped.push(child)}return Fragment$2.fromArray(mapped)}class AddMarkStep extends Step{constructor(from,to,mark){super(),this.from=from,this.to=to,this.mark=mark}apply(doc){let oldSlice=doc.slice(this.from,this.to),$from=doc.resolve(this.from),parent=$from.node($from.sharedDepth(this.to)),slice=new Slice$2(mapFragment(oldSlice.content,(node,parent)=>node.isAtom&&parent.type.allowsMarkType(this.mark.type)?node.mark(this.mark.addToSet(node.marks)):node,parent),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new AddMarkStep(from.pos,to.pos,this.mark)}merge(other){return other instanceof AddMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new AddMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(json.from,json.to,schema.markFromJSON(json.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(from,to,mark){super(),this.from=from,this.to=to,this.mark=mark}apply(doc){let oldSlice=doc.slice(this.from,this.to),slice=new Slice$2(mapFragment(oldSlice.content,node=>node.mark(this.mark.removeFromSet(node.marks)),doc),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new RemoveMarkStep(from.pos,to.pos,this.mark)}merge(other){return other instanceof RemoveMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new RemoveMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(json.from,json.to,schema.markFromJSON(json.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(pos,mark){super(),this.pos=pos,this.mark=mark}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at mark step's position");let updated=node.type.create(node.attrs,null,this.mark.addToSet(node.marks));return StepResult.fromReplace(doc,this.pos,this.pos+1,new Slice$2(Fragment$2.from(updated),0,node.isLeaf?0:1))}invert(doc){let node=doc.nodeAt(this.pos);if(node){let newSet=this.mark.addToSet(node.marks);if(newSet.length==node.marks.length){for(let i=0;i<node.marks.length;i++)if(!node.marks[i].isInSet(newSet))return new AddNodeMarkStep(this.pos,node.marks[i]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new AddNodeMarkStep(pos.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(schema,json){if("number"!=typeof json.pos)throw RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(json.pos,schema.markFromJSON(json.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(pos,mark){super(),this.pos=pos,this.mark=mark}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at mark step's position");let updated=node.type.create(node.attrs,null,this.mark.removeFromSet(node.marks));return StepResult.fromReplace(doc,this.pos,this.pos+1,new Slice$2(Fragment$2.from(updated),0,node.isLeaf?0:1))}invert(doc){let node=doc.nodeAt(this.pos);return node&&this.mark.isInSet(node.marks)?new AddNodeMarkStep(this.pos,this.mark):this}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new RemoveNodeMarkStep(pos.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(schema,json){if("number"!=typeof json.pos)throw RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(json.pos,schema.markFromJSON(json.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(from,to,slice,structure=!1){super(),this.from=from,this.to=to,this.slice=slice,this.structure=structure}apply(doc){return this.structure&&contentBetween(doc,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(doc,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(doc){return new ReplaceStep(this.from,this.from+this.slice.size,doc.slice(this.from,this.to))}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deletedAcross&&to.deletedAcross?null:new ReplaceStep(from.pos,Math.max(from.pos,to.pos),this.slice)}merge(other){if(!(other instanceof ReplaceStep)||other.structure||this.structure)return null;if(this.from+this.slice.size!=other.from||this.slice.openEnd||other.slice.openStart){if(other.to!=this.from||this.slice.openStart||other.slice.openEnd)return null;{let slice=this.slice.size+other.slice.size==0?Slice$2.empty:new Slice$2(other.slice.content.append(this.slice.content),other.slice.openStart,this.slice.openEnd);return new ReplaceStep(other.from,this.to,slice,this.structure)}}{let slice1=this.slice.size+other.slice.size==0?Slice$2.empty:new Slice$2(this.slice.content.append(other.slice.content),this.slice.openStart,other.slice.openEnd);return new ReplaceStep(this.from,this.to+(other.to-other.from),slice1,this.structure)}}toJSON(){let json={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(json.from,json.to,Slice$2.fromJSON(schema,json.slice),!!json.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(from,to,gapFrom,gapTo,slice,insert,structure=!1){super(),this.from=from,this.to=to,this.gapFrom=gapFrom,this.gapTo=gapTo,this.slice=slice,this.insert=insert,this.structure=structure}apply(doc){if(this.structure&&(contentBetween(doc,this.from,this.gapFrom)||contentBetween(doc,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let gap=doc.slice(this.gapFrom,this.gapTo);if(gap.openStart||gap.openEnd)return StepResult.fail("Gap is not a flat range");let inserted=this.slice.insertAt(this.insert,gap.content);return inserted?StepResult.fromReplace(doc,this.from,this.to,inserted):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(doc){let gap=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+gap,this.from+this.insert,this.from+this.insert+gap,doc.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1),gapFrom=mapping.map(this.gapFrom,-1),gapTo=mapping.map(this.gapTo,1);return from.deletedAcross&&to.deletedAcross||gapFrom<from.pos||gapTo>to.pos?null:new ReplaceAroundStep(from.pos,to.pos,gapFrom,gapTo,this.slice,this.insert,this.structure)}toJSON(){let json={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to||"number"!=typeof json.gapFrom||"number"!=typeof json.gapTo||"number"!=typeof json.insert)throw RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(json.from,json.to,json.gapFrom,json.gapTo,Slice$2.fromJSON(schema,json.slice),json.insert,!!json.structure)}}function contentBetween(doc,from,to){let $from=doc.resolve(from),dist=to-from,depth=$from.depth;for(;dist>0&&depth>0&&$from.indexAfter(depth)==$from.node(depth).childCount;)depth--,dist--;if(dist>0){let next=$from.node(depth).maybeChild($from.indexAfter(depth));for(;dist>0;){if(!next||next.isLeaf)return!0;next=next.firstChild,dist--}}return!1}function liftTarget(range){let content=range.parent.content.cutByIndex(range.startIndex,range.endIndex);for(let depth=range.depth;;--depth){let node=range.$from.node(depth),index=range.$from.index(depth),endIndex=range.$to.indexAfter(depth);if(depth<range.depth&&node.canReplace(index,endIndex,content))return depth;if(0==depth||node.type.spec.isolating||!((0==index||node.canReplace(index,node.childCount))&&(endIndex==node.childCount||node.canReplace(0,endIndex))))break}return null}function findWrapping(range,nodeType,attrs=null,innerRange=range){let around=function(range,type){let{parent,startIndex,endIndex}=range,around=parent.contentMatchAt(startIndex).findWrapping(type);if(!around)return null;let outer=around.length?around[0]:type;return parent.canReplaceWith(startIndex,endIndex,outer)?around:null}(range,nodeType),inner=around&&function(range,type){let{parent,startIndex,endIndex}=range,inner=parent.child(startIndex),inside=type.contentMatch.findWrapping(inner.type);if(!inside)return null;let innerMatch=(inside.length?inside[inside.length-1]:type).contentMatch;for(let i=startIndex;innerMatch&&i<endIndex;i++)innerMatch=innerMatch.matchType(parent.child(i).type);return innerMatch&&innerMatch.validEnd?inside:null}(innerRange,nodeType);return inner?around.map(withAttrs).concat({type:nodeType,attrs}).concat(inner.map(withAttrs)):null}function withAttrs(type){return{type,attrs:null}}function canSplit(doc,pos,depth=1,typesAfter){let $pos=doc.resolve(pos),base=$pos.depth-depth,innerType=typesAfter&&typesAfter[typesAfter.length-1]||$pos.parent;if(base<0||$pos.parent.type.spec.isolating||!$pos.parent.canReplace($pos.index(),$pos.parent.childCount)||!innerType.type.validContent($pos.parent.content.cutByIndex($pos.index(),$pos.parent.childCount)))return!1;for(let d=$pos.depth-1,i=depth-2;d>base;d--,i--){let node=$pos.node(d),index=$pos.index(d);if(node.type.spec.isolating)return!1;let rest=node.content.cutByIndex(index,node.childCount),overrideChild=typesAfter&&typesAfter[i+1];overrideChild&&(rest=rest.replaceChild(0,overrideChild.type.create(overrideChild.attrs)));let after=typesAfter&&typesAfter[i]||node;if(!node.canReplace(index+1,node.childCount)||!after.type.validContent(rest))return!1}let index1=$pos.indexAfter(base),baseType=typesAfter&&typesAfter[0];return $pos.node(base).canReplaceWith(index1,index1,baseType?baseType.type:$pos.node(base+1).type)}function canJoin(doc,pos){let $pos=doc.resolve(pos),index=$pos.index();return joinable$1($pos.nodeBefore,$pos.nodeAfter)&&$pos.parent.canReplace(index,index+1)}function joinable$1(a,b){return!!(a&&b&&!a.isLeaf&&a.canAppend(b))}function joinPoint(doc,pos,dir=-1){let $pos=doc.resolve(pos);for(let d=$pos.depth;;d--){let before,after,index=$pos.index(d);if(d==$pos.depth?(before=$pos.nodeBefore,after=$pos.nodeAfter):dir>0?(before=$pos.node(d+1),index++,after=$pos.node(d).maybeChild(index)):(before=$pos.node(d).maybeChild(index-1),after=$pos.node(d+1)),before&&!before.isTextblock&&joinable$1(before,after)&&$pos.node(d).canReplace(index,index+1))return pos;if(0==d)break;pos=dir<0?$pos.before(d):$pos.after(d)}}function dropPoint(doc,pos,slice){let $pos=doc.resolve(pos);if(!slice.content.size)return pos;let content=slice.content;for(let i=0;i<slice.openStart;i++)content=content.firstChild.content;for(let pass=1;pass<=(0==slice.openStart&&slice.size?2:1);pass++)for(let d=$pos.depth;d>=0;d--){let bias=d==$pos.depth?0:$pos.pos<=($pos.start(d+1)+$pos.end(d+1))/2?-1:1,insertPos=$pos.index(d)+(bias>0?1:0),parent=$pos.node(d),fits=!1;if(1==pass)fits=parent.canReplace(insertPos,insertPos,content);else{let wrapping=parent.contentMatchAt(insertPos).findWrapping(content.firstChild.type);fits=wrapping&&parent.canReplaceWith(insertPos,insertPos,wrapping[0])}if(fits)return 0==bias?$pos.pos:bias<0?$pos.before(d+1):$pos.after(d+1)}return null}function replaceStep(doc,from,to=from,slice=Slice$2.empty){if(from==to&&!slice.size)return null;let $from=doc.resolve(from),$to=doc.resolve(to);return fitsTrivially($from,$to,slice)?new ReplaceStep(from,to,slice):new Fitter($from,$to,slice).fit()}function fitsTrivially($from,$to,slice){return!slice.openStart&&!slice.openEnd&&$from.start()==$to.start()&&$from.parent.canReplace($from.index(),$to.index(),slice.content)}Step.jsonID("replaceAround",ReplaceAroundStep);class Fitter{constructor($from,$to,unplaced){this.$from=$from,this.$to=$to,this.unplaced=unplaced,this.frontier=[],this.placed=Fragment$2.empty;for(let i=0;i<=$from.depth;i++){let node=$from.node(i);this.frontier.push({type:node.type,match:node.contentMatchAt($from.indexAfter(i))})}for(let i1=$from.depth;i1>0;i1--)this.placed=Fragment$2.from($from.node(i1).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let fit=this.findFittable();fit?this.placeNodes(fit):this.openMore()||this.dropNode()}let moveInline=this.mustMoveInline(),placedSize=this.placed.size-this.depth-this.$from.depth,$from=this.$from,$to=this.close(moveInline<0?this.$to:$from.doc.resolve(moveInline));if(!$to)return null;let content=this.placed,openStart=$from.depth,openEnd=$to.depth;for(;openStart&&openEnd&&1==content.childCount;)content=content.firstChild.content,openStart--,openEnd--;let slice=new Slice$2(content,openStart,openEnd);return moveInline>-1?new ReplaceAroundStep($from.pos,moveInline,this.$to.pos,this.$to.end(),slice,placedSize):slice.size||$from.pos!=this.$to.pos?new ReplaceStep($from.pos,$to.pos,slice):null}findFittable(){let startDepth=this.unplaced.openStart;for(let cur=this.unplaced.content,d=0,openEnd=this.unplaced.openEnd;d<startDepth;d++){let node=cur.firstChild;if(cur.childCount>1&&(openEnd=0),node.type.spec.isolating&&openEnd<=d){startDepth=d;break}cur=node.content}for(let pass=1;pass<=2;pass++)for(let sliceDepth=1==pass?startDepth:this.unplaced.openStart;sliceDepth>=0;sliceDepth--){let parent=null,first=(sliceDepth?(parent=contentAt(this.unplaced.content,sliceDepth-1).firstChild).content:this.unplaced.content).firstChild;for(let frontierDepth=this.depth;frontierDepth>=0;frontierDepth--){let{type,match}=this.frontier[frontierDepth],wrap,inject=null;if(1==pass&&(first?match.matchType(first.type)||(inject=match.fillBefore(Fragment$2.from(first),!1)):parent&&type.compatibleContent(parent.type)))return{sliceDepth,frontierDepth,parent,inject};if(2==pass&&first&&(wrap=match.findWrapping(first.type)))return{sliceDepth,frontierDepth,parent,wrap};if(parent&&match.matchType(parent.type))break}}}openMore(){let{content,openStart,openEnd}=this.unplaced,inner=contentAt(content,openStart);return!!inner.childCount&&!inner.firstChild.isLeaf&&(this.unplaced=new Slice$2(content,openStart+1,Math.max(openEnd,inner.size+openStart>=content.size-openEnd?openStart+1:0)),!0)}dropNode(){let{content,openStart,openEnd}=this.unplaced,inner=contentAt(content,openStart);if(inner.childCount<=1&&openStart>0){let openAtEnd=content.size-openStart<=openStart+inner.size;this.unplaced=new Slice$2(dropFromFragment(content,openStart-1,1),openStart-1,openAtEnd?openStart-1:openEnd)}else this.unplaced=new Slice$2(dropFromFragment(content,openStart,1),openStart,openEnd)}placeNodes({sliceDepth,frontierDepth,parent,inject,wrap}){for(;this.depth>frontierDepth;)this.closeFrontierNode();if(wrap)for(let i=0;i<wrap.length;i++)this.openFrontierNode(wrap[i]);let slice=this.unplaced,fragment=parent?parent.content:slice.content,openStart=slice.openStart-sliceDepth,taken=0,add=[],{match,type}=this.frontier[frontierDepth];if(inject){for(let i1=0;i1<inject.childCount;i1++)add.push(inject.child(i1));match=match.matchFragment(inject)}let openEndCount=fragment.size+sliceDepth-(slice.content.size-slice.openEnd);for(;taken<fragment.childCount;){let next=fragment.child(taken),matches=match.matchType(next.type);if(!matches)break;(++taken>1||0==openStart||next.content.size)&&(match=matches,add.push(function closeNodeStart(node,openStart,openEnd){if(openStart<=0)return node;let frag=node.content;return openStart>1&&(frag=frag.replaceChild(0,closeNodeStart(frag.firstChild,openStart-1,1==frag.childCount?openEnd-1:0))),openStart>0&&(frag=node.type.contentMatch.fillBefore(frag).append(frag),openEnd<=0&&(frag=frag.append(node.type.contentMatch.matchFragment(frag).fillBefore(Fragment$2.empty,!0)))),node.copy(frag)}(next.mark(type.allowedMarks(next.marks)),1==taken?openStart:0,taken==fragment.childCount?openEndCount:-1)))}let toEnd=taken==fragment.childCount;toEnd||(openEndCount=-1),this.placed=addToFragment(this.placed,frontierDepth,Fragment$2.from(add)),this.frontier[frontierDepth].match=match,toEnd&&openEndCount<0&&parent&&parent.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let i2=0,cur=fragment;i2<openEndCount;i2++){let node=cur.lastChild;this.frontier.push({type:node.type,match:node.contentMatchAt(node.childCount)}),cur=node.content}this.unplaced=toEnd?0==sliceDepth?Slice$2.empty:new Slice$2(dropFromFragment(slice.content,sliceDepth-1,1),sliceDepth-1,openEndCount<0?slice.openEnd:sliceDepth-1):new Slice$2(dropFromFragment(slice.content,sliceDepth,taken),slice.openStart,slice.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return -1;let top=this.frontier[this.depth],level;if(!top.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,top.type,top.match,!1)||this.$to.depth==this.depth&&(level=this.findCloseLevel(this.$to))&&level.depth==this.depth)return -1;let{depth}=this.$to,after=this.$to.after(depth);for(;depth>1&&after==this.$to.end(--depth);)++after;return after}findCloseLevel($to){scan:for(let i=Math.min(this.depth,$to.depth);i>=0;i--){let{match,type}=this.frontier[i],dropInner=i<$to.depth&&$to.end(i+1)==$to.pos+($to.depth-(i+1)),fit=contentAfterFits($to,i,type,match,dropInner);if(fit){for(let d=i-1;d>=0;d--){let{match:match1,type:type1}=this.frontier[d],matches=contentAfterFits($to,d,type1,match1,!0);if(!matches||matches.childCount)continue scan}return{depth:i,fit,move:dropInner?$to.doc.resolve($to.after(i+1)):$to}}}}close($to){let close=this.findCloseLevel($to);if(!close)return null;for(;this.depth>close.depth;)this.closeFrontierNode();close.fit.childCount&&(this.placed=addToFragment(this.placed,close.depth,close.fit)),$to=close.move;for(let d=close.depth+1;d<=$to.depth;d++){let node=$to.node(d),add=node.type.contentMatch.fillBefore(node.content,!0,$to.index(d));this.openFrontierNode(node.type,node.attrs,add)}return $to}openFrontierNode(type,attrs=null,content){let top=this.frontier[this.depth];top.match=top.match.matchType(type),this.placed=addToFragment(this.placed,this.depth,Fragment$2.from(type.create(attrs,content))),this.frontier.push({type,match:type.contentMatch})}closeFrontierNode(){let add=this.frontier.pop().match.fillBefore(Fragment$2.empty,!0);add.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,add))}}function dropFromFragment(fragment,depth,count){return 0==depth?fragment.cutByIndex(count,fragment.childCount):fragment.replaceChild(0,fragment.firstChild.copy(dropFromFragment(fragment.firstChild.content,depth-1,count)))}function addToFragment(fragment,depth,content){return 0==depth?fragment.append(content):fragment.replaceChild(fragment.childCount-1,fragment.lastChild.copy(addToFragment(fragment.lastChild.content,depth-1,content)))}function contentAt(fragment,depth){for(let i=0;i<depth;i++)fragment=fragment.firstChild.content;return fragment}function contentAfterFits($to,depth,type,match,open){let node=$to.node(depth),index=open?$to.indexAfter(depth):$to.index(depth);if(index==node.childCount&&!type.compatibleContent(node.type))return null;let fit=match.fillBefore(node.content,!0,index);return fit&&!function(type,fragment,start){for(let i=start;i<fragment.childCount;i++)if(!type.allowsMarks(fragment.child(i).marks))return!0;return!1}(type,node.content,index)?fit:null}function coveredDepths($from,$to){let result=[],minDepth=Math.min($from.depth,$to.depth);for(let d=minDepth;d>=0;d--){let start=$from.start(d);if(start<$from.pos-($from.depth-d)||$to.end(d)>$to.pos+($to.depth-d)||$from.node(d).type.spec.isolating||$to.node(d).type.spec.isolating)break;(start==$to.start(d)||d==$from.depth&&d==$to.depth&&$from.parent.inlineContent&&$to.parent.inlineContent&&d&&$to.start(d-1)==start-1)&&result.push(d)}return result}class AttrStep extends Step{constructor(pos,attr,value){super(),this.pos=pos,this.attr=attr,this.value=value}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at attribute step's position");let attrs=Object.create(null);for(let name in node.attrs)attrs[name]=node.attrs[name];attrs[this.attr]=this.value;let updated=node.type.create(attrs,null,node.marks);return StepResult.fromReplace(doc,this.pos,this.pos+1,new Slice$2(Fragment$2.from(updated),0,node.isLeaf?0:1))}getMap(){return StepMap.empty}invert(doc){return new AttrStep(this.pos,this.attr,doc.nodeAt(this.pos).attrs[this.attr])}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new AttrStep(pos.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(schema,json){if("number"!=typeof json.pos||"string"!=typeof json.attr)throw RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(json.pos,json.attr,json.value)}}Step.jsonID("attr",AttrStep);let TransformError=class extends Error{};(TransformError=function TransformError(message){let err=Error.call(this,message);return err.__proto__=TransformError.prototype,err}).prototype=Object.create(Error.prototype),TransformError.prototype.constructor=TransformError,TransformError.prototype.name="TransformError";class Transform{constructor(doc){this.doc=doc,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(step){let result=this.maybeStep(step);if(result.failed)throw new TransformError(result.failed);return this}maybeStep(step){let result=step.apply(this.doc);return result.failed||this.addStep(step,result.doc),result}get docChanged(){return this.steps.length>0}addStep(step,doc){this.docs.push(this.doc),this.steps.push(step),this.mapping.appendMap(step.getMap()),this.doc=doc}replace(from,to=from,slice=Slice$2.empty){let step=replaceStep(this.doc,from,to,slice);return step&&this.step(step),this}replaceWith(from,to,content){return this.replace(from,to,new Slice$2(Fragment$2.from(content),0,0))}delete(from,to){return this.replace(from,to,Slice$2.empty)}insert(pos,content){return this.replaceWith(pos,pos,content)}replaceRange(from,to,slice){return!function(tr,from,to,slice){if(!slice.size)return tr.deleteRange(from,to);let $from=tr.doc.resolve(from),$to=tr.doc.resolve(to);if(fitsTrivially($from,$to,slice))return tr.step(new ReplaceStep(from,to,slice));let targetDepths=coveredDepths($from,tr.doc.resolve(to));0==targetDepths[targetDepths.length-1]&&targetDepths.pop();let preferredTarget=-($from.depth+1);targetDepths.unshift(preferredTarget);for(let d=$from.depth,pos=$from.pos-1;d>0;d--,pos--){let spec=$from.node(d).type.spec;if(spec.defining||spec.definingAsContext||spec.isolating)break;targetDepths.indexOf(d)>-1?preferredTarget=d:$from.before(d)==pos&&targetDepths.splice(1,0,-d)}let preferredTargetIndex=targetDepths.indexOf(preferredTarget),leftNodes=[],preferredDepth=slice.openStart;for(let content=slice.content,i=0;;i++){let node=content.firstChild;if(leftNodes.push(node),i==slice.openStart)break;content=node.content}for(let d1=preferredDepth-1;d1>=0;d1--){let type=leftNodes[d1].type,def=type.spec.defining||type.spec.definingForContent;if(def&&$from.node(preferredTargetIndex).type!=type)preferredDepth=d1;else if(def||!type.isTextblock)break}for(let j=slice.openStart;j>=0;j--){let openDepth=(j+preferredDepth+1)%(slice.openStart+1),insert=leftNodes[openDepth];if(insert)for(let i1=0;i1<targetDepths.length;i1++){let targetDepth=targetDepths[(i1+preferredTargetIndex)%targetDepths.length],expand=!0;targetDepth<0&&(expand=!1,targetDepth=-targetDepth);let parent=$from.node(targetDepth-1),index=$from.index(targetDepth-1);if(parent.canReplaceWith(index,index,insert.type,insert.marks))return tr.replace($from.before(targetDepth),expand?$to.after(targetDepth):to,new Slice$2(function closeFragment(fragment,depth,oldOpen,newOpen,parent){if(depth<oldOpen){let first=fragment.firstChild;fragment=fragment.replaceChild(0,first.copy(closeFragment(first.content,depth+1,oldOpen,newOpen,first)))}if(depth>newOpen){let match=parent.contentMatchAt(0),start=match.fillBefore(fragment).append(fragment);fragment=start.append(match.matchFragment(start).fillBefore(Fragment$2.empty,!0))}return fragment}(slice.content,0,slice.openStart,openDepth),openDepth,slice.openEnd))}}let startSteps=tr.steps.length;for(let i2=targetDepths.length-1;i2>=0&&(tr.replace(from,to,slice),!(tr.steps.length>startSteps));i2--){let depth=targetDepths[i2];depth<0||(from=$from.before(depth),to=$to.after(depth))}}(this,from,to,slice),this}replaceRangeWith(from,to,node){return!function(tr,from,to,node){if(!node.isInline&&from==to&&tr.doc.resolve(from).parent.content.size){let point=function(doc,pos,nodeType){let $pos=doc.resolve(pos);if($pos.parent.canReplaceWith($pos.index(),$pos.index(),nodeType))return pos;if(0==$pos.parentOffset)for(let d=$pos.depth-1;d>=0;d--){let index=$pos.index(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.before(d+1);if(index>0)return null}if($pos.parentOffset==$pos.parent.content.size)for(let d1=$pos.depth-1;d1>=0;d1--){let index1=$pos.indexAfter(d1);if($pos.node(d1).canReplaceWith(index1,index1,nodeType))return $pos.after(d1+1);if(index1<$pos.node(d1).childCount)break}return null}(tr.doc,from,node.type);null!=point&&(from=to=point)}tr.replaceRange(from,to,new Slice$2(Fragment$2.from(node),0,0))}(this,from,to,node),this}deleteRange(from,to){return!function(tr,from,to){let $from=tr.doc.resolve(from),$to=tr.doc.resolve(to),covered=coveredDepths($from,$to);for(let i=0;i<covered.length;i++){let depth=covered[i],last=i==covered.length-1;if(last&&0==depth||$from.node(depth).type.contentMatch.validEnd)return tr.delete($from.start(depth),$to.end(depth));if(depth>0&&(last||$from.node(depth-1).canReplace($from.index(depth-1),$to.indexAfter(depth-1))))return tr.delete($from.before(depth),$to.after(depth))}for(let d=1;d<=$from.depth&&d<=$to.depth;d++)if(from-$from.start(d)==$from.depth-d&&to>$from.end(d)&&$to.end(d)-to!=$to.depth-d)return tr.delete($from.before(d),to);tr.delete(from,to)}(this,from,to),this}lift(range,target){return!function(tr,range,target){let{$from,$to,depth}=range,gapStart=$from.before(depth+1),gapEnd=$to.after(depth+1),start=gapStart,end=gapEnd,before=Fragment$2.empty,openStart=0;for(let d=depth,splitting=!1;d>target;d--)splitting||$from.index(d)>0?(splitting=!0,before=Fragment$2.from($from.node(d).copy(before)),openStart++):start--;let after=Fragment$2.empty,openEnd=0;for(let d1=depth,splitting1=!1;d1>target;d1--)splitting1||$to.after(d1+1)<$to.end(d1)?(splitting1=!0,after=Fragment$2.from($to.node(d1).copy(after)),openEnd++):end++;tr.step(new ReplaceAroundStep(start,end,gapStart,gapEnd,new Slice$2(before.append(after),openStart,openEnd),before.size-openStart,!0))}(this,range,target),this}join(pos,depth=1){return!function(tr,pos,depth){let step=new ReplaceStep(pos-depth,pos+depth,Slice$2.empty,!0);tr.step(step)}(this,pos,depth),this}wrap(range,wrappers){return!function(tr,range,wrappers){let content=Fragment$2.empty;for(let i=wrappers.length-1;i>=0;i--){if(content.size){let match=wrappers[i].type.contentMatch.matchFragment(content);if(!match||!match.validEnd)throw RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}content=Fragment$2.from(wrappers[i].type.create(wrappers[i].attrs,content))}let start=range.start,end=range.end;tr.step(new ReplaceAroundStep(start,end,start,end,new Slice$2(content,0,0),wrappers.length,!0))}(this,range,wrappers),this}setBlockType(from,to=from,type,attrs=null){return!function(tr,from,to,type,attrs){if(!type.isTextblock)throw RangeError("Type given to setBlockType should be a textblock");let mapFrom=tr.steps.length;tr.doc.nodesBetween(from,to,(node,pos)=>{var doc,pos1;let $pos,index;if(node.isTextblock&&!node.hasMarkup(type,attrs)&&(doc=tr.doc,pos1=tr.mapping.slice(mapFrom).map(pos),index=($pos=doc.resolve(pos1)).index(),$pos.parent.canReplaceWith(index,index+1,type))){tr.clearIncompatible(tr.mapping.slice(mapFrom).map(pos,1),type);let mapping=tr.mapping.slice(mapFrom),startM=mapping.map(pos,1),endM=mapping.map(pos+node.nodeSize,1);return tr.step(new ReplaceAroundStep(startM,endM,startM+1,endM-1,new Slice$2(Fragment$2.from(type.create(attrs,null,node.marks)),0,0),1,!0)),!1}})}(this,from,to,type,attrs),this}setNodeMarkup(pos,type,attrs=null,marks){return!function(tr,pos,type,attrs,marks){let node=tr.doc.nodeAt(pos);if(!node)throw RangeError("No node at given position");type||(type=node.type);let newNode=type.create(attrs,null,marks||node.marks);if(node.isLeaf)return tr.replaceWith(pos,pos+node.nodeSize,newNode);if(!type.validContent(node.content))throw RangeError("Invalid content for node type "+type.name);tr.step(new ReplaceAroundStep(pos,pos+node.nodeSize,pos+1,pos+node.nodeSize-1,new Slice$2(Fragment$2.from(newNode),0,0),1,!0))}(this,pos,type,attrs,marks),this}setNodeAttribute(pos,attr,value){return this.step(new AttrStep(pos,attr,value)),this}addNodeMark(pos,mark){return this.step(new AddNodeMarkStep(pos,mark)),this}removeNodeMark(pos,mark){if(!(mark instanceof Mark$3)){let node=this.doc.nodeAt(pos);if(!node)throw RangeError("No node at position "+pos);if(!(mark=mark.isInSet(node.marks)))return this}return this.step(new RemoveNodeMarkStep(pos,mark)),this}split(pos,depth=1,typesAfter){return!function(tr,pos,depth=1,typesAfter){let $pos=tr.doc.resolve(pos),before=Fragment$2.empty,after=Fragment$2.empty;for(let d=$pos.depth,e=$pos.depth-depth,i=depth-1;d>e;d--,i--){before=Fragment$2.from($pos.node(d).copy(before));let typeAfter=typesAfter&&typesAfter[i];after=Fragment$2.from(typeAfter?typeAfter.type.create(typeAfter.attrs,after):$pos.node(d).copy(after))}tr.step(new ReplaceStep(pos,pos,new Slice$2(before.append(after),depth,depth),!0))}(this,pos,depth,typesAfter),this}addMark(from,to,mark){var tr;let removing,adding,removed,added;return tr=this,removed=[],added=[],tr.doc.nodesBetween(from,to,(node,pos,parent)=>{if(!node.isInline)return;let marks=node.marks;if(!mark.isInSet(marks)&&parent.type.allowsMarkType(mark.type)){let start=Math.max(pos,from),end=Math.min(pos+node.nodeSize,to),newSet=mark.addToSet(marks);for(let i=0;i<marks.length;i++)marks[i].isInSet(newSet)||(removing&&removing.to==start&&removing.mark.eq(marks[i])?removing.to=end:removed.push(removing=new RemoveMarkStep(start,end,marks[i])));adding&&adding.to==start?adding.to=end:added.push(adding=new AddMarkStep(start,end,mark))}}),removed.forEach(s=>tr.step(s)),added.forEach(s=>tr.step(s)),this}removeMark(from,to,mark){var tr;let matched,step;return tr=this,matched=[],step=0,tr.doc.nodesBetween(from,to,(node,pos)=>{if(!node.isInline)return;step++;let toRemove=null;if(mark instanceof MarkType$1){let set=node.marks,found;for(;found=mark.isInSet(set);)(toRemove||(toRemove=[])).push(found),set=found.removeFromSet(set)}else mark?mark.isInSet(node.marks)&&(toRemove=[mark]):toRemove=node.marks;if(toRemove&&toRemove.length){let end=Math.min(pos+node.nodeSize,to);for(let i=0;i<toRemove.length;i++){let style=toRemove[i],found1;for(let j=0;j<matched.length;j++){let m=matched[j];m.step==step-1&&style.eq(matched[j].style)&&(found1=m)}found1?(found1.to=end,found1.step=step):matched.push({style,from:Math.max(pos,from),to:end,step})}}}),matched.forEach(m=>tr.step(new RemoveMarkStep(m.from,m.to,m.style))),this}clearIncompatible(pos,parentType,match){return!function(tr,pos,parentType,match=parentType.contentMatch){let node=tr.doc.nodeAt(pos),delSteps=[],cur=pos+1;for(let i=0;i<node.childCount;i++){let child=node.child(i),end=cur+child.nodeSize,allowed=match.matchType(child.type);if(allowed){match=allowed;for(let j=0;j<child.marks.length;j++)parentType.allowsMarkType(child.marks[j].type)||tr.step(new RemoveMarkStep(cur,end,child.marks[j]))}else delSteps.push(new ReplaceStep(cur,end,Slice$2.empty));cur=end}if(!match.validEnd){let fill=match.fillBefore(Fragment$2.empty,!0);tr.replace(cur,cur,new Slice$2(fill,0,0))}for(let i1=delSteps.length-1;i1>=0;i1--)tr.step(delSteps[i1])}(this,pos,parentType,match),this}}let classesById=Object.create(null);class Selection{constructor($anchor,$head,ranges){this.$anchor=$anchor,this.$head=$head,this.ranges=ranges||[new SelectionRange($anchor.min($head),$anchor.max($head))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let ranges=this.ranges;for(let i=0;i<ranges.length;i++)if(ranges[i].$from.pos!=ranges[i].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(tr,content=Slice$2.empty){let lastNode=content.content.lastChild,lastParent=null;for(let i=0;i<content.openEnd;i++)lastParent=lastNode,lastNode=lastNode.lastChild;let mapFrom=tr.steps.length,ranges=this.ranges;for(let i1=0;i1<ranges.length;i1++){let{$from,$to}=ranges[i1],mapping=tr.mapping.slice(mapFrom);tr.replaceRange(mapping.map($from.pos),mapping.map($to.pos),i1?Slice$2.empty:content),0==i1&&selectionToInsertionEnd$1(tr,mapFrom,(lastNode?lastNode.isInline:lastParent&&lastParent.isTextblock)?-1:1)}}replaceWith(tr,node){let mapFrom=tr.steps.length,ranges=this.ranges;for(let i=0;i<ranges.length;i++){let{$from,$to}=ranges[i],mapping=tr.mapping.slice(mapFrom),from=mapping.map($from.pos),to=mapping.map($to.pos);i?tr.deleteRange(from,to):(tr.replaceRangeWith(from,to,node),selectionToInsertionEnd$1(tr,mapFrom,node.isInline?-1:1))}}static findFrom($pos,dir,textOnly=!1){let inner=$pos.parent.inlineContent?new TextSelection($pos):findSelectionIn($pos.node(0),$pos.parent,$pos.pos,$pos.index(),dir,textOnly);if(inner)return inner;for(let depth=$pos.depth-1;depth>=0;depth--){let found=dir<0?findSelectionIn($pos.node(0),$pos.node(depth),$pos.before(depth+1),$pos.index(depth),dir,textOnly):findSelectionIn($pos.node(0),$pos.node(depth),$pos.after(depth+1),$pos.index(depth)+1,dir,textOnly);if(found)return found}return null}static near($pos,bias=1){return this.findFrom($pos,bias)||this.findFrom($pos,-bias)||new AllSelection($pos.node(0))}static atStart(doc){return findSelectionIn(doc,doc,0,0,1)||new AllSelection(doc)}static atEnd(doc){return findSelectionIn(doc,doc,doc.content.size,doc.childCount,-1)||new AllSelection(doc)}static fromJSON(doc,json){if(!json||!json.type)throw RangeError("Invalid input for Selection.fromJSON");let cls=classesById[json.type];if(!cls)throw RangeError(`No selection type ${json.type} defined`);return cls.fromJSON(doc,json)}static jsonID(id,selectionClass){if(id in classesById)throw RangeError("Duplicate use of selection JSON ID "+id);return classesById[id]=selectionClass,selectionClass.prototype.jsonID=id,selectionClass}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}Selection.prototype.visible=!0;class SelectionRange{constructor($from,$to){this.$from=$from,this.$to=$to}}let warnedAboutTextSelection=!1;function checkTextSelection($pos){warnedAboutTextSelection||$pos.parent.inlineContent||(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+$pos.parent.type.name+")"))}class TextSelection extends Selection{constructor($anchor,$head=$anchor){checkTextSelection($anchor),checkTextSelection($head),super($anchor,$head)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(doc,mapping){let $head=doc.resolve(mapping.map(this.head));if(!$head.parent.inlineContent)return Selection.near($head);let $anchor=doc.resolve(mapping.map(this.anchor));return new TextSelection($anchor.parent.inlineContent?$anchor:$head,$head)}replace(tr,content=Slice$2.empty){if(super.replace(tr,content),content==Slice$2.empty){let marks=this.$from.marksAcross(this.$to);marks&&tr.ensureMarks(marks)}}eq(other){return other instanceof TextSelection&&other.anchor==this.anchor&&other.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(doc,json){if("number"!=typeof json.anchor||"number"!=typeof json.head)throw RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(doc.resolve(json.anchor),doc.resolve(json.head))}static create(doc,anchor,head=anchor){let $anchor=doc.resolve(anchor);return new this($anchor,head==anchor?$anchor:doc.resolve(head))}static between($anchor,$head,bias){let dPos=$anchor.pos-$head.pos;if((!bias||dPos)&&(bias=dPos>=0?1:-1),!$head.parent.inlineContent){let found=Selection.findFrom($head,bias,!0)||Selection.findFrom($head,-bias,!0);if(!found)return Selection.near($head,bias);$head=found.$head}return $anchor.parent.inlineContent||(0==dPos?$anchor=$head:($anchor=(Selection.findFrom($anchor,-bias,!0)||Selection.findFrom($anchor,bias,!0)).$anchor).pos<$head.pos==dPos<0||($anchor=$head)),new TextSelection($anchor,$head)}}Selection.jsonID("text",TextSelection);class TextBookmark{constructor(anchor,head){this.anchor=anchor,this.head=head}map(mapping){return new TextBookmark(mapping.map(this.anchor),mapping.map(this.head))}resolve(doc){return TextSelection.between(doc.resolve(this.anchor),doc.resolve(this.head))}}class NodeSelection extends Selection{constructor($pos){let node=$pos.nodeAfter;super($pos,$pos.node(0).resolve($pos.pos+node.nodeSize)),this.node=node}map(doc,mapping){let{deleted,pos}=mapping.mapResult(this.anchor),$pos=doc.resolve(pos);return deleted?Selection.near($pos):new NodeSelection($pos)}content(){return new Slice$2(Fragment$2.from(this.node),0,0)}eq(other){return other instanceof NodeSelection&&other.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(doc,json){if("number"!=typeof json.anchor)throw RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(doc.resolve(json.anchor))}static create(doc,from){return new NodeSelection(doc.resolve(from))}static isSelectable(node){return!node.isText&&!1!==node.type.spec.selectable}}NodeSelection.prototype.visible=!1,Selection.jsonID("node",NodeSelection);class NodeBookmark{constructor(anchor){this.anchor=anchor}map(mapping){let{deleted,pos}=mapping.mapResult(this.anchor);return deleted?new TextBookmark(pos,pos):new NodeBookmark(pos)}resolve(doc){let $pos=doc.resolve(this.anchor),node=$pos.nodeAfter;return node&&NodeSelection.isSelectable(node)?new NodeSelection($pos):Selection.near($pos)}}class AllSelection extends Selection{constructor(doc){super(doc.resolve(0),doc.resolve(doc.content.size))}replace(tr,content=Slice$2.empty){if(content==Slice$2.empty){tr.delete(0,tr.doc.content.size);let sel=Selection.atStart(tr.doc);sel.eq(tr.selection)||tr.setSelection(sel)}else super.replace(tr,content)}toJSON(){return{type:"all"}}static fromJSON(doc){return new AllSelection(doc)}map(doc){return new AllSelection(doc)}eq(other){return other instanceof AllSelection}getBookmark(){return AllBookmark}}Selection.jsonID("all",AllSelection);let AllBookmark={map(){return this},resolve:doc=>new AllSelection(doc)};function findSelectionIn(doc,node,pos,index,dir,text=!1){if(node.inlineContent)return TextSelection.create(doc,pos);for(let i=index-(dir>0?0:1);dir>0?i<node.childCount:i>=0;i+=dir){let child=node.child(i);if(child.isAtom){if(!text&&NodeSelection.isSelectable(child))return NodeSelection.create(doc,pos-(dir<0?child.nodeSize:0))}else{let inner=findSelectionIn(doc,child,pos+dir,dir<0?child.childCount:0,dir,text);if(inner)return inner}pos+=child.nodeSize*dir}return null}function selectionToInsertionEnd$1(tr,startLen,bias){let end,last=tr.steps.length-1;if(last<startLen)return;let step=tr.steps[last];(step instanceof ReplaceStep||step instanceof ReplaceAroundStep)&&(tr.mapping.maps[last].forEach((_from,_to,_newFrom,newTo)=>{null==end&&(end=newTo)}),tr.setSelection(Selection.near(tr.doc.resolve(end),bias)))}class Transaction extends Transform{constructor(state){super(state.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=state.selection,this.storedMarks=state.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(selection){if(selection.$from.doc!=this.doc)throw RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=selection,this.curSelectionFor=this.steps.length,this.updated=(1|this.updated)&-3,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(marks){return this.storedMarks=marks,this.updated|=2,this}ensureMarks(marks){return Mark$3.sameSet(this.storedMarks||this.selection.$from.marks(),marks)||this.setStoredMarks(marks),this}addStoredMark(mark){return this.ensureMarks(mark.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(mark){return this.ensureMarks(mark.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(step,doc){super.addStep(step,doc),this.updated=-3&this.updated,this.storedMarks=null}setTime(time){return this.time=time,this}replaceSelection(slice){return this.selection.replace(this,slice),this}replaceSelectionWith(node,inheritMarks=!0){let selection=this.selection;return inheritMarks&&(node=node.mark(this.storedMarks||(selection.empty?selection.$from.marks():selection.$from.marksAcross(selection.$to)||Mark$3.none))),selection.replaceWith(this,node),this}deleteSelection(){return this.selection.replace(this),this}insertText(text,from,to){let schema=this.doc.type.schema;if(null==from)return text?this.replaceSelectionWith(schema.text(text),!0):this.deleteSelection();{if(null==to&&(to=from),to=null==to?from:to,!text)return this.deleteRange(from,to);let marks=this.storedMarks;if(!marks){let $from=this.doc.resolve(from);marks=to==from?$from.marks():$from.marksAcross(this.doc.resolve(to))}return this.replaceRangeWith(from,to,schema.text(text,marks)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}}setMeta(key,value){return this.meta["string"==typeof key?key:key.key]=value,this}getMeta(key){return this.meta["string"==typeof key?key:key.key]}get isGeneric(){for(let _ in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function bind(f,self1){return self1&&f?f.bind(self1):f}class FieldDesc{constructor(name,desc,self1){this.name=name,this.init=bind(desc.init,self1),this.apply=bind(desc.apply,self1)}}let baseFields=[new FieldDesc("doc",{init:config=>config.doc||config.schema.topNodeType.createAndFill(),apply:tr=>tr.doc}),new FieldDesc("selection",{init:(config,instance)=>config.selection||Selection.atStart(instance.doc),apply:tr=>tr.selection}),new FieldDesc("storedMarks",{init:config=>config.storedMarks||null,apply:(tr,_marks,_old,state)=>state.selection.$cursor?tr.storedMarks:null}),new FieldDesc("scrollToSelection",{init:()=>0,apply:(tr,prev)=>tr.scrolledIntoView?prev+1:prev})];class Configuration{constructor(schema,plugins){this.schema=schema,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),plugins&&plugins.forEach(plugin=>{if(this.pluginsByKey[plugin.key])throw RangeError("Adding different instances of a keyed plugin ("+plugin.key+")");this.plugins.push(plugin),this.pluginsByKey[plugin.key]=plugin,plugin.spec.state&&this.fields.push(new FieldDesc(plugin.key,plugin.spec.state,plugin))})}}class EditorState{constructor(config){this.config=config}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(tr){return this.applyTransaction(tr).state}filterTransaction(tr,ignore=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=ignore){let plugin=this.config.plugins[i];if(plugin.spec.filterTransaction&&!plugin.spec.filterTransaction.call(plugin,tr,this))return!1}return!0}applyTransaction(rootTr){if(!this.filterTransaction(rootTr))return{state:this,transactions:[]};let trs=[rootTr],newState=this.applyInner(rootTr),seen=null;for(;;){let haveNew=!1;for(let i=0;i<this.config.plugins.length;i++){let plugin=this.config.plugins[i];if(plugin.spec.appendTransaction){let n=seen?seen[i].n:0,oldState=seen?seen[i].state:this,tr=n<trs.length&&plugin.spec.appendTransaction.call(plugin,n?trs.slice(n):trs,oldState,newState);if(tr&&newState.filterTransaction(tr,i)){if(tr.setMeta("appendedTransaction",rootTr),!seen){seen=[];for(let j=0;j<this.config.plugins.length;j++)seen.push(j<i?{state:newState,n:trs.length}:{state:this,n:0})}trs.push(tr),newState=newState.applyInner(tr),haveNew=!0}seen&&(seen[i]={state:newState,n:trs.length})}}if(!haveNew)return{state:newState,transactions:trs}}}applyInner(tr){if(!tr.before.eq(this.doc))throw RangeError("Applying a mismatched transaction");let newInstance=new EditorState(this.config),fields=this.config.fields;for(let i=0;i<fields.length;i++){let field=fields[i];newInstance[field.name]=field.apply(tr,this[field.name],this,newInstance)}return newInstance}get tr(){return new Transaction(this)}static create(config){let $config=new Configuration(config.doc?config.doc.type.schema:config.schema,config.plugins),instance=new EditorState($config);for(let i=0;i<$config.fields.length;i++)instance[$config.fields[i].name]=$config.fields[i].init(config,instance);return instance}reconfigure(config){let $config=new Configuration(this.schema,config.plugins),fields=$config.fields,instance=new EditorState($config);for(let i=0;i<fields.length;i++){let name=fields[i].name;instance[name]=this.hasOwnProperty(name)?this[name]:fields[i].init(config,instance)}return instance}toJSON(pluginFields){let result={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(result.storedMarks=this.storedMarks.map(m=>m.toJSON())),pluginFields&&"object"==typeof pluginFields)for(let prop in pluginFields){if("doc"==prop||"selection"==prop)throw RangeError("The JSON fields `doc` and `selection` are reserved");let plugin=pluginFields[prop],state=plugin.spec.state;state&&state.toJSON&&(result[prop]=state.toJSON.call(plugin,this[plugin.key]))}return result}static fromJSON(config,json,pluginFields){if(!json)throw RangeError("Invalid input for EditorState.fromJSON");if(!config.schema)throw RangeError("Required config field 'schema' missing");let $config=new Configuration(config.schema,config.plugins),instance=new EditorState($config);return $config.fields.forEach(field=>{if("doc"==field.name)instance.doc=Node$2.fromJSON(config.schema,json.doc);else if("selection"==field.name)instance.selection=Selection.fromJSON(instance.doc,json.selection);else if("storedMarks"==field.name)json.storedMarks&&(instance.storedMarks=json.storedMarks.map(config.schema.markFromJSON));else{if(pluginFields)for(let prop in pluginFields){let plugin=pluginFields[prop],state=plugin.spec.state;if(plugin.key==field.name&&state&&state.fromJSON&&Object.prototype.hasOwnProperty.call(json,prop)){instance[field.name]=state.fromJSON.call(plugin,config,json[prop],instance);return}}instance[field.name]=field.init(config,instance)}}),instance}}class Plugin{constructor(spec){this.spec=spec,this.props={},spec.props&&function bindProps(obj,self1,target){for(let prop in obj){let val=obj[prop];val instanceof Function?val=val.bind(self1):"handleDOMEvents"==prop&&(val=bindProps(val,self1,{})),target[prop]=val}return target}(spec.props,this,this.props),this.key=spec.key?spec.key.key:createKey("plugin")}getState(state){return state[this.key]}}let keys=Object.create(null);function createKey(name){return name in keys?name+"$"+ ++keys[name]:(keys[name]=0,name+"$")}class PluginKey{constructor(name="key"){this.key=createKey(name)}get(state){return state.config.pluginsByKey[this.key]}getState(state){return state[this.key]}}class Fragment$1{constructor(content,size){if(this.content=content,this.size=size||0,null==size)for(let i=0;i<content.length;i++)this.size+=content[i].nodeSize}nodesBetween(from,to,f,nodeStart=0,parent){for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;if(end>from&&!1!==f(child,nodeStart+pos,parent||null,i)&&child.content.size){let start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}}descendants(f){this.nodesBetween(0,this.size,f)}textBetween(from,to,blockSeparator,leafText){let text="",separated=!0;return this.nodesBetween(from,to,(node,pos)=>{node.isText?(text+=node.text.slice(Math.max(from,pos)-pos,to-pos),separated=!blockSeparator):node.isLeaf?(leafText?text+="function"==typeof leafText?leafText(node):leafText:node.type.spec.leafText&&(text+=node.type.spec.leafText(node)),separated=!blockSeparator):!separated&&node.isBlock&&(text+=blockSeparator,separated=!0)},0),text}append(other){if(!other.size)return this;if(!this.size)return other;let last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment$1(content,this.size+other.size)}cut(from,to=this.size){if(0==from&&to==this.size)return this;let result=[],size=0;if(to>from)for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child=child.isText?child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment$1(result,size)}cutByIndex(from,to){return from==to?Fragment$1.empty:0==from&&to==this.content.length?this:new Fragment$1(this.content.slice(from,to))}replaceChild(index,node){let current=this.content[index];if(current==node)return this;let copy=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy[index]=node,new Fragment$1(copy,size)}addToStart(node){return new Fragment$1([node].concat(this.content),this.size+node.nodeSize)}addToEnd(node){return new Fragment$1(this.content.concat(node),this.size+node.nodeSize)}eq(other){if(this.content.length!=other.content.length)return!1;for(let i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(index){let found=this.content[index];if(!found)throw RangeError("Index "+index+" out of range for "+this);return found}maybeChild(index){return this.content[index]||null}forEach(f){for(let i=0,p=0;i<this.content.length;i++){let child=this.content[i];f(child,p,i),p+=child.nodeSize}}findDiffStart(other,pos=0){return function findDiffStart$1(a,b,pos){for(let i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;let childA=a.child(i),childB=b.child(i);if(childA==childB){pos+=childA.nodeSize;continue}if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(let j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){let inner=findDiffStart$1(childA.content,childB.content,pos+1);if(null!=inner)return inner}pos+=childA.nodeSize}}(this,other,pos)}findDiffEnd(other,pos=this.size,otherPos=other.size){return function findDiffEnd$1(a,b,posA,posB){for(let iA=a.childCount,iB=b.childCount;;){if(0==iA||0==iB)return iA==iB?null:{a:posA,b:posB};let childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA==childB){posA-=size,posB-=size;continue}if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){let same=0,minSize=Math.min(childA.text.length,childB.text.length);for(;same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){let inner=findDiffEnd$1(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}}(this,other,pos,otherPos)}findIndex(pos,round=-1){if(0==pos)return retIndex$1(0,pos);if(pos==this.size)return retIndex$1(this.content.length,pos);if(pos>this.size||pos<0)throw RangeError(`Position ${pos} outside of fragment (${this})`);for(let i=0,curPos=0;;i++){let end=curPos+this.child(i).nodeSize;if(end>=pos){if(end==pos||round>0)return retIndex$1(i+1,end);return retIndex$1(i,curPos)}curPos=end}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(n=>n.toJSON()):null}static fromJSON(schema,value){if(!value)return Fragment$1.empty;if(!Array.isArray(value))throw RangeError("Invalid input for Fragment.fromJSON");return new Fragment$1(value.map(schema.nodeFromJSON))}static fromArray(array){if(!array.length)return Fragment$1.empty;let joined,size=0;for(let i=0;i<array.length;i++){let node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment$1(joined||array,size)}static from(nodes){if(!nodes)return Fragment$1.empty;if(nodes instanceof Fragment$1)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment$1([nodes],nodes.nodeSize);throw RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment$1.empty=new Fragment$1([],0);let found$1={index:0,offset:0};function retIndex$1(index,offset){return found$1.index=index,found$1.offset=offset,found$1}class Mark$2{constructor(type,attrs){this.type=type,this.attrs=attrs}addToSet(set){let copy,placed=!1;for(let i=0;i<set.length;i++){let other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy||(copy=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy||(copy=set.slice(0,i)),copy.push(this),placed=!0),copy&&copy.push(other)}}return copy||(copy=set.slice()),placed||copy.push(this),copy}removeFromSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}isInSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}eq(other){return this==other||this.type==other.type&&function compareDeep$1(a,b){if(a===b)return!0;if(!(a&&"object"==typeof a)||!(b&&"object"==typeof b))return!1;let array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compareDeep$1(a[i],b[i]))return!1}else{for(let p in a)if(!(p in b)||!compareDeep$1(a[p],b[p]))return!1;for(let p1 in b)if(!(p1 in a))return!1}return!0}(this.attrs,other.attrs)}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return obj}static fromJSON(schema,json){if(!json)throw RangeError("Invalid input for Mark.fromJSON");let type=schema.marks[json.type];if(!type)throw RangeError(`There is no mark type ${json.type} in this schema`);return type.create(json.attrs)}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}static setFrom(marks){if(!marks||Array.isArray(marks)&&0==marks.length)return Mark$2.none;if(marks instanceof Mark$2)return[marks];let copy=marks.slice();return copy.sort((a,b)=>a.type.rank-b.type.rank),copy}}Mark$2.none=[];class Slice$1{constructor(content,openStart,openEnd){this.content=content,this.openStart=openStart,this.openEnd=openEnd}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(pos,fragment){let content=function insertInto$1(content,dist,insert,parent){let{index,offset}=content.findIndex(dist),child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));let inner=insertInto$1(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}(this.content,pos+this.openStart,fragment);return content&&new Slice$1(content,this.openStart,this.openEnd)}removeBetween(from,to){return new Slice$1(function removeRange$1(content,from,to){let{index,offset}=content.findIndex(from),child=content.maybeChild(index),{index:indexTo,offset:offsetTo}=content.findIndex(to);if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange$1(child.content,from-offset-1,to-offset-1)))}(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)}eq(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json}static fromJSON(schema,json){if(!json)return Slice$1.empty;let openStart=json.openStart||0,openEnd=json.openEnd||0;if("number"!=typeof openStart||"number"!=typeof openEnd)throw RangeError("Invalid input for Slice.fromJSON");return new Slice$1(Fragment$1.fromJSON(schema,json.content),openStart,openEnd)}static maxOpen(fragment,openIsolating=!0){let openStart=0,openEnd=0;for(let n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(let n1=fragment.lastChild;n1&&!n1.isLeaf&&(openIsolating||!n1.type.spec.isolating);n1=n1.lastChild)openEnd++;return new Slice$1(fragment,openStart,openEnd)}}Slice$1.empty=new Slice$1(Fragment$1.empty,0,0);class DOMParser$1{constructor(schema,rules){this.schema=schema,this.rules=rules,this.tags=[],this.styles=[],rules.forEach(rule=>{rule.tag?this.tags.push(rule):rule.style&&this.styles.push(rule)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let node=schema.nodes[r.node];return node.contentMatch.matchType(node)})}parse(dom,options={}){let context=new ParseContext$1(this,options,!1);return context.addAll(dom,options.from,options.to),context.finish()}parseSlice(dom,options={}){let context=new ParseContext$1(this,options,!0);return context.addAll(dom,options.from,options.to),Slice$1.maxOpen(context.finish())}matchTag(dom,context,after){for(let i=after?this.tags.indexOf(after)+1:0;i<this.tags.length;i++){var selector;let rule=this.tags[i];if(selector=rule.tag,(dom.matches||dom.msMatchesSelector||dom.webkitMatchesSelector||dom.mozMatchesSelector).call(dom,selector)&&(void 0===rule.namespace||dom.namespaceURI==rule.namespace)&&(!rule.context||context.matchesContext(rule.context))){if(rule.getAttrs){let result=rule.getAttrs(dom);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}matchStyle(prop,value,context,after){for(let i=after?this.styles.indexOf(after)+1:0;i<this.styles.length;i++){let rule=this.styles[i],style=rule.style;if(0==style.indexOf(prop)&&(!rule.context||context.matchesContext(rule.context))&&(!(style.length>prop.length)||61==style.charCodeAt(prop.length)&&style.slice(prop.length+1)==value)){if(rule.getAttrs){let result=rule.getAttrs(value);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}static schemaRules(schema){let result=[];function insert(rule){let priority=null==rule.priority?50:rule.priority,i=0;for(;i<result.length;i++){let next=result[i];if((null==next.priority?50:next.priority)<priority)break}result.splice(i,0,rule)}for(let name in schema.marks){let rules=schema.marks[name].spec.parseDOM;rules&&rules.forEach(rule=>{insert(rule=copy$2(rule)),rule.mark||rule.ignore||rule.clearMark||(rule.mark=name)})}for(let name1 in schema.nodes){let rules1=schema.nodes[name1].spec.parseDOM;rules1&&rules1.forEach(rule=>{insert(rule=copy$2(rule)),rule.node||rule.ignore||rule.mark||(rule.node=name1)})}return result}static fromSchema(schema){return schema.cached.domParser||(schema.cached.domParser=new DOMParser$1(schema,DOMParser$1.schemaRules(schema)))}}let blockTags$1={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags$1={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags$1={ol:!0,ul:!0};function wsOptionsFor$1(type,preserveWhitespace,base){return null!=preserveWhitespace?(preserveWhitespace?1:0)|("full"===preserveWhitespace?2:0):type&&"pre"==type.whitespace?3:-5&base}class NodeContext$1{constructor(type,attrs,marks,pendingMarks,solid,match,options){this.type=type,this.attrs=attrs,this.marks=marks,this.pendingMarks=pendingMarks,this.solid=solid,this.options=options,this.content=[],this.activeMarks=Mark$2.none,this.stashMarks=[],this.match=match||(4&options?null:type.contentMatch)}findWrapping(node){if(!this.match){if(!this.type)return[];let fill=this.type.contentMatch.fillBefore(Fragment$1.from(node));if(fill)this.match=this.type.contentMatch.matchFragment(fill);else{let start=this.type.contentMatch,wrap;return(wrap=start.findWrapping(node.type))?(this.match=start,wrap):null}}return this.match.findWrapping(node.type)}finish(openEnd){if(!(1&this.options)){let last=this.content[this.content.length-1],m;last&&last.isText&&(m=/[ \t\r\n\u000c]+$/.exec(last.text))&&(last.text.length==m[0].length?this.content.pop():this.content[this.content.length-1]=last.withText(last.text.slice(0,last.text.length-m[0].length)))}let content=Fragment$1.from(this.content);return!openEnd&&this.match&&(content=content.append(this.match.fillBefore(Fragment$1.empty,!0))),this.type?this.type.create(this.attrs,content,this.marks):content}popFromStashMark(mark){for(let i=this.stashMarks.length-1;i>=0;i--)if(mark.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]}applyPending(nextType){for(let i=0,pending=this.pendingMarks;i<pending.length;i++){let mark=pending[i];(this.type?this.type.allowsMarkType(mark.type):function(markType,nodeType){let nodes=nodeType.schema.nodes;for(let name in nodes){let parent=nodes[name];if(!parent.allowsMarkType(markType))continue;let seen=[],scan=match=>{seen.push(match);for(let i=0;i<match.edgeCount;i++){let{type,next}=match.edge(i);if(type==nodeType||0>seen.indexOf(next)&&scan(next))return!0}};if(scan(parent.contentMatch))return!0}}(mark.type,nextType))&&!mark.isInSet(this.activeMarks)&&(this.activeMarks=mark.addToSet(this.activeMarks),this.pendingMarks=mark.removeFromSet(this.pendingMarks))}}inlineContext(node){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:node.parentNode&&!blockTags$1.hasOwnProperty(node.parentNode.nodeName.toLowerCase())}}class ParseContext$1{constructor(parser,options,isOpen){this.parser=parser,this.options=options,this.isOpen=isOpen,this.open=0;let topNode=options.topNode,topContext,topOptions=wsOptionsFor$1(null,options.preserveWhitespace,0)|(isOpen?4:0);topContext=topNode?new NodeContext$1(topNode.type,topNode.attrs,Mark$2.none,Mark$2.none,!0,options.topMatch||topNode.type.contentMatch,topOptions):isOpen?new NodeContext$1(null,null,Mark$2.none,Mark$2.none,!0,null,topOptions):new NodeContext$1(parser.schema.topNodeType,null,Mark$2.none,Mark$2.none,!0,null,topOptions),this.nodes=[topContext],this.find=options.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(dom){if(3==dom.nodeType)this.addTextNode(dom);else if(1==dom.nodeType){let style=dom.getAttribute("style");if(style){let marks=this.readStyles(function(style){let re=/\s*([\w-]+)\s*:\s*([^;]+)/g,m,result=[];for(;m=re.exec(style);)result.push(m[1],m[2].trim());return result}(style));if(!marks)return;let[addMarks,removeMarks]=marks,top=this.top;for(let i=0;i<removeMarks.length;i++)this.removePendingMark(removeMarks[i],top);for(let i1=0;i1<addMarks.length;i1++)this.addPendingMark(addMarks[i1]);this.addElement(dom);for(let i2=0;i2<addMarks.length;i2++)this.removePendingMark(addMarks[i2],top);for(let i3=0;i3<removeMarks.length;i3++)this.addPendingMark(removeMarks[i3])}else this.addElement(dom)}}addTextNode(dom){let value=dom.nodeValue,top=this.top;if(2&top.options||top.inlineContext(dom)||/[^ \t\r\n\u000c]/.test(value)){if(1&top.options)value=2&top.options?value.replace(/\r\n?/g,"\n"):value.replace(/\r?\n|\r/g," ");else if(value=value.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(value)&&this.open==this.nodes.length-1){let nodeBefore=top.content[top.content.length-1],domNodeBefore=dom.previousSibling;(!nodeBefore||domNodeBefore&&"BR"==domNodeBefore.nodeName||nodeBefore.isText&&/[ \t\r\n\u000c]$/.test(nodeBefore.text))&&(value=value.slice(1))}value&&this.insertNode(this.parser.schema.text(value)),this.findInText(dom)}else this.findInside(dom)}addElement(dom,matchAfter){let name=dom.nodeName.toLowerCase(),ruleID;listTags$1.hasOwnProperty(name)&&this.parser.normalizeLists&&function(dom){for(let child=dom.firstChild,prevItem=null;child;child=child.nextSibling){let name=1==child.nodeType?child.nodeName.toLowerCase():null;name&&listTags$1.hasOwnProperty(name)&&prevItem?(prevItem.appendChild(child),child=prevItem):"li"==name?prevItem=child:name&&(prevItem=null)}}(dom);let rule=this.options.ruleFromNode&&this.options.ruleFromNode(dom)||(ruleID=this.parser.matchTag(dom,this,matchAfter));if(rule?rule.ignore:ignoreTags$1.hasOwnProperty(name))this.findInside(dom),this.ignoreFallback(dom);else if(!rule||rule.skip||rule.closeParent){rule&&rule.closeParent?this.open=Math.max(0,this.open-1):rule&&rule.skip.nodeType&&(dom=rule.skip);let sync,top=this.top,oldNeedsBlock=this.needsBlock;if(blockTags$1.hasOwnProperty(name))top.content.length&&top.content[0].isInline&&this.open&&(this.open--,top=this.top),sync=!0,top.type||(this.needsBlock=!0);else if(!dom.firstChild){this.leafFallback(dom);return}this.addAll(dom),sync&&this.sync(top),this.needsBlock=oldNeedsBlock}else this.addElementByRule(dom,rule,!1===rule.consuming?ruleID:void 0)}leafFallback(dom){"BR"==dom.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(dom.ownerDocument.createTextNode("\n"))}ignoreFallback(dom){"BR"!=dom.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(styles){let add=Mark$2.none,remove=Mark$2.none;for(let i=0;i<styles.length;i+=2)for(let after;;){let rule=this.parser.matchStyle(styles[i],styles[i+1],this,after);if(!rule)break;if(rule.ignore)return null;if(rule.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach(m=>{rule.clearMark(m)&&(remove=m.addToSet(remove))}):add=this.parser.schema.marks[rule.mark].create(rule.attrs).addToSet(add),!1===rule.consuming)after=rule;else break}return[add,remove]}addElementByRule(dom,rule,continueAfter){let sync,nodeType,mark;rule.node?(nodeType=this.parser.schema.nodes[rule.node]).isLeaf?this.insertNode(nodeType.create(rule.attrs))||this.leafFallback(dom):sync=this.enter(nodeType,rule.attrs||null,rule.preserveWhitespace):(mark=this.parser.schema.marks[rule.mark].create(rule.attrs),this.addPendingMark(mark));let startIn=this.top;if(nodeType&&nodeType.isLeaf)this.findInside(dom);else if(continueAfter)this.addElement(dom,continueAfter);else if(rule.getContent)this.findInside(dom),rule.getContent(dom,this.parser.schema).forEach(node=>this.insertNode(node));else{let contentDOM=dom;"string"==typeof rule.contentElement?contentDOM=dom.querySelector(rule.contentElement):"function"==typeof rule.contentElement?contentDOM=rule.contentElement(dom):rule.contentElement&&(contentDOM=rule.contentElement),this.findAround(dom,contentDOM,!0),this.addAll(contentDOM)}sync&&this.sync(startIn)&&this.open--,mark&&this.removePendingMark(mark,startIn)}addAll(parent,startIndex,endIndex){let index=startIndex||0;for(let dom=startIndex?parent.childNodes[startIndex]:parent.firstChild,end=null==endIndex?null:parent.childNodes[endIndex];dom!=end;dom=dom.nextSibling,++index)this.findAtPoint(parent,index),this.addDOM(dom);this.findAtPoint(parent,index)}findPlace(node){let route,sync;for(let depth=this.open;depth>=0;depth--){let cx=this.nodes[depth],found=cx.findWrapping(node);if(found&&(!route||route.length>found.length)&&(route=found,sync=cx,!found.length)||cx.solid)break}if(!route)return!1;this.sync(sync);for(let i=0;i<route.length;i++)this.enterInner(route[i],null,!1);return!0}insertNode(node){if(node.isInline&&this.needsBlock&&!this.top.type){let block=this.textblockFromContext();block&&this.enterInner(block)}if(this.findPlace(node)){this.closeExtra();let top=this.top;top.applyPending(node.type),top.match&&(top.match=top.match.matchType(node.type));let marks=top.activeMarks;for(let i=0;i<node.marks.length;i++)(!top.type||top.type.allowsMarkType(node.marks[i].type))&&(marks=node.marks[i].addToSet(marks));return top.content.push(node.mark(marks)),!0}return!1}enter(type,attrs,preserveWS){let ok=this.findPlace(type.create(attrs));return ok&&this.enterInner(type,attrs,!0,preserveWS),ok}enterInner(type,attrs=null,solid=!1,preserveWS){this.closeExtra();let top=this.top;top.applyPending(type),top.match=top.match&&top.match.matchType(type);let options=wsOptionsFor$1(type,preserveWS,top.options);4&top.options&&0==top.content.length&&(options|=4),this.nodes.push(new NodeContext$1(type,attrs,top.activeMarks,top.pendingMarks,solid,null,options)),this.open++}closeExtra(openEnd=!1){let i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(openEnd));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(to){for(let i=this.open;i>=0;i--)if(this.nodes[i]==to)return this.open=i,!0;return!1}get currentPos(){this.closeExtra();let pos=0;for(let i=this.open;i>=0;i--){let content=this.nodes[i].content;for(let j=content.length-1;j>=0;j--)pos+=content[j].nodeSize;i&&pos++}return pos}findAtPoint(parent,offset){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==parent&&this.find[i].offset==offset&&(this.find[i].pos=this.currentPos)}findInside(parent){if(this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)}findAround(parent,content,before){if(parent!=content&&this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&content.compareDocumentPosition(this.find[i].node)&(before?2:4)&&(this.find[i].pos=this.currentPos)}findInText(textNode){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==textNode&&(this.find[i].pos=this.currentPos-(textNode.nodeValue.length-this.find[i].offset))}matchesContext(context){if(context.indexOf("|")>-1)return context.split(/\s*\|\s*/).some(this.matchesContext,this);let parts=context.split("/"),option=this.options.context,useRoot=!this.isOpen&&(!option||option.parent.type==this.nodes[0].type),minDepth=-(option?option.depth+1:0)+(useRoot?0:1),match=(i,depth)=>{for(;i>=0;i--){let part=parts[i];if(""==part){if(i==parts.length-1||0==i)continue;for(;depth>=minDepth;depth--)if(match(i-1,depth))return!0;return!1}{let next=depth>0||0==depth&&useRoot?this.nodes[depth].type:option&&depth>=minDepth?option.node(depth-minDepth).type:null;if(!next||next.name!=part&&-1==next.groups.indexOf(part))return!1;depth--}}return!0};return match(parts.length-1,this.open)}textblockFromContext(){let $context=this.options.context;if($context)for(let d=$context.depth;d>=0;d--){let deflt=$context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;if(deflt&&deflt.isTextblock&&deflt.defaultAttrs)return deflt}for(let name in this.parser.schema.nodes){let type=this.parser.schema.nodes[name];if(type.isTextblock&&type.defaultAttrs)return type}}addPendingMark(mark){let found=function(mark,set){for(let i=0;i<set.length;i++)if(mark.eq(set[i]))return set[i]}(mark,this.top.pendingMarks);found&&this.top.stashMarks.push(found),this.top.pendingMarks=mark.addToSet(this.top.pendingMarks)}removePendingMark(mark,upto){for(let depth=this.open;depth>=0;depth--){let level=this.nodes[depth];if(level.pendingMarks.lastIndexOf(mark)>-1)level.pendingMarks=mark.removeFromSet(level.pendingMarks);else{level.activeMarks=mark.removeFromSet(level.activeMarks);let stashMark=level.popFromStashMark(mark);stashMark&&level.type&&level.type.allowsMarkType(stashMark.type)&&(level.activeMarks=stashMark.addToSet(level.activeMarks))}if(level==upto)break}}}function copy$2(obj){let copy={};for(let prop in obj)copy[prop]=obj[prop];return copy}class DOMSerializer$1{constructor(nodes,marks){this.nodes=nodes,this.marks=marks}serializeFragment(fragment,options={},target){target||(target=doc$2(options).createDocumentFragment());let top=target,active=[];return fragment.forEach(node=>{if(active.length||node.marks.length){let keep=0,rendered=0;for(;keep<active.length&&rendered<node.marks.length;){let next=node.marks[rendered];if(!this.marks[next.type.name]){rendered++;continue}if(!next.eq(active[keep][0])||!1===next.type.spec.spanning)break;keep++,rendered++}for(;keep<active.length;)top=active.pop()[1];for(;rendered<node.marks.length;){let add=node.marks[rendered++],markDOM=this.serializeMark(add,node.isInline,options);markDOM&&(active.push([add,top]),top.appendChild(markDOM.dom),top=markDOM.contentDOM||markDOM.dom)}}top.appendChild(this.serializeNodeInner(node,options))}),target}serializeNodeInner(node,options){let{dom,contentDOM}=DOMSerializer$1.renderSpec(doc$2(options),this.nodes[node.type.name](node));if(contentDOM){if(node.isLeaf)throw RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(node.content,options,contentDOM)}return dom}serializeNode(node,options={}){let dom=this.serializeNodeInner(node,options);for(let i=node.marks.length-1;i>=0;i--){let wrap=this.serializeMark(node.marks[i],node.isInline,options);wrap&&((wrap.contentDOM||wrap.dom).appendChild(dom),dom=wrap.dom)}return dom}serializeMark(mark,inline,options={}){let toDOM=this.marks[mark.type.name];return toDOM&&DOMSerializer$1.renderSpec(doc$2(options),toDOM(mark,inline))}static renderSpec(doc,structure,xmlNS=null){let contentDOM;if("string"==typeof structure)return{dom:doc.createTextNode(structure)};if(null!=structure.nodeType)return{dom:structure};if(structure.dom&&null!=structure.dom.nodeType)return structure;let tagName=structure[0],space=tagName.indexOf(" ");space>0&&(xmlNS=tagName.slice(0,space),tagName=tagName.slice(space+1));let dom=xmlNS?doc.createElementNS(xmlNS,tagName):doc.createElement(tagName),attrs=structure[1],start=1;if(attrs&&"object"==typeof attrs&&null==attrs.nodeType&&!Array.isArray(attrs)){for(let name in start=2,attrs)if(null!=attrs[name]){let space1=name.indexOf(" ");space1>0?dom.setAttributeNS(name.slice(0,space1),name.slice(space1+1),attrs[name]):dom.setAttribute(name,attrs[name])}}for(let i=start;i<structure.length;i++){let child=structure[i];if(0===child){if(i<structure.length-1||i>start)throw RangeError("Content hole must be the only child of its parent node");return{dom,contentDOM:dom}}{let{dom:inner,contentDOM:innerContent}=DOMSerializer$1.renderSpec(doc,child,xmlNS);if(dom.appendChild(inner),innerContent){if(contentDOM)throw RangeError("Multiple content holes");contentDOM=innerContent}}}return{dom,contentDOM}}static fromSchema(schema){return schema.cached.domSerializer||(schema.cached.domSerializer=new DOMSerializer$1(this.nodesFromSchema(schema),this.marksFromSchema(schema)))}static nodesFromSchema(schema){let result=gatherToDOM$1(schema.nodes);return result.text||(result.text=node=>node.text),result}static marksFromSchema(schema){return gatherToDOM$1(schema.marks)}}function gatherToDOM$1(obj){let result={};for(let name in obj){let toDOM=obj[name].spec.toDOM;toDOM&&(result[name]=toDOM)}return result}function doc$2(options){return options.document||window.document}let domIndex=function(node){for(var index=0;;index++)if(!(node=node.previousSibling))return index},parentNode=function(node){let parent=node.assignedSlot||node.parentNode;return parent&&11==parent.nodeType?parent.host:parent},reusedRange=null,textRange=function(node,from,to){let range=reusedRange||(reusedRange=document.createRange());return range.setEnd(node,null==to?node.nodeValue.length:to),range.setStart(node,from||0),range},isEquivalentPosition=function(node,off,targetNode,targetOff){return targetNode&&(scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(dir<0?0:nodeSize(node))){let parent=node.parentNode;if(!parent||1!=parent.nodeType||function(dom){let desc;for(let cur=dom;cur&&!(desc=cur.pmViewDesc);cur=cur.parentNode);return desc&&desc.node&&desc.node.isBlock&&(desc.dom==dom||desc.contentDOM==dom)}(node)||atomElements.test(node.nodeName)||"false"==node.contentEditable)return!1;off=domIndex(node)+(dir<0?0:1),node=parent}else{if(1!=node.nodeType||"false"==(node=node.childNodes[off+(dir<0?-1:0)]).contentEditable)return!1;off=dir<0?nodeSize(node):0}}}function nodeSize(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}let selectionCollapsed=function(domSel){return domSel.focusNode&&isEquivalentPosition(domSel.focusNode,domSel.focusOffset,domSel.anchorNode,domSel.anchorOffset)};function keyEvent(keyCode,key){let event=document.createEvent("Event");return event.initEvent("keydown",!0,!0),event.keyCode=keyCode,event.key=event.code=key,event}let nav="undefined"!=typeof navigator?navigator:null,doc$1="undefined"!=typeof document?document:null,agent=nav&&nav.userAgent||"",ie_edge=/Edge\/(\d+)/.exec(agent),ie_upto10=/MSIE \d/.exec(agent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie$1=!!(ie_upto10||ie_11up||ie_edge),ie_version=ie_upto10?document.documentMode:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko=!ie$1&&/gecko\/(\d+)/i.test(agent);gecko&&(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];let _chrome=!ie$1&&/Chrome\/(\d+)/.exec(agent),chrome=!!_chrome,chrome_version=_chrome?+_chrome[1]:0,safari=!ie$1&&!!nav&&/Apple Computer/.test(nav.vendor),ios=safari&&(/Mobile\/\w+/.test(agent)||!!nav&&nav.maxTouchPoints>2),mac$2=ios||!!nav&&/Mac/.test(nav.platform),windows=!!nav&&/Win/.test(nav.platform),android=/Android \d/.test(agent),webkit=!!doc$1&&"webkitFontSmoothing"in doc$1.documentElement.style,webkit_version=webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function getSide(value,side){return"number"==typeof value?value:value[side]}function scrollRectIntoView(view,rect,startDOM){let scrollThreshold=view.someProp("scrollThreshold")||0,scrollMargin=view.someProp("scrollMargin")||5,doc=view.dom.ownerDocument;for(let parent=startDOM||view.dom;parent;parent=parentNode(parent)){if(1!=parent.nodeType)continue;let elt=parent,atTop=elt==doc.body,bounding=atTop?{left:0,right:doc.documentElement.clientWidth,top:0,bottom:doc.documentElement.clientHeight}:function(node){let rect=node.getBoundingClientRect(),scaleX=rect.width/node.offsetWidth||1,scaleY=rect.height/node.offsetHeight||1;return{left:rect.left,right:rect.left+node.clientWidth*scaleX,top:rect.top,bottom:rect.top+node.clientHeight*scaleY}}(elt),moveX=0,moveY=0;if(rect.top<bounding.top+getSide(scrollThreshold,"top")?moveY=-(bounding.top-rect.top+getSide(scrollMargin,"top")):rect.bottom>bounding.bottom-getSide(scrollThreshold,"bottom")&&(moveY=rect.bottom-bounding.bottom+getSide(scrollMargin,"bottom")),rect.left<bounding.left+getSide(scrollThreshold,"left")?moveX=-(bounding.left-rect.left+getSide(scrollMargin,"left")):rect.right>bounding.right-getSide(scrollThreshold,"right")&&(moveX=rect.right-bounding.right+getSide(scrollMargin,"right")),moveX||moveY){if(atTop)doc.defaultView.scrollBy(moveX,moveY);else{let startX=elt.scrollLeft,startY=elt.scrollTop;moveY&&(elt.scrollTop+=moveY),moveX&&(elt.scrollLeft+=moveX);let dX=elt.scrollLeft-startX,dY=elt.scrollTop-startY;rect={left:rect.left-dX,top:rect.top-dY,right:rect.right-dX,bottom:rect.bottom-dY}}}if(atTop)break}}function scrollStack(dom){let stack=[],doc=dom.ownerDocument;for(let cur=dom;cur&&(stack.push({dom:cur,top:cur.scrollTop,left:cur.scrollLeft}),dom!=doc);cur=parentNode(cur));return stack}function restoreScrollStack(stack,dTop){for(let i=0;i<stack.length;i++){let{dom,top,left}=stack[i];dom.scrollTop!=top+dTop&&(dom.scrollTop=top+dTop),dom.scrollLeft!=left&&(dom.scrollLeft=left)}}let preventScrollSupported=null;function inRect(coords,rect){return coords.left>=rect.left-1&&coords.left<=rect.right+1&&coords.top>=rect.top-1&&coords.top<=rect.bottom+1}function nonZero(rect){return rect.top<rect.bottom||rect.left<rect.right}function singleRect(target,bias){let rects=target.getClientRects();if(rects.length){let first=rects[bias<0?0:rects.length-1];if(nonZero(first))return first}return Array.prototype.find.call(rects,nonZero)||target.getBoundingClientRect()}let BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(view,pos,side){let{node,offset,atom}=view.docView.domFromPos(pos,side<0?-1:1),supportEmptyRange=webkit||gecko;if(3==node.nodeType){if(supportEmptyRange&&(BIDI.test(node.nodeValue)||(side<0?!offset:offset==node.nodeValue.length))){let rect=singleRect(textRange(node,offset,offset),side);if(gecko&&offset&&/\s/.test(node.nodeValue[offset-1])&&offset<node.nodeValue.length){let rectBefore=singleRect(textRange(node,offset-1,offset-1),-1);if(rectBefore.top==rect.top){let rectAfter=singleRect(textRange(node,offset,offset+1),-1);if(rectAfter.top!=rect.top)return flattenV(rectAfter,rectAfter.left<rectBefore.left)}}return rect}{let from=offset,to=offset,takeSide=side<0?1:-1;return side<0&&!offset?(to++,takeSide=-1):side>=0&&offset==node.nodeValue.length?(from--,takeSide=1):side<0?from--:to++,flattenV(singleRect(textRange(node,from,to),takeSide),takeSide<0)}}if(!view.state.doc.resolve(pos-(atom||0)).parent.inlineContent){if(null==atom&&offset&&(side<0||offset==nodeSize(node))){let before=node.childNodes[offset-1];if(1==before.nodeType)return flattenH(before.getBoundingClientRect(),!1)}if(null==atom&&offset<nodeSize(node)){let after=node.childNodes[offset];if(1==after.nodeType)return flattenH(after.getBoundingClientRect(),!0)}return flattenH(node.getBoundingClientRect(),side>=0)}if(null==atom&&offset&&(side<0||offset==nodeSize(node))){let before1=node.childNodes[offset-1],target=3==before1.nodeType?textRange(before1,nodeSize(before1)-(supportEmptyRange?0:1)):1!=before1.nodeType||"BR"==before1.nodeName&&before1.nextSibling?null:before1;if(target)return flattenV(singleRect(target,1),!1)}if(null==atom&&offset<nodeSize(node)){let after1=node.childNodes[offset];for(;after1.pmViewDesc&&after1.pmViewDesc.ignoreForCoords;)after1=after1.nextSibling;let target1=after1?3==after1.nodeType?textRange(after1,0,supportEmptyRange?0:1):1==after1.nodeType?after1:null:null;if(target1)return flattenV(singleRect(target1,-1),!0)}return flattenV(singleRect(3==node.nodeType?textRange(node):node,-side),side>=0)}function flattenV(rect,left){if(0==rect.width)return rect;let x=left?rect.left:rect.right;return{top:rect.top,bottom:rect.bottom,left:x,right:x}}function flattenH(rect,top){if(0==rect.height)return rect;let y=top?rect.top:rect.bottom;return{top:y,bottom:y,left:rect.left,right:rect.right}}function withFlushedState(view,state,f){let viewState=view.state,active=view.root.activeElement;viewState!=state&&view.updateState(state),active!=view.dom&&view.focus();try{return f()}finally{viewState!=state&&view.updateState(viewState),active!=view.dom&&active&&active.focus()}}let maybeRTL=/[\u0590-\u08ac]/,cachedState=null,cachedDir=null,cachedResult=!1;class ViewDesc{constructor(parent,children,dom,contentDOM){this.parent=parent,this.children=children,this.dom=dom,this.contentDOM=contentDOM,this.dirty=0,dom.pmViewDesc=this}matchesWidget(widget){return!1}matchesMark(mark){return!1}matchesNode(node,outerDeco,innerDeco){return!1}matchesHack(nodeName){return!1}parseRule(){return null}stopEvent(event){return!1}get size(){let size=0;for(let i=0;i<this.children.length;i++)size+=this.children[i].size;return size}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let i=0;i<this.children.length;i++)this.children[i].destroy()}posBeforeChild(child){for(let i=0,pos=this.posAtStart;;i++){let cur=this.children[i];if(cur==child)return pos;pos+=cur.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(dom,offset,bias){let atEnd;if(this.contentDOM&&this.contentDOM.contains(1==dom.nodeType?dom:dom.parentNode)){if(bias<0){let domBefore,desc;if(dom==this.contentDOM)domBefore=dom.childNodes[offset-1];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domBefore=dom.previousSibling}for(;domBefore&&!((desc=domBefore.pmViewDesc)&&desc.parent==this);)domBefore=domBefore.previousSibling;return domBefore?this.posBeforeChild(desc)+desc.size:this.posAtStart}{let domAfter,desc1;if(dom==this.contentDOM)domAfter=dom.childNodes[offset];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domAfter=dom.nextSibling}for(;domAfter&&!((desc1=domAfter.pmViewDesc)&&desc1.parent==this);)domAfter=domAfter.nextSibling;return domAfter?this.posBeforeChild(desc1):this.posAtEnd}}if(dom==this.dom&&this.contentDOM)atEnd=offset>domIndex(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))atEnd=2&dom.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==offset)for(let search=dom;;search=search.parentNode){if(search==this.dom){atEnd=!1;break}if(search.previousSibling)break}if(null==atEnd&&offset==dom.childNodes.length)for(let search1=dom;;search1=search1.parentNode){if(search1==this.dom){atEnd=!0;break}if(search1.nextSibling)break}}return(null==atEnd?bias>0:atEnd)?this.posAtEnd:this.posAtStart}nearestDesc(dom,onlyNodes=!1){for(let first=!0,cur=dom;cur;cur=cur.parentNode){let desc=this.getDesc(cur),nodeDOM;if(desc&&(!onlyNodes||desc.node)){if(!first||!(nodeDOM=desc.nodeDOM)||(1==nodeDOM.nodeType?nodeDOM.contains(1==dom.nodeType?dom:dom.parentNode):nodeDOM==dom))return desc;first=!1}}}getDesc(dom){let desc=dom.pmViewDesc;for(let cur=desc;cur;cur=cur.parent)if(cur==this)return desc}posFromDOM(dom,offset,bias){for(let scan=dom;scan;scan=scan.parentNode){let desc=this.getDesc(scan);if(desc)return desc.localPosFromDOM(dom,offset,bias)}return -1}descAt(pos){for(let i=0,offset=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(offset==pos&&end!=offset){for(;!child.border&&child.children.length;)child=child.children[0];return child}if(pos<end)return child.descAt(pos-offset-child.border);offset=end}}domFromPos(pos,side){if(!this.contentDOM)return{node:this.dom,offset:0,atom:pos+1};let i=0,offset=0;for(let curPos=0;i<this.children.length;i++){let child=this.children[i],end=curPos+child.size;if(end>pos||child instanceof TrailingHackViewDesc){offset=pos-curPos;break}curPos=end}if(offset)return this.children[i].domFromPos(offset-this.children[i].border,side);for(let prev;i&&!(prev=this.children[i-1]).size&&prev instanceof WidgetViewDesc&&prev.side>=0;i--);if(side<=0){let prev1,enter=!0;for(;(prev1=i?this.children[i-1]:null)&&prev1.dom.parentNode!=this.contentDOM;i--,enter=!1);return prev1&&side&&enter&&!prev1.border&&!prev1.domAtom?prev1.domFromPos(prev1.size,side):{node:this.contentDOM,offset:prev1?domIndex(prev1.dom)+1:0}}{let next,enter1=!0;for(;(next=i<this.children.length?this.children[i]:null)&&next.dom.parentNode!=this.contentDOM;i++,enter1=!1);return next&&enter1&&!next.border&&!next.domAtom?next.domFromPos(0,side):{node:this.contentDOM,offset:next?domIndex(next.dom):this.contentDOM.childNodes.length}}}parseRange(from,to,base=0){if(0==this.children.length)return{node:this.contentDOM,from,to,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let fromOffset=-1,toOffset=-1;for(let offset=base,i=0;;i++){let child=this.children[i],end=offset+child.size;if(-1==fromOffset&&from<=end){let childBase=offset+child.border;if(from>=childBase&&to<=end-child.border&&child.node&&child.contentDOM&&this.contentDOM.contains(child.contentDOM))return child.parseRange(from,to,childBase);from=offset;for(let j=i;j>0;j--){let prev=this.children[j-1];if(prev.size&&prev.dom.parentNode==this.contentDOM&&!prev.emptyChildAt(1)){fromOffset=domIndex(prev.dom)+1;break}from-=prev.size}-1==fromOffset&&(fromOffset=0)}if(fromOffset>-1&&(end>to||i==this.children.length-1)){to=end;for(let j1=i+1;j1<this.children.length;j1++){let next=this.children[j1];if(next.size&&next.dom.parentNode==this.contentDOM&&!next.emptyChildAt(-1)){toOffset=domIndex(next.dom);break}to+=next.size}-1==toOffset&&(toOffset=this.contentDOM.childNodes.length);break}offset=end}return{node:this.contentDOM,from,to,fromOffset,toOffset}}emptyChildAt(side){if(this.border||!this.contentDOM||!this.children.length)return!1;let child=this.children[side<0?0:this.children.length-1];return 0==child.size||child.emptyChildAt(side)}domAfterPos(pos){let{node,offset}=this.domFromPos(pos,0);if(1!=node.nodeType||offset==node.childNodes.length)throw RangeError("No node after pos "+pos);return node.childNodes[offset]}setSelection(anchor,head,root,force=!1){let from=Math.min(anchor,head),to=Math.max(anchor,head);for(let i=0,offset=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(from>offset&&to<end)return child.setSelection(anchor-offset-child.border,head-offset-child.border,root,force);offset=end}let anchorDOM=this.domFromPos(anchor,anchor?-1:1),headDOM=head==anchor?anchorDOM:this.domFromPos(head,head?-1:1),domSel=root.getSelection(),brKludge=!1;if((gecko||safari)&&anchor==head){let{node,offset:offset1}=anchorDOM;if(3==node.nodeType)brKludge=!!(offset1&&"\n"==node.nodeValue[offset1-1]);else{let prev=node.childNodes[offset1-1];brKludge=prev&&("BR"==prev.nodeName||"false"==prev.contentEditable)}}if(gecko&&domSel.focusNode&&domSel.focusNode!=headDOM.node&&1==domSel.focusNode.nodeType){let after=domSel.focusNode.childNodes[domSel.focusOffset];after&&"false"==after.contentEditable&&(force=!0)}if(!(force||brKludge&&safari)&&isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)&&isEquivalentPosition(headDOM.node,headDOM.offset,domSel.focusNode,domSel.focusOffset))return;let domSelExtended=!1;if((domSel.extend||anchor==head)&&!brKludge){domSel.collapse(anchorDOM.node,anchorDOM.offset);try{anchor!=head&&domSel.extend(headDOM.node,headDOM.offset),domSelExtended=!0}catch(_){}}if(!domSelExtended){if(anchor>head){let tmp=anchorDOM;anchorDOM=headDOM,headDOM=tmp}let range=document.createRange();range.setEnd(headDOM.node,headDOM.offset),range.setStart(anchorDOM.node,anchorDOM.offset),domSel.removeAllRanges(),domSel.addRange(range)}}ignoreMutation(mutation){return!this.contentDOM&&"selection"!=mutation.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(from,to){for(let offset=0,i=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(offset==end?from<=end&&to>=offset:from<end&&to>offset){let startInside=offset+child.border,endInside=end-child.border;if(from>=startInside&&to<=endInside){this.dirty=from==offset||to==end?2:1,from==startInside&&to==endInside&&(child.contentLost||child.dom.parentNode!=this.contentDOM)?child.dirty=3:child.markDirty(from-startInside,to-startInside);return}child.dirty=child.dom!=child.contentDOM||child.dom.parentNode!=this.contentDOM||child.children.length?3:2}offset=end}this.dirty=2}markParentsDirty(){let level=1;for(let node=this.parent;node;node=node.parent,level++){let dirty=1==level?2:1;node.dirty<dirty&&(node.dirty=dirty)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class WidgetViewDesc extends ViewDesc{constructor(parent,widget,view,pos){let self1,dom=widget.type.toDOM;if("function"==typeof dom&&(dom=dom(view,()=>self1?self1.parent?self1.parent.posBeforeChild(self1):void 0:pos)),!widget.type.spec.raw){if(1!=dom.nodeType){let wrap=document.createElement("span");wrap.appendChild(dom),dom=wrap}dom.contentEditable="false",dom.classList.add("ProseMirror-widget")}super(parent,[],dom,null),this.widget=widget,this.widget=widget,self1=this}matchesWidget(widget){return 0==this.dirty&&widget.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(event){let stop=this.widget.spec.stopEvent;return!!stop&&stop(event)}ignoreMutation(mutation){return"selection"!=mutation.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class CompositionViewDesc extends ViewDesc{constructor(parent,dom,textDOM,text){super(parent,[],dom,null),this.textDOM=textDOM,this.text=text}get size(){return this.text.length}localPosFromDOM(dom,offset){return dom!=this.textDOM?this.posAtStart+(offset?this.size:0):this.posAtStart+offset}domFromPos(pos){return{node:this.textDOM,offset:pos}}ignoreMutation(mut){return"characterData"===mut.type&&mut.target.nodeValue==mut.oldValue}}class MarkViewDesc extends ViewDesc{constructor(parent,mark,dom,contentDOM){super(parent,[],dom,contentDOM),this.mark=mark}static create(parent,mark,inline,view){let custom=view.nodeViews[mark.type.name],spec=custom&&custom(mark,view,inline);return spec&&spec.dom||(spec=DOMSerializer$1.renderSpec(document,mark.type.spec.toDOM(mark,inline))),new MarkViewDesc(parent,mark,spec.dom,spec.contentDOM||spec.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(mark){return 3!=this.dirty&&this.mark.eq(mark)}markDirty(from,to){if(super.markDirty(from,to),0!=this.dirty){let parent=this.parent;for(;!parent.node;)parent=parent.parent;parent.dirty<this.dirty&&(parent.dirty=this.dirty),this.dirty=0}}slice(from,to,view){let copy=MarkViewDesc.create(this.parent,this.mark,!0,view),nodes=this.children,size=this.size;to<size&&(nodes=replaceNodes(nodes,to,size,view)),from>0&&(nodes=replaceNodes(nodes,0,from,view));for(let i=0;i<nodes.length;i++)nodes[i].parent=copy;return copy.children=nodes,copy}}class NodeViewDesc extends ViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos){super(parent,[],dom,contentDOM),this.node=node,this.outerDeco=outerDeco,this.innerDeco=innerDeco,this.nodeDOM=nodeDOM}static create(parent,node,outerDeco,innerDeco,view,pos){let custom=view.nodeViews[node.type.name],descObj,spec=custom&&custom(node,view,()=>descObj?descObj.parent?descObj.parent.posBeforeChild(descObj):void 0:pos,outerDeco,innerDeco),dom=spec&&spec.dom,contentDOM=spec&&spec.contentDOM;if(node.isText){if(dom){if(3!=dom.nodeType)throw RangeError("Text must be rendered as a DOM text node")}else dom=document.createTextNode(node.text)}else dom||({dom,contentDOM}=DOMSerializer$1.renderSpec(document,node.type.spec.toDOM(node)));contentDOM||node.isText||"BR"==dom.nodeName||(dom.hasAttribute("contenteditable")||(dom.contentEditable="false"),node.type.spec.draggable&&(dom.draggable=!0));let nodeDOM=dom;return(dom=applyOuterDeco(dom,outerDeco,node),spec)?descObj=new CustomNodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM||null,nodeDOM,spec,view,pos+1):node.isText?new TextViewDesc(parent,node,outerDeco,innerDeco,dom,nodeDOM,view):new NodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM||null,nodeDOM,view,pos+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let rule={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(rule.preserveWhitespace="full"),this.contentDOM){if(this.contentLost){for(let i=this.children.length-1;i>=0;i--){let child=this.children[i];if(this.dom.contains(child.dom.parentNode)){rule.contentElement=child.dom.parentNode;break}}rule.contentElement||(rule.getContent=()=>Fragment$1.empty)}else rule.contentElement=this.contentDOM}else rule.getContent=()=>this.node.content;return rule}matchesNode(node,outerDeco,innerDeco){return 0==this.dirty&&node.eq(this.node)&&sameOuterDeco(outerDeco,this.outerDeco)&&innerDeco.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(view,pos){let inline=this.node.inlineContent,off=pos,composition=view.composing?this.localCompositionInfo(view,pos):null,localComposition=composition&&composition.pos>-1?composition:null,compositionInChild=composition&&composition.pos<0,updater=new ViewTreeUpdater(this,localComposition&&localComposition.node,view);(function(parent,deco,onWidget,onNode){let locals=deco.locals(parent),offset=0;if(0==locals.length){for(let i=0;i<parent.childCount;i++){let child=parent.child(i);onNode(child,locals,deco.forChild(offset,child),i),offset+=child.nodeSize}return}let decoIndex=0,active=[],restNode=null;for(let parentIndex=0;;){let child1,index;if(decoIndex<locals.length&&locals[decoIndex].to==offset){let widget=locals[decoIndex++],widgets;for(;decoIndex<locals.length&&locals[decoIndex].to==offset;)(widgets||(widgets=[widget])).push(locals[decoIndex++]);if(widgets){widgets.sort(compareSide);for(let i1=0;i1<widgets.length;i1++)onWidget(widgets[i1],parentIndex,!!restNode)}else onWidget(widget,parentIndex,!!restNode)}if(restNode)index=-1,child1=restNode,restNode=null;else if(parentIndex<parent.childCount)index=parentIndex,child1=parent.child(parentIndex++);else break;for(let i2=0;i2<active.length;i2++)active[i2].to<=offset&&active.splice(i2--,1);for(;decoIndex<locals.length&&locals[decoIndex].from<=offset&&locals[decoIndex].to>offset;)active.push(locals[decoIndex++]);let end=offset+child1.nodeSize;if(child1.isText){let cutAt=end;decoIndex<locals.length&&locals[decoIndex].from<cutAt&&(cutAt=locals[decoIndex].from);for(let i3=0;i3<active.length;i3++)active[i3].to<cutAt&&(cutAt=active[i3].to);cutAt<end&&(restNode=child1.cut(cutAt-offset),child1=child1.cut(0,cutAt-offset),end=cutAt,index=-1)}let outerDeco=child1.isInline&&!child1.isLeaf?active.filter(d=>!d.inline):active.slice();onNode(child1,outerDeco,deco.forChild(offset,child1),index),offset=end}})(this.node,this.innerDeco,(widget,i,insideNode)=>{widget.spec.marks?updater.syncToMarks(widget.spec.marks,inline,view):widget.type.side>=0&&!insideNode&&updater.syncToMarks(i==this.node.childCount?Mark$2.none:this.node.child(i).marks,inline,view),updater.placeWidget(widget,view,off)},(child,outerDeco,innerDeco,i)=>{let compIndex;updater.syncToMarks(child.marks,inline,view),updater.findNodeMatch(child,outerDeco,innerDeco,i)||compositionInChild&&view.state.selection.from>off&&view.state.selection.to<off+child.nodeSize&&(compIndex=updater.findIndexWithChild(composition.node))>-1&&updater.updateNodeAt(child,outerDeco,innerDeco,compIndex,view)||updater.updateNextNode(child,outerDeco,innerDeco,view,i,off)||updater.addNode(child,outerDeco,innerDeco,view,off),off+=child.nodeSize}),updater.syncToMarks([],inline,view),this.node.isTextblock&&updater.addTextblockHacks(),updater.destroyRest(),(updater.changed||2==this.dirty)&&(localComposition&&this.protectLocalComposition(view,localComposition),function renderDescs(parentDOM,descs,view){let dom=parentDOM.firstChild,written=!1;for(let i=0;i<descs.length;i++){let desc=descs[i],childDOM=desc.dom;if(childDOM.parentNode==parentDOM){for(;childDOM!=dom;)dom=rm(dom),written=!0;dom=dom.nextSibling}else written=!0,parentDOM.insertBefore(childDOM,dom);if(desc instanceof MarkViewDesc){let pos=dom?dom.previousSibling:parentDOM.lastChild;renderDescs(desc.contentDOM,desc.children,view),dom=pos?pos.nextSibling:parentDOM.firstChild}}for(;dom;)dom=rm(dom),written=!0;written&&view.trackWrites==parentDOM&&(view.trackWrites=null)}(this.contentDOM,this.children,view),ios&&function(dom){if("UL"==dom.nodeName||"OL"==dom.nodeName){let oldCSS=dom.style.cssText;dom.style.cssText=oldCSS+"; list-style: square !important",window.getComputedStyle(dom).listStyle,dom.style.cssText=oldCSS}}(this.dom))}localCompositionInfo(view,pos){let{from,to}=view.state.selection;if(!(view.state.selection instanceof TextSelection)||from<pos||to>pos+this.node.content.size)return null;let sel=view.domSelectionRange(),textNode=function(node,offset){for(;;){if(3==node.nodeType)return node;if(1==node.nodeType&&offset>0){if(node.childNodes.length>offset&&3==node.childNodes[offset].nodeType)return node.childNodes[offset];offset=nodeSize(node=node.childNodes[offset-1])}else{if(1!=node.nodeType||!(offset<node.childNodes.length))return null;node=node.childNodes[offset],offset=0}}}(sel.focusNode,sel.focusOffset);if(!textNode||!this.dom.contains(textNode.parentNode))return null;if(!this.node.inlineContent)return{node:textNode,pos:-1,text:""};{let text=textNode.nodeValue,textPos=function(frag,text,from,to){for(let i=0,pos=0;i<frag.childCount&&pos<=to;){let child=frag.child(i++),childStart=pos;if(pos+=child.nodeSize,!child.isText)continue;let str=child.text;for(;i<frag.childCount;){let next=frag.child(i++);if(pos+=next.nodeSize,!next.isText)break;str+=next.text}if(pos>=from){let found=childStart<to?str.lastIndexOf(text,to-childStart-1):-1;if(found>=0&&found+text.length+childStart>=from)return childStart+found;if(from==to&&str.length>=to+text.length-childStart&&str.slice(to-childStart,to-childStart+text.length)==text)return to}}return -1}(this.node.content,text,from-pos,to-pos);return textPos<0?null:{node:textNode,pos:textPos,text}}}protectLocalComposition(view,{node,pos,text}){if(this.getDesc(node))return;let topNode=node;for(;topNode.parentNode!=this.contentDOM;topNode=topNode.parentNode){for(;topNode.previousSibling;)topNode.parentNode.removeChild(topNode.previousSibling);for(;topNode.nextSibling;)topNode.parentNode.removeChild(topNode.nextSibling);topNode.pmViewDesc&&(topNode.pmViewDesc=void 0)}let desc=new CompositionViewDesc(this,topNode,node,text);view.input.compositionNodes.push(desc),this.children=replaceNodes(this.children,pos,pos+text.length,view,desc)}update(node,outerDeco,innerDeco,view){return!!(3!=this.dirty&&node.sameMarkup(this.node))&&(this.updateInner(node,outerDeco,innerDeco,view),!0)}updateInner(node,outerDeco,innerDeco,view){this.updateOuterDeco(outerDeco),this.node=node,this.innerDeco=innerDeco,this.contentDOM&&this.updateChildren(view,this.posAtStart),this.dirty=0}updateOuterDeco(outerDeco){if(sameOuterDeco(outerDeco,this.outerDeco))return;let needsWrap=1!=this.nodeDOM.nodeType,oldDOM=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,needsWrap),computeOuterDeco(outerDeco,this.node,needsWrap)),this.dom!=oldDOM&&(oldDOM.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=outerDeco}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function docViewDesc(doc,outerDeco,innerDeco,dom,view){applyOuterDeco(dom,outerDeco,doc);let docView=new NodeViewDesc(void 0,doc,outerDeco,innerDeco,dom,dom,dom,view,0);return docView.contentDOM&&docView.updateChildren(view,0),docView}class TextViewDesc extends NodeViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,nodeDOM,view){super(parent,node,outerDeco,innerDeco,dom,null,nodeDOM,view,0)}parseRule(){let skip=this.nodeDOM.parentNode;for(;skip&&skip!=this.dom&&!skip.pmIsDeco;)skip=skip.parentNode;return{skip:skip||!0}}update(node,outerDeco,innerDeco,view){return!!(3!=this.dirty&&(0==this.dirty||this.inParent())&&node.sameMarkup(this.node))&&(this.updateOuterDeco(outerDeco),(0!=this.dirty||node.text!=this.node.text)&&node.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=node.text,view.trackWrites==this.nodeDOM&&(view.trackWrites=null)),this.node=node,this.dirty=0,!0)}inParent(){let parentDOM=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==parentDOM)return!0;return!1}domFromPos(pos){return{node:this.nodeDOM,offset:pos}}localPosFromDOM(dom,offset,bias){return dom==this.nodeDOM?this.posAtStart+Math.min(offset,this.node.text.length):super.localPosFromDOM(dom,offset,bias)}ignoreMutation(mutation){return"characterData"!=mutation.type&&"selection"!=mutation.type}slice(from,to,view){let node=this.node.cut(from,to),dom=document.createTextNode(node.text);return new TextViewDesc(this.parent,node,this.outerDeco,this.innerDeco,dom,dom,view)}markDirty(from,to){super.markDirty(from,to),this.dom!=this.nodeDOM&&(0==from||to==this.nodeDOM.nodeValue.length)&&(this.dirty=3)}get domAtom(){return!1}}class TrailingHackViewDesc extends ViewDesc{parseRule(){return{ignore:!0}}matchesHack(nodeName){return 0==this.dirty&&this.dom.nodeName==nodeName}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class CustomNodeViewDesc extends NodeViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,spec,view,pos){super(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos),this.spec=spec}update(node,outerDeco,innerDeco,view){if(3==this.dirty)return!1;if(this.spec.update){let result=this.spec.update(node,outerDeco,innerDeco);return result&&this.updateInner(node,outerDeco,innerDeco,view),result}return(!!this.contentDOM||!!node.isLeaf)&&super.update(node,outerDeco,innerDeco,view)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(anchor,head,root,force){this.spec.setSelection?this.spec.setSelection(anchor,head,root):super.setSelection(anchor,head,root,force)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(event){return!!this.spec.stopEvent&&this.spec.stopEvent(event)}ignoreMutation(mutation){return this.spec.ignoreMutation?this.spec.ignoreMutation(mutation):super.ignoreMutation(mutation)}}let OuterDecoLevel=function(nodeName){nodeName&&(this.nodeName=nodeName)};OuterDecoLevel.prototype=Object.create(null);let noDeco=[new OuterDecoLevel];function computeOuterDeco(outerDeco,node,needsWrap){if(0==outerDeco.length)return noDeco;let top=needsWrap?noDeco[0]:new OuterDecoLevel,result=[top];for(let i=0;i<outerDeco.length;i++){let attrs=outerDeco[i].type.attrs;if(attrs)for(let name in attrs.nodeName&&result.push(top=new OuterDecoLevel(attrs.nodeName)),attrs){let val=attrs[name];null!=val&&(needsWrap&&1==result.length&&result.push(top=new OuterDecoLevel(node.isInline?"span":"div")),"class"==name?top.class=(top.class?top.class+" ":"")+val:"style"==name?top.style=(top.style?top.style+";":"")+val:"nodeName"!=name&&(top[name]=val))}}return result}function patchOuterDeco(outerDOM,nodeDOM,prevComputed,curComputed){if(prevComputed==noDeco&&curComputed==noDeco)return nodeDOM;let curDOM=nodeDOM;for(let i=0;i<curComputed.length;i++){let deco=curComputed[i],prev=prevComputed[i];if(i){let parent;prev&&prev.nodeName==deco.nodeName&&curDOM!=outerDOM&&(parent=curDOM.parentNode)&&parent.nodeName.toLowerCase()==deco.nodeName||((parent=document.createElement(deco.nodeName)).pmIsDeco=!0,parent.appendChild(curDOM),prev=noDeco[0]),curDOM=parent}!function(dom,prev,cur){for(let name in prev)"class"==name||"style"==name||"nodeName"==name||name in cur||dom.removeAttribute(name);for(let name1 in cur)"class"!=name1&&"style"!=name1&&"nodeName"!=name1&&cur[name1]!=prev[name1]&&dom.setAttribute(name1,cur[name1]);if(prev.class!=cur.class){let prevList=prev.class?prev.class.split(" ").filter(Boolean):[],curList=cur.class?cur.class.split(" ").filter(Boolean):[];for(let i=0;i<prevList.length;i++)-1==curList.indexOf(prevList[i])&&dom.classList.remove(prevList[i]);for(let i1=0;i1<curList.length;i1++)-1==prevList.indexOf(curList[i1])&&dom.classList.add(curList[i1]);0==dom.classList.length&&dom.removeAttribute("class")}if(prev.style!=cur.style){if(prev.style){let prop=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,m;for(;m=prop.exec(prev.style);)dom.style.removeProperty(m[1])}cur.style&&(dom.style.cssText+=cur.style)}}(curDOM,prev||noDeco[0],deco)}return curDOM}function applyOuterDeco(dom,deco,node){return patchOuterDeco(dom,dom,noDeco,computeOuterDeco(deco,node,1!=dom.nodeType))}function sameOuterDeco(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].type.eq(b[i].type))return!1;return!0}function rm(dom){let next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}class ViewTreeUpdater{constructor(top,lock,view){this.lock=lock,this.view=view,this.index=0,this.stack=[],this.changed=!1,this.top=top,this.preMatch=function(frag,parentDesc){let curDesc=parentDesc,descI=curDesc.children.length,fI=frag.childCount,matched=new Map,matches=[];outer:for(;fI>0;){let desc;for(;;)if(descI){let next=curDesc.children[descI-1];if(next instanceof MarkViewDesc)curDesc=next,descI=next.children.length;else{desc=next,descI--;break}}else if(curDesc==parentDesc)break outer;else descI=curDesc.parent.children.indexOf(curDesc),curDesc=curDesc.parent;let node=desc.node;if(node){if(node!=frag.child(fI-1))break;--fI,matched.set(desc,fI),matches.push(desc)}}return{index:fI,matched,matches:matches.reverse()}}(top.node.content,top)}destroyBetween(start,end){if(start!=end){for(let i=start;i<end;i++)this.top.children[i].destroy();this.top.children.splice(start,end-start),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(marks,inline,view){let keep=0,depth=this.stack.length>>1,maxKeep=Math.min(depth,marks.length);for(;keep<maxKeep&&(keep==depth-1?this.top:this.stack[keep+1<<1]).matchesMark(marks[keep])&&!1!==marks[keep].type.spec.spanning;)keep++;for(;keep<depth;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),depth--;for(;depth<marks.length;){this.stack.push(this.top,this.index+1);let found=-1;for(let i=this.index;i<Math.min(this.index+3,this.top.children.length);i++){let next=this.top.children[i];if(next.matchesMark(marks[depth])&&!this.isLocked(next.dom)){found=i;break}}if(found>-1)found>this.index&&(this.changed=!0,this.destroyBetween(this.index,found)),this.top=this.top.children[this.index];else{let markDesc=MarkViewDesc.create(this.top,marks[depth],inline,view);this.top.children.splice(this.index,0,markDesc),this.top=markDesc,this.changed=!0}this.index=0,depth++}}findNodeMatch(node,outerDeco,innerDeco,index){let found=-1,targetDesc;if(index>=this.preMatch.index&&(targetDesc=this.preMatch.matches[index-this.preMatch.index]).parent==this.top&&targetDesc.matchesNode(node,outerDeco,innerDeco))found=this.top.children.indexOf(targetDesc,this.index);else for(let i=this.index,e=Math.min(this.top.children.length,i+5);i<e;i++){let child=this.top.children[i];if(child.matchesNode(node,outerDeco,innerDeco)&&!this.preMatch.matched.has(child)){found=i;break}}return!(found<0)&&(this.destroyBetween(this.index,found),this.index++,!0)}updateNodeAt(node,outerDeco,innerDeco,index,view){let child=this.top.children[index];return 3==child.dirty&&child.dom==child.contentDOM&&(child.dirty=2),!!child.update(node,outerDeco,innerDeco,view)&&(this.destroyBetween(this.index,index),this.index++,!0)}findIndexWithChild(domNode){for(;;){let parent=domNode.parentNode;if(!parent)return -1;if(parent==this.top.contentDOM){let desc=domNode.pmViewDesc;if(desc){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==desc)return i}return -1}domNode=parent}}updateNextNode(node,outerDeco,innerDeco,view,index,pos){for(let i=this.index;i<this.top.children.length;i++){let next=this.top.children[i];if(next instanceof NodeViewDesc){let preMatch=this.preMatch.matched.get(next);if(null!=preMatch&&preMatch!=index)return!1;let nextDOM=next.dom,updated,locked=this.isLocked(nextDOM)&&!(node.isText&&next.node&&next.node.isText&&next.nodeDOM.nodeValue==node.text&&3!=next.dirty&&sameOuterDeco(outerDeco,next.outerDeco));if(!locked&&next.update(node,outerDeco,innerDeco,view))return this.destroyBetween(this.index,i),next.dom!=nextDOM&&(this.changed=!0),this.index++,!0;if(!locked&&(updated=this.recreateWrapper(next,node,outerDeco,innerDeco,view,pos)))return this.top.children[this.index]=updated,updated.dirty=2,updated.updateChildren(view,pos+1),updated.dirty=0,this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(next,node,outerDeco,innerDeco,view,pos){if(next.dirty||node.isAtom||!next.children.length||!next.node.content.eq(node.content))return null;let wrapper=NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos);if(!wrapper.contentDOM)return null;for(let ch of(wrapper.children=next.children,next.children=[],next.destroy(),wrapper.children))ch.parent=wrapper;return wrapper}addNode(node,outerDeco,innerDeco,view,pos){let desc=NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos);desc.contentDOM&&desc.updateChildren(view,pos+1),this.top.children.splice(this.index++,0,desc),this.changed=!0}placeWidget(widget,view,pos){let next=this.index<this.top.children.length?this.top.children[this.index]:null;if(next&&next.matchesWidget(widget)&&(widget==next.widget||!next.widget.type.toDOM.parentNode))this.index++;else{let desc=new WidgetViewDesc(this.top,widget,view,pos);this.top.children.splice(this.index++,0,desc),this.changed=!0}}addTextblockHacks(){let lastChild=this.top.children[this.index-1],parent=this.top;for(;lastChild instanceof MarkViewDesc;)lastChild=(parent=lastChild).children[parent.children.length-1];(!lastChild||!(lastChild instanceof TextViewDesc)||/\n$/.test(lastChild.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(lastChild.node.text))&&((safari||chrome)&&lastChild&&"false"==lastChild.dom.contentEditable&&this.addHackNode("IMG",parent),this.addHackNode("BR",this.top))}addHackNode(nodeName,parent){if(parent==this.top&&this.index<parent.children.length&&parent.children[this.index].matchesHack(nodeName))this.index++;else{let dom=document.createElement(nodeName);"IMG"==nodeName&&(dom.className="ProseMirror-separator",dom.alt=""),"BR"==nodeName&&(dom.className="ProseMirror-trailingBreak");let hack=new TrailingHackViewDesc(this.top,[],dom,null);parent!=this.top?parent.children.push(hack):parent.children.splice(this.index++,0,hack),this.changed=!0}}isLocked(node){return this.lock&&(node==this.lock||1==node.nodeType&&node.contains(this.lock.parentNode))}}function compareSide(a,b){return a.type.side-b.type.side}function replaceNodes(nodes,from,to,view,replacement){let result=[];for(let i=0,off=0;i<nodes.length;i++){let child=nodes[i],start=off,end=off+=child.size;start>=to||end<=from?result.push(child):(start<from&&result.push(child.slice(0,from-start,view)),replacement&&(result.push(replacement),replacement=void 0),end>to&&result.push(child.slice(to-start,child.size,view)))}return result}function selectionFromDOM(view,origin=null){let domSel=view.domSelectionRange(),doc=view.state.doc;if(!domSel.focusNode)return null;let nearestDesc=view.docView.nearestDesc(domSel.focusNode),inWidget=nearestDesc&&0==nearestDesc.size,head=view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset,1);if(head<0)return null;let $head=doc.resolve(head),$anchor,selection;if(selectionCollapsed(domSel)){for($anchor=$head;nearestDesc&&!nearestDesc.node;)nearestDesc=nearestDesc.parent;let nearestDescNode=nearestDesc.node;if(nearestDesc&&nearestDescNode.isAtom&&NodeSelection.isSelectable(nearestDescNode)&&nearestDesc.parent&&!(nearestDescNode.isInline&&function(node,offset,parent){for(let atStart=0==offset,atEnd=offset==nodeSize(node);atStart||atEnd;){if(node==parent)return!0;let index=domIndex(node);if(!(node=node.parentNode))return!1;atStart=atStart&&0==index,atEnd=atEnd&&index==nodeSize(node)}}(domSel.focusNode,domSel.focusOffset,nearestDesc.dom))){let pos=nearestDesc.posBefore;selection=new NodeSelection(head==pos?$head:doc.resolve(pos))}}else{let anchor=view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset,1);if(anchor<0)return null;$anchor=doc.resolve(anchor)}if(!selection){let bias="pointer"==origin||view.state.selection.head<$head.pos&&!inWidget?1:-1;selection=selectionBetween(view,$anchor,$head,bias)}return selection}function editorOwnsSelection(view){return view.editable?view.hasFocus():hasSelection(view)&&document.activeElement&&document.activeElement.contains(view.dom)}function selectionToDOM(view,force=!1){let sel=view.state.selection;if(syncNodeSelection(view,sel),editorOwnsSelection(view)){var view1;if(!force&&view.input.mouseDown&&view.input.mouseDown.allowDefault&&chrome){let domSel=view.domSelectionRange(),curSel=view.domObserver.currentSelection;if(domSel.anchorNode&&curSel.anchorNode&&isEquivalentPosition(domSel.anchorNode,domSel.anchorOffset,curSel.anchorNode,curSel.anchorOffset)){view.input.mouseDown.delayedSelectionSync=!0,view.domObserver.setCurSelection();return}}if(view.domObserver.disconnectSelection(),view.cursorWrapper){let domSel1,range,node,img;domSel1=view.domSelection(),range=document.createRange(),(img="IMG"==(node=view.cursorWrapper.dom).nodeName)?range.setEnd(node.parentNode,domIndex(node)+1):range.setEnd(node,0),range.collapse(!1),domSel1.removeAllRanges(),domSel1.addRange(range),!img&&!view.state.selection.visible&&ie$1&&ie_version<=11&&(node.disabled=!0,node.disabled=!1)}else{let doc,domSel2,node1,offset,{anchor,head}=sel,resetEditableFrom,resetEditableTo;!brokenSelectBetweenUneditable||sel instanceof TextSelection||(sel.$from.parent.inlineContent||(resetEditableFrom=temporarilyEditableNear(view,sel.from)),sel.empty||sel.$from.parent.inlineContent||(resetEditableTo=temporarilyEditableNear(view,sel.to))),view.docView.setSelection(anchor,head,view.root,force),brokenSelectBetweenUneditable&&(resetEditableFrom&&resetEditable(resetEditableFrom),resetEditableTo&&resetEditable(resetEditableTo)),sel.visible?view.dom.classList.remove("ProseMirror-hideselection"):(view.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&((doc=(view1=view).dom.ownerDocument).removeEventListener("selectionchange",view1.input.hideSelectionGuard),node1=(domSel2=view1.domSelectionRange()).anchorNode,offset=domSel2.anchorOffset,doc.addEventListener("selectionchange",view1.input.hideSelectionGuard=()=>{(domSel2.anchorNode!=node1||domSel2.anchorOffset!=offset)&&(doc.removeEventListener("selectionchange",view1.input.hideSelectionGuard),setTimeout(()=>{(!editorOwnsSelection(view1)||view1.state.selection.visible)&&view1.dom.classList.remove("ProseMirror-hideselection")},20))})))}view.domObserver.setCurSelection(),view.domObserver.connectSelection()}}let brokenSelectBetweenUneditable=safari||chrome&&chrome_version<63;function temporarilyEditableNear(view,pos){let{node,offset}=view.docView.domFromPos(pos,0),after=offset<node.childNodes.length?node.childNodes[offset]:null,before=offset?node.childNodes[offset-1]:null;if(safari&&after&&"false"==after.contentEditable)return setEditable(after);if((!after||"false"==after.contentEditable)&&(!before||"false"==before.contentEditable)){if(after)return setEditable(after);if(before)return setEditable(before)}}function setEditable(element){return element.contentEditable="true",safari&&element.draggable&&(element.draggable=!1,element.wasDraggable=!0),element}function resetEditable(element){element.contentEditable="false",element.wasDraggable&&(element.draggable=!0,element.wasDraggable=null)}function syncNodeSelection(view,sel){if(sel instanceof NodeSelection){let desc=view.docView.descAt(sel.from);desc!=view.lastSelectedViewDesc&&(clearNodeSelection(view),desc&&desc.selectNode(),view.lastSelectedViewDesc=desc)}else clearNodeSelection(view)}function clearNodeSelection(view){view.lastSelectedViewDesc&&(view.lastSelectedViewDesc.parent&&view.lastSelectedViewDesc.deselectNode(),view.lastSelectedViewDesc=void 0)}function selectionBetween(view,$anchor,$head,bias){return view.someProp("createSelectionBetween",f=>f(view,$anchor,$head))||TextSelection.between($anchor,$head,bias)}function hasFocusAndSelection(view){return(!view.editable||!!view.hasFocus())&&hasSelection(view)}function hasSelection(view){let sel=view.domSelectionRange();if(!sel.anchorNode)return!1;try{return view.dom.contains(3==sel.anchorNode.nodeType?sel.anchorNode.parentNode:sel.anchorNode)&&(view.editable||view.dom.contains(3==sel.focusNode.nodeType?sel.focusNode.parentNode:sel.focusNode))}catch(_){return!1}}function moveSelectionBlock(state,dir){let{$anchor,$head}=state.selection,$side=dir>0?$anchor.max($head):$anchor.min($head),$start=$side.parent.inlineContent?$side.depth?state.doc.resolve(dir>0?$side.after():$side.before()):null:$side;return $start&&Selection.findFrom($start,dir)}function apply(view,sel){return view.dispatch(view.state.tr.setSelection(sel).scrollIntoView()),!0}function selectHorizontally(view,dir,mods){let sel=view.state.selection;if(sel instanceof TextSelection){if(!sel.empty||mods.indexOf("s")>-1)return!1;if(view.endOfTextblock(dir>0?"forward":"backward")){let next=moveSelectionBlock(view.state,dir);return!!next&&next instanceof NodeSelection&&apply(view,next)}if(!(mac$2&&mods.indexOf("m")>-1)){let $head=sel.$head,node=$head.textOffset?null:dir<0?$head.nodeBefore:$head.nodeAfter,desc;if(!node||node.isText)return!1;let nodePos=dir<0?$head.pos-node.nodeSize:$head.pos;return!!(node.isAtom||(desc=view.docView.descAt(nodePos))&&!desc.contentDOM)&&(NodeSelection.isSelectable(node)?apply(view,new NodeSelection(dir<0?view.state.doc.resolve($head.pos-node.nodeSize):$head)):!!webkit&&apply(view,new TextSelection(view.state.doc.resolve(dir<0?nodePos:nodePos+node.nodeSize))))}}else{if(sel instanceof NodeSelection&&sel.node.isInline)return apply(view,new TextSelection(dir>0?sel.$to:sel.$from));let next1=moveSelectionBlock(view.state,dir);return!!next1&&apply(view,next1)}}function nodeLen(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function isIgnorable(dom){let desc=dom.pmViewDesc;return desc&&0==desc.size&&(dom.nextSibling||"BR"!=dom.nodeName)}function skipIgnoredNodes(view,dir){return dir<0?function(view){let sel=view.domSelectionRange(),node=sel.focusNode,offset=sel.focusOffset;if(!node)return;let moveNode,moveOffset,force=!1;for(gecko&&1==node.nodeType&&offset<nodeLen(node)&&isIgnorable(node.childNodes[offset])&&(force=!0);;)if(offset>0){if(1!=node.nodeType)break;{let before=node.childNodes[offset-1];if(isIgnorable(before))moveNode=node,moveOffset=--offset;else if(3==before.nodeType)offset=(node=before).nodeValue.length;else break}}else if(isBlockNode(node))break;else{let prev=node.previousSibling;for(;prev&&isIgnorable(prev);)moveNode=node.parentNode,moveOffset=domIndex(prev),prev=prev.previousSibling;if(prev)offset=nodeLen(node=prev);else{if((node=node.parentNode)==view.dom)break;offset=0}}force?setSelFocus(view,node,offset):moveNode&&setSelFocus(view,moveNode,moveOffset)}(view):skipIgnoredNodesAfter(view)}function skipIgnoredNodesAfter(view){let moveNode,moveOffset,sel=view.domSelectionRange(),node=sel.focusNode,offset=sel.focusOffset;if(!node)return;let len=nodeLen(node);for(;;)if(offset<len){if(1!=node.nodeType)break;if(isIgnorable(node.childNodes[offset]))moveNode=node,moveOffset=++offset;else break}else if(isBlockNode(node))break;else{let next=node.nextSibling;for(;next&&isIgnorable(next);)moveNode=next.parentNode,moveOffset=domIndex(next)+1,next=next.nextSibling;if(next)offset=0,len=nodeLen(node=next);else{if((node=node.parentNode)==view.dom)break;offset=len=0}}moveNode&&setSelFocus(view,moveNode,moveOffset)}function isBlockNode(dom){let desc=dom.pmViewDesc;return desc&&desc.node&&desc.node.isBlock}function setSelFocus(view,node,offset){let sel=view.domSelection();if(selectionCollapsed(sel)){let range=document.createRange();range.setEnd(node,offset),range.setStart(node,offset),sel.removeAllRanges(),sel.addRange(range)}else sel.extend&&sel.extend(node,offset);view.domObserver.setCurSelection();let{state}=view;setTimeout(()=>{view.state==state&&selectionToDOM(view)},50)}function findDirection(view,pos){let $pos=view.state.doc.resolve(pos);if(!(chrome||windows)&&$pos.parent.inlineContent){let coords=view.coordsAtPos(pos);if(pos>$pos.start()){let before=view.coordsAtPos(pos-1),mid=(before.top+before.bottom)/2;if(mid>coords.top&&mid<coords.bottom&&Math.abs(before.left-coords.left)>1)return before.left<coords.left?"ltr":"rtl"}if(pos<$pos.end()){let after=view.coordsAtPos(pos+1),mid1=(after.top+after.bottom)/2;if(mid1>coords.top&&mid1<coords.bottom&&Math.abs(after.left-coords.left)>1)return after.left>coords.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(view.dom).direction?"rtl":"ltr"}function selectVertically(view,dir,mods){let sel=view.state.selection;if(sel instanceof TextSelection&&!sel.empty||mods.indexOf("s")>-1||mac$2&&mods.indexOf("m")>-1)return!1;let{$from,$to}=sel;if(!$from.parent.inlineContent||view.endOfTextblock(dir<0?"up":"down")){let next=moveSelectionBlock(view.state,dir);if(next&&next instanceof NodeSelection)return apply(view,next)}if(!$from.parent.inlineContent){let side=dir<0?$from:$to,beyond=sel instanceof AllSelection?Selection.near(side,dir):Selection.findFrom(side,dir);return!!beyond&&apply(view,beyond)}return!1}function stopNativeHorizontalDelete(view,dir){if(!(view.state.selection instanceof TextSelection))return!0;let{$head,$anchor,empty}=view.state.selection;if(!$head.sameParent($anchor))return!0;if(!empty)return!1;if(view.endOfTextblock(dir>0?"forward":"backward"))return!0;let nextNode=!$head.textOffset&&(dir<0?$head.nodeBefore:$head.nodeAfter);if(nextNode&&!nextNode.isText){let tr=view.state.tr;return dir<0?tr.delete($head.pos-nextNode.nodeSize,$head.pos):tr.delete($head.pos,$head.pos+nextNode.nodeSize),view.dispatch(tr),!0}return!1}function switchEditable(view,node,state){view.domObserver.stop(),node.contentEditable=state,view.domObserver.start()}function serializeForClipboard(view,slice){view.someProp("transformCopied",f=>{slice=f(slice,view)});let context=[],{content,openStart,openEnd}=slice;for(;openStart>1&&openEnd>1&&1==content.childCount&&1==content.firstChild.childCount;){openStart--,openEnd--;let node=content.firstChild;context.push(node.type.name,node.attrs!=node.type.defaultAttrs?node.attrs:null),content=node.content}let serializer=view.someProp("clipboardSerializer")||DOMSerializer$1.fromSchema(view.state.schema),doc=detachedDoc(),wrap=doc.createElement("div");wrap.appendChild(serializer.serializeFragment(content,{document:doc}));let firstChild=wrap.firstChild,needsWrap,wrappers=0;for(;firstChild&&1==firstChild.nodeType&&(needsWrap=wrapMap[firstChild.nodeName.toLowerCase()]);){for(let i=needsWrap.length-1;i>=0;i--){let wrapper=doc.createElement(needsWrap[i]);for(;wrap.firstChild;)wrapper.appendChild(wrap.firstChild);wrap.appendChild(wrapper),wrappers++}firstChild=wrap.firstChild}firstChild&&1==firstChild.nodeType&&firstChild.setAttribute("data-pm-slice",`${openStart} ${openEnd}${wrappers?` -${wrappers}`:""} ${JSON.stringify(context)}`);let text=view.someProp("clipboardTextSerializer",f=>f(slice,view))||slice.content.textBetween(0,slice.content.size,"\n\n");return{dom:wrap,text}}function parseFromClipboard(view,text,html,plainText,$context){let dom,slice,inCode=$context.parent.type.spec.code;if(!html&&!text)return null;let asText=text&&(plainText||inCode||!html);if(asText){if(view.someProp("transformPastedText",f=>{text=f(text,inCode||plainText,view)}),inCode)return text?new Slice$1(Fragment$1.from(view.state.schema.text(text.replace(/\r\n?/g,"\n"))),0,0):Slice$1.empty;let parsed=view.someProp("clipboardTextParser",f=>f(text,$context,plainText,view));if(parsed)slice=parsed;else{let marks=$context.marks(),{schema}=view.state,serializer=DOMSerializer$1.fromSchema(schema);dom=document.createElement("div"),text.split(/(?:\r\n?|\n)+/).forEach(block=>{let p=dom.appendChild(document.createElement("p"));block&&p.appendChild(serializer.serializeNode(schema.text(block,marks)))})}}else view.someProp("transformPastedHTML",f=>{html=f(html,view)}),dom=function(html){let metas=/^(\s*<meta [^>]*>)*/.exec(html);metas&&(html=html.slice(metas[0].length));let elt=detachedDoc().createElement("div"),firstTag=/<([a-z][^>\s]+)/i.exec(html),wrap;if((wrap=firstTag&&wrapMap[firstTag[1].toLowerCase()])&&(html=wrap.map(n=>"<"+n+">").join("")+html+wrap.map(n=>"</"+n+">").reverse().join("")),elt.innerHTML=html,wrap)for(let i=0;i<wrap.length;i++)elt=elt.querySelector(wrap[i])||elt;return elt}(html),webkit&&function(dom){let nodes=dom.querySelectorAll(chrome?"span:not([class]):not([style])":"span.Apple-converted-space");for(let i=0;i<nodes.length;i++){let node=nodes[i];1==node.childNodes.length&&"\xa0"==node.textContent&&node.parentNode&&node.parentNode.replaceChild(dom.ownerDocument.createTextNode(" "),node)}}(dom);let contextNode=dom&&dom.querySelector("[data-pm-slice]"),sliceData=contextNode&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(contextNode.getAttribute("data-pm-slice")||"");if(sliceData&&sliceData[3])for(let i=+sliceData[3];i>0;i--){let child=dom.firstChild;for(;child&&1!=child.nodeType;)child=child.nextSibling;if(!child)break;dom=child}if(slice||(slice=(view.someProp("clipboardParser")||view.someProp("domParser")||DOMParser$1.fromSchema(view.state.schema)).parseSlice(dom,{preserveWhitespace:!!(asText||sliceData),context:$context,ruleFromNode:dom=>"BR"!=dom.nodeName||dom.nextSibling||!dom.parentNode||inlineParents.test(dom.parentNode.nodeName)?null:{ignore:!0}})),sliceData)slice=function(slice,context){if(!slice.size)return slice;let schema=slice.content.firstChild.type.schema,array;try{array=JSON.parse(context)}catch(e){return slice}let{content,openStart,openEnd}=slice;for(let i=array.length-2;i>=0;i-=2){let type=schema.nodes[array[i]];if(!type||type.hasRequiredAttrs())break;content=Fragment$1.from(type.create(array[i+1],content)),openStart++,openEnd++}return new Slice$1(content,openStart,openEnd)}(closeSlice(slice,+sliceData[1],+sliceData[2]),sliceData[4]);else if((slice=Slice$1.maxOpen(function(fragment,$context){if(fragment.childCount<2)return fragment;for(let d=$context.depth;d>=0;d--){let match=$context.node(d).contentMatchAt($context.index(d)),lastWrap,result=[];if(fragment.forEach(node=>{if(!result)return;let wrap=match.findWrapping(node.type),inLast;if(!wrap)return result=null;if(inLast=result.length&&lastWrap.length&&function addToSibling(wrap,lastWrap,node,sibling,depth){if(depth<wrap.length&&depth<lastWrap.length&&wrap[depth]==lastWrap[depth]){let inner=addToSibling(wrap,lastWrap,node,sibling.lastChild,depth+1);if(inner)return sibling.copy(sibling.content.replaceChild(sibling.childCount-1,inner));if(sibling.contentMatchAt(sibling.childCount).matchType(depth==wrap.length-1?node.type:wrap[depth+1]))return sibling.copy(sibling.content.append(Fragment$1.from(withWrappers(node,wrap,depth+1))))}}(wrap,lastWrap,node,result[result.length-1],0))result[result.length-1]=inLast;else{result.length&&(result[result.length-1]=function closeRight(node,depth){if(0==depth)return node;let fragment=node.content.replaceChild(node.childCount-1,closeRight(node.lastChild,depth-1)),fill=node.contentMatchAt(node.childCount).fillBefore(Fragment$1.empty,!0);return node.copy(fragment.append(fill))}(result[result.length-1],lastWrap.length));let wrapped=withWrappers(node,wrap);result.push(wrapped),match=match.matchType(wrapped.type),lastWrap=wrap}}),result)return Fragment$1.from(result)}return fragment}(slice.content,$context),!0)).openStart||slice.openEnd){let openStart=0,openEnd=0;for(let node=slice.content.firstChild;openStart<slice.openStart&&!node.type.spec.isolating;openStart++,node=node.firstChild);for(let node1=slice.content.lastChild;openEnd<slice.openEnd&&!node1.type.spec.isolating;openEnd++,node1=node1.lastChild);slice=closeSlice(slice,openStart,openEnd)}return view.someProp("transformPasted",f=>{slice=f(slice,view)}),slice}let inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function withWrappers(node,wrap,from=0){for(let i=wrap.length-1;i>=from;i--)node=wrap[i].create(null,Fragment$1.from(node));return node}function closeRange(fragment,side,from,to,depth,openEnd){let node=side<0?fragment.firstChild:fragment.lastChild,inner=node.content;return fragment.childCount>1&&(openEnd=0),depth<to-1&&(inner=closeRange(inner,side,from,to,depth+1,openEnd)),depth>=from&&(inner=side<0?node.contentMatchAt(0).fillBefore(inner,openEnd<=depth).append(inner):inner.append(node.contentMatchAt(node.childCount).fillBefore(Fragment$1.empty,!0))),fragment.replaceChild(side<0?0:fragment.childCount-1,node.copy(inner))}function closeSlice(slice,openStart,openEnd){return openStart<slice.openStart&&(slice=new Slice$1(closeRange(slice.content,-1,openStart,slice.openStart,0,slice.openEnd),openStart,slice.openEnd)),openEnd<slice.openEnd&&(slice=new Slice$1(closeRange(slice.content,1,openEnd,slice.openEnd,0,0),slice.openStart,openEnd)),slice}let wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},_detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}let handlers={},editHandlers={},passiveHandlers={touchstart:!0,touchmove:!0};class InputState{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function setSelectionOrigin(view,origin){view.input.lastSelectionOrigin=origin,view.input.lastSelectionTime=Date.now()}function ensureListeners(view){view.someProp("handleDOMEvents",currentHandlers=>{for(let type in currentHandlers)view.input.eventHandlers[type]||view.dom.addEventListener(type,view.input.eventHandlers[type]=event=>runCustomHandler(view,event))})}function runCustomHandler(view,event){return view.someProp("handleDOMEvents",handlers=>{let handler=handlers[event.type];return!!handler&&(handler(view,event)||event.defaultPrevented)})}function eventCoords(event){return{left:event.clientX,top:event.clientY}}function runHandlerOnContext(view,propName,pos,inside,event){if(-1==inside)return!1;let $pos=view.state.doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--)if(view.someProp(propName,f=>i>$pos.depth?f(view,pos,$pos.nodeAfter,$pos.before(i),event,!0):f(view,pos,$pos.node(i),$pos.before(i),event,!1)))return!0;return!1}function updateSelection(view,selection,origin){view.focused||view.focus();let tr=view.state.tr.setSelection(selection);"pointer"==origin&&tr.setMeta("pointer",!0),view.dispatch(tr)}function handleDoubleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleDoubleClickOn",pos,inside,event)||view.someProp("handleDoubleClick",f=>f(view,pos,event))}function handleTripleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleTripleClickOn",pos,inside,event)||view.someProp("handleTripleClick",f=>f(view,pos,event))||function(view,inside,event){if(0!=event.button)return!1;let doc=view.state.doc;if(-1==inside)return!!doc.inlineContent&&(updateSelection(view,TextSelection.create(doc,0,doc.content.size),"pointer"),!0);let $pos=doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--){let node=i>$pos.depth?$pos.nodeAfter:$pos.node(i),nodePos=$pos.before(i);if(node.inlineContent)updateSelection(view,TextSelection.create(doc,nodePos+1,nodePos+1+node.content.size),"pointer");else{if(!NodeSelection.isSelectable(node))continue;updateSelection(view,NodeSelection.create(doc,nodePos),"pointer")}return!0}}(view,inside,event)}editHandlers.keydown=(view,_event)=>{if(view.input.shiftKey=16==_event.keyCode||_event.shiftKey,!inOrNearComposition(view,_event)&&(view.input.lastKeyCode=_event.keyCode,view.input.lastKeyCodeTime=Date.now(),!android||!chrome||13!=_event.keyCode)){if(229!=_event.keyCode&&view.domObserver.forceFlush(),!ios||13!=_event.keyCode||_event.ctrlKey||_event.altKey||_event.metaKey)view.someProp("handleKeyDown",f=>f(view,_event))||function(view,event){let result;let code=event.keyCode,mods=(result="",event.ctrlKey&&(result+="c"),event.metaKey&&(result+="m"),event.altKey&&(result+="a"),event.shiftKey&&(result+="s"),result);if(8==code||mac$2&&72==code&&"c"==mods)return stopNativeHorizontalDelete(view,-1)||skipIgnoredNodes(view,-1);if(46==code||mac$2&&68==code&&"c"==mods)return stopNativeHorizontalDelete(view,1)||skipIgnoredNodes(view,1);if(13==code||27==code)return!0;if(37==code||mac$2&&66==code&&"c"==mods){let dir=37==code?"ltr"==findDirection(view,view.state.selection.from)?-1:1:-1;return selectHorizontally(view,dir,mods)||skipIgnoredNodes(view,dir)}if(39==code||mac$2&&70==code&&"c"==mods){let dir1=39==code?"ltr"==findDirection(view,view.state.selection.from)?1:-1:1;return selectHorizontally(view,dir1,mods)||skipIgnoredNodes(view,dir1)}if(38==code||mac$2&&80==code&&"c"==mods)return selectVertically(view,-1,mods)||skipIgnoredNodes(view,-1);if(40==code||mac$2&&78==code&&"c"==mods)return function(view){if(!safari||view.state.selection.$head.parentOffset>0)return!1;let{focusNode,focusOffset}=view.domSelectionRange();if(focusNode&&1==focusNode.nodeType&&0==focusOffset&&focusNode.firstChild&&"false"==focusNode.firstChild.contentEditable){let child=focusNode.firstChild;switchEditable(view,child,"true"),setTimeout(()=>switchEditable(view,child,"false"),20)}return!1}(view)||selectVertically(view,1,mods)||skipIgnoredNodesAfter(view);else if(mods==(mac$2?"m":"c")&&(66==code||73==code||89==code||90==code))return!0;return!1}(view,_event)?_event.preventDefault():setSelectionOrigin(view,"key");else{let now=Date.now();view.input.lastIOSEnter=now,view.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{view.input.lastIOSEnter==now&&(view.someProp("handleKeyDown",f=>f(view,keyEvent(13,"Enter"))),view.input.lastIOSEnter=0)},200)}}},editHandlers.keyup=(view,event)=>{16==event.keyCode&&(view.input.shiftKey=!1)},editHandlers.keypress=(view,_event)=>{if(inOrNearComposition(view,_event)||!_event.charCode||_event.ctrlKey&&!_event.altKey||mac$2&&_event.metaKey)return;if(view.someProp("handleKeyPress",f=>f(view,_event))){_event.preventDefault();return}let sel=view.state.selection;if(!(sel instanceof TextSelection)||!sel.$from.sameParent(sel.$to)){let text=String.fromCharCode(_event.charCode);/[\r\n]/.test(text)||view.someProp("handleTextInput",f=>f(view,sel.$from.pos,sel.$to.pos,text))||view.dispatch(view.state.tr.insertText(text).scrollIntoView()),_event.preventDefault()}};let selectNodeModifier=mac$2?"metaKey":"ctrlKey";handlers.mousedown=(view,_event)=>{var click;let dx,dy;view.input.shiftKey=_event.shiftKey;let flushed=endComposition(view),now=Date.now(),type="singleClick";now-view.input.lastClick.time<500&&(dx=(click=view.input.lastClick).x-_event.clientX)*dx+(dy=click.y-_event.clientY)*dy<100&&!_event[selectNodeModifier]&&("singleClick"==view.input.lastClick.type?type="doubleClick":"doubleClick"==view.input.lastClick.type&&(type="tripleClick")),view.input.lastClick={time:now,x:_event.clientX,y:_event.clientY,type};let pos=view.posAtCoords(eventCoords(_event));pos&&("singleClick"==type?(view.input.mouseDown&&view.input.mouseDown.done(),view.input.mouseDown=new MouseDown(view,pos,_event,!!flushed)):("doubleClick"==type?handleDoubleClick:handleTripleClick)(view,pos.pos,pos.inside,_event)?_event.preventDefault():setSelectionOrigin(view,"pointer"))};class MouseDown{constructor(view,pos,event,flushed){let targetNode,targetPos;if(this.view=view,this.pos=pos,this.event=event,this.flushed=flushed,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=view.state.doc,this.selectNode=!!event[selectNodeModifier],this.allowDefault=event.shiftKey,pos.inside>-1)targetNode=view.state.doc.nodeAt(pos.inside),targetPos=pos.inside;else{let $pos=view.state.doc.resolve(pos.pos);targetNode=$pos.parent,targetPos=$pos.depth?$pos.before():0}let target=flushed?null:event.target,targetDesc=target?view.docView.nearestDesc(target,!0):null;this.target=targetDesc?targetDesc.dom:null;let{selection}=view.state;(0==event.button&&targetNode.type.spec.draggable&&!1!==targetNode.type.spec.selectable||selection instanceof NodeSelection&&selection.from<=targetPos&&selection.to>targetPos)&&(this.mightDrag={node:targetNode,pos:targetPos,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&gecko&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),view.root.addEventListener("mouseup",this.up=this.up.bind(this)),view.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(view,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>selectionToDOM(this.view)),this.view.input.mouseDown=null}up(event){if(this.done(),!this.view.dom.contains(event.target))return;let pos=this.pos;if(this.view.state.doc!=this.startDoc&&(pos=this.view.posAtCoords(eventCoords(event))),this.updateAllowDefault(event),this.allowDefault||!pos)setSelectionOrigin(this.view,"pointer");else{var view,pos1,inside,selectNode;(view=this.view,pos1=pos.pos,inside=pos.inside,selectNode=this.selectNode,runHandlerOnContext(view,"handleClickOn",pos1,inside,event)||view.someProp("handleClick",f=>f(view,pos1,event))||(selectNode?function(view,inside){if(-1==inside)return!1;let sel=view.state.selection,selectedNode,selectAt;sel instanceof NodeSelection&&(selectedNode=sel.node);let $pos=view.state.doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--){let node=i>$pos.depth?$pos.nodeAfter:$pos.node(i);if(NodeSelection.isSelectable(node)){selectAt=selectedNode&&sel.$from.depth>0&&i>=sel.$from.depth&&$pos.before(sel.$from.depth+1)==sel.$from.pos?$pos.before(sel.$from.depth):$pos.before(i);break}}return null!=selectAt&&(updateSelection(view,NodeSelection.create(view.state.doc,selectAt),"pointer"),!0)}(view,inside):function(view,inside){if(-1==inside)return!1;let $pos=view.state.doc.resolve(inside),node=$pos.nodeAfter;return!!(node&&node.isAtom&&NodeSelection.isSelectable(node))&&(updateSelection(view,new NodeSelection($pos),"pointer"),!0)}(view,inside)))?event.preventDefault():0==event.button&&(this.flushed||safari&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome&&!this.view.state.selection.visible&&2>=Math.min(Math.abs(pos.pos-this.view.state.selection.from),Math.abs(pos.pos-this.view.state.selection.to)))?(updateSelection(this.view,Selection.near(this.view.state.doc.resolve(pos.pos)),"pointer"),event.preventDefault()):setSelectionOrigin(this.view,"pointer")}}move(event){this.updateAllowDefault(event),setSelectionOrigin(this.view,"pointer"),0==event.buttons&&this.done()}updateAllowDefault(event){!this.allowDefault&&(Math.abs(this.event.x-event.clientX)>4||Math.abs(this.event.y-event.clientY)>4)&&(this.allowDefault=!0)}}function inOrNearComposition(view,event){return!!view.composing||!!(safari&&500>Math.abs(event.timeStamp-view.input.compositionEndedAt))&&(view.input.compositionEndedAt=-2e8,!0)}handlers.touchstart=view=>{view.input.lastTouch=Date.now(),endComposition(view),setSelectionOrigin(view,"pointer")},handlers.touchmove=view=>{view.input.lastTouch=Date.now(),setSelectionOrigin(view,"pointer")},handlers.contextmenu=view=>endComposition(view);let timeoutComposition=android?5e3:-1;function scheduleComposeEnd(view,delay){clearTimeout(view.input.composingTimeout),delay>-1&&(view.input.composingTimeout=setTimeout(()=>endComposition(view),delay))}function clearComposition(view){let event;for(view.composing&&(view.input.composing=!1,view.input.compositionEndedAt=((event=document.createEvent("Event")).initEvent("event",!0,!0),event.timeStamp));view.input.compositionNodes.length>0;)view.input.compositionNodes.pop().markParentsDirty()}function endComposition(view,forceUpdate=!1){if(!android||!(view.domObserver.flushingSoon>=0)){if(view.domObserver.forceFlush(),clearComposition(view),forceUpdate||view.docView&&view.docView.dirty){let sel=selectionFromDOM(view);return sel&&!sel.eq(view.state.selection)?view.dispatch(view.state.tr.setSelection(sel)):view.updateState(view.state),!0}return!1}}editHandlers.compositionstart=editHandlers.compositionupdate=view=>{if(!view.composing){view.domObserver.flush();let{state}=view,$pos=state.selection.$from;if(state.selection.empty&&(state.storedMarks||!$pos.textOffset&&$pos.parentOffset&&$pos.nodeBefore.marks.some(m=>!1===m.type.spec.inclusive)))view.markCursor=view.state.storedMarks||$pos.marks(),endComposition(view,!0),view.markCursor=null;else if(endComposition(view),gecko&&state.selection.empty&&$pos.parentOffset&&!$pos.textOffset&&$pos.nodeBefore.marks.length){let sel=view.domSelectionRange();for(let node=sel.focusNode,offset=sel.focusOffset;node&&1==node.nodeType&&0!=offset;){let before=offset<0?node.lastChild:node.childNodes[offset-1];if(!before)break;if(3==before.nodeType){view.domSelection().collapse(before,before.nodeValue.length);break}node=before,offset=-1}}view.input.composing=!0}scheduleComposeEnd(view,timeoutComposition)},editHandlers.compositionend=(view,event)=>{view.composing&&(view.input.composing=!1,view.input.compositionEndedAt=event.timeStamp,view.input.compositionID++,scheduleComposeEnd(view,20))};let brokenClipboardAPI=ie$1&&ie_version<15||ios&&webkit_version<604;function doPaste(view,text,html,preferPlain,event){let slice=parseFromClipboard(view,text,html,preferPlain,view.state.selection.$from);if(view.someProp("handlePaste",f=>f(view,event,slice||Slice$1.empty)))return!0;if(!slice)return!1;let singleNode=0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount?slice.content.firstChild:null,tr=singleNode?view.state.tr.replaceSelectionWith(singleNode,view.input.shiftKey):view.state.tr.replaceSelection(slice);return view.dispatch(tr.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}handlers.copy=editHandlers.cut=(view,_event)=>{let sel=view.state.selection,cut="cut"==_event.type;if(sel.empty)return;let data=brokenClipboardAPI?null:_event.clipboardData,{dom,text}=serializeForClipboard(view,sel.content());data?(_event.preventDefault(),data.clearData(),data.setData("text/html",dom.innerHTML),data.setData("text/plain",text)):function(view,dom){if(!view.dom.parentNode)return;let wrap=view.dom.parentNode.appendChild(document.createElement("div"));wrap.appendChild(dom),wrap.style.cssText="position: fixed; left: -10000px; top: 10px";let sel=getSelection(),range=document.createRange();range.selectNodeContents(dom),view.dom.blur(),sel.removeAllRanges(),sel.addRange(range),setTimeout(()=>{wrap.parentNode&&wrap.parentNode.removeChild(wrap),view.focus()},50)}(view,dom),cut&&view.dispatch(view.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},editHandlers.paste=(view,_event)=>{if(view.composing&&!android)return;let data=brokenClipboardAPI?null:_event.clipboardData;data&&doPaste(view,data.getData("text/plain"),data.getData("text/html"),view.input.shiftKey,_event)?_event.preventDefault():function(view,event){if(!view.dom.parentNode)return;let plainText=view.input.shiftKey||view.state.selection.$from.parent.type.spec.code,target=view.dom.parentNode.appendChild(document.createElement(plainText?"textarea":"div"));plainText||(target.contentEditable="true"),target.style.cssText="position: fixed; left: -10000px; top: 10px",target.focus(),setTimeout(()=>{view.focus(),target.parentNode&&target.parentNode.removeChild(target),plainText?doPaste(view,target.value,null,view.input.shiftKey,event):doPaste(view,target.textContent,target.innerHTML,view.input.shiftKey,event)},50)}(view,_event)};class Dragging{constructor(slice,move){this.slice=slice,this.move=move}}let dragCopyModifier=mac$2?"altKey":"ctrlKey";for(let prop in handlers.dragstart=(view,_event)=>{let event=_event,mouseDown=view.input.mouseDown;if(mouseDown&&mouseDown.done(),!event.dataTransfer)return;let sel=view.state.selection,pos=sel.empty?null:view.posAtCoords(eventCoords(event));if(pos&&pos.pos>=sel.from&&pos.pos<=(sel instanceof NodeSelection?sel.to-1:sel.to));else if(mouseDown&&mouseDown.mightDrag)view.dispatch(view.state.tr.setSelection(NodeSelection.create(view.state.doc,mouseDown.mightDrag.pos)));else if(event.target&&1==event.target.nodeType){let desc=view.docView.nearestDesc(event.target,!0);desc&&desc.node.type.spec.draggable&&desc!=view.docView&&view.dispatch(view.state.tr.setSelection(NodeSelection.create(view.state.doc,desc.posBefore)))}let slice=view.state.selection.content(),{dom,text}=serializeForClipboard(view,slice);event.dataTransfer.clearData(),event.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",dom.innerHTML),event.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI||event.dataTransfer.setData("text/plain",text),view.dragging=new Dragging(slice,!event[dragCopyModifier])},handlers.dragend=view=>{let dragging=view.dragging;window.setTimeout(()=>{view.dragging==dragging&&(view.dragging=null)},50)},editHandlers.dragover=editHandlers.dragenter=(_,e)=>e.preventDefault(),editHandlers.drop=(view,_event)=>{let dragging=view.dragging;if(view.dragging=null,!_event.dataTransfer)return;let eventPos=view.posAtCoords(eventCoords(_event));if(!eventPos)return;let $mouse=view.state.doc.resolve(eventPos.pos),slice=dragging&&dragging.slice;slice?view.someProp("transformPasted",f=>{slice=f(slice,view)}):slice=parseFromClipboard(view,_event.dataTransfer.getData(brokenClipboardAPI?"Text":"text/plain"),brokenClipboardAPI?null:_event.dataTransfer.getData("text/html"),!1,$mouse);let move=!!(dragging&&!_event[dragCopyModifier]);if(view.someProp("handleDrop",f=>f(view,_event,slice||Slice$1.empty,move))){_event.preventDefault();return}if(!slice)return;_event.preventDefault();let insertPos=slice?dropPoint(view.state.doc,$mouse.pos,slice):$mouse.pos;null==insertPos&&(insertPos=$mouse.pos);let tr=view.state.tr;move&&tr.deleteSelection();let pos=tr.mapping.map(insertPos),isNode=0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount,beforeInsert=tr.doc;if(isNode?tr.replaceRangeWith(pos,pos,slice.content.firstChild):tr.replaceRange(pos,pos,slice),tr.doc.eq(beforeInsert))return;let $pos=tr.doc.resolve(pos);if(isNode&&NodeSelection.isSelectable(slice.content.firstChild)&&$pos.nodeAfter&&$pos.nodeAfter.sameMarkup(slice.content.firstChild))tr.setSelection(new NodeSelection($pos));else{let end=tr.mapping.map(insertPos);tr.mapping.maps[tr.mapping.maps.length-1].forEach((_from,_to,_newFrom,newTo)=>end=newTo),tr.setSelection(selectionBetween(view,$pos,tr.doc.resolve(end)))}view.focus(),view.dispatch(tr.setMeta("uiEvent","drop"))},handlers.focus=view=>{view.input.lastFocus=Date.now(),view.focused||(view.domObserver.stop(),view.dom.classList.add("ProseMirror-focused"),view.domObserver.start(),view.focused=!0,setTimeout(()=>{view.docView&&view.hasFocus()&&!view.domObserver.currentSelection.eq(view.domSelectionRange())&&selectionToDOM(view)},20))},handlers.blur=(view,_event)=>{view.focused&&(view.domObserver.stop(),view.dom.classList.remove("ProseMirror-focused"),view.domObserver.start(),_event.relatedTarget&&view.dom.contains(_event.relatedTarget)&&view.domObserver.currentSelection.clear(),view.focused=!1)},handlers.beforeinput=(view,_event)=>{if(chrome&&android&&"deleteContentBackward"==_event.inputType){view.domObserver.flushSoon();let{domChangeCount}=view.input;setTimeout(()=>{if(view.input.domChangeCount!=domChangeCount||(view.dom.blur(),view.focus(),view.someProp("handleKeyDown",f=>f(view,keyEvent(8,"Backspace")))))return;let{$cursor}=view.state.selection;$cursor&&$cursor.pos>0&&view.dispatch(view.state.tr.delete($cursor.pos-1,$cursor.pos).scrollIntoView())},50)}},editHandlers)handlers[prop]=editHandlers[prop];function compareObjs(a,b){if(a==b)return!0;for(let p in a)if(a[p]!==b[p])return!1;for(let p1 in b)if(!(p1 in a))return!1;return!0}class WidgetType{constructor(toDOM,spec){this.toDOM=toDOM,this.spec=spec||noSpec,this.side=this.spec.side||0}map(mapping,span,offset,oldOffset){let{pos,deleted}=mapping.mapResult(span.from+oldOffset,this.side<0?-1:1);return deleted?null:new Decoration(pos-offset,pos-offset,this)}valid(){return!0}eq(other){return this==other||other instanceof WidgetType&&(this.spec.key&&this.spec.key==other.spec.key||this.toDOM==other.toDOM&&compareObjs(this.spec,other.spec))}destroy(node){this.spec.destroy&&this.spec.destroy(node)}}class InlineType{constructor(attrs,spec){this.attrs=attrs,this.spec=spec||noSpec}map(mapping,span,offset,oldOffset){let from=mapping.map(span.from+oldOffset,this.spec.inclusiveStart?-1:1)-offset,to=mapping.map(span.to+oldOffset,this.spec.inclusiveEnd?1:-1)-offset;return from>=to?null:new Decoration(from,to,this)}valid(_,span){return span.from<span.to}eq(other){return this==other||other instanceof InlineType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)}static is(span){return span.type instanceof InlineType}destroy(){}}class NodeType$1{constructor(attrs,spec){this.attrs=attrs,this.spec=spec||noSpec}map(mapping,span,offset,oldOffset){let from=mapping.mapResult(span.from+oldOffset,1);if(from.deleted)return null;let to=mapping.mapResult(span.to+oldOffset,-1);return to.deleted||to.pos<=from.pos?null:new Decoration(from.pos-offset,to.pos-offset,this)}valid(node,span){let{index,offset}=node.content.findIndex(span.from),child;return offset==span.from&&!(child=node.child(index)).isText&&offset+child.nodeSize==span.to}eq(other){return this==other||other instanceof NodeType$1&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)}destroy(){}}class Decoration{constructor(from,to,type){this.from=from,this.to=to,this.type=type}copy(from,to){return new Decoration(from,to,this.type)}eq(other,offset=0){return this.type.eq(other.type)&&this.from+offset==other.from&&this.to+offset==other.to}map(mapping,offset,oldOffset){return this.type.map(mapping,this,offset,oldOffset)}static widget(pos,toDOM,spec){return new Decoration(pos,pos,new WidgetType(toDOM,spec))}static inline(from,to,attrs,spec){return new Decoration(from,to,new InlineType(attrs,spec))}static node(from,to,attrs,spec){return new Decoration(from,to,new NodeType$1(attrs,spec))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}}let none=[],noSpec={};class DecorationSet{constructor(local,children){this.local=local.length?local:none,this.children=children.length?children:none}static create(doc,decorations){return decorations.length?buildTree(decorations,doc,0,noSpec):empty$1}find(start,end,predicate){let result=[];return this.findInner(null==start?0:start,null==end?1e9:end,result,0,predicate),result}findInner(start,end,result,offset,predicate){for(let i=0;i<this.local.length;i++){let span=this.local[i];span.from<=end&&span.to>=start&&(!predicate||predicate(span.spec))&&result.push(span.copy(span.from+offset,span.to+offset))}for(let i1=0;i1<this.children.length;i1+=3)if(this.children[i1]<end&&this.children[i1+1]>start){let childOff=this.children[i1]+1;this.children[i1+2].findInner(start-childOff,end-childOff,result,offset+childOff,predicate)}}map(mapping,doc,options){return this==empty$1||0==mapping.maps.length?this:this.mapInner(mapping,doc,0,0,options||noSpec)}mapInner(mapping,node,offset,oldOffset,options){let newLocal;for(let i=0;i<this.local.length;i++){let mapped=this.local[i].map(mapping,offset,oldOffset);mapped&&mapped.type.valid(node,mapped)?(newLocal||(newLocal=[])).push(mapped):options.onRemove&&options.onRemove(this.local[i].spec)}return this.children.length?function(oldChildren,newLocal,mapping,node,offset,oldOffset,options){let children=oldChildren.slice();for(let i=0,baseOffset=oldOffset;i<mapping.maps.length;i++){let moved=0;mapping.maps[i].forEach((oldStart,oldEnd,newStart,newEnd)=>{let dSize=newEnd-newStart-(oldEnd-oldStart);for(let i=0;i<children.length;i+=3){let end=children[i+1];if(end<0||oldStart>end+baseOffset-moved)continue;let start=children[i]+baseOffset-moved;oldEnd>=start?children[i+1]=oldStart<=start?-2:-1:newStart>=offset&&dSize&&(children[i]+=dSize,children[i+1]+=dSize)}moved+=dSize}),baseOffset=mapping.maps[i].map(baseOffset,-1)}let mustRebuild=!1;for(let i1=0;i1<children.length;i1+=3)if(children[i1+1]<0){if(-2==children[i1+1]){mustRebuild=!0,children[i1+1]=-1;continue}let from=mapping.map(oldChildren[i1]+oldOffset),fromLocal=from-offset;if(fromLocal<0||fromLocal>=node.content.size){mustRebuild=!0;continue}let toLocal=mapping.map(oldChildren[i1+1]+oldOffset,-1)-offset,{index,offset:childOffset}=node.content.findIndex(fromLocal),childNode=node.maybeChild(index);if(childNode&&childOffset==fromLocal&&childOffset+childNode.nodeSize==toLocal){let mapped=children[i1+2].mapInner(mapping,childNode,from+1,oldChildren[i1]+oldOffset+1,options);mapped!=empty$1?(children[i1]=fromLocal,children[i1+1]=toLocal,children[i1+2]=mapped):(children[i1+1]=-2,mustRebuild=!0)}else mustRebuild=!0}if(mustRebuild){let built=buildTree(function(children,oldChildren,decorations,mapping,offset,oldOffset,options){for(let i=0;i<children.length;i+=3)-1==children[i+1]&&function gather(set,oldOffset){for(let i=0;i<set.local.length;i++){let mapped=set.local[i].map(mapping,offset,oldOffset);mapped?decorations.push(mapped):options.onRemove&&options.onRemove(set.local[i].spec)}for(let i1=0;i1<set.children.length;i1+=3)gather(set.children[i1+2],set.children[i1]+oldOffset+1)}(children[i+2],oldChildren[i]+oldOffset+1);return decorations}(children,oldChildren,newLocal,mapping,offset,oldOffset,options),node,0,options);newLocal=built.local;for(let i2=0;i2<children.length;i2+=3)children[i2+1]<0&&(children.splice(i2,3),i2-=3);for(let i3=0,j=0;i3<built.children.length;i3+=3){let from1=built.children[i3];for(;j<children.length&&children[j]<from1;)j+=3;children.splice(j,0,built.children[i3],built.children[i3+1],built.children[i3+2])}}return new DecorationSet(newLocal.sort(byPos),children)}(this.children,newLocal||[],mapping,node,offset,oldOffset,options):newLocal?new DecorationSet(newLocal.sort(byPos),none):empty$1}add(doc,decorations){return decorations.length?this==empty$1?DecorationSet.create(doc,decorations):this.addInner(doc,decorations,0):this}addInner(doc,decorations,offset){let children,childIndex=0;doc.forEach((childNode,childOffset)=>{let baseOffset=childOffset+offset,found;if(found=takeSpansForNode(decorations,childNode,baseOffset)){for(children||(children=this.children.slice());childIndex<children.length&&children[childIndex]<childOffset;)childIndex+=3;children[childIndex]==childOffset?children[childIndex+2]=children[childIndex+2].addInner(childNode,found,baseOffset+1):children.splice(childIndex,0,childOffset,childOffset+childNode.nodeSize,buildTree(found,childNode,baseOffset+1,noSpec)),childIndex+=3}});let local=moveSpans(childIndex?withoutNulls(decorations):decorations,-offset);for(let i=0;i<local.length;i++)local[i].type.valid(doc,local[i])||local.splice(i--,1);return new DecorationSet(local.length?this.local.concat(local).sort(byPos):this.local,children||this.children)}remove(decorations){return 0==decorations.length||this==empty$1?this:this.removeInner(decorations,0)}removeInner(decorations,offset){let children=this.children,local=this.local;for(let i=0;i<children.length;i+=3){let found;let from=children[i]+offset,to=children[i+1]+offset;for(let j=0,span;j<decorations.length;j++)(span=decorations[j])&&span.from>from&&span.to<to&&(decorations[j]=null,(found||(found=[])).push(span));if(!found)continue;children==this.children&&(children=this.children.slice());let removed=children[i+2].removeInner(found,from+1);removed!=empty$1?children[i+2]=removed:(children.splice(i,3),i-=3)}if(local.length){for(let i1=0,span1;i1<decorations.length;i1++)if(span1=decorations[i1])for(let j1=0;j1<local.length;j1++)local[j1].eq(span1,offset)&&(local==this.local&&(local=this.local.slice()),local.splice(j1--,1))}return children==this.children&&local==this.local?this:local.length||children.length?new DecorationSet(local,children):empty$1}forChild(offset,node){let child,local;if(this==empty$1)return this;if(node.isLeaf)return DecorationSet.empty;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=offset){this.children[i]==offset&&(child=this.children[i+2]);break}let start=offset+1,end=start+node.content.size;for(let i1=0;i1<this.local.length;i1++){let dec=this.local[i1];if(dec.from<end&&dec.to>start&&dec.type instanceof InlineType){let from=Math.max(start,dec.from)-start,to=Math.min(end,dec.to)-start;from<to&&(local||(local=[])).push(dec.copy(from,to))}}if(local){let localSet=new DecorationSet(local.sort(byPos),none);return child?new DecorationGroup([localSet,child]):localSet}return child||empty$1}eq(other){if(this==other)return!0;if(!(other instanceof DecorationSet)||this.local.length!=other.local.length||this.children.length!=other.children.length)return!1;for(let i=0;i<this.local.length;i++)if(!this.local[i].eq(other.local[i]))return!1;for(let i1=0;i1<this.children.length;i1+=3)if(this.children[i1]!=other.children[i1]||this.children[i1+1]!=other.children[i1+1]||!this.children[i1+2].eq(other.children[i1+2]))return!1;return!0}locals(node){return removeOverlap(this.localsInner(node))}localsInner(node){if(this==empty$1)return none;if(node.inlineContent||!this.local.some(InlineType.is))return this.local;let result=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof InlineType||result.push(this.local[i]);return result}}DecorationSet.empty=new DecorationSet([],[]),DecorationSet.removeOverlap=removeOverlap;let empty$1=DecorationSet.empty;class DecorationGroup{constructor(members){this.members=members}map(mapping,doc){let mappedDecos=this.members.map(member=>member.map(mapping,doc,noSpec));return DecorationGroup.from(mappedDecos)}forChild(offset,child){if(child.isLeaf)return DecorationSet.empty;let found=[];for(let i=0;i<this.members.length;i++){let result=this.members[i].forChild(offset,child);result!=empty$1&&(result instanceof DecorationGroup?found=found.concat(result.members):found.push(result))}return DecorationGroup.from(found)}eq(other){if(!(other instanceof DecorationGroup)||other.members.length!=this.members.length)return!1;for(let i=0;i<this.members.length;i++)if(!this.members[i].eq(other.members[i]))return!1;return!0}locals(node){let result,sorted=!0;for(let i=0;i<this.members.length;i++){let locals=this.members[i].localsInner(node);if(locals.length){if(result){sorted&&(result=result.slice(),sorted=!1);for(let j=0;j<locals.length;j++)result.push(locals[j])}else result=locals}}return result?removeOverlap(sorted?result:result.sort(byPos)):none}static from(members){switch(members.length){case 0:return empty$1;case 1:return members[0];default:return new DecorationGroup(members.every(m=>m instanceof DecorationSet)?members:members.reduce((r,m)=>r.concat(m instanceof DecorationSet?m:m.members),[]))}}}function moveSpans(spans,offset){if(!offset||!spans.length)return spans;let result=[];for(let i=0;i<spans.length;i++){let span=spans[i];result.push(new Decoration(span.from+offset,span.to+offset,span.type))}return result}function takeSpansForNode(spans,node,offset){if(node.isLeaf)return null;let end=offset+node.nodeSize,found=null;for(let i=0,span;i<spans.length;i++)(span=spans[i])&&span.from>offset&&span.to<end&&((found||(found=[])).push(span),spans[i]=null);return found}function withoutNulls(array){let result=[];for(let i=0;i<array.length;i++)null!=array[i]&&result.push(array[i]);return result}function buildTree(spans,node,offset,options){let children=[],hasNulls=!1;node.forEach((childNode,localStart)=>{let found=takeSpansForNode(spans,childNode,localStart+offset);if(found){hasNulls=!0;let subtree=buildTree(found,childNode,offset+localStart+1,options);subtree!=empty$1&&children.push(localStart,localStart+childNode.nodeSize,subtree)}});let locals=moveSpans(hasNulls?withoutNulls(spans):spans,-offset).sort(byPos);for(let i=0;i<locals.length;i++)locals[i].type.valid(node,locals[i])||(options.onRemove&&options.onRemove(locals[i].spec),locals.splice(i--,1));return locals.length||children.length?new DecorationSet(locals,children):empty$1}function byPos(a,b){return a.from-b.from||a.to-b.to}function removeOverlap(spans){let working=spans;for(let i=0;i<working.length-1;i++){let span=working[i];if(span.from!=span.to)for(let j=i+1;j<working.length;j++){let next=working[j];if(next.from==span.from){next.to!=span.to&&(working==spans&&(working=spans.slice()),working[j]=next.copy(next.from,span.to),insertAhead(working,j+1,next.copy(span.to,next.to)));continue}next.from<span.to&&(working==spans&&(working=spans.slice()),working[i]=span.copy(span.from,next.from),insertAhead(working,j,span.copy(next.from,span.to)));break}}return working}function insertAhead(array,i,deco){for(;i<array.length&&byPos(deco,array[i])>0;)i++;array.splice(i,0,deco)}function viewDecorations(view){let found=[];return view.someProp("decorations",f=>{let result=f(view.state);result&&result!=empty$1&&found.push(result)}),view.cursorWrapper&&found.push(DecorationSet.create(view.state.doc,[view.cursorWrapper.deco])),DecorationGroup.from(found)}let observeOptions={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData=ie$1&&ie_version<=11;class SelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(sel){this.anchorNode=sel.anchorNode,this.anchorOffset=sel.anchorOffset,this.focusNode=sel.focusNode,this.focusOffset=sel.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(sel){return sel.anchorNode==this.anchorNode&&sel.anchorOffset==this.anchorOffset&&sel.focusNode==this.focusNode&&sel.focusOffset==this.focusOffset}}class DOMObserver{constructor(view,handleDOMChange){this.view=view,this.handleDOMChange=handleDOMChange,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new SelectionState,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver(mutations=>{for(let i=0;i<mutations.length;i++)this.queue.push(mutations[i]);ie$1&&ie_version<=11&&mutations.some(m=>"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length)?this.flushSoon():this.flush()}),useCharData&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,observeOptions)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let take=this.observer.takeRecords();if(take.length){for(let i=0;i<take.length;i++)this.queue.push(take[i]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(ie$1&&ie_version<=11&&!this.view.state.selection.empty){let sel=this.view.domSelectionRange();if(sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(sel){if(!sel.focusNode)return!0;let ancestors=new Set,container;for(let scan=sel.focusNode;scan;scan=parentNode(scan))ancestors.add(scan);for(let scan1=sel.anchorNode;scan1;scan1=parentNode(scan1))if(ancestors.has(scan1)){container=scan1;break}let desc=container&&this.view.docView.nearestDesc(container);if(desc&&desc.ignoreMutation({type:"selection",target:3==container.nodeType?container.parentNode:container}))return this.setCurSelection(),!0}flush(){var view;let{view:view1}=this;if(!view1.docView||this.flushingSoon>-1)return;let mutations=this.observer?this.observer.takeRecords():[];this.queue.length&&(mutations=this.queue.concat(mutations),this.queue.length=0);let sel=view1.domSelectionRange(),newSel=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(sel)&&hasFocusAndSelection(view1)&&!this.ignoreSelectionChange(sel),from=-1,to=-1,typeOver=!1,added=[];if(view1.editable)for(let i=0;i<mutations.length;i++){let result=this.registerMutation(mutations[i],added);result&&(from=from<0?result.from:Math.min(result.from,from),to=to<0?result.to:Math.max(result.to,to),result.typeOver&&(typeOver=!0))}if(gecko&&added.length>1){let brs=added.filter(n=>"BR"==n.nodeName);if(2==brs.length){let a=brs[0],b=brs[1];a.parentNode&&a.parentNode.parentNode==b.parentNode?b.remove():a.remove()}}let readSel=null;from<0&&newSel&&view1.input.lastFocus>Date.now()-200&&Math.max(view1.input.lastTouch,view1.input.lastClick.time)<Date.now()-300&&selectionCollapsed(sel)&&(readSel=selectionFromDOM(view1))&&readSel.eq(Selection.near(view1.state.doc.resolve(0),1))?(view1.input.lastFocus=0,selectionToDOM(view1),this.currentSelection.set(sel),view1.scrollToSelection()):(from>-1||newSel)&&(from>-1&&(view1.docView.markDirty(from,to),view=view1,cssChecked.has(view)||(cssChecked.set(view,null),-1===["normal","nowrap","pre-line"].indexOf(getComputedStyle(view.dom).whiteSpace))||(view.requiresGeckoHackNode=gecko,cssCheckWarned||(console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cssCheckWarned=!0))),this.handleDOMChange(from,to,typeOver,added),view1.docView&&view1.docView.dirty?view1.updateState(view1.state):this.currentSelection.eq(sel)||selectionToDOM(view1),this.currentSelection.set(sel))}registerMutation(mut,added){if(added.indexOf(mut.target)>-1)return null;let desc=this.view.docView.nearestDesc(mut.target);if("attributes"==mut.type&&(desc==this.view.docView||"contenteditable"==mut.attributeName||"style"==mut.attributeName&&!mut.oldValue&&!mut.target.getAttribute("style"))||!desc||desc.ignoreMutation(mut))return null;if("childList"==mut.type){for(let i=0;i<mut.addedNodes.length;i++)added.push(mut.addedNodes[i]);if(desc.contentDOM&&desc.contentDOM!=desc.dom&&!desc.contentDOM.contains(mut.target))return{from:desc.posBefore,to:desc.posAfter};let prev=mut.previousSibling,next=mut.nextSibling;if(ie$1&&ie_version<=11&&mut.addedNodes.length)for(let i1=0;i1<mut.addedNodes.length;i1++){let{previousSibling,nextSibling}=mut.addedNodes[i1];(!previousSibling||0>Array.prototype.indexOf.call(mut.addedNodes,previousSibling))&&(prev=previousSibling),(!nextSibling||0>Array.prototype.indexOf.call(mut.addedNodes,nextSibling))&&(next=nextSibling)}let fromOffset=prev&&prev.parentNode==mut.target?domIndex(prev)+1:0,from=desc.localPosFromDOM(mut.target,fromOffset,-1),toOffset=next&&next.parentNode==mut.target?domIndex(next):mut.target.childNodes.length,to=desc.localPosFromDOM(mut.target,toOffset,1);return{from,to}}return"attributes"==mut.type?{from:desc.posAtStart-desc.border,to:desc.posAtEnd+desc.border}:{from:desc.posAtStart,to:desc.posAtEnd,typeOver:mut.target.nodeValue==mut.oldValue}}}let cssChecked=new WeakMap,cssCheckWarned=!1;function ruleFromNode(dom){let desc=dom.pmViewDesc;if(desc)return desc.parseRule();if("BR"==dom.nodeName&&dom.parentNode){if(safari&&/^(ul|ol)$/i.test(dom.parentNode.nodeName)){let skip=document.createElement("div");return skip.appendChild(document.createElement("li")),{skip}}if(dom.parentNode.lastChild==dom||safari&&/^(tr|table)$/i.test(dom.parentNode.nodeName))return{ignore:!0}}else if("IMG"==dom.nodeName&&dom.getAttribute("mark-placeholder"))return{ignore:!0};return null}let isInline=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function resolveSelection(view,doc,parsedSel){return Math.max(parsedSel.anchor,parsedSel.head)>doc.content.size?null:selectionBetween(view,doc.resolve(parsedSel.anchor),doc.resolve(parsedSel.head))}function skipClosingAndOpening($pos,fromEnd,mayOpen){let depth=$pos.depth,end=fromEnd?$pos.end():$pos.pos;for(;depth>0&&(fromEnd||$pos.indexAfter(depth)==$pos.node(depth).childCount);)depth--,end++,fromEnd=!1;if(mayOpen){let next=$pos.node(depth).maybeChild($pos.indexAfter(depth));for(;next&&!next.isLeaf;)next=next.firstChild,end++}return end}class EditorView{constructor(place,props){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new InputState,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=props,this.state=props.state,this.directPlugins=props.plugins||[],this.directPlugins.forEach(checkStateComponent),this.dispatch=this.dispatch.bind(this),this.dom=place&&place.mount||document.createElement("div"),place&&(place.appendChild?place.appendChild(this.dom):"function"==typeof place?place(this.dom):place.mount&&(this.mounted=!0)),this.editable=getEditable(this),updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.domObserver=new DOMObserver(this,(from,to,typeOver,added)=>(function(view,from,to,typeOver,addedNodes){let preferredPos,preferredSide,nextSel,tr,storedMarks,markChange;if(from<0){let origin=view.input.lastSelectionTime>Date.now()-50?view.input.lastSelectionOrigin:null,newSel=selectionFromDOM(view,origin);if(newSel&&!view.state.selection.eq(newSel)){if(chrome&&android&&13===view.input.lastKeyCode&&Date.now()-100<view.input.lastKeyCodeTime&&view.someProp("handleKeyDown",f=>f(view,keyEvent(13,"Enter"))))return;let tr1=view.state.tr.setSelection(newSel);"pointer"==origin?tr1.setMeta("pointer",!0):"key"==origin&&tr1.scrollIntoView(),view.composing&&tr1.setMeta("composition",view.input.compositionID),view.dispatch(tr1)}return}let $before=view.state.doc.resolve(from),shared=$before.sharedDepth(to);from=$before.before(shared+1),to=view.state.doc.resolve(to).after(shared+1);let sel=view.state.selection,parse=function(view,from_,to_){let find,{node:parent,fromOffset,toOffset,from,to}=view.docView.parseRange(from_,to_),domSel=view.domSelectionRange(),anchor=domSel.anchorNode;if(anchor&&view.dom.contains(1==anchor.nodeType?anchor:anchor.parentNode)&&(find=[{node:anchor,offset:domSel.anchorOffset}],selectionCollapsed(domSel)||find.push({node:domSel.focusNode,offset:domSel.focusOffset})),chrome&&8===view.input.lastKeyCode)for(let off=toOffset;off>fromOffset;off--){let node=parent.childNodes[off-1],desc=node.pmViewDesc;if("BR"==node.nodeName&&!desc){toOffset=off;break}if(!desc||desc.size)break}let startDoc=view.state.doc,parser=view.someProp("domParser")||DOMParser$1.fromSchema(view.state.schema),$from=startDoc.resolve(from),sel=null,doc=parser.parse(parent,{topNode:$from.parent,topMatch:$from.parent.contentMatchAt($from.index()),topOpen:!0,from:fromOffset,to:toOffset,preserveWhitespace:"pre"!=$from.parent.type.whitespace||"full",findPositions:find,ruleFromNode,context:$from});if(find&&null!=find[0].pos){let anchor1=find[0].pos,head=find[1]&&find[1].pos;null==head&&(head=anchor1),sel={anchor:anchor1+from,head:head+from}}return{doc,sel,from,to}}(view,from,to),doc=view.state.doc,compare=doc.slice(parse.from,parse.to);8===view.input.lastKeyCode&&Date.now()-100<view.input.lastKeyCodeTime?(preferredPos=view.state.selection.to,preferredSide="end"):(preferredPos=view.state.selection.from,preferredSide="start"),view.input.lastKeyCode=null;let change=function(a,b,pos,preferredPos,preferredSide){let start=a.findDiffStart(b,pos);if(null==start)return null;let{a:endA,b:endB}=a.findDiffEnd(b,pos+a.size,pos+b.size);if("end"==preferredSide){let adjust=Math.max(0,start-Math.min(endA,endB));preferredPos-=endA+adjust-start}if(endA<start&&a.size<b.size){let move=preferredPos<=start&&preferredPos>=endA?start-preferredPos:0;start-=move,endB=start+(endB-endA),endA=start}else if(endB<start){let move1=preferredPos<=start&&preferredPos>=endB?start-preferredPos:0;start-=move1,endA=start+(endA-endB),endB=start}return{start,endA,endB}}(compare.content,parse.doc.content,parse.from,preferredPos,preferredSide);if((ios&&view.input.lastIOSEnter>Date.now()-225||android)&&addedNodes.some(n=>1==n.nodeType&&!isInline.test(n.nodeName))&&(!change||change.endA>=change.endB)&&view.someProp("handleKeyDown",f=>f(view,keyEvent(13,"Enter")))){view.input.lastIOSEnter=0;return}if(!change){if(typeOver&&sel instanceof TextSelection&&!sel.empty&&sel.$head.sameParent(sel.$anchor)&&!view.composing&&!(parse.sel&&parse.sel.anchor!=parse.sel.head))change={start:sel.from,endA:sel.to,endB:sel.to};else{if(parse.sel){let sel1=resolveSelection(view,view.state.doc,parse.sel);if(sel1&&!sel1.eq(view.state.selection)){let tr2=view.state.tr.setSelection(sel1);view.composing&&tr2.setMeta("composition",view.input.compositionID),view.dispatch(tr2)}}return}}if(chrome&&view.cursorWrapper&&parse.sel&&parse.sel.anchor==view.cursorWrapper.deco.from&&parse.sel.head==parse.sel.anchor){let size=change.endB-change.start;parse.sel={anchor:parse.sel.anchor+size,head:parse.sel.anchor+size}}view.input.domChangeCount++,view.state.selection.from<view.state.selection.to&&change.start==change.endB&&view.state.selection instanceof TextSelection&&(change.start>view.state.selection.from&&change.start<=view.state.selection.from+2&&view.state.selection.from>=parse.from?change.start=view.state.selection.from:change.endA<view.state.selection.to&&change.endA>=view.state.selection.to-2&&view.state.selection.to<=parse.to&&(change.endB+=view.state.selection.to-change.endA,change.endA=view.state.selection.to)),ie$1&&ie_version<=11&&change.endB==change.start+1&&change.endA==change.start&&change.start>parse.from&&" \xa0"==parse.doc.textBetween(change.start-parse.from-1,change.start-parse.from+1)&&(change.start--,change.endA--,change.endB--);let $from=parse.doc.resolveNoCache(change.start-parse.from),$to=parse.doc.resolveNoCache(change.endB-parse.from),$fromA=doc.resolve(change.start),inlineChange=$from.sameParent($to)&&$from.parent.inlineContent&&$fromA.end()>=change.endA;if((ios&&view.input.lastIOSEnter>Date.now()-225&&(!inlineChange||addedNodes.some(n=>"DIV"==n.nodeName||"P"==n.nodeName))||!inlineChange&&$from.pos<parse.doc.content.size&&(nextSel=Selection.findFrom(parse.doc.resolve($from.pos+1),1,!0))&&nextSel.head==$to.pos)&&view.someProp("handleKeyDown",f=>f(view,keyEvent(13,"Enter")))){view.input.lastIOSEnter=0;return}if(view.state.selection.anchor>change.start&&function(old,start,end,$newStart,$newEnd){if(!$newStart.parent.isTextblock||end-start<=$newEnd.pos-$newStart.pos||skipClosingAndOpening($newStart,!0,!1)<$newEnd.pos)return!1;let $start=old.resolve(start);if($start.parentOffset<$start.parent.content.size||!$start.parent.isTextblock)return!1;let $next=old.resolve(skipClosingAndOpening($start,!0,!0));return!(!$next.parent.isTextblock||$next.pos>end||skipClosingAndOpening($next,!0,!1)<end)&&$newStart.parent.content.cut($newStart.parentOffset).eq($next.parent.content)}(doc,change.start,change.endA,$from,$to)&&view.someProp("handleKeyDown",f=>f(view,keyEvent(8,"Backspace")))){android&&chrome&&view.domObserver.suppressSelectionUpdates();return}chrome&&android&&change.endB==change.start&&(view.input.lastAndroidDelete=Date.now()),android&&!inlineChange&&$from.start()!=$to.start()&&0==$to.parentOffset&&$from.depth==$to.depth&&parse.sel&&parse.sel.anchor==parse.sel.head&&parse.sel.head==change.endA&&(change.endB-=2,$to=parse.doc.resolveNoCache(change.endB-parse.from),setTimeout(()=>{view.someProp("handleKeyDown",function(f){return f(view,keyEvent(13,"Enter"))})},20));let chFrom=change.start,chTo=change.endA;if(inlineChange){if($from.pos==$to.pos)ie$1&&ie_version<=11&&0==$from.parentOffset&&(view.domObserver.suppressSelectionUpdates(),setTimeout(()=>selectionToDOM(view),20)),tr=view.state.tr.delete(chFrom,chTo),storedMarks=doc.resolve(change.start).marksAcross(doc.resolve(change.endA));else if(change.endA==change.endB&&(markChange=function(cur,prev){let curMarks=cur.firstChild.marks,prevMarks=prev.firstChild.marks,added=curMarks,removed=prevMarks,type,mark,update;for(let i=0;i<prevMarks.length;i++)added=prevMarks[i].removeFromSet(added);for(let i1=0;i1<curMarks.length;i1++)removed=curMarks[i1].removeFromSet(removed);if(1==added.length&&0==removed.length)mark=added[0],type="add",update=node=>node.mark(mark.addToSet(node.marks));else{if(0!=added.length||1!=removed.length)return null;mark=removed[0],type="remove",update=node=>node.mark(mark.removeFromSet(node.marks))}let updated=[];for(let i2=0;i2<prev.childCount;i2++)updated.push(update(prev.child(i2)));if(Fragment$1.from(updated).eq(cur))return{mark,type}}($from.parent.content.cut($from.parentOffset,$to.parentOffset),$fromA.parent.content.cut($fromA.parentOffset,change.endA-$fromA.start()))))tr=view.state.tr,"add"==markChange.type?tr.addMark(chFrom,chTo,markChange.mark):tr.removeMark(chFrom,chTo,markChange.mark);else if($from.parent.child($from.index()).isText&&$from.index()==$to.index()-($to.textOffset?0:1)){let text=$from.parent.textBetween($from.parentOffset,$to.parentOffset);if(view.someProp("handleTextInput",f=>f(view,chFrom,chTo,text)))return;tr=view.state.tr.insertText(text,chFrom,chTo)}}if(tr||(tr=view.state.tr.replace(chFrom,chTo,parse.doc.slice(change.start-parse.from,change.endB-parse.from))),parse.sel){let sel2=resolveSelection(view,tr.doc,parse.sel);sel2&&!(chrome&&android&&view.composing&&sel2.empty&&(change.start!=change.endB||view.input.lastAndroidDelete<Date.now()-100)&&(sel2.head==chFrom||sel2.head==tr.mapping.map(chTo)-1)||ie$1&&sel2.empty&&sel2.head==chFrom)&&tr.setSelection(sel2)}storedMarks&&tr.ensureMarks(storedMarks),view.composing&&tr.setMeta("composition",view.input.compositionID),view.dispatch(tr.scrollIntoView())})(this,from,to,typeOver,added)),this.domObserver.start(),function(view){for(let event in handlers){let handler=handlers[event];view.dom.addEventListener(event,view.input.eventHandlers[event]=event=>{!function(view,event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(let node=event.target;node!=view.dom;node=node.parentNode)if(!node||11==node.nodeType||node.pmViewDesc&&node.pmViewDesc.stopEvent(event))return!1;return!0}(view,event)||runCustomHandler(view,event)||!view.editable&&event.type in editHandlers||handler(view,event)},passiveHandlers[event]?{passive:!0}:void 0)}safari&&view.dom.addEventListener("input",()=>null),ensureListeners(view)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let prev=this._props;for(let name in this._props={},prev)this._props[name]=prev[name];this._props.state=this.state}return this._props}update(props){props.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this);let prevProps=this._props;this._props=props,props.plugins&&(props.plugins.forEach(checkStateComponent),this.directPlugins=props.plugins),this.updateStateInner(props.state,prevProps)}setProps(props){let updated={};for(let name in this._props)updated[name]=this._props[name];for(let name1 in updated.state=this.state,props)updated[name1]=props[name1];this.update(updated)}updateState(state){this.updateStateInner(state,this._props)}updateStateInner(state,prevProps){let prev=this.state,redraw=!1,updateSel=!1;state.storedMarks&&this.composing&&(clearComposition(this),updateSel=!0),this.state=state;let pluginsChanged=prev.plugins!=state.plugins||this._props.plugins!=prevProps.plugins;if(pluginsChanged||this._props.plugins!=prevProps.plugins||this._props.nodeViews!=prevProps.nodeViews){let nodeViews=buildNodeViews(this);(function(a,b){let nA=0,nB=0;for(let prop in a){if(a[prop]!=b[prop])return!0;nA++}for(let _ in b)nB++;return nA!=nB})(nodeViews,this.nodeViews)&&(this.nodeViews=nodeViews,redraw=!0)}(pluginsChanged||prevProps.handleDOMEvents!=this._props.handleDOMEvents)&&ensureListeners(this),this.editable=getEditable(this),updateCursorWrapper(this);let innerDeco=viewDecorations(this),outerDeco=computeDocDeco(this),scroll=prev.plugins==state.plugins||prev.doc.eq(state.doc)?state.scrollToSelection>prev.scrollToSelection?"to selection":"preserve":"reset",updateDoc=redraw||!this.docView.matchesNode(state.doc,outerDeco,innerDeco);(updateDoc||!state.selection.eq(prev.selection))&&(updateSel=!0);let oldScrollPos="preserve"==scroll&&updateSel&&null==this.dom.style.overflowAnchor&&function(view){let refDOM,refTop,rect=view.dom.getBoundingClientRect(),startY=Math.max(0,rect.top);for(let x=(rect.left+rect.right)/2,y=startY+1;y<Math.min(innerHeight,rect.bottom);y+=5){let dom=view.root.elementFromPoint(x,y);if(!dom||dom==view.dom||!view.dom.contains(dom))continue;let localRect=dom.getBoundingClientRect();if(localRect.top>=startY-20){refDOM=dom,refTop=localRect.top;break}}return{refDOM:refDOM,refTop:refTop,stack:scrollStack(view.dom)}}(this);if(updateSel){var sel1,sel2;let anchorDOM,domSel,depth;this.domObserver.stop();let forceSelUpdate=updateDoc&&(ie$1||chrome)&&!this.composing&&!prev.selection.empty&&!state.selection.empty&&(sel1=prev.selection,sel2=state.selection,depth=Math.min(sel1.$anchor.sharedDepth(sel1.head),sel2.$anchor.sharedDepth(sel2.head)),sel1.$anchor.start(depth)!=sel2.$anchor.start(depth));if(updateDoc){let chromeKludge=chrome?this.trackWrites=this.domSelectionRange().focusNode:null;(redraw||!this.docView.update(state.doc,outerDeco,innerDeco,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=docViewDesc(state.doc,outerDeco,innerDeco,this.dom,this)),chromeKludge&&!this.trackWrites&&(forceSelUpdate=!0)}forceSelUpdate||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&(anchorDOM=this.docView.domFromPos(this.state.selection.anchor,0),domSel=this.domSelectionRange(),isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)))?selectionToDOM(this,forceSelUpdate):(syncNodeSelection(this,state.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(prev),"reset"==scroll?this.dom.scrollTop=0:"to selection"==scroll?this.scrollToSelection():oldScrollPos&&function({refDOM,refTop,stack}){let newRefTop=refDOM?refDOM.getBoundingClientRect().top:0;restoreScrollStack(stack,0==newRefTop?0:newRefTop-refTop)}(oldScrollPos)}scrollToSelection(){let startDOM=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",f=>f(this)));else if(this.state.selection instanceof NodeSelection){let target=this.docView.domAfterPos(this.state.selection.from);1==target.nodeType&&scrollRectIntoView(this,target.getBoundingClientRect(),startDOM)}else scrollRectIntoView(this,this.coordsAtPos(this.state.selection.head,1),startDOM)}destroyPluginViews(){let view;for(;view=this.pluginViews.pop();)view.destroy&&view.destroy()}updatePluginViews(prevState){if(prevState&&prevState.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let i=0;i<this.pluginViews.length;i++){let pluginView=this.pluginViews[i];pluginView.update&&pluginView.update(this,prevState)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let i1=0;i1<this.directPlugins.length;i1++){let plugin=this.directPlugins[i1];plugin.spec.view&&this.pluginViews.push(plugin.spec.view(this))}for(let i2=0;i2<this.state.plugins.length;i2++){let plugin1=this.state.plugins[i2];plugin1.spec.view&&this.pluginViews.push(plugin1.spec.view(this))}}}someProp(propName,f){let prop=this._props&&this._props[propName],value;if(null!=prop&&(value=f?f(prop):prop))return value;for(let i=0;i<this.directPlugins.length;i++){let prop1=this.directPlugins[i].props[propName];if(null!=prop1&&(value=f?f(prop1):prop1))return value}let plugins=this.state.plugins;if(plugins)for(let i1=0;i1<plugins.length;i1++){let prop2=plugins[i1].props[propName];if(null!=prop2&&(value=f?f(prop2):prop2))return value}}hasFocus(){if(ie$1){let node=this.root.activeElement;if(node==this.dom)return!0;if(!node||!this.dom.contains(node))return!1;for(;node&&this.dom!=node&&this.dom.contains(node);){if("false"==node.contentEditable)return!1;node=node.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);let stored=scrollStack(dom);dom.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),preventScrollSupported||(preventScrollSupported=!1,restoreScrollStack(stored,0))}(this.dom),selectionToDOM(this),this.domObserver.start()}get root(){let cached=this._root;if(null==cached){for(let search=this.dom.parentNode;search;search=search.parentNode)if(9==search.nodeType||11==search.nodeType&&search.host)return search.getSelection||(Object.getPrototypeOf(search).getSelection=()=>search.ownerDocument.getSelection()),this._root=search}return cached||document}posAtCoords(coords){return function(view,coords){var dom;let parent,pos,doc=view.dom.ownerDocument,node,offset=0,caret=function(doc,x,y){if(doc.caretPositionFromPoint)try{let pos=doc.caretPositionFromPoint(x,y);if(pos)return{node:pos.offsetNode,offset:pos.offset}}catch(_){}if(doc.caretRangeFromPoint){let range=doc.caretRangeFromPoint(x,y);if(range)return{node:range.startContainer,offset:range.startOffset}}}(doc,coords.left,coords.top);caret&&({node,offset}=caret);let elt=(view.root.elementFromPoint?view.root:doc).elementFromPoint(coords.left,coords.top);if(!elt||!view.dom.contains(1!=elt.nodeType?elt.parentNode:elt)){let box=view.dom.getBoundingClientRect();if(!inRect(coords,box)||!(elt=function elementFromPoint(element,coords,box){let len=element.childNodes.length;if(len&&box.top<box.bottom)for(let startI=Math.max(0,Math.min(len-1,Math.floor(len*(coords.top-box.top)/(box.bottom-box.top))-2)),i=startI;;){let child=element.childNodes[i];if(1==child.nodeType){let rects=child.getClientRects();for(let j=0;j<rects.length;j++){let rect=rects[j];if(inRect(coords,rect))return elementFromPoint(child,coords,rect)}}if((i=(i+1)%len)==startI)break}return element}(view.dom,coords,box)))return null}if(safari)for(let p=elt;node&&p;p=parentNode(p))p.draggable&&(node=void 0);if(elt=(parent=(dom=elt).parentNode)&&/^li$/i.test(parent.nodeName)&&coords.left<dom.getBoundingClientRect().left?parent:dom,node){if(gecko&&1==node.nodeType&&(offset=Math.min(offset,node.childNodes.length))<node.childNodes.length){let next=node.childNodes[offset],box1;"IMG"==next.nodeName&&(box1=next.getBoundingClientRect()).right<=coords.left&&box1.bottom>coords.top&&offset++}node==view.dom&&offset==node.childNodes.length-1&&1==node.lastChild.nodeType&&coords.top>node.lastChild.getBoundingClientRect().bottom?pos=view.state.doc.content.size:(0==offset||1!=node.nodeType||"BR"!=node.childNodes[offset-1].nodeName)&&(pos=function(view,node,offset,coords){let outsideBlock=-1;for(let cur=node,sawBlock=!1;cur!=view.dom;){let desc=view.docView.nearestDesc(cur,!0);if(!desc)return null;if(1==desc.dom.nodeType&&(desc.node.isBlock&&desc.parent&&!sawBlock||!desc.contentDOM)){let rect=desc.dom.getBoundingClientRect();if(desc.node.isBlock&&desc.parent&&!sawBlock&&(sawBlock=!0,rect.left>coords.left||rect.top>coords.top?outsideBlock=desc.posBefore:(rect.right<coords.left||rect.bottom<coords.top)&&(outsideBlock=desc.posAfter)),!desc.contentDOM&&outsideBlock<0)return(desc.node.isBlock?coords.top<(rect.top+rect.bottom)/2:coords.left<(rect.left+rect.right)/2)?desc.posBefore:desc.posAfter}cur=desc.dom.parentNode}return outsideBlock>-1?outsideBlock:view.docView.posFromDOM(node,offset,-1)}(view,node,offset,coords))}null==pos&&(pos=function(view,elt,coords){let{node,offset}=function findOffsetInNode(node,coords){let firstBelow,coordsBelow,closest,dxClosest=2e8,coordsClosest,offset=0,rowBot=coords.top,rowTop=coords.top;for(let child=node.firstChild,childIndex=0;child;child=child.nextSibling,childIndex++){let rects;if(1==child.nodeType)rects=child.getClientRects();else{if(3!=child.nodeType)continue;rects=textRange(child).getClientRects()}for(let i=0;i<rects.length;i++){let rect=rects[i];if(rect.top<=rowBot&&rect.bottom>=rowTop){rowBot=Math.max(rect.bottom,rowBot),rowTop=Math.min(rect.top,rowTop);let dx=rect.left>coords.left?rect.left-coords.left:rect.right<coords.left?coords.left-rect.right:0;if(dx<dxClosest){closest=child,dxClosest=dx,coordsClosest=dx&&3==closest.nodeType?{left:rect.right<coords.left?rect.right:rect.left,top:coords.top}:coords,1==child.nodeType&&dx&&(offset=childIndex+(coords.left>=(rect.left+rect.right)/2?1:0));continue}}else rect.top>coords.top&&!firstBelow&&rect.left<=coords.left&&rect.right>=coords.left&&(firstBelow=child,coordsBelow={left:Math.max(rect.left,Math.min(rect.right,coords.left)),top:rect.top});!closest&&(coords.left>=rect.right&&coords.top>=rect.top||coords.left>=rect.left&&coords.top>=rect.bottom)&&(offset=childIndex+1)}}return(!closest&&firstBelow&&(closest=firstBelow,coordsClosest=coordsBelow,dxClosest=0),closest&&3==closest.nodeType)?function(node,coords){let len=node.nodeValue.length,range=document.createRange();for(let i=0;i<len;i++){range.setEnd(node,i+1),range.setStart(node,i);let rect=singleRect(range,1);if(rect.top!=rect.bottom&&inRect(coords,rect))return{node,offset:i+(coords.left>=(rect.left+rect.right)/2?1:0)}}return{node,offset:0}}(closest,coordsClosest):!closest||dxClosest&&1==closest.nodeType?{node,offset}:findOffsetInNode(closest,coordsClosest)}(elt,coords),bias=-1;if(1==node.nodeType&&!node.firstChild){let rect=node.getBoundingClientRect();bias=rect.left!=rect.right&&coords.left>(rect.left+rect.right)/2?1:-1}return view.docView.posFromDOM(node,offset,bias)}(view,elt,coords));let desc=view.docView.nearestDesc(elt,!0);return{pos,inside:desc?desc.posAtStart-desc.border:-1}}(this,coords)}coordsAtPos(pos,side=1){return coordsAtPos(this,pos,side)}domAtPos(pos,side=0){return this.docView.domFromPos(pos,side)}nodeDOM(pos){let desc=this.docView.descAt(pos);return desc?desc.nodeDOM:null}posAtDOM(node,offset,bias=-1){let pos=this.docView.posFromDOM(node,offset,bias);if(null==pos)throw RangeError("DOM position not inside the editor");return pos}endOfTextblock(dir,state){var view,state1,dir1;let sel,$pos;return view=this,state1=state||this.state,dir1=dir,cachedState==state1&&cachedDir==dir1?cachedResult:(cachedState=state1,cachedDir=dir1,cachedResult="up"==dir1||"down"==dir1?(sel=state1.selection,$pos="up"==dir1?sel.$from:sel.$to,withFlushedState(view,state1,()=>{let{node:dom}=view.docView.domFromPos($pos.pos,"up"==dir1?-1:1);for(;;){let nearest=view.docView.nearestDesc(dom,!0);if(!nearest)break;if(nearest.node.isBlock){dom=nearest.contentDOM||nearest.dom;break}dom=nearest.dom.parentNode}let coords=coordsAtPos(view,$pos.pos,1);for(let child=dom.firstChild;child;child=child.nextSibling){let boxes;if(1==child.nodeType)boxes=child.getClientRects();else{if(3!=child.nodeType)continue;boxes=textRange(child,0,child.nodeValue.length).getClientRects()}for(let i=0;i<boxes.length;i++){let box=boxes[i];if(box.bottom>box.top+1&&("up"==dir1?coords.top-box.top>(box.bottom-coords.top)*2:box.bottom-coords.bottom>(coords.bottom-box.top)*2))return!1}}return!0})):function(view,state,dir){let{$head}=state.selection;if(!$head.parent.isTextblock)return!1;let offset=$head.parentOffset,atEnd=offset==$head.parent.content.size,sel=view.domSelection();return maybeRTL.test($head.parent.textContent)&&sel.modify?withFlushedState(view,state,()=>{let{focusNode:oldNode,focusOffset:oldOff,anchorNode,anchorOffset}=view.domSelectionRange(),oldBidiLevel=sel.caretBidiLevel;sel.modify("move",dir,"character");let parentDOM=$head.depth?view.docView.domAfterPos($head.before()):view.dom,{focusNode:newNode,focusOffset:newOff}=view.domSelectionRange(),result=newNode&&!parentDOM.contains(1==newNode.nodeType?newNode:newNode.parentNode)||oldNode==newNode&&oldOff==newOff;try{sel.collapse(anchorNode,anchorOffset),oldNode&&(oldNode!=anchorNode||oldOff!=anchorOffset)&&sel.extend&&sel.extend(oldNode,oldOff)}catch(_){}return null!=oldBidiLevel&&(sel.caretBidiLevel=oldBidiLevel),result}):"left"==dir||"backward"==dir?!offset:atEnd}(view,state1,dir1))}pasteHTML(html,event){return doPaste(this,"",html,!1,event||new ClipboardEvent("paste"))}pasteText(text,event){return doPaste(this,text,null,!0,event||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(view){for(let type in view.domObserver.stop(),view.input.eventHandlers)view.dom.removeEventListener(type,view.input.eventHandlers[type]);clearTimeout(view.input.composingTimeout),clearTimeout(view.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(event){runCustomHandler(this,event)||!handlers[event.type]||!this.editable&&event.type in editHandlers||handlers[event.type](this,event)}dispatch(tr){let dispatchTransaction=this._props.dispatchTransaction;dispatchTransaction?dispatchTransaction.call(this,tr):this.updateState(this.state.apply(tr))}domSelectionRange(){return safari&&11===this.root.nodeType&&function(doc){let elt=doc.activeElement;for(;elt&&elt.shadowRoot;)elt=elt.shadowRoot.activeElement;return elt}(this.dom.ownerDocument)==this.dom?function(view){let found;function read(event){event.preventDefault(),event.stopImmediatePropagation(),found=event.getTargetRanges()[0]}view.dom.addEventListener("beforeinput",read,!0),document.execCommand("indent"),view.dom.removeEventListener("beforeinput",read,!0);let anchorNode=found.startContainer,anchorOffset=found.startOffset,focusNode=found.endContainer,focusOffset=found.endOffset,currentAnchor=view.domAtPos(view.state.selection.anchor);return isEquivalentPosition(currentAnchor.node,currentAnchor.offset,focusNode,focusOffset)&&([anchorNode,anchorOffset,focusNode,focusOffset]=[focusNode,focusOffset,anchorNode,anchorOffset]),{anchorNode,anchorOffset,focusNode,focusOffset}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function computeDocDeco(view){let attrs=Object.create(null);return attrs.class="ProseMirror",attrs.contenteditable=String(view.editable),view.someProp("attributes",value=>{if("function"==typeof value&&(value=value(view.state)),value)for(let attr in value)"class"==attr?attrs.class+=" "+value[attr]:"style"==attr?attrs.style=(attrs.style?attrs.style+";":"")+value[attr]:attrs[attr]||"contenteditable"==attr||"nodeName"==attr||(attrs[attr]=String(value[attr]))}),attrs.translate||(attrs.translate="no"),[Decoration.node(0,view.state.doc.content.size,attrs)]}function updateCursorWrapper(view){if(view.markCursor){let dom=document.createElement("img");dom.className="ProseMirror-separator",dom.setAttribute("mark-placeholder","true"),dom.setAttribute("alt",""),view.cursorWrapper={dom,deco:Decoration.widget(view.state.selection.head,dom,{raw:!0,marks:view.markCursor})}}else view.cursorWrapper=null}function getEditable(view){return!view.someProp("editable",value=>!1===value(view.state))}function buildNodeViews(view){let result=Object.create(null);function add(obj){for(let prop in obj)Object.prototype.hasOwnProperty.call(result,prop)||(result[prop]=obj[prop])}return view.someProp("nodeViews",add),view.someProp("markViews",add),result}function checkStateComponent(plugin){if(plugin.spec.state||plugin.spec.filterTransaction||plugin.spec.appendTransaction)throw RangeError("Plugins passed directly to the view must not have a state component")}for(var base$1={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac$1="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ie="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),i$1=0;i$1<10;i$1++)base$1[48+i$1]=base$1[96+i$1]=String(i$1);for(var i$1=1;i$1<=24;i$1++)base$1[i$1+111]="F"+i$1;for(var i$1=65;i$1<=90;i$1++)base$1[i$1]=String.fromCharCode(i$1+32),shift[i$1]=String.fromCharCode(i$1);for(var code$1 in base$1)shift.hasOwnProperty(code$1)||(shift[code$1]=base$1[code$1]);let mac="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function modifiers(name,event,shift=!0){return event.altKey&&(name="Alt-"+name),event.ctrlKey&&(name="Ctrl-"+name),event.metaKey&&(name="Meta-"+name),shift&&event.shiftKey&&(name="Shift-"+name),name}function keydownHandler(bindings){let map=function(map){let copy=Object.create(null);for(let prop in map)copy[function(name){let alt,ctrl,shift,meta,parts=name.split(/-(?!$)/),result=parts[parts.length-1];"Space"==result&&(result=" ");for(let i=0;i<parts.length-1;i++){let mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else if(/^mod$/i.test(mod))mac?meta=!0:ctrl=!0;else throw Error("Unrecognized modifier name: "+mod)}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),meta&&(result="Meta-"+result),shift&&(result="Shift-"+result),result}(prop)]=map[prop];return copy}(bindings);return function(view,event){var name;let name1=("Esc"==(name=!(mac$1&&event.metaKey&&event.shiftKey&&!event.ctrlKey&&!event.altKey||ie&&event.shiftKey&&event.key&&1==event.key.length||"Unidentified"==event.key)&&event.key||(event.shiftKey?shift:base$1)[event.keyCode]||event.key||"Unidentified")&&(name="Escape"),"Del"==name&&(name="Delete"),"Left"==name&&(name="ArrowLeft"),"Up"==name&&(name="ArrowUp"),"Right"==name&&(name="ArrowRight"),"Down"==name&&(name="ArrowDown"),name),baseName,direct=map[modifiers(name1,event)];if(direct&&direct(view.state,view.dispatch,view))return!0;if(1==name1.length&&" "!=name1){if(event.shiftKey){let noShift=map[modifiers(name1,event,!1)];if(noShift&&noShift(view.state,view.dispatch,view))return!0}if((event.shiftKey||event.altKey||event.metaKey||name1.charCodeAt(0)>127)&&(baseName=base$1[event.keyCode])&&baseName!=name1){let fromCode=map[modifiers(baseName,event)];if(fromCode&&fromCode(view.state,view.dispatch,view))return!0}}return!1}}class Fragment{constructor(content,size){if(this.content=content,this.size=size||0,null==size)for(let i=0;i<content.length;i++)this.size+=content[i].nodeSize}nodesBetween(from,to,f,nodeStart=0,parent){for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;if(end>from&&!1!==f(child,nodeStart+pos,parent||null,i)&&child.content.size){let start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}}descendants(f){this.nodesBetween(0,this.size,f)}textBetween(from,to,blockSeparator,leafText){let text="",separated=!0;return this.nodesBetween(from,to,(node,pos)=>{node.isText?(text+=node.text.slice(Math.max(from,pos)-pos,to-pos),separated=!blockSeparator):node.isLeaf?(leafText?text+="function"==typeof leafText?leafText(node):leafText:node.type.spec.leafText&&(text+=node.type.spec.leafText(node)),separated=!blockSeparator):!separated&&node.isBlock&&(text+=blockSeparator,separated=!0)},0),text}append(other){if(!other.size)return this;if(!this.size)return other;let last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment(content,this.size+other.size)}cut(from,to=this.size){if(0==from&&to==this.size)return this;let result=[],size=0;if(to>from)for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child=child.isText?child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment(result,size)}cutByIndex(from,to){return from==to?Fragment.empty:0==from&&to==this.content.length?this:new Fragment(this.content.slice(from,to))}replaceChild(index,node){let current=this.content[index];if(current==node)return this;let copy=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy[index]=node,new Fragment(copy,size)}addToStart(node){return new Fragment([node].concat(this.content),this.size+node.nodeSize)}addToEnd(node){return new Fragment(this.content.concat(node),this.size+node.nodeSize)}eq(other){if(this.content.length!=other.content.length)return!1;for(let i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(index){let found=this.content[index];if(!found)throw RangeError("Index "+index+" out of range for "+this);return found}maybeChild(index){return this.content[index]||null}forEach(f){for(let i=0,p=0;i<this.content.length;i++){let child=this.content[i];f(child,p,i),p+=child.nodeSize}}findDiffStart(other,pos=0){return function findDiffStart(a,b,pos){for(let i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;let childA=a.child(i),childB=b.child(i);if(childA==childB){pos+=childA.nodeSize;continue}if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(let j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){let inner=findDiffStart(childA.content,childB.content,pos+1);if(null!=inner)return inner}pos+=childA.nodeSize}}(this,other,pos)}findDiffEnd(other,pos=this.size,otherPos=other.size){return function findDiffEnd(a,b,posA,posB){for(let iA=a.childCount,iB=b.childCount;;){if(0==iA||0==iB)return iA==iB?null:{a:posA,b:posB};let childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA==childB){posA-=size,posB-=size;continue}if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){let same=0,minSize=Math.min(childA.text.length,childB.text.length);for(;same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){let inner=findDiffEnd(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}}(this,other,pos,otherPos)}findIndex(pos,round=-1){if(0==pos)return retIndex(0,pos);if(pos==this.size)return retIndex(this.content.length,pos);if(pos>this.size||pos<0)throw RangeError(`Position ${pos} outside of fragment (${this})`);for(let i=0,curPos=0;;i++){let end=curPos+this.child(i).nodeSize;if(end>=pos){if(end==pos||round>0)return retIndex(i+1,end);return retIndex(i,curPos)}curPos=end}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(n=>n.toJSON()):null}static fromJSON(schema,value){if(!value)return Fragment.empty;if(!Array.isArray(value))throw RangeError("Invalid input for Fragment.fromJSON");return new Fragment(value.map(schema.nodeFromJSON))}static fromArray(array){if(!array.length)return Fragment.empty;let joined,size=0;for(let i=0;i<array.length;i++){let node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment(joined||array,size)}static from(nodes){if(!nodes)return Fragment.empty;if(nodes instanceof Fragment)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment([nodes],nodes.nodeSize);throw RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);let found={index:0,offset:0};function retIndex(index,offset){return found.index=index,found.offset=offset,found}function compareDeep(a,b){if(a===b)return!0;if(!(a&&"object"==typeof a)||!(b&&"object"==typeof b))return!1;let array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compareDeep(a[i],b[i]))return!1}else{for(let p in a)if(!(p in b)||!compareDeep(a[p],b[p]))return!1;for(let p1 in b)if(!(p1 in a))return!1}return!0}class Mark$1{constructor(type,attrs){this.type=type,this.attrs=attrs}addToSet(set){let copy,placed=!1;for(let i=0;i<set.length;i++){let other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy||(copy=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy||(copy=set.slice(0,i)),copy.push(this),placed=!0),copy&&copy.push(other)}}return copy||(copy=set.slice()),placed||copy.push(this),copy}removeFromSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}isInSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}eq(other){return this==other||this.type==other.type&&compareDeep(this.attrs,other.attrs)}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return obj}static fromJSON(schema,json){if(!json)throw RangeError("Invalid input for Mark.fromJSON");let type=schema.marks[json.type];if(!type)throw RangeError(`There is no mark type ${json.type} in this schema`);return type.create(json.attrs)}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}static setFrom(marks){if(!marks||Array.isArray(marks)&&0==marks.length)return Mark$1.none;if(marks instanceof Mark$1)return[marks];let copy=marks.slice();return copy.sort((a,b)=>a.type.rank-b.type.rank),copy}}Mark$1.none=[];class ReplaceError extends Error{}class Slice{constructor(content,openStart,openEnd){this.content=content,this.openStart=openStart,this.openEnd=openEnd}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(pos,fragment){let content=function insertInto(content,dist,insert,parent){let{index,offset}=content.findIndex(dist),child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));let inner=insertInto(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}(this.content,pos+this.openStart,fragment);return content&&new Slice(content,this.openStart,this.openEnd)}removeBetween(from,to){return new Slice(function removeRange(content,from,to){let{index,offset}=content.findIndex(from),child=content.maybeChild(index),{index:indexTo,offset:offsetTo}=content.findIndex(to);if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange(child.content,from-offset-1,to-offset-1)))}(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)}eq(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json}static fromJSON(schema,json){if(!json)return Slice.empty;let openStart=json.openStart||0,openEnd=json.openEnd||0;if("number"!=typeof openStart||"number"!=typeof openEnd)throw RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(schema,json.content),openStart,openEnd)}static maxOpen(fragment,openIsolating=!0){let openStart=0,openEnd=0;for(let n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(let n1=fragment.lastChild;n1&&!n1.isLeaf&&(openIsolating||!n1.type.spec.isolating);n1=n1.lastChild)openEnd++;return new Slice(fragment,openStart,openEnd)}}function checkJoin(main,sub){if(!sub.type.compatibleContent(main.type))throw new ReplaceError("Cannot join "+sub.type.name+" onto "+main.type.name)}function joinable($before,$after,depth){let node=$before.node(depth);return checkJoin(node,$after.node(depth)),node}function addNode(child,target){let last=target.length-1;last>=0&&child.isText&&child.sameMarkup(target[last])?target[last]=child.withText(target[last].text+child.text):target.push(child)}function addRange($start,$end,depth,target){let node=($end||$start).node(depth),startIndex=0,endIndex=$end?$end.index(depth):node.childCount;$start&&(startIndex=$start.index(depth),$start.depth>depth?startIndex++:$start.textOffset&&(addNode($start.nodeAfter,target),startIndex++));for(let i=startIndex;i<endIndex;i++)addNode(node.child(i),target);$end&&$end.depth==depth&&$end.textOffset&&addNode($end.nodeBefore,target)}function close(node,content){return node.type.checkContent(content),node.copy(content)}function replaceTwoWay($from,$to,depth){let content=[];return addRange(null,$from,depth,content),$from.depth>depth&&addNode(close(joinable($from,$to,depth+1),replaceTwoWay($from,$to,depth+1)),content),addRange($to,null,depth,content),new Fragment(content)}Slice.empty=new Slice(Fragment.empty,0,0);class ResolvedPos{constructor(pos,path,parentOffset){this.pos=pos,this.path=path,this.parentOffset=parentOffset,this.depth=path.length/3-1}resolveDepth(val){return null==val?this.depth:val<0?this.depth+val:val}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(depth){return this.path[3*this.resolveDepth(depth)]}index(depth){return this.path[3*this.resolveDepth(depth)+1]}indexAfter(depth){return depth=this.resolveDepth(depth),this.index(depth)+(depth!=this.depth||this.textOffset?1:0)}start(depth){return 0==(depth=this.resolveDepth(depth))?0:this.path[3*depth-1]+1}end(depth){return depth=this.resolveDepth(depth),this.start(depth)+this.node(depth).content.size}before(depth){if(!(depth=this.resolveDepth(depth)))throw RangeError("There is no position before the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]}after(depth){if(!(depth=this.resolveDepth(depth)))throw RangeError("There is no position after the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]+this.path[3*depth].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let parent=this.parent,index=this.index(this.depth);if(index==parent.childCount)return null;let dOff=this.pos-this.path[this.path.length-1],child=parent.child(index);return dOff?parent.child(index).cut(dOff):child}get nodeBefore(){let index=this.index(this.depth),dOff=this.pos-this.path[this.path.length-1];return dOff?this.parent.child(index).cut(0,dOff):0==index?null:this.parent.child(index-1)}posAtIndex(index,depth){depth=this.resolveDepth(depth);let node=this.path[3*depth],pos=0==depth?0:this.path[3*depth-1]+1;for(let i=0;i<index;i++)pos+=node.child(i).nodeSize;return pos}marks(){let parent=this.parent,index=this.index();if(0==parent.content.size)return Mark$1.none;if(this.textOffset)return parent.child(index).marks;let main=parent.maybeChild(index-1),other=parent.maybeChild(index);if(!main){let tmp=main;main=other,other=tmp}let marks=main.marks;for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||other&&marks[i].isInSet(other.marks)||(marks=marks[i--].removeFromSet(marks));return marks}marksAcross($end){let after=this.parent.maybeChild(this.index());if(!after||!after.isInline)return null;let marks=after.marks,next=$end.parent.maybeChild($end.index());for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||next&&marks[i].isInSet(next.marks)||(marks=marks[i--].removeFromSet(marks));return marks}sharedDepth(pos){for(let depth=this.depth;depth>0;depth--)if(this.start(depth)<=pos&&this.end(depth)>=pos)return depth;return 0}blockRange(other=this,pred){if(other.pos<this.pos)return other.blockRange(this);for(let d=this.depth-(this.parent.inlineContent||this.pos==other.pos?1:0);d>=0;d--)if(other.pos<=this.end(d)&&(!pred||pred(this.node(d))))return new NodeRange(this,other,d);return null}sameParent(other){return this.pos-this.parentOffset==other.pos-other.parentOffset}max(other){return other.pos>this.pos?other:this}min(other){return other.pos<this.pos?other:this}toString(){let str="";for(let i=1;i<=this.depth;i++)str+=(str?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return str+":"+this.parentOffset}static resolve(doc,pos){if(!(pos>=0&&pos<=doc.content.size))throw RangeError("Position "+pos+" out of range");let path=[],start=0,parentOffset=pos;for(let node=doc;;){let{index,offset}=node.content.findIndex(parentOffset),rem=parentOffset-offset;if(path.push(node,index,start+offset),!rem||(node=node.child(index)).isText)break;parentOffset=rem-1,start+=offset+1}return new ResolvedPos(pos,path,parentOffset)}static resolveCached(doc,pos){for(let i=0;i<resolveCache.length;i++){let cached=resolveCache[i];if(cached.pos==pos&&cached.doc==doc)return cached}let result=resolveCache[resolveCachePos]=ResolvedPos.resolve(doc,pos);return resolveCachePos=(resolveCachePos+1)%resolveCacheSize,result}}let resolveCache=[],resolveCachePos=0,resolveCacheSize=12;class NodeRange{constructor($from,$to,depth){this.$from=$from,this.$to=$to,this.depth=depth}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}let emptyAttrs=Object.create(null);class Node$1{constructor(type,attrs,content,marks=Mark$1.none){this.type=type,this.attrs=attrs,this.marks=marks,this.content=content||Fragment.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(index){return this.content.child(index)}maybeChild(index){return this.content.maybeChild(index)}forEach(f){this.content.forEach(f)}nodesBetween(from,to,f,startPos=0){this.content.nodesBetween(from,to,f,startPos,this)}descendants(f){this.nodesBetween(0,this.content.size,f)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(from,to,blockSeparator,leafText){return this.content.textBetween(from,to,blockSeparator,leafText)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(other){return this==other||this.sameMarkup(other)&&this.content.eq(other.content)}sameMarkup(other){return this.hasMarkup(other.type,other.attrs,other.marks)}hasMarkup(type,attrs,marks){return this.type==type&&compareDeep(this.attrs,attrs||type.defaultAttrs||emptyAttrs)&&Mark$1.sameSet(this.marks,marks||Mark$1.none)}copy(content=null){return content==this.content?this:new Node$1(this.type,this.attrs,content,this.marks)}mark(marks){return marks==this.marks?this:new Node$1(this.type,this.attrs,this.content,marks)}cut(from,to=this.content.size){return 0==from&&to==this.content.size?this:this.copy(this.content.cut(from,to))}slice(from,to=this.content.size,includeParents=!1){if(from==to)return Slice.empty;let $from=this.resolve(from),$to=this.resolve(to),depth=includeParents?0:$from.sharedDepth(to),start=$from.start(depth),content=$from.node(depth).content.cut($from.pos-start,$to.pos-start);return new Slice(content,$from.depth-depth,$to.depth-depth)}replace(from,to,slice){return function($from,$to,slice){if(slice.openStart>$from.depth)throw new ReplaceError("Inserted content deeper than insertion position");if($from.depth-slice.openStart!=$to.depth-slice.openEnd)throw new ReplaceError("Inconsistent open depths");return function replaceOuter($from,$to,slice,depth){let index=$from.index(depth),node=$from.node(depth);if(index==$to.index(depth)&&depth<$from.depth-slice.openStart){let inner=replaceOuter($from,$to,slice,depth+1);return node.copy(node.content.replaceChild(index,inner))}if(!slice.content.size)return close(node,replaceTwoWay($from,$to,depth));if(slice.openStart||slice.openEnd||$from.depth!=depth||$to.depth!=depth){let{start,end}=function(slice,$along){let extra=$along.depth-slice.openStart,node=$along.node(extra).copy(slice.content);for(let i=extra-1;i>=0;i--)node=$along.node(i).copy(Fragment.from(node));return{start:node.resolveNoCache(slice.openStart+extra),end:node.resolveNoCache(node.content.size-slice.openEnd-extra)}}(slice,$from);return close(node,function replaceThreeWay($from,$start,$end,$to,depth){let openStart=$from.depth>depth&&joinable($from,$start,depth+1),openEnd=$to.depth>depth&&joinable($end,$to,depth+1),content=[];return addRange(null,$from,depth,content),openStart&&openEnd&&$start.index(depth)==$end.index(depth)?(checkJoin(openStart,openEnd),addNode(close(openStart,replaceThreeWay($from,$start,$end,$to,depth+1)),content)):(openStart&&addNode(close(openStart,replaceTwoWay($from,$start,depth+1)),content),addRange($start,$end,depth,content),openEnd&&addNode(close(openEnd,replaceTwoWay($end,$to,depth+1)),content)),addRange($to,null,depth,content),new Fragment(content)}($from,start,end,$to,depth))}{let parent=$from.parent,content=parent.content;return close(parent,content.cut(0,$from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))}}($from,$to,slice,0)}(this.resolve(from),this.resolve(to),slice)}nodeAt(pos){for(let node=this;;){let{index,offset}=node.content.findIndex(pos);if(!(node=node.maybeChild(index)))return null;if(offset==pos||node.isText)return node;pos-=offset+1}}childAfter(pos){let{index,offset}=this.content.findIndex(pos);return{node:this.content.maybeChild(index),index,offset}}childBefore(pos){if(0==pos)return{node:null,index:0,offset:0};let{index,offset}=this.content.findIndex(pos);if(offset<pos)return{node:this.content.child(index),index,offset};let node=this.content.child(index-1);return{node,index:index-1,offset:offset-node.nodeSize}}resolve(pos){return ResolvedPos.resolveCached(this,pos)}resolveNoCache(pos){return ResolvedPos.resolve(this,pos)}rangeHasMark(from,to,type){let found=!1;return to>from&&this.nodesBetween(from,to,node=>(type.isInSet(node.marks)&&(found=!0),!found)),found}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let name=this.type.name;return this.content.size&&(name+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,name)}contentMatchAt(index){let match=this.type.contentMatch.matchFragment(this.content,0,index);if(!match)throw Error("Called contentMatchAt on a node with invalid content");return match}canReplace(from,to,replacement=Fragment.empty,start=0,end=replacement.childCount){let one=this.contentMatchAt(from).matchFragment(replacement,start,end),two=one&&one.matchFragment(this.content,to);if(!two||!two.validEnd)return!1;for(let i=start;i<end;i++)if(!this.type.allowsMarks(replacement.child(i).marks))return!1;return!0}canReplaceWith(from,to,type,marks){if(marks&&!this.type.allowsMarks(marks))return!1;let start=this.contentMatchAt(from).matchType(type),end=start&&start.matchFragment(this.content,to);return!!end&&end.validEnd}canAppend(other){return other.content.size?this.canReplace(this.childCount,this.childCount,other.content):this.type.compatibleContent(other.type)}check(){this.type.checkContent(this.content);let copy=Mark$1.none;for(let i=0;i<this.marks.length;i++)copy=this.marks[i].addToSet(copy);if(!Mark$1.sameSet(copy,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(m=>m.type.name)}`);this.content.forEach(node=>node.check())}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return this.content.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map(n=>n.toJSON())),obj}static fromJSON(schema,json){if(!json)throw RangeError("Invalid input for Node.fromJSON");let marks=null;if(json.marks){if(!Array.isArray(json.marks))throw RangeError("Invalid mark data for Node.fromJSON");marks=json.marks.map(schema.markFromJSON)}if("text"==json.type){if("string"!=typeof json.text)throw RangeError("Invalid text node in JSON");return schema.text(json.text,marks)}let content=Fragment.fromJSON(schema,json.content);return schema.nodeType(json.type).create(json.attrs,content,marks)}}Node$1.prototype.text=void 0;class TextNode extends Node$1{constructor(type,attrs,content,marks){if(super(type,attrs,null,marks),!content)throw RangeError("Empty text nodes are not allowed");this.text=content}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(from,to){return this.text.slice(from,to)}get nodeSize(){return this.text.length}mark(marks){return marks==this.marks?this:new TextNode(this.type,this.attrs,this.text,marks)}withText(text){return text==this.text?this:new TextNode(this.type,this.attrs,text,this.marks)}cut(from=0,to=this.text.length){return 0==from&&to==this.text.length?this:this.withText(this.text.slice(from,to))}eq(other){return this.sameMarkup(other)&&this.text==other.text}toJSON(){let base=super.toJSON();return base.text=this.text,base}}function wrapMarks(marks,str){for(let i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}class ContentMatch{constructor(validEnd){this.validEnd=validEnd,this.next=[],this.wrapCache=[]}static parse(string,nodeTypes){var nfa;let labeled,stream=new TokenStream(string,nodeTypes);if(null==stream.next)return ContentMatch.empty;let expr=function parseExpr(stream){let exprs=[];do exprs.push(function(stream){let exprs=[];do exprs.push(function(stream){let expr=function(stream){if(stream.eat("(")){let expr=parseExpr(stream);return stream.eat(")")||stream.err("Missing closing paren"),expr}if(/\W/.test(stream.next))stream.err("Unexpected token '"+stream.next+"'");else{let exprs=(function(stream,name){let types=stream.nodeTypes,type=types[name];if(type)return[type];let result=[];for(let typeName in types){let type1=types[typeName];type1.groups.indexOf(name)>-1&&result.push(type1)}return 0==result.length&&stream.err("No node type or group '"+name+"' found"),result})(stream,stream.next).map(type=>(null==stream.inline?stream.inline=type.isInline:stream.inline!=type.isInline&&stream.err("Mixing inline and block content"),{type:"name",value:type}));return stream.pos++,1==exprs.length?exprs[0]:{type:"choice",exprs}}}(stream);for(;;)if(stream.eat("+"))expr={type:"plus",expr};else if(stream.eat("*"))expr={type:"star",expr};else if(stream.eat("?"))expr={type:"opt",expr};else if(stream.eat("{"))expr=function(stream,expr){let min=parseNum(stream),max=min;return stream.eat(",")&&(max="}"!=stream.next?parseNum(stream):-1),stream.eat("}")||stream.err("Unclosed braced range"),{type:"range",min,max,expr}}(stream,expr);else break;return expr}(stream));while(stream.next&&")"!=stream.next&&"|"!=stream.next);return 1==exprs.length?exprs[0]:{type:"seq",exprs}}(stream));while(stream.eat("|"));return 1==exprs.length?exprs[0]:{type:"choice",exprs}}(stream);stream.next&&stream.err("Unexpected trailing text");let match=(nfa=function(expr){let nfa=[[]];return connect(function compile(expr,from){if("choice"==expr.type)return expr.exprs.reduce((out,expr)=>out.concat(compile(expr,from)),[]);if("seq"==expr.type)for(let i=0;;i++){let next=compile(expr.exprs[i],from);if(i==expr.exprs.length-1)return next;connect(next,from=node())}else if("star"==expr.type){let loop=node();return edge(from,loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}else if("plus"==expr.type){let loop1=node();return connect(compile(expr.expr,from),loop1),connect(compile(expr.expr,loop1),loop1),[edge(loop1)]}else if("opt"==expr.type)return[edge(from)].concat(compile(expr.expr,from));else if("range"==expr.type){let cur=from;for(let i1=0;i1<expr.min;i1++){let next1=node();connect(compile(expr.expr,cur),next1),cur=next1}if(-1==expr.max)connect(compile(expr.expr,cur),cur);else for(let i2=expr.min;i2<expr.max;i2++){let next2=node();edge(cur,next2),connect(compile(expr.expr,cur),next2),cur=next2}return[edge(cur)]}else if("name"==expr.type)return[edge(from,void 0,expr.value)];else throw Error("Unknown expr type")}(expr,0),node()),nfa;function node(){return nfa.push([])-1}function edge(from,to,term){let edge={term,to};return nfa[from].push(edge),edge}function connect(edges,to){edges.forEach(edge=>edge.to=to)}}(expr),labeled=Object.create(null),function explore(states){let out=[];states.forEach(node=>{nfa[node].forEach(({term,to})=>{let set;if(term){for(let i=0;i<out.length;i++)out[i][0]==term&&(set=out[i][1]);nullFrom(nfa,to).forEach(node=>{set||out.push([term,set=[]]),-1==set.indexOf(node)&&set.push(node)})}})});let state=labeled[states.join(",")]=new ContentMatch(states.indexOf(nfa.length-1)>-1);for(let i=0;i<out.length;i++){let states1=out[i][1].sort(cmp);state.next.push({type:out[i][0],next:labeled[states1.join(",")]||explore(states1)})}return state}(nullFrom(nfa,0)));return function(match,stream){for(let i=0,work=[match];i<work.length;i++){let state=work[i],dead=!state.validEnd,nodes=[];for(let j=0;j<state.next.length;j++){let{type,next}=state.next[j];nodes.push(type.name),dead&&!(type.isText||type.hasRequiredAttrs())&&(dead=!1),-1==work.indexOf(next)&&work.push(next)}dead&&stream.err("Only non-generatable nodes ("+nodes.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(match,stream),match}matchType(type){for(let i=0;i<this.next.length;i++)if(this.next[i].type==type)return this.next[i].next;return null}matchFragment(frag,start=0,end=frag.childCount){let cur=this;for(let i=start;cur&&i<end;i++)cur=cur.matchType(frag.child(i).type);return cur}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let i=0;i<this.next.length;i++){let{type}=this.next[i];if(!(type.isText||type.hasRequiredAttrs()))return type}return null}compatible(other){for(let i=0;i<this.next.length;i++)for(let j=0;j<other.next.length;j++)if(this.next[i].type==other.next[j].type)return!0;return!1}fillBefore(after,toEnd=!1,startIndex=0){let seen=[this];return function search(match,types){let finished=match.matchFragment(after,startIndex);if(finished&&(!toEnd||finished.validEnd))return Fragment.from(types.map(tp=>tp.createAndFill()));for(let i=0;i<match.next.length;i++){let{type,next}=match.next[i];if(!(type.isText||type.hasRequiredAttrs())&&-1==seen.indexOf(next)){seen.push(next);let found=search(next,types.concat(type));if(found)return found}}return null}(this,[])}findWrapping(target){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==target)return this.wrapCache[i+1];let computed=this.computeWrapping(target);return this.wrapCache.push(target,computed),computed}computeWrapping(target){let seen=Object.create(null),active=[{match:this,type:null,via:null}];for(;active.length;){let current=active.shift(),match=current.match;if(match.matchType(target)){let result=[];for(let obj=current;obj.type;obj=obj.via)result.push(obj.type);return result.reverse()}for(let i=0;i<match.next.length;i++){let{type,next}=match.next[i];type.isLeaf||type.hasRequiredAttrs()||type.name in seen||current.type&&!next.validEnd||(active.push({match:type.contentMatch,type,via:current}),seen[type.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(n){if(n>=this.next.length)throw RangeError(`There's no ${n}th edge in this content match`);return this.next[n]}toString(){let seen=[];return!function scan(m){seen.push(m);for(let i=0;i<m.next.length;i++)-1==seen.indexOf(m.next[i].next)&&scan(m.next[i].next)}(this),seen.map((m,i)=>{let out=i+(m.validEnd?"*":" ")+" ";for(let i1=0;i1<m.next.length;i1++)out+=(i1?", ":"")+m.next[i1].type.name+"->"+seen.indexOf(m.next[i1].next);return out}).join("\n")}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(string,nodeTypes){this.string=string,this.nodeTypes=nodeTypes,this.inline=null,this.pos=0,this.tokens=string.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(tok){return this.next==tok&&(this.pos++||!0)}err(str){throw SyntaxError(str+" (in content expression '"+this.string+"')")}}function parseNum(stream){/\D/.test(stream.next)&&stream.err("Expected number, got '"+stream.next+"'");let result=Number(stream.next);return stream.pos++,result}function cmp(a,b){return b-a}function nullFrom(nfa,node){let result=[];return function scan(node){let edges=nfa[node];if(1==edges.length&&!edges[0].term)return scan(edges[0].to);result.push(node);for(let i=0;i<edges.length;i++){let{term,to}=edges[i];term||-1!=result.indexOf(to)||scan(to)}}(node),result.sort(cmp)}function defaultAttrs(attrs){let defaults=Object.create(null);for(let attrName in attrs){let attr=attrs[attrName];if(!attr.hasDefault)return null;defaults[attrName]=attr.default}return defaults}function computeAttrs(attrs,value){let built=Object.create(null);for(let name in attrs){let given=value&&value[name];if(void 0===given){let attr=attrs[name];if(attr.hasDefault)given=attr.default;else throw RangeError("No value supplied for attribute "+name)}built[name]=given}return built}function initAttrs(attrs){let result=Object.create(null);if(attrs)for(let name in attrs)result[name]=new Attribute(attrs[name]);return result}class NodeType{constructor(name,schema,spec){this.name=name,this.schema=schema,this.spec=spec,this.markSet=null,this.groups=spec.group?spec.group.split(" "):[],this.attrs=initAttrs(spec.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(spec.inline||"text"==name),this.isText="text"==name}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1}compatibleContent(other){return this==other||this.contentMatch.compatible(other.contentMatch)}computeAttrs(attrs){return!attrs&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,attrs)}create(attrs=null,content,marks){if(this.isText)throw Error("NodeType.create can't construct text nodes");return new Node$1(this,this.computeAttrs(attrs),Fragment.from(content),Mark$1.setFrom(marks))}createChecked(attrs=null,content,marks){return content=Fragment.from(content),this.checkContent(content),new Node$1(this,this.computeAttrs(attrs),content,Mark$1.setFrom(marks))}createAndFill(attrs=null,content,marks){if(attrs=this.computeAttrs(attrs),(content=Fragment.from(content)).size){let before=this.contentMatch.fillBefore(content);if(!before)return null;content=before.append(content)}let matched=this.contentMatch.matchFragment(content),after=matched&&matched.fillBefore(Fragment.empty,!0);return after?new Node$1(this,attrs,content.append(after),Mark$1.setFrom(marks)):null}validContent(content){let result=this.contentMatch.matchFragment(content);if(!result||!result.validEnd)return!1;for(let i=0;i<content.childCount;i++)if(!this.allowsMarks(content.child(i).marks))return!1;return!0}checkContent(content){if(!this.validContent(content))throw RangeError(`Invalid content for node ${this.name}: ${content.toString().slice(0,50)}`)}allowsMarkType(markType){return null==this.markSet||this.markSet.indexOf(markType)>-1}allowsMarks(marks){if(null==this.markSet)return!0;for(let i=0;i<marks.length;i++)if(!this.allowsMarkType(marks[i].type))return!1;return!0}allowedMarks(marks){let copy;if(null==this.markSet)return marks;for(let i=0;i<marks.length;i++)this.allowsMarkType(marks[i].type)?copy&&copy.push(marks[i]):copy||(copy=marks.slice(0,i));return copy?copy.length?copy:Mark$1.none:marks}static compile(nodes,schema){let result=Object.create(null);nodes.forEach((name,spec)=>result[name]=new NodeType(name,schema,spec));let topType=schema.spec.topNode||"doc";if(!result[topType])throw RangeError("Schema is missing its top node type ('"+topType+"')");if(!result.text)throw RangeError("Every schema needs a 'text' type");for(let _ in result.text.attrs)throw RangeError("The text node type should not have attributes");return result}}class Attribute{constructor(options){this.hasDefault=Object.prototype.hasOwnProperty.call(options,"default"),this.default=options.default}get isRequired(){return!this.hasDefault}}class MarkType{constructor(name,rank,schema,spec){this.name=name,this.rank=rank,this.schema=schema,this.spec=spec,this.attrs=initAttrs(spec.attrs),this.excluded=null;let defaults=defaultAttrs(this.attrs);this.instance=defaults?new Mark$1(this,defaults):null}create(attrs=null){return!attrs&&this.instance?this.instance:new Mark$1(this,computeAttrs(this.attrs,attrs))}static compile(marks,schema){let result=Object.create(null),rank=0;return marks.forEach((name,spec)=>result[name]=new MarkType(name,rank++,schema,spec)),result}removeFromSet(set){for(var i=0;i<set.length;i++)set[i].type==this&&(set=set.slice(0,i).concat(set.slice(i+1)),i--);return set}isInSet(set){for(let i=0;i<set.length;i++)if(set[i].type==this)return set[i]}excludes(other){return this.excluded.indexOf(other)>-1}}class Schema{constructor(spec){this.cached=Object.create(null);let instanceSpec=this.spec={};for(let prop in spec)instanceSpec[prop]=spec[prop];instanceSpec.nodes=OrderedMap.from(spec.nodes),instanceSpec.marks=OrderedMap.from(spec.marks||{}),this.nodes=NodeType.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let contentExprCache=Object.create(null);for(let prop1 in this.nodes){if(prop1 in this.marks)throw RangeError(prop1+" can not be both a node and a mark");let type=this.nodes[prop1],contentExpr=type.spec.content||"",markExpr=type.spec.marks;type.contentMatch=contentExprCache[contentExpr]||(contentExprCache[contentExpr]=ContentMatch.parse(contentExpr,this.nodes)),type.inlineContent=type.contentMatch.inlineContent,type.markSet="_"==markExpr?null:markExpr?gatherMarks(this,markExpr.split(" ")):""!=markExpr&&type.inlineContent?null:[]}for(let prop2 in this.marks){let type1=this.marks[prop2],excl=type1.spec.excludes;type1.excluded=null==excl?[type1]:""==excl?[]:gatherMarks(this,excl.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(type,attrs=null,content,marks){if("string"==typeof type)type=this.nodeType(type);else if(type instanceof NodeType){if(type.schema!=this)throw RangeError("Node type from different schema used ("+type.name+")")}else throw RangeError("Invalid node type: "+type);return type.createChecked(attrs,content,marks)}text(text,marks){let type=this.nodes.text;return new TextNode(type,type.defaultAttrs,text,Mark$1.setFrom(marks))}mark(type,attrs){return"string"==typeof type&&(type=this.marks[type]),type.create(attrs)}nodeFromJSON(json){return Node$1.fromJSON(this,json)}markFromJSON(json){return Mark$1.fromJSON(this,json)}nodeType(name){let found=this.nodes[name];if(!found)throw RangeError("Unknown node type: "+name);return found}}function gatherMarks(schema,marks){let found=[];for(let i=0;i<marks.length;i++){let name=marks[i],mark=schema.marks[name],ok=mark;if(mark)found.push(mark);else for(let prop in schema.marks){let mark1=schema.marks[prop];("_"==name||mark1.spec.group&&mark1.spec.group.split(" ").indexOf(name)>-1)&&found.push(ok=mark1)}if(!ok)throw SyntaxError("Unknown mark type: '"+marks[i]+"'")}return found}class DOMParser{constructor(schema,rules){this.schema=schema,this.rules=rules,this.tags=[],this.styles=[],rules.forEach(rule=>{rule.tag?this.tags.push(rule):rule.style&&this.styles.push(rule)}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let node=schema.nodes[r.node];return node.contentMatch.matchType(node)})}parse(dom,options={}){let context=new ParseContext(this,options,!1);return context.addAll(dom,options.from,options.to),context.finish()}parseSlice(dom,options={}){let context=new ParseContext(this,options,!0);return context.addAll(dom,options.from,options.to),Slice.maxOpen(context.finish())}matchTag(dom,context,after){for(let i=after?this.tags.indexOf(after)+1:0;i<this.tags.length;i++){var selector;let rule=this.tags[i];if(selector=rule.tag,(dom.matches||dom.msMatchesSelector||dom.webkitMatchesSelector||dom.mozMatchesSelector).call(dom,selector)&&(void 0===rule.namespace||dom.namespaceURI==rule.namespace)&&(!rule.context||context.matchesContext(rule.context))){if(rule.getAttrs){let result=rule.getAttrs(dom);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}matchStyle(prop,value,context,after){for(let i=after?this.styles.indexOf(after)+1:0;i<this.styles.length;i++){let rule=this.styles[i],style=rule.style;if(0==style.indexOf(prop)&&(!rule.context||context.matchesContext(rule.context))&&(!(style.length>prop.length)||61==style.charCodeAt(prop.length)&&style.slice(prop.length+1)==value)){if(rule.getAttrs){let result=rule.getAttrs(value);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}static schemaRules(schema){let result=[];function insert(rule){let priority=null==rule.priority?50:rule.priority,i=0;for(;i<result.length;i++){let next=result[i];if((null==next.priority?50:next.priority)<priority)break}result.splice(i,0,rule)}for(let name in schema.marks){let rules=schema.marks[name].spec.parseDOM;rules&&rules.forEach(rule=>{insert(rule=copy$1(rule)),rule.mark||rule.ignore||rule.clearMark||(rule.mark=name)})}for(let name1 in schema.nodes){let rules1=schema.nodes[name1].spec.parseDOM;rules1&&rules1.forEach(rule=>{insert(rule=copy$1(rule)),rule.node||rule.ignore||rule.mark||(rule.node=name1)})}return result}static fromSchema(schema){return schema.cached.domParser||(schema.cached.domParser=new DOMParser(schema,DOMParser.schemaRules(schema)))}}let blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0};function wsOptionsFor(type,preserveWhitespace,base){return null!=preserveWhitespace?(preserveWhitespace?1:0)|("full"===preserveWhitespace?2:0):type&&"pre"==type.whitespace?3:-5&base}class NodeContext{constructor(type,attrs,marks,pendingMarks,solid,match,options){this.type=type,this.attrs=attrs,this.marks=marks,this.pendingMarks=pendingMarks,this.solid=solid,this.options=options,this.content=[],this.activeMarks=Mark$1.none,this.stashMarks=[],this.match=match||(4&options?null:type.contentMatch)}findWrapping(node){if(!this.match){if(!this.type)return[];let fill=this.type.contentMatch.fillBefore(Fragment.from(node));if(fill)this.match=this.type.contentMatch.matchFragment(fill);else{let start=this.type.contentMatch,wrap;return(wrap=start.findWrapping(node.type))?(this.match=start,wrap):null}}return this.match.findWrapping(node.type)}finish(openEnd){if(!(1&this.options)){let last=this.content[this.content.length-1],m;last&&last.isText&&(m=/[ \t\r\n\u000c]+$/.exec(last.text))&&(last.text.length==m[0].length?this.content.pop():this.content[this.content.length-1]=last.withText(last.text.slice(0,last.text.length-m[0].length)))}let content=Fragment.from(this.content);return!openEnd&&this.match&&(content=content.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,content,this.marks):content}popFromStashMark(mark){for(let i=this.stashMarks.length-1;i>=0;i--)if(mark.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]}applyPending(nextType){for(let i=0,pending=this.pendingMarks;i<pending.length;i++){let mark=pending[i];(this.type?this.type.allowsMarkType(mark.type):function(markType,nodeType){let nodes=nodeType.schema.nodes;for(let name in nodes){let parent=nodes[name];if(!parent.allowsMarkType(markType))continue;let seen=[],scan=match=>{seen.push(match);for(let i=0;i<match.edgeCount;i++){let{type,next}=match.edge(i);if(type==nodeType||0>seen.indexOf(next)&&scan(next))return!0}};if(scan(parent.contentMatch))return!0}}(mark.type,nextType))&&!mark.isInSet(this.activeMarks)&&(this.activeMarks=mark.addToSet(this.activeMarks),this.pendingMarks=mark.removeFromSet(this.pendingMarks))}}inlineContext(node){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:node.parentNode&&!blockTags.hasOwnProperty(node.parentNode.nodeName.toLowerCase())}}class ParseContext{constructor(parser,options,isOpen){this.parser=parser,this.options=options,this.isOpen=isOpen,this.open=0;let topNode=options.topNode,topContext,topOptions=wsOptionsFor(null,options.preserveWhitespace,0)|(isOpen?4:0);topContext=topNode?new NodeContext(topNode.type,topNode.attrs,Mark$1.none,Mark$1.none,!0,options.topMatch||topNode.type.contentMatch,topOptions):isOpen?new NodeContext(null,null,Mark$1.none,Mark$1.none,!0,null,topOptions):new NodeContext(parser.schema.topNodeType,null,Mark$1.none,Mark$1.none,!0,null,topOptions),this.nodes=[topContext],this.find=options.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(dom){if(3==dom.nodeType)this.addTextNode(dom);else if(1==dom.nodeType){let style=dom.getAttribute("style");if(style){let marks=this.readStyles(function(style){let re=/\s*([\w-]+)\s*:\s*([^;]+)/g,m,result=[];for(;m=re.exec(style);)result.push(m[1],m[2].trim());return result}(style));if(!marks)return;let[addMarks,removeMarks]=marks,top=this.top;for(let i=0;i<removeMarks.length;i++)this.removePendingMark(removeMarks[i],top);for(let i1=0;i1<addMarks.length;i1++)this.addPendingMark(addMarks[i1]);this.addElement(dom);for(let i2=0;i2<addMarks.length;i2++)this.removePendingMark(addMarks[i2],top);for(let i3=0;i3<removeMarks.length;i3++)this.addPendingMark(removeMarks[i3])}else this.addElement(dom)}}addTextNode(dom){let value=dom.nodeValue,top=this.top;if(2&top.options||top.inlineContext(dom)||/[^ \t\r\n\u000c]/.test(value)){if(1&top.options)value=2&top.options?value.replace(/\r\n?/g,"\n"):value.replace(/\r?\n|\r/g," ");else if(value=value.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(value)&&this.open==this.nodes.length-1){let nodeBefore=top.content[top.content.length-1],domNodeBefore=dom.previousSibling;(!nodeBefore||domNodeBefore&&"BR"==domNodeBefore.nodeName||nodeBefore.isText&&/[ \t\r\n\u000c]$/.test(nodeBefore.text))&&(value=value.slice(1))}value&&this.insertNode(this.parser.schema.text(value)),this.findInText(dom)}else this.findInside(dom)}addElement(dom,matchAfter){let name=dom.nodeName.toLowerCase(),ruleID;listTags.hasOwnProperty(name)&&this.parser.normalizeLists&&function(dom){for(let child=dom.firstChild,prevItem=null;child;child=child.nextSibling){let name=1==child.nodeType?child.nodeName.toLowerCase():null;name&&listTags.hasOwnProperty(name)&&prevItem?(prevItem.appendChild(child),child=prevItem):"li"==name?prevItem=child:name&&(prevItem=null)}}(dom);let rule=this.options.ruleFromNode&&this.options.ruleFromNode(dom)||(ruleID=this.parser.matchTag(dom,this,matchAfter));if(rule?rule.ignore:ignoreTags.hasOwnProperty(name))this.findInside(dom),this.ignoreFallback(dom);else if(!rule||rule.skip||rule.closeParent){rule&&rule.closeParent?this.open=Math.max(0,this.open-1):rule&&rule.skip.nodeType&&(dom=rule.skip);let sync,top=this.top,oldNeedsBlock=this.needsBlock;if(blockTags.hasOwnProperty(name))top.content.length&&top.content[0].isInline&&this.open&&(this.open--,top=this.top),sync=!0,top.type||(this.needsBlock=!0);else if(!dom.firstChild){this.leafFallback(dom);return}this.addAll(dom),sync&&this.sync(top),this.needsBlock=oldNeedsBlock}else this.addElementByRule(dom,rule,!1===rule.consuming?ruleID:void 0)}leafFallback(dom){"BR"==dom.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(dom.ownerDocument.createTextNode("\n"))}ignoreFallback(dom){"BR"!=dom.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(styles){let add=Mark$1.none,remove=Mark$1.none;for(let i=0;i<styles.length;i+=2)for(let after;;){let rule=this.parser.matchStyle(styles[i],styles[i+1],this,after);if(!rule)break;if(rule.ignore)return null;if(rule.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach(m=>{rule.clearMark(m)&&(remove=m.addToSet(remove))}):add=this.parser.schema.marks[rule.mark].create(rule.attrs).addToSet(add),!1===rule.consuming)after=rule;else break}return[add,remove]}addElementByRule(dom,rule,continueAfter){let sync,nodeType,mark;rule.node?(nodeType=this.parser.schema.nodes[rule.node]).isLeaf?this.insertNode(nodeType.create(rule.attrs))||this.leafFallback(dom):sync=this.enter(nodeType,rule.attrs||null,rule.preserveWhitespace):(mark=this.parser.schema.marks[rule.mark].create(rule.attrs),this.addPendingMark(mark));let startIn=this.top;if(nodeType&&nodeType.isLeaf)this.findInside(dom);else if(continueAfter)this.addElement(dom,continueAfter);else if(rule.getContent)this.findInside(dom),rule.getContent(dom,this.parser.schema).forEach(node=>this.insertNode(node));else{let contentDOM=dom;"string"==typeof rule.contentElement?contentDOM=dom.querySelector(rule.contentElement):"function"==typeof rule.contentElement?contentDOM=rule.contentElement(dom):rule.contentElement&&(contentDOM=rule.contentElement),this.findAround(dom,contentDOM,!0),this.addAll(contentDOM)}sync&&this.sync(startIn)&&this.open--,mark&&this.removePendingMark(mark,startIn)}addAll(parent,startIndex,endIndex){let index=startIndex||0;for(let dom=startIndex?parent.childNodes[startIndex]:parent.firstChild,end=null==endIndex?null:parent.childNodes[endIndex];dom!=end;dom=dom.nextSibling,++index)this.findAtPoint(parent,index),this.addDOM(dom);this.findAtPoint(parent,index)}findPlace(node){let route,sync;for(let depth=this.open;depth>=0;depth--){let cx=this.nodes[depth],found=cx.findWrapping(node);if(found&&(!route||route.length>found.length)&&(route=found,sync=cx,!found.length)||cx.solid)break}if(!route)return!1;this.sync(sync);for(let i=0;i<route.length;i++)this.enterInner(route[i],null,!1);return!0}insertNode(node){if(node.isInline&&this.needsBlock&&!this.top.type){let block=this.textblockFromContext();block&&this.enterInner(block)}if(this.findPlace(node)){this.closeExtra();let top=this.top;top.applyPending(node.type),top.match&&(top.match=top.match.matchType(node.type));let marks=top.activeMarks;for(let i=0;i<node.marks.length;i++)(!top.type||top.type.allowsMarkType(node.marks[i].type))&&(marks=node.marks[i].addToSet(marks));return top.content.push(node.mark(marks)),!0}return!1}enter(type,attrs,preserveWS){let ok=this.findPlace(type.create(attrs));return ok&&this.enterInner(type,attrs,!0,preserveWS),ok}enterInner(type,attrs=null,solid=!1,preserveWS){this.closeExtra();let top=this.top;top.applyPending(type),top.match=top.match&&top.match.matchType(type);let options=wsOptionsFor(type,preserveWS,top.options);4&top.options&&0==top.content.length&&(options|=4),this.nodes.push(new NodeContext(type,attrs,top.activeMarks,top.pendingMarks,solid,null,options)),this.open++}closeExtra(openEnd=!1){let i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(openEnd));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(to){for(let i=this.open;i>=0;i--)if(this.nodes[i]==to)return this.open=i,!0;return!1}get currentPos(){this.closeExtra();let pos=0;for(let i=this.open;i>=0;i--){let content=this.nodes[i].content;for(let j=content.length-1;j>=0;j--)pos+=content[j].nodeSize;i&&pos++}return pos}findAtPoint(parent,offset){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==parent&&this.find[i].offset==offset&&(this.find[i].pos=this.currentPos)}findInside(parent){if(this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)}findAround(parent,content,before){if(parent!=content&&this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&content.compareDocumentPosition(this.find[i].node)&(before?2:4)&&(this.find[i].pos=this.currentPos)}findInText(textNode){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==textNode&&(this.find[i].pos=this.currentPos-(textNode.nodeValue.length-this.find[i].offset))}matchesContext(context){if(context.indexOf("|")>-1)return context.split(/\s*\|\s*/).some(this.matchesContext,this);let parts=context.split("/"),option=this.options.context,useRoot=!this.isOpen&&(!option||option.parent.type==this.nodes[0].type),minDepth=-(option?option.depth+1:0)+(useRoot?0:1),match=(i,depth)=>{for(;i>=0;i--){let part=parts[i];if(""==part){if(i==parts.length-1||0==i)continue;for(;depth>=minDepth;depth--)if(match(i-1,depth))return!0;return!1}{let next=depth>0||0==depth&&useRoot?this.nodes[depth].type:option&&depth>=minDepth?option.node(depth-minDepth).type:null;if(!next||next.name!=part&&-1==next.groups.indexOf(part))return!1;depth--}}return!0};return match(parts.length-1,this.open)}textblockFromContext(){let $context=this.options.context;if($context)for(let d=$context.depth;d>=0;d--){let deflt=$context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;if(deflt&&deflt.isTextblock&&deflt.defaultAttrs)return deflt}for(let name in this.parser.schema.nodes){let type=this.parser.schema.nodes[name];if(type.isTextblock&&type.defaultAttrs)return type}}addPendingMark(mark){let found=function(mark,set){for(let i=0;i<set.length;i++)if(mark.eq(set[i]))return set[i]}(mark,this.top.pendingMarks);found&&this.top.stashMarks.push(found),this.top.pendingMarks=mark.addToSet(this.top.pendingMarks)}removePendingMark(mark,upto){for(let depth=this.open;depth>=0;depth--){let level=this.nodes[depth];if(level.pendingMarks.lastIndexOf(mark)>-1)level.pendingMarks=mark.removeFromSet(level.pendingMarks);else{level.activeMarks=mark.removeFromSet(level.activeMarks);let stashMark=level.popFromStashMark(mark);stashMark&&level.type&&level.type.allowsMarkType(stashMark.type)&&(level.activeMarks=stashMark.addToSet(level.activeMarks))}if(level==upto)break}}}function copy$1(obj){let copy={};for(let prop in obj)copy[prop]=obj[prop];return copy}class DOMSerializer{constructor(nodes,marks){this.nodes=nodes,this.marks=marks}serializeFragment(fragment,options={},target){target||(target=doc(options).createDocumentFragment());let top=target,active=[];return fragment.forEach(node=>{if(active.length||node.marks.length){let keep=0,rendered=0;for(;keep<active.length&&rendered<node.marks.length;){let next=node.marks[rendered];if(!this.marks[next.type.name]){rendered++;continue}if(!next.eq(active[keep][0])||!1===next.type.spec.spanning)break;keep++,rendered++}for(;keep<active.length;)top=active.pop()[1];for(;rendered<node.marks.length;){let add=node.marks[rendered++],markDOM=this.serializeMark(add,node.isInline,options);markDOM&&(active.push([add,top]),top.appendChild(markDOM.dom),top=markDOM.contentDOM||markDOM.dom)}}top.appendChild(this.serializeNodeInner(node,options))}),target}serializeNodeInner(node,options){let{dom,contentDOM}=DOMSerializer.renderSpec(doc(options),this.nodes[node.type.name](node));if(contentDOM){if(node.isLeaf)throw RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(node.content,options,contentDOM)}return dom}serializeNode(node,options={}){let dom=this.serializeNodeInner(node,options);for(let i=node.marks.length-1;i>=0;i--){let wrap=this.serializeMark(node.marks[i],node.isInline,options);wrap&&((wrap.contentDOM||wrap.dom).appendChild(dom),dom=wrap.dom)}return dom}serializeMark(mark,inline,options={}){let toDOM=this.marks[mark.type.name];return toDOM&&DOMSerializer.renderSpec(doc(options),toDOM(mark,inline))}static renderSpec(doc,structure,xmlNS=null){let contentDOM;if("string"==typeof structure)return{dom:doc.createTextNode(structure)};if(null!=structure.nodeType)return{dom:structure};if(structure.dom&&null!=structure.dom.nodeType)return structure;let tagName=structure[0],space=tagName.indexOf(" ");space>0&&(xmlNS=tagName.slice(0,space),tagName=tagName.slice(space+1));let dom=xmlNS?doc.createElementNS(xmlNS,tagName):doc.createElement(tagName),attrs=structure[1],start=1;if(attrs&&"object"==typeof attrs&&null==attrs.nodeType&&!Array.isArray(attrs)){for(let name in start=2,attrs)if(null!=attrs[name]){let space1=name.indexOf(" ");space1>0?dom.setAttributeNS(name.slice(0,space1),name.slice(space1+1),attrs[name]):dom.setAttribute(name,attrs[name])}}for(let i=start;i<structure.length;i++){let child=structure[i];if(0===child){if(i<structure.length-1||i>start)throw RangeError("Content hole must be the only child of its parent node");return{dom,contentDOM:dom}}{let{dom:inner,contentDOM:innerContent}=DOMSerializer.renderSpec(doc,child,xmlNS);if(dom.appendChild(inner),innerContent){if(contentDOM)throw RangeError("Multiple content holes");contentDOM=innerContent}}}return{dom,contentDOM}}static fromSchema(schema){return schema.cached.domSerializer||(schema.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(schema),this.marksFromSchema(schema)))}static nodesFromSchema(schema){let result=gatherToDOM(schema.nodes);return result.text||(result.text=node=>node.text),result}static marksFromSchema(schema){return gatherToDOM(schema.marks)}}function gatherToDOM(obj){let result={};for(let name in obj){let toDOM=obj[name].spec.toDOM;toDOM&&(result[name]=toDOM)}return result}function doc(options){return options.document||window.document}let deleteSelection$1=(state,dispatch)=>!state.selection.empty&&(dispatch&&dispatch(state.tr.deleteSelection().scrollIntoView()),!0),joinBackward$1=(state,dispatch,view)=>{let $cursor=function(state,view){let{$cursor}=state.selection;return $cursor&&(view?view.endOfTextblock("backward",state):!($cursor.parentOffset>0))?$cursor:null}(state,view);if(!$cursor)return!1;let $cut=findCutBefore($cursor);if(!$cut){let range=$cursor.blockRange(),target=range&&liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}let before=$cut.nodeBefore;if(!before.type.spec.isolating&&deleteBarrier(state,$cut,dispatch))return!0;if(0==$cursor.parent.content.size&&(textblockAt(before,"end")||NodeSelection.isSelectable(before))){let delStep=replaceStep(state.doc,$cursor.before(),$cursor.after(),Slice$2.empty);if(delStep&&delStep.slice.size<delStep.to-delStep.from){if(dispatch){let tr=state.tr.step(delStep);tr.setSelection(textblockAt(before,"end")?Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos,-1)),-1):NodeSelection.create(tr.doc,$cut.pos-before.nodeSize)),dispatch(tr.scrollIntoView())}return!0}}return!!before.isAtom&&$cut.depth==$cursor.depth-1&&(dispatch&&dispatch(state.tr.delete($cut.pos-before.nodeSize,$cut.pos).scrollIntoView()),!0)};function textblockAt(node,side,only=!1){for(let scan=node;scan;scan="start"==side?scan.firstChild:scan.lastChild){if(scan.isTextblock)return!0;if(only&&1!=scan.childCount)break}return!1}let selectNodeBackward$1=(state,dispatch,view)=>{let{$head,empty}=state.selection,$cut=$head;if(!empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("backward",state):$head.parentOffset>0)return!1;$cut=findCutBefore($head)}let node=$cut&&$cut.nodeBefore;return!!(node&&NodeSelection.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(NodeSelection.create(state.doc,$cut.pos-node.nodeSize)).scrollIntoView()),!0)};function findCutBefore($pos){if(!$pos.parent.type.spec.isolating)for(let i=$pos.depth-1;i>=0;i--){if($pos.index(i)>0)return $pos.doc.resolve($pos.before(i+1));if($pos.node(i).type.spec.isolating)break}return null}let joinForward$1=(state,dispatch,view)=>{let $cursor=function(state,view){let{$cursor}=state.selection;return $cursor&&(view?view.endOfTextblock("forward",state):!($cursor.parentOffset<$cursor.parent.content.size))?$cursor:null}(state,view);if(!$cursor)return!1;let $cut=findCutAfter($cursor);if(!$cut)return!1;let after=$cut.nodeAfter;if(deleteBarrier(state,$cut,dispatch))return!0;if(0==$cursor.parent.content.size&&(textblockAt(after,"start")||NodeSelection.isSelectable(after))){let delStep=replaceStep(state.doc,$cursor.before(),$cursor.after(),Slice$2.empty);if(delStep&&delStep.slice.size<delStep.to-delStep.from){if(dispatch){let tr=state.tr.step(delStep);tr.setSelection(textblockAt(after,"start")?Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos)),1):NodeSelection.create(tr.doc,tr.mapping.map($cut.pos))),dispatch(tr.scrollIntoView())}return!0}}return!!after.isAtom&&$cut.depth==$cursor.depth-1&&(dispatch&&dispatch(state.tr.delete($cut.pos,$cut.pos+after.nodeSize).scrollIntoView()),!0)},selectNodeForward$1=(state,dispatch,view)=>{let{$head,empty}=state.selection,$cut=$head;if(!empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("forward",state):$head.parentOffset<$head.parent.content.size)return!1;$cut=findCutAfter($head)}let node=$cut&&$cut.nodeAfter;return!!(node&&NodeSelection.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(NodeSelection.create(state.doc,$cut.pos)).scrollIntoView()),!0)};function findCutAfter($pos){if(!$pos.parent.type.spec.isolating)for(let i=$pos.depth-1;i>=0;i--){let parent=$pos.node(i);if($pos.index(i)+1<parent.childCount)return $pos.doc.resolve($pos.after(i+1));if(parent.type.spec.isolating)break}return null}let joinUp$1=(state,dispatch)=>{let sel=state.selection,nodeSel=sel instanceof NodeSelection,point;if(nodeSel){if(sel.node.isTextblock||!canJoin(state.doc,sel.from))return!1;point=sel.from}else if(null==(point=joinPoint(state.doc,sel.from,-1)))return!1;if(dispatch){let tr=state.tr.join(point);nodeSel&&tr.setSelection(NodeSelection.create(tr.doc,point-state.doc.resolve(point).nodeBefore.nodeSize)),dispatch(tr.scrollIntoView())}return!0},joinDown$1=(state,dispatch)=>{let sel=state.selection,point;if(sel instanceof NodeSelection){if(sel.node.isTextblock||!canJoin(state.doc,sel.to))return!1;point=sel.to}else if(null==(point=joinPoint(state.doc,sel.to,1)))return!1;return dispatch&&dispatch(state.tr.join(point).scrollIntoView()),!0},lift$1=(state,dispatch)=>{let{$from,$to}=state.selection,range=$from.blockRange($to),target=range&&liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)},newlineInCode$1=(state,dispatch)=>{let{$head,$anchor}=state.selection;return!!($head.parent.type.spec.code&&$head.sameParent($anchor))&&(dispatch&&dispatch(state.tr.insertText("\n").scrollIntoView()),!0)};function defaultBlockAt$1(match){for(let i=0;i<match.edgeCount;i++){let{type}=match.edge(i);if(type.isTextblock&&!type.hasRequiredAttrs())return type}return null}let exitCode$1=(state,dispatch)=>{let{$head,$anchor}=state.selection;if(!$head.parent.type.spec.code||!$head.sameParent($anchor))return!1;let above=$head.node(-1),after=$head.indexAfter(-1),type=defaultBlockAt$1(above.contentMatchAt(after));if(!type||!above.canReplaceWith(after,after,type))return!1;if(dispatch){let pos=$head.after(),tr=state.tr.replaceWith(pos,pos,type.createAndFill());tr.setSelection(Selection.near(tr.doc.resolve(pos),1)),dispatch(tr.scrollIntoView())}return!0},createParagraphNear$1=(state,dispatch)=>{let sel=state.selection,{$from,$to}=sel;if(sel instanceof AllSelection||$from.parent.inlineContent||$to.parent.inlineContent)return!1;let type=defaultBlockAt$1($to.parent.contentMatchAt($to.indexAfter()));if(!type||!type.isTextblock)return!1;if(dispatch){let side=(!$from.parentOffset&&$to.index()<$to.parent.childCount?$from:$to).pos,tr=state.tr.insert(side,type.createAndFill());tr.setSelection(TextSelection.create(tr.doc,side+1)),dispatch(tr.scrollIntoView())}return!0},liftEmptyBlock$1=(state,dispatch)=>{let{$cursor}=state.selection;if(!$cursor||$cursor.parent.content.size)return!1;if($cursor.depth>1&&$cursor.after()!=$cursor.end(-1)){let before=$cursor.before();if(canSplit(state.doc,before))return dispatch&&dispatch(state.tr.split(before).scrollIntoView()),!0}let range=$cursor.blockRange(),target=range&&liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)},splitBlock$1=(state,dispatch)=>{let{$from,$to}=state.selection;if(state.selection instanceof NodeSelection&&state.selection.node.isBlock)return!!($from.parentOffset&&canSplit(state.doc,$from.pos))&&(dispatch&&dispatch(state.tr.split($from.pos).scrollIntoView()),!0);if(!$from.parent.isBlock)return!1;if(dispatch){let atEnd=$to.parentOffset==$to.parent.content.size,tr=state.tr;(state.selection instanceof TextSelection||state.selection instanceof AllSelection)&&tr.deleteSelection();let deflt=0==$from.depth?null:defaultBlockAt$1($from.node(-1).contentMatchAt($from.indexAfter(-1))),splitType=splitNode&&splitNode($to.parent,atEnd),types=splitType?[splitType]:atEnd&&deflt?[{type:deflt}]:void 0,can=canSplit(tr.doc,tr.mapping.map($from.pos),1,types);if(!types&&!can&&canSplit(tr.doc,tr.mapping.map($from.pos),1,deflt?[{type:deflt}]:void 0)&&(deflt&&(types=[{type:deflt}]),can=!0),can&&(tr.split(tr.mapping.map($from.pos),1,types),!atEnd&&!$from.parentOffset&&$from.parent.type!=deflt)){let first=tr.mapping.map($from.before()),$first=tr.doc.resolve(first);deflt&&$from.node(-1).canReplaceWith($first.index(),$first.index()+1,deflt)&&tr.setNodeMarkup(tr.mapping.map($from.before()),deflt)}dispatch(tr.scrollIntoView())}return!0},selectParentNode$1=(state,dispatch)=>{let{$from,to}=state.selection,pos,same=$from.sharedDepth(to);return 0!=same&&(pos=$from.before(same),dispatch&&dispatch(state.tr.setSelection(NodeSelection.create(state.doc,pos))),!0)},selectAll$1=(state,dispatch)=>(dispatch&&dispatch(state.tr.setSelection(new AllSelection(state.doc))),!0);function deleteBarrier(state,$cut,dispatch){let before,after,index,before1=$cut.nodeBefore,after1=$cut.nodeAfter,conn,match;if(before1.type.spec.isolating||after1.type.spec.isolating)return!1;if(before=$cut.nodeBefore,after=$cut.nodeAfter,index=$cut.index(),before&&after&&before.type.compatibleContent(after.type)&&(!before.content.size&&$cut.parent.canReplace(index-1,index)?(dispatch&&dispatch(state.tr.delete($cut.pos-before.nodeSize,$cut.pos).scrollIntoView()),!0):!!($cut.parent.canReplace(index,index+1)&&(after.isTextblock||canJoin(state.doc,$cut.pos)))&&(dispatch&&dispatch(state.tr.clearIncompatible($cut.pos,before.type,before.contentMatchAt(before.childCount)).join($cut.pos).scrollIntoView()),!0)))return!0;let canDelAfter=$cut.parent.canReplace($cut.index(),$cut.index()+1);if(canDelAfter&&(conn=(match=before1.contentMatchAt(before1.childCount)).findWrapping(after1.type))&&match.matchType(conn[0]||after1.type).validEnd){if(dispatch){let end=$cut.pos+after1.nodeSize,wrap=Fragment$2.empty;for(let i=conn.length-1;i>=0;i--)wrap=Fragment$2.from(conn[i].create(null,wrap));wrap=Fragment$2.from(before1.copy(wrap));let tr=state.tr.step(new ReplaceAroundStep($cut.pos-1,end,$cut.pos,end,new Slice$2(wrap,1,0),conn.length,!0)),joinAt=end+2*conn.length;canJoin(tr.doc,joinAt)&&tr.join(joinAt),dispatch(tr.scrollIntoView())}return!0}let selAfter=Selection.findFrom($cut,1),range=selAfter&&selAfter.$from.blockRange(selAfter.$to),target=range&&liftTarget(range);if(null!=target&&target>=$cut.depth)return dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0;if(canDelAfter&&textblockAt(after1,"start",!0)&&textblockAt(before1,"end")){let at=before1,wrap1=[];for(;wrap1.push(at),!at.isTextblock;)at=at.lastChild;let afterText=after1,afterDepth=1;for(;!afterText.isTextblock;afterText=afterText.firstChild)afterDepth++;if(at.canReplace(at.childCount,at.childCount,afterText.content)){if(dispatch){let end1=Fragment$2.empty;for(let i1=wrap1.length-1;i1>=0;i1--)end1=Fragment$2.from(wrap1[i1].copy(end1));dispatch(state.tr.step(new ReplaceAroundStep($cut.pos-wrap1.length,$cut.pos+after1.nodeSize,$cut.pos+afterDepth,$cut.pos+after1.nodeSize-afterDepth,new Slice$2(end1,wrap1.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function selectTextblockSide(side){return function(state,dispatch){let sel=state.selection,$pos=side<0?sel.$from:sel.$to,depth=$pos.depth;for(;$pos.node(depth).isInline;){if(!depth)return!1;depth--}return!!$pos.node(depth).isTextblock&&(dispatch&&dispatch(state.tr.setSelection(TextSelection.create(state.doc,side<0?$pos.start(depth):$pos.end(depth)))),!0)}}let selectTextblockStart$1=selectTextblockSide(-1),selectTextblockEnd$1=selectTextblockSide(1);function setBlockType(nodeType,attrs=null){return function(state,dispatch){let applicable=!1;for(let i=0;i<state.selection.ranges.length&&!applicable;i++){let{$from:{pos:from},$to:{pos:to}}=state.selection.ranges[i];state.doc.nodesBetween(from,to,(node,pos)=>{if(applicable)return!1;if(!(!node.isTextblock||node.hasMarkup(nodeType,attrs))){if(node.type==nodeType)applicable=!0;else{let $pos=state.doc.resolve(pos),index=$pos.index();applicable=$pos.parent.canReplaceWith(index,index+1,nodeType)}}})}if(!applicable)return!1;if(dispatch){let tr=state.tr;for(let i1=0;i1<state.selection.ranges.length;i1++){let{$from:{pos:from1},$to:{pos:to1}}=state.selection.ranges[i1];tr.setBlockType(from1,to1,nodeType,attrs)}dispatch(tr.scrollIntoView())}return!0}}function chainCommands(...commands){return function(state,dispatch,view){for(let i=0;i<commands.length;i++)if(commands[i](state,dispatch,view))return!0;return!1}}let backspace=chainCommands(deleteSelection$1,joinBackward$1,selectNodeBackward$1),del=chainCommands(deleteSelection$1,joinForward$1,selectNodeForward$1),pcBaseKeymap={Enter:chainCommands(newlineInCode$1,createParagraphNear$1,liftEmptyBlock$1,splitBlock$1),"Mod-Enter":exitCode$1,Backspace:backspace,"Mod-Backspace":backspace,"Shift-Backspace":backspace,Delete:del,"Mod-Delete":del,"Mod-a":selectAll$1},macBaseKeymap={"Ctrl-h":pcBaseKeymap.Backspace,"Alt-Backspace":pcBaseKeymap["Mod-Backspace"],"Ctrl-d":pcBaseKeymap.Delete,"Ctrl-Alt-Backspace":pcBaseKeymap["Mod-Delete"],"Alt-Delete":pcBaseKeymap["Mod-Delete"],"Alt-d":pcBaseKeymap["Mod-Delete"],"Ctrl-a":selectTextblockStart$1,"Ctrl-e":selectTextblockEnd$1};for(let key in pcBaseKeymap)macBaseKeymap[key]=pcBaseKeymap[key];function createChainableState(config){let{state,transaction}=config,{selection}=transaction,{doc}=transaction,{storedMarks}=transaction;return{...state,apply:state.apply.bind(state),applyTransaction:state.applyTransaction.bind(state),filterTransaction:state.filterTransaction,plugins:state.plugins,schema:state.schema,reconfigure:state.reconfigure.bind(state),toJSON:state.toJSON.bind(state),get storedMarks(){return storedMarks},get selection(){return selection},get doc(){return doc},get tr(){return selection=transaction.selection,doc=transaction.doc,storedMarks=transaction.storedMarks,transaction}}}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();class CommandManager{constructor(props){this.editor=props.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=props.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands,editor,state}=this,{view}=editor,{tr}=state,props=this.buildProps(tr);return Object.fromEntries(Object.entries(rawCommands).map(([name,command])=>{let method=(...args)=>{let callback=command(...args)(props);return tr.getMeta("preventDispatch")||this.hasCustomState||view.dispatch(tr),callback};return[name,method]}))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(startTr,shouldDispatch=!0){let{rawCommands,editor,state}=this,{view}=editor,callbacks=[],hasStartTransaction=!!startTr,tr=startTr||state.tr,run=()=>(hasStartTransaction||!shouldDispatch||tr.getMeta("preventDispatch")||this.hasCustomState||view.dispatch(tr),callbacks.every(callback=>!0===callback)),chain={...Object.fromEntries(Object.entries(rawCommands).map(([name,command])=>{let chainedCommand=(...args)=>{let props=this.buildProps(tr,shouldDispatch),callback=command(...args)(props);return callbacks.push(callback),chain};return[name,chainedCommand]})),run};return chain}createCan(startTr){let{rawCommands,state}=this,tr=startTr||state.tr,props=this.buildProps(tr,!1),formattedCommands=Object.fromEntries(Object.entries(rawCommands).map(([name,command])=>[name,(...args)=>command(...args)({...props,dispatch:void 0})]));return{...formattedCommands,chain:()=>this.createChain(tr,!1)}}buildProps(tr,shouldDispatch=!0){let{rawCommands,editor,state}=this,{view}=editor;state.storedMarks&&tr.setStoredMarks(state.storedMarks);let props={tr,editor,view,state:createChainableState({state,transaction:tr}),dispatch:shouldDispatch?()=>void 0:void 0,chain:()=>this.createChain(tr),can:()=>this.createCan(tr),get commands(){return Object.fromEntries(Object.entries(rawCommands).map(([name,command])=>[name,(...args)=>command(...args)(props)]))}};return props}}class EventEmitter{constructor(){this.callbacks={}}on(event,fn){return this.callbacks[event]||(this.callbacks[event]=[]),this.callbacks[event].push(fn),this}emit(event,...args){let callbacks=this.callbacks[event];return callbacks&&callbacks.forEach(callback=>callback.apply(this,args)),this}off(event,fn){let callbacks=this.callbacks[event];return callbacks&&(fn?this.callbacks[event]=callbacks.filter(callback=>callback!==fn):delete this.callbacks[event]),this}removeAllListeners(){this.callbacks={}}}function getExtensionField(extension,field,context){if(void 0===extension.config[field]&&extension.parent)return getExtensionField(extension.parent,field,context);if("function"==typeof extension.config[field]){let value=extension.config[field].bind({...context,parent:extension.parent?getExtensionField(extension.parent,field,context):null});return value}return extension.config[field]}function splitExtensions(extensions){let baseExtensions=extensions.filter(extension=>"extension"===extension.type),nodeExtensions=extensions.filter(extension=>"node"===extension.type),markExtensions=extensions.filter(extension=>"mark"===extension.type);return{baseExtensions,nodeExtensions,markExtensions}}function getAttributesFromExtensions(extensions){let extensionAttributes=[],{nodeExtensions,markExtensions}=splitExtensions(extensions),nodeAndMarkExtensions=[...nodeExtensions,...markExtensions],defaultAttribute={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return extensions.forEach(extension=>{let context={name:extension.name,options:extension.options,storage:extension.storage},addGlobalAttributes=getExtensionField(extension,"addGlobalAttributes",context);if(!addGlobalAttributes)return;let globalAttributes=addGlobalAttributes();globalAttributes.forEach(globalAttribute=>{globalAttribute.types.forEach(type=>{Object.entries(globalAttribute.attributes).forEach(([name,attribute])=>{extensionAttributes.push({type,name,attribute:{...defaultAttribute,...attribute}})})})})}),nodeAndMarkExtensions.forEach(extension=>{let context={name:extension.name,options:extension.options,storage:extension.storage},addAttributes=getExtensionField(extension,"addAttributes",context);if(!addAttributes)return;let attributes=addAttributes();Object.entries(attributes).forEach(([name,attribute])=>{let mergedAttr={...defaultAttribute,...attribute};"function"==typeof(null==mergedAttr?void 0:mergedAttr.default)&&(mergedAttr.default=mergedAttr.default()),(null==mergedAttr?void 0:mergedAttr.isRequired)&&(null==mergedAttr?void 0:mergedAttr.default)===void 0&&delete mergedAttr.default,extensionAttributes.push({type:extension.name,name,attribute:mergedAttr})})}),extensionAttributes}function getNodeType(nameOrType,schema){if("string"==typeof nameOrType){if(!schema.nodes[nameOrType])throw Error(`There is no node type named '${nameOrType}'. Maybe you forgot to add the extension?`);return schema.nodes[nameOrType]}return nameOrType}function mergeAttributes(...objects){return objects.filter(item=>!!item).reduce((items,item)=>{let mergedAttributes={...items};return Object.entries(item).forEach(([key,value])=>{let exists=mergedAttributes[key];if(!exists){mergedAttributes[key]=value;return}"class"===key?mergedAttributes[key]=[mergedAttributes[key],value].join(" "):"style"===key?mergedAttributes[key]=[mergedAttributes[key],value].join("; "):mergedAttributes[key]=value}),mergedAttributes},{})}function getRenderedAttributes(nodeOrMark,extensionAttributes){return extensionAttributes.filter(item=>item.attribute.rendered).map(item=>item.attribute.renderHTML?item.attribute.renderHTML(nodeOrMark.attrs)||{}:{[item.name]:nodeOrMark.attrs[item.name]}).reduce((attributes,attribute)=>mergeAttributes(attributes,attribute),{})}function isFunction$1(value){return"function"==typeof value}function callOrReturn(value,context,...props){return isFunction$1(value)?context?value.bind(context)(...props):value(...props):value}function injectExtensionAttributesToParseRule(parseRule,extensionAttributes){return parseRule.style?parseRule:{...parseRule,getAttrs(node){let oldAttributes=parseRule.getAttrs?parseRule.getAttrs(node):parseRule.attrs;if(!1===oldAttributes)return!1;let newAttributes=extensionAttributes.reduce((items,item)=>{var value;let value1=item.attribute.parseHTML?item.attribute.parseHTML(node):"string"!=typeof(value=node.getAttribute(item.name))?value:value.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(value):"true"===value||"false"!==value&&value;return null==value1?items:{...items,[item.name]:value1}},{});return{...oldAttributes,...newAttributes}}}}function cleanUpSchemaItem(data){return Object.fromEntries(Object.entries(data).filter(([key,value])=>!("attrs"===key&&function(value={}){return 0===Object.keys(value).length&&value.constructor===Object}(value))&&null!=value))}function getSchemaTypeByName(name,schema){return schema.nodes[name]||schema.marks[name]||null}function isExtensionRulesEnabled(extension,enabled){return Array.isArray(enabled)?enabled.some(enabledExtension=>{let name="string"==typeof enabledExtension?enabledExtension:enabledExtension.name;return name===extension.name}):enabled}let getTextContentFromNodes=($from,maxMatch=500)=>{let textBefore="",sliceEndPos=$from.parentOffset;return $from.parent.nodesBetween(Math.max(0,sliceEndPos-maxMatch),sliceEndPos,(node,pos,parent,index)=>{var _a,_b;let chunk=(null===(_b=(_a=node.type.spec).toText)||void 0===_b?void 0:_b.call(_a,{node,pos,parent,index}))||node.textContent||"%leaf%";textBefore+=chunk.slice(0,Math.max(0,sliceEndPos-pos))}),textBefore};function isRegExp$1(value){return"[object RegExp]"===Object.prototype.toString.call(value)}class InputRule{constructor(config){this.find=config.find,this.handler=config.handler}}let inputRuleMatcherHandler=(text,find)=>{if(isRegExp$1(find))return find.exec(text);let inputRuleMatch=find(text);if(!inputRuleMatch)return null;let result=[inputRuleMatch.text];return result.index=inputRuleMatch.index,result.input=text,result.data=inputRuleMatch.data,inputRuleMatch.replaceWith&&(inputRuleMatch.text.includes(inputRuleMatch.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),result.push(inputRuleMatch.replaceWith)),result};function run$1$1(config){var _a;let{editor,from,to,text,rules,plugin}=config,{view}=editor;if(view.composing)return!1;let $from=view.state.doc.resolve(from);if($from.parent.type.spec.code||(null===(_a=$from.nodeBefore||$from.nodeAfter)||void 0===_a?void 0:_a.marks.find(mark=>mark.type.spec.code)))return!1;let matched=!1,textBefore=getTextContentFromNodes($from)+text;return rules.forEach(rule=>{if(matched)return;let match=inputRuleMatcherHandler(textBefore,rule.find);if(!match)return;let tr=view.state.tr,state=createChainableState({state:view.state,transaction:tr}),range={from:from-(match[0].length-text.length),to},{commands,chain,can}=new CommandManager({editor,state}),handler=rule.handler({state,range,match,commands,chain,can});null!==handler&&tr.steps.length&&(tr.setMeta(plugin,{transform:tr,from,to,text}),view.dispatch(tr),matched=!0)}),matched}class PasteRule{constructor(config){this.find=config.find,this.handler=config.handler}}let pasteRuleMatcherHandler=(text,find)=>{if(isRegExp$1(find))return[...text.matchAll(find)];let matches=find(text);return matches?matches.map(pasteRuleMatch=>{let result=[pasteRuleMatch.text];return result.index=pasteRuleMatch.index,result.input=text,result.data=pasteRuleMatch.data,pasteRuleMatch.replaceWith&&(pasteRuleMatch.text.includes(pasteRuleMatch.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),result.push(pasteRuleMatch.replaceWith)),result}):[]};class ExtensionManager{constructor(extensions,editor){this.splittableMarks=[],this.editor=editor,this.extensions=ExtensionManager.resolve(extensions),this.schema=function(extensions,editor){var _a;let allAttributes=getAttributesFromExtensions(extensions),{nodeExtensions,markExtensions}=splitExtensions(extensions),topNode=null===(_a=nodeExtensions.find(extension=>getExtensionField(extension,"topNode")))||void 0===_a?void 0:_a.name,nodes=Object.fromEntries(nodeExtensions.map(extension=>{let extensionAttributes=allAttributes.filter(attribute=>attribute.type===extension.name),context={name:extension.name,options:extension.options,storage:extension.storage,editor},extraNodeFields=extensions.reduce((fields,e)=>{let extendNodeSchema=getExtensionField(e,"extendNodeSchema",context);return{...fields,...extendNodeSchema?extendNodeSchema(extension):{}}},{}),schema=cleanUpSchemaItem({...extraNodeFields,content:callOrReturn(getExtensionField(extension,"content",context)),marks:callOrReturn(getExtensionField(extension,"marks",context)),group:callOrReturn(getExtensionField(extension,"group",context)),inline:callOrReturn(getExtensionField(extension,"inline",context)),atom:callOrReturn(getExtensionField(extension,"atom",context)),selectable:callOrReturn(getExtensionField(extension,"selectable",context)),draggable:callOrReturn(getExtensionField(extension,"draggable",context)),code:callOrReturn(getExtensionField(extension,"code",context)),defining:callOrReturn(getExtensionField(extension,"defining",context)),isolating:callOrReturn(getExtensionField(extension,"isolating",context)),attrs:Object.fromEntries(extensionAttributes.map(extensionAttribute=>{var _a;return[extensionAttribute.name,{default:null===(_a=null==extensionAttribute?void 0:extensionAttribute.attribute)||void 0===_a?void 0:_a.default}]}))}),parseHTML=callOrReturn(getExtensionField(extension,"parseHTML",context));parseHTML&&(schema.parseDOM=parseHTML.map(parseRule=>injectExtensionAttributesToParseRule(parseRule,extensionAttributes)));let renderHTML=getExtensionField(extension,"renderHTML",context);renderHTML&&(schema.toDOM=node=>renderHTML({node,HTMLAttributes:getRenderedAttributes(node,extensionAttributes)}));let renderText=getExtensionField(extension,"renderText",context);return renderText&&(schema.toText=renderText),[extension.name,schema]})),marks=Object.fromEntries(markExtensions.map(extension=>{let extensionAttributes=allAttributes.filter(attribute=>attribute.type===extension.name),context={name:extension.name,options:extension.options,storage:extension.storage,editor},extraMarkFields=extensions.reduce((fields,e)=>{let extendMarkSchema=getExtensionField(e,"extendMarkSchema",context);return{...fields,...extendMarkSchema?extendMarkSchema(extension):{}}},{}),schema=cleanUpSchemaItem({...extraMarkFields,inclusive:callOrReturn(getExtensionField(extension,"inclusive",context)),excludes:callOrReturn(getExtensionField(extension,"excludes",context)),group:callOrReturn(getExtensionField(extension,"group",context)),spanning:callOrReturn(getExtensionField(extension,"spanning",context)),code:callOrReturn(getExtensionField(extension,"code",context)),attrs:Object.fromEntries(extensionAttributes.map(extensionAttribute=>{var _a;return[extensionAttribute.name,{default:null===(_a=null==extensionAttribute?void 0:extensionAttribute.attribute)||void 0===_a?void 0:_a.default}]}))}),parseHTML=callOrReturn(getExtensionField(extension,"parseHTML",context));parseHTML&&(schema.parseDOM=parseHTML.map(parseRule=>injectExtensionAttributesToParseRule(parseRule,extensionAttributes)));let renderHTML=getExtensionField(extension,"renderHTML",context);return renderHTML&&(schema.toDOM=mark=>renderHTML({mark,HTMLAttributes:getRenderedAttributes(mark,extensionAttributes)})),[extension.name,schema]}));return new Schema({topNode,nodes,marks})}(this.extensions,editor),this.extensions.forEach(extension=>{var _a;this.editor.extensionStorage[extension.name]=extension.storage;let context={name:extension.name,options:extension.options,storage:extension.storage,editor:this.editor,type:getSchemaTypeByName(extension.name,this.schema)};if("mark"===extension.type){let keepOnSplit=null===(_a=callOrReturn(getExtensionField(extension,"keepOnSplit",context)))||void 0===_a||_a;keepOnSplit&&this.splittableMarks.push(extension.name)}let onBeforeCreate=getExtensionField(extension,"onBeforeCreate",context);onBeforeCreate&&this.editor.on("beforeCreate",onBeforeCreate);let onCreate=getExtensionField(extension,"onCreate",context);onCreate&&this.editor.on("create",onCreate);let onUpdate=getExtensionField(extension,"onUpdate",context);onUpdate&&this.editor.on("update",onUpdate);let onSelectionUpdate=getExtensionField(extension,"onSelectionUpdate",context);onSelectionUpdate&&this.editor.on("selectionUpdate",onSelectionUpdate);let onTransaction=getExtensionField(extension,"onTransaction",context);onTransaction&&this.editor.on("transaction",onTransaction);let onFocus=getExtensionField(extension,"onFocus",context);onFocus&&this.editor.on("focus",onFocus);let onBlur=getExtensionField(extension,"onBlur",context);onBlur&&this.editor.on("blur",onBlur);let onDestroy=getExtensionField(extension,"onDestroy",context);onDestroy&&this.editor.on("destroy",onDestroy)})}static resolve(extensions){let resolvedExtensions=ExtensionManager.sort(ExtensionManager.flatten(extensions)),duplicatedNames=function(items){let filtered=items.filter((el,index)=>items.indexOf(el)!==index);return[...new Set(filtered)]}(resolvedExtensions.map(extension=>extension.name));return duplicatedNames.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${duplicatedNames.map(item=>`'${item}'`).join(", ")}]. This can lead to issues.`),resolvedExtensions}static flatten(extensions){return extensions.map(extension=>{let context={name:extension.name,options:extension.options,storage:extension.storage},addExtensions=getExtensionField(extension,"addExtensions",context);return addExtensions?[extension,...this.flatten(addExtensions())]:extension}).flat(10)}static sort(extensions){return extensions.sort((a,b)=>{let priorityA=getExtensionField(a,"priority")||100,priorityB=getExtensionField(b,"priority")||100;return priorityA>priorityB?-1:priorityA<priorityB?1:0})}get commands(){return this.extensions.reduce((commands,extension)=>{let context={name:extension.name,options:extension.options,storage:extension.storage,editor:this.editor,type:getSchemaTypeByName(extension.name,this.schema)},addCommands=getExtensionField(extension,"addCommands",context);return addCommands?{...commands,...addCommands()}:commands},{})}get plugins(){let{editor}=this,extensions=ExtensionManager.sort([...this.extensions].reverse()),inputRules=[],pasteRules=[],allPlugins=extensions.map(extension=>{var bindings;let context={name:extension.name,options:extension.options,storage:extension.storage,editor,type:getSchemaTypeByName(extension.name,this.schema)},plugins=[],addKeyboardShortcuts=getExtensionField(extension,"addKeyboardShortcuts",context),defaultBindings={};if("mark"===extension.type&&extension.config.exitable&&(defaultBindings.ArrowRight=()=>Mark.handleExit({editor,mark:extension})),addKeyboardShortcuts){let bindings1=Object.fromEntries(Object.entries(addKeyboardShortcuts()).map(([shortcut,method])=>[shortcut,()=>method({editor})]));defaultBindings={...defaultBindings,...bindings1}}let keyMapPlugin=(bindings=defaultBindings,new Plugin({props:{handleKeyDown:keydownHandler(bindings)}}));plugins.push(keyMapPlugin);let addInputRules=getExtensionField(extension,"addInputRules",context);isExtensionRulesEnabled(extension,editor.options.enableInputRules)&&addInputRules&&inputRules.push(...addInputRules());let addPasteRules=getExtensionField(extension,"addPasteRules",context);isExtensionRulesEnabled(extension,editor.options.enablePasteRules)&&addPasteRules&&pasteRules.push(...addPasteRules());let addProseMirrorPlugins=getExtensionField(extension,"addProseMirrorPlugins",context);if(addProseMirrorPlugins){let proseMirrorPlugins=addProseMirrorPlugins();plugins.push(...proseMirrorPlugins)}return plugins}).flat();return[function(props){let{editor,rules}=props,plugin=new Plugin({state:{init:()=>null,apply(tr,prev){let stored=tr.getMeta(plugin);return stored||(tr.selectionSet||tr.docChanged?null:prev)}},props:{handleTextInput:(view,from,to,text)=>run$1$1({editor,from,to,text,rules,plugin}),handleDOMEvents:{compositionend:view=>(setTimeout(()=>{let{$cursor}=view.state.selection;$cursor&&run$1$1({editor,from:$cursor.pos,to:$cursor.pos,text:"",rules,plugin})}),!1)},handleKeyDown(view,event){if("Enter"!==event.key)return!1;let{$cursor}=view.state.selection;return!!$cursor&&run$1$1({editor,from:$cursor.pos,to:$cursor.pos,text:"\n",rules,plugin})}},isInputRules:!0});return plugin}({editor,rules:inputRules}),...function(props){let{editor,rules}=props,dragSourceElement=null,isPastedFromProseMirror=!1,isDroppedFromProseMirror=!1,plugins=rules.map(rule=>new Plugin({view(view){let handleDragstart=event=>{var _a;dragSourceElement=(null===(_a=view.dom.parentElement)||void 0===_a?void 0:_a.contains(event.target))?view.dom.parentElement:null};return window.addEventListener("dragstart",handleDragstart),{destroy(){window.removeEventListener("dragstart",handleDragstart)}}},props:{handleDOMEvents:{drop:view=>(isDroppedFromProseMirror=dragSourceElement===view.dom.parentElement,!1),paste(view,event){var _a;let html=null===(_a=event.clipboardData)||void 0===_a?void 0:_a.getData("text/html");return isPastedFromProseMirror=!!(null==html?void 0:html.includes("data-pm-slice")),!1}}},appendTransaction(transactions,oldState,state){let transaction=transactions[0],isPaste="paste"===transaction.getMeta("uiEvent")&&!isPastedFromProseMirror,isDrop="drop"===transaction.getMeta("uiEvent")&&!isDroppedFromProseMirror;if(!isPaste&&!isDrop)return;let from=oldState.doc.content.findDiffStart(state.doc.content),to=oldState.doc.content.findDiffEnd(state.doc.content);if("number"!=typeof from||!to||from===to.b)return;let tr=state.tr,chainableState=createChainableState({state,transaction:tr}),handler=function(config){let{editor,state,from,to,rule}=config,{commands,chain,can}=new CommandManager({editor,state}),handlers=[];state.doc.nodesBetween(from,to,(node,pos)=>{if(!node.isTextblock||node.type.spec.code)return;let resolvedFrom=Math.max(from,pos),resolvedTo=Math.min(to,pos+node.content.size),textToMatch=node.textBetween(resolvedFrom-pos,resolvedTo-pos,void 0,"￼"),matches=pasteRuleMatcherHandler(textToMatch,rule.find);matches.forEach(match=>{if(void 0===match.index)return;let start=resolvedFrom+match.index+1,end=start+match[0].length,range={from:state.tr.mapping.map(start),to:state.tr.mapping.map(end)},handler=rule.handler({state,range,match,commands,chain,can});handlers.push(handler)})});let success=handlers.every(handler=>null!==handler);return success}({editor,state:chainableState,from:Math.max(from-1,0),to:to.b-1,rule});if(handler&&tr.steps.length)return tr}}));return plugins}({editor,rules:pasteRules}),...allPlugins]}get attributes(){return getAttributesFromExtensions(this.extensions)}get nodeViews(){let{editor}=this,{nodeExtensions}=splitExtensions(this.extensions);return Object.fromEntries(nodeExtensions.filter(extension=>!!getExtensionField(extension,"addNodeView")).map(extension=>{let extensionAttributes=this.attributes.filter(attribute=>attribute.type===extension.name),context={name:extension.name,options:extension.options,storage:extension.storage,editor,type:getNodeType(extension.name,this.schema)},addNodeView=getExtensionField(extension,"addNodeView",context);if(!addNodeView)return[];let nodeview=(node,view,getPos,decorations)=>{let HTMLAttributes=getRenderedAttributes(node,extensionAttributes);return addNodeView()({editor,node,getPos,decorations,HTMLAttributes,extension})};return[extension.name,nodeview]}))}}function isPlainObject(value){return"Object"===Object.prototype.toString.call(value).slice(8,-1)&&value.constructor===Object&&Object.getPrototypeOf(value)===Object.prototype}function mergeDeep(target,source){let output={...target};return isPlainObject(target)&&isPlainObject(source)&&Object.keys(source).forEach(key=>{isPlainObject(source[key])&&key in target?output[key]=mergeDeep(target[key],source[key]):Object.assign(output,{[key]:source[key]})}),output}class Extension{constructor(config={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...config},this.name=this.config.name,config.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(config={}){return new Extension(config)}configure(options={}){let extension=this.extend();return extension.options=mergeDeep(this.options,options),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}extend(extendedConfig={}){let extension=new Extension(extendedConfig);return extension.parent=this,this.child=extension,extension.name=extendedConfig.name?extendedConfig.name:extension.parent.name,extendedConfig.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${extension.name}".`),extension.options=callOrReturn(getExtensionField(extension,"addOptions",{name:extension.name})),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}}function getTextBetween(startNode,range,options){let{from,to}=range,{blockSeparator="\n\n",textSerializers={}}=options||{},text="",separated=!0;return startNode.nodesBetween(from,to,(node,pos,parent,index)=>{var _a;let textSerializer=null==textSerializers?void 0:textSerializers[node.type.name];textSerializer?(node.isBlock&&!separated&&(text+=blockSeparator,separated=!0),parent&&(text+=textSerializer({node,pos,parent,index,range}))):node.isText?(text+=null===(_a=null==node?void 0:node.text)||void 0===_a?void 0:_a.slice(Math.max(from,pos)-pos,to-pos),separated=!1):node.isBlock&&!separated&&(text+=blockSeparator,separated=!0)}),text}function getTextSerializersFromSchema(schema){return Object.fromEntries(Object.entries(schema.nodes).filter(([,node])=>node.spec.toText).map(([name,node])=>[name,node.spec.toText]))}let ClipboardTextSerializer=Extension.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor}=this,{state,schema}=editor,{doc,selection}=state,{ranges}=selection,from=Math.min(...ranges.map(range=>range.$from.pos)),to=Math.max(...ranges.map(range=>range.$to.pos)),textSerializers=getTextSerializersFromSchema(schema);return getTextBetween(doc,{from,to},{textSerializers})}}})]}}),blur=()=>({editor,view})=>(requestAnimationFrame(()=>{var _a;editor.isDestroyed||(view.dom.blur(),null===(_a=null==window?void 0:window.getSelection())||void 0===_a||_a.removeAllRanges())}),!0),clearContent=(emitUpdate=!1)=>({commands})=>commands.setContent("",emitUpdate),clearNodes=()=>({state,tr,dispatch})=>{let{selection}=tr,{ranges}=selection;return!dispatch||(ranges.forEach(({$from,$to})=>{state.doc.nodesBetween($from.pos,$to.pos,(node,pos)=>{if(node.type.isText)return;let{doc,mapping}=tr,$mappedFrom=doc.resolve(mapping.map(pos)),$mappedTo=doc.resolve(mapping.map(pos+node.nodeSize)),nodeRange=$mappedFrom.blockRange($mappedTo);if(!nodeRange)return;let targetLiftDepth=liftTarget(nodeRange);if(node.type.isTextblock){let{defaultType}=$mappedFrom.parent.contentMatchAt($mappedFrom.index());tr.setNodeMarkup(nodeRange.start,defaultType)}(targetLiftDepth||0===targetLiftDepth)&&tr.lift(nodeRange,targetLiftDepth)})}),!0)},command=fn=>props=>fn(props),createParagraphNear=()=>({state,dispatch})=>createParagraphNear$1(state,dispatch),deleteCurrentNode=()=>({tr,dispatch})=>{let{selection}=tr,currentNode=selection.$anchor.node();if(currentNode.content.size>0)return!1;let $pos=tr.selection.$anchor;for(let depth=$pos.depth;depth>0;depth-=1){let node=$pos.node(depth);if(node.type===currentNode.type){if(dispatch){let from=$pos.before(depth),to=$pos.after(depth);tr.delete(from,to).scrollIntoView()}return!0}}return!1},deleteNode=typeOrName=>({tr,state,dispatch})=>{let type=getNodeType(typeOrName,state.schema),$pos=tr.selection.$anchor;for(let depth=$pos.depth;depth>0;depth-=1){let node=$pos.node(depth);if(node.type===type){if(dispatch){let from=$pos.before(depth),to=$pos.after(depth);tr.delete(from,to).scrollIntoView()}return!0}}return!1},deleteRange=range=>({tr,dispatch})=>{let{from,to}=range;return dispatch&&tr.delete(from,to),!0},deleteSelection=()=>({state,dispatch})=>deleteSelection$1(state,dispatch),enter=()=>({commands})=>commands.keyboardShortcut("Enter"),exitCode=()=>({state,dispatch})=>exitCode$1(state,dispatch);function objectIncludes(object1,object2,options={strict:!0}){let keys=Object.keys(object2);return!keys.length||keys.every(key=>options.strict?object2[key]===object1[key]:isRegExp$1(object2[key])?object2[key].test(object1[key]):object2[key]===object1[key])}function findMarkInSet(marks,type,attributes={}){return marks.find(item=>item.type===type&&objectIncludes(item.attrs,attributes))}function getMarkRange($pos,type,attributes={}){if(!$pos||!type)return;let start=$pos.parent.childAfter($pos.parentOffset);if($pos.parentOffset===start.offset&&0!==start.offset&&(start=$pos.parent.childBefore($pos.parentOffset)),!start.node)return;let mark=findMarkInSet([...start.node.marks],type,attributes);if(!mark)return;let startIndex=start.index,startPos=$pos.start()+start.offset,endIndex=startIndex+1,endPos=startPos+start.node.nodeSize;for(findMarkInSet([...start.node.marks],type,attributes);startIndex>0&&mark.isInSet($pos.parent.child(startIndex-1).marks);)startIndex-=1,startPos-=$pos.parent.child(startIndex).nodeSize;for(;endIndex<$pos.parent.childCount&&function(marks,type,attributes={}){return!!findMarkInSet(marks,type,attributes)}([...$pos.parent.child(endIndex).marks],type,attributes);)endPos+=$pos.parent.child(endIndex).nodeSize,endIndex+=1;return{from:startPos,to:endPos}}function getMarkType(nameOrType,schema){if("string"==typeof nameOrType){if(!schema.marks[nameOrType])throw Error(`There is no mark type named '${nameOrType}'. Maybe you forgot to add the extension?`);return schema.marks[nameOrType]}return nameOrType}let extendMarkRange=(typeOrName,attributes={})=>({tr,state,dispatch})=>{let type=getMarkType(typeOrName,state.schema),{doc,selection}=tr,{$from,from,to}=selection;if(dispatch){let range=getMarkRange($from,type,attributes);if(range&&range.from<=from&&range.to>=to){let newSelection=TextSelection.create(doc,range.from,range.to);tr.setSelection(newSelection)}}return!0},first=commands=>props=>{let items="function"==typeof commands?commands(props):commands;for(let i=0;i<items.length;i+=1)if(items[i](props))return!0;return!1};function isTextSelection(value){return value instanceof TextSelection}function minMax(value=0,min=0,max=0){return Math.min(Math.max(value,min),max)}function resolveFocusPosition(doc,position=null){if(!position)return null;let selectionAtStart=Selection.atStart(doc),selectionAtEnd=Selection.atEnd(doc);if("start"===position||!0===position)return selectionAtStart;if("end"===position)return selectionAtEnd;let minPos=selectionAtStart.from,maxPos=selectionAtEnd.to;return"all"===position?TextSelection.create(doc,minMax(0,minPos,maxPos),minMax(doc.content.size,minPos,maxPos)):TextSelection.create(doc,minMax(position,minPos,maxPos),minMax(position,minPos,maxPos))}function isiOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}let focus=(position=null,options={})=>({editor,view,tr,dispatch})=>{options={scrollIntoView:!0,...options};let delayedFocus=()=>{isiOS()&&view.dom.focus(),requestAnimationFrame(()=>{!editor.isDestroyed&&(view.focus(),(null==options?void 0:options.scrollIntoView)&&editor.commands.scrollIntoView())})};if(view.hasFocus()&&null===position||!1===position)return!0;if(dispatch&&null===position&&!isTextSelection(editor.state.selection))return delayedFocus(),!0;let selection=resolveFocusPosition(tr.doc,position)||editor.state.selection,isSameSelection=editor.state.selection.eq(selection);return dispatch&&(isSameSelection||tr.setSelection(selection),isSameSelection&&tr.storedMarks&&tr.setStoredMarks(tr.storedMarks),delayedFocus()),!0},forEach=(items,fn)=>props=>items.every((item,index)=>fn(item,{...props,index})),insertContent=(value,options)=>({tr,commands})=>commands.insertContentAt({from:tr.selection.from,to:tr.selection.to},value,options);function elementFromString(value){let wrappedValue=`<body>${value}</body>`;return new window.DOMParser().parseFromString(wrappedValue,"text/html").body}function createNodeFromContent(content,schema,options){if(options={slice:!0,parseOptions:{},...options},"object"==typeof content&&null!==content)try{if(Array.isArray(content)&&content.length>0)return Fragment.fromArray(content.map(item=>schema.nodeFromJSON(item)));return schema.nodeFromJSON(content)}catch(error){return console.warn("[tiptap warn]: Invalid content.","Passed value:",content,"Error:",error),createNodeFromContent("",schema,options)}if("string"==typeof content){let parser=DOMParser.fromSchema(schema);return options.slice?parser.parseSlice(elementFromString(content),options.parseOptions).content:parser.parse(elementFromString(content),options.parseOptions)}return createNodeFromContent("",schema,options)}let isFragment=nodeOrFragment=>nodeOrFragment.toString().startsWith("<"),insertContentAt=(position,value,options)=>({tr,dispatch,editor})=>{if(dispatch){options={parseOptions:{},updateSelection:!0,...options};let content=createNodeFromContent(value,editor.schema,{parseOptions:{preserveWhitespace:"full",...options.parseOptions}});if("<>"===content.toString())return!0;let{from,to}="number"==typeof position?{from:position,to:position}:position,isOnlyTextContent=!0,isOnlyBlockContent=!0,nodes=isFragment(content)?content:[content];if(nodes.forEach(node=>{node.check(),isOnlyTextContent=!!isOnlyTextContent&&node.isText&&0===node.marks.length,isOnlyBlockContent=!!isOnlyBlockContent&&node.isBlock}),from===to&&isOnlyBlockContent){let{parent}=tr.doc.resolve(from),isEmptyTextBlock=parent.isTextblock&&!parent.type.spec.code&&!parent.childCount;isEmptyTextBlock&&(from-=1,to+=1)}isOnlyTextContent?Array.isArray(value)?tr.insertText(value.map(v=>v.text||"").join(""),from,to):"object"==typeof value&&value&&value.text?tr.insertText(value.text,from,to):tr.insertText(value,from,to):tr.replaceWith(from,to,content),options.updateSelection&&function(tr,startLen,bias){let last=tr.steps.length-1;if(last<startLen)return;let step=tr.steps[last];if(!(step instanceof ReplaceStep||step instanceof ReplaceAroundStep))return;let map=tr.mapping.maps[last],end=0;map.forEach((_from,_to,_newFrom,newTo)=>{0===end&&(end=newTo)}),tr.setSelection(Selection.near(tr.doc.resolve(end),-1))}(tr,tr.steps.length-1,0)}return!0},joinUp=()=>({state,dispatch})=>joinUp$1(state,dispatch),joinDown=()=>({state,dispatch})=>joinDown$1(state,dispatch),joinBackward=()=>({state,dispatch})=>joinBackward$1(state,dispatch),joinForward=()=>({state,dispatch})=>joinForward$1(state,dispatch);function isMacOS(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}let keyboardShortcut=name=>({editor,view,tr,dispatch})=>{let keys=(function(name){let alt,ctrl,shift,meta;let parts=name.split(/-(?!$)/),result=parts[parts.length-1];"Space"===result&&(result=" ");for(let i=0;i<parts.length-1;i+=1){let mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else if(/^mod$/i.test(mod))isiOS()||isMacOS()?meta=!0:ctrl=!0;else throw Error(`Unrecognized modifier name: ${mod}`)}return alt&&(result=`Alt-${result}`),ctrl&&(result=`Ctrl-${result}`),meta&&(result=`Meta-${result}`),shift&&(result=`Shift-${result}`),result})(name).split(/-(?!$)/),key=keys.find(item=>!["Alt","Ctrl","Meta","Shift"].includes(item)),event=new KeyboardEvent("keydown",{key:"Space"===key?" ":key,altKey:keys.includes("Alt"),ctrlKey:keys.includes("Ctrl"),metaKey:keys.includes("Meta"),shiftKey:keys.includes("Shift"),bubbles:!0,cancelable:!0}),capturedTransaction=editor.captureTransaction(()=>{view.someProp("handleKeyDown",f=>f(view,event))});return null==capturedTransaction||capturedTransaction.steps.forEach(step=>{let newStep=step.map(tr.mapping);newStep&&dispatch&&tr.maybeStep(newStep)}),!0};function isNodeActive(state,typeOrName,attributes={}){let{from,to,empty}=state.selection,type=typeOrName?getNodeType(typeOrName,state.schema):null,nodeRanges=[];state.doc.nodesBetween(from,to,(node,pos)=>{if(node.isText)return;let relativeTo=Math.min(to,pos+node.nodeSize);nodeRanges.push({node,from:Math.max(from,pos),to:relativeTo})});let matchedNodeRanges=nodeRanges.filter(nodeRange=>!type||type.name===nodeRange.node.type.name).filter(nodeRange=>objectIncludes(nodeRange.node.attrs,attributes,{strict:!1}));if(empty)return!!matchedNodeRanges.length;let range=matchedNodeRanges.reduce((sum,nodeRange)=>sum+nodeRange.to-nodeRange.from,0);return range>=to-from}let lift=(typeOrName,attributes={})=>({state,dispatch})=>{let type=getNodeType(typeOrName,state.schema),isActive=isNodeActive(state,type,attributes);return!!isActive&&lift$1(state,dispatch)},liftEmptyBlock=()=>({state,dispatch})=>liftEmptyBlock$1(state,dispatch),liftListItem=typeOrName=>({state,dispatch})=>{let type=getNodeType(typeOrName,state.schema);return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to,node=>node.childCount>0&&node.firstChild.type==type);return!!range&&(!dispatch||($from.node(range.depth-1).type==type?function(state,dispatch,itemType,range){let tr=state.tr,end=range.end,endOfList=range.$to.end(range.depth);end<endOfList&&(tr.step(new ReplaceAroundStep(end-1,endOfList,end,endOfList,new Slice$2(Fragment$2.from(itemType.create(null,range.parent.copy())),1,0),1,!0)),range=new NodeRange$1(tr.doc.resolve(range.$from.pos),tr.doc.resolve(endOfList),range.depth));let target=liftTarget(range);if(null==target)return!1;tr.lift(range,target);let after=tr.mapping.map(end,-1)-1;return canJoin(tr.doc,after)&&tr.join(after),dispatch(tr.scrollIntoView()),!0}(state,dispatch,type,range):function(state,dispatch,range){let tr=state.tr,list=range.parent;for(let pos=range.end,i=range.endIndex-1,e=range.startIndex;i>e;i--)pos-=list.child(i).nodeSize,tr.delete(pos-1,pos+1);let $start=tr.doc.resolve(range.start),item=$start.nodeAfter;if(tr.mapping.map(range.end)!=range.start+$start.nodeAfter.nodeSize)return!1;let atStart=0==range.startIndex,atEnd=range.endIndex==list.childCount,parent=$start.node(-1),indexBefore=$start.index(-1);if(!parent.canReplace(indexBefore+(atStart?0:1),indexBefore+1,item.content.append(atEnd?Fragment$2.empty:Fragment$2.from(list))))return!1;let start=$start.pos,end=start+item.nodeSize;return tr.step(new ReplaceAroundStep(start-(atStart?1:0),end+(atEnd?1:0),start+1,end-1,new Slice$2((atStart?Fragment$2.empty:Fragment$2.from(list.copy(Fragment$2.empty))).append(atEnd?Fragment$2.empty:Fragment$2.from(list.copy(Fragment$2.empty))),atStart?0:1,atEnd?0:1),atStart?0:1)),dispatch(tr.scrollIntoView()),!0}(state,dispatch,range)))}(state,dispatch)},newlineInCode=()=>({state,dispatch})=>newlineInCode$1(state,dispatch);function getSchemaTypeNameByName(name,schema){return schema.nodes[name]?"node":schema.marks[name]?"mark":null}function deleteProps(obj,propOrProps){let props="string"==typeof propOrProps?[propOrProps]:propOrProps;return Object.keys(obj).reduce((newObj,prop)=>(props.includes(prop)||(newObj[prop]=obj[prop]),newObj),{})}let resetAttributes=(typeOrName,attributes)=>({tr,state,dispatch})=>{let nodeType=null,markType=null,schemaType=getSchemaTypeNameByName("string"==typeof typeOrName?typeOrName:typeOrName.name,state.schema);return!!schemaType&&("node"===schemaType&&(nodeType=getNodeType(typeOrName,state.schema)),"mark"===schemaType&&(markType=getMarkType(typeOrName,state.schema)),dispatch&&tr.selection.ranges.forEach(range=>{state.doc.nodesBetween(range.$from.pos,range.$to.pos,(node,pos)=>{nodeType&&nodeType===node.type&&tr.setNodeMarkup(pos,void 0,deleteProps(node.attrs,attributes)),markType&&node.marks.length&&node.marks.forEach(mark=>{markType===mark.type&&tr.addMark(pos,pos+node.nodeSize,markType.create(deleteProps(mark.attrs,attributes)))})})}),!0)},scrollIntoView=()=>({tr,dispatch})=>(dispatch&&tr.scrollIntoView(),!0),selectAll=()=>({tr,commands})=>commands.setTextSelection({from:0,to:tr.doc.content.size}),selectNodeBackward=()=>({state,dispatch})=>selectNodeBackward$1(state,dispatch),selectNodeForward=()=>({state,dispatch})=>selectNodeForward$1(state,dispatch),selectParentNode=()=>({state,dispatch})=>selectParentNode$1(state,dispatch),selectTextblockEnd=()=>({state,dispatch})=>selectTextblockEnd$1(state,dispatch),selectTextblockStart=()=>({state,dispatch})=>selectTextblockStart$1(state,dispatch);function createDocument(content,schema,parseOptions={}){return createNodeFromContent(content,schema,{slice:!1,parseOptions})}let setContent=(content,emitUpdate=!1,parseOptions={})=>({tr,editor,dispatch})=>{let{doc}=tr,document1=createDocument(content,editor.schema,parseOptions);return dispatch&&tr.replaceWith(0,doc.content.size,document1).setMeta("preventUpdate",!emitUpdate),!0};function findParentNode(predicate){return selection=>(function($pos,predicate){for(let i=$pos.depth;i>0;i-=1){let node=$pos.node(i);if(predicate(node))return{pos:i>0?$pos.before(i):0,start:$pos.start(i),depth:i,node}}})(selection.$from,predicate)}function getMarkAttributes(state,typeOrName){let type=getMarkType(typeOrName,state.schema),{from,to,empty}=state.selection,marks=[];empty?(state.storedMarks&&marks.push(...state.storedMarks),marks.push(...state.selection.$head.marks())):state.doc.nodesBetween(from,to,node=>{marks.push(...node.marks)});let mark=marks.find(markItem=>markItem.type.name===type.name);return mark?{...mark.attrs}:{}}function getAttributes(state,typeOrName){let schemaType=getSchemaTypeNameByName("string"==typeof typeOrName?typeOrName:typeOrName.name,state.schema);return"node"===schemaType?function(state,typeOrName){let type=getNodeType(typeOrName,state.schema),{from,to}=state.selection,nodes=[];state.doc.nodesBetween(from,to,node=>{nodes.push(node)});let node=nodes.reverse().find(nodeItem=>nodeItem.type.name===type.name);return node?{...node.attrs}:{}}(state,typeOrName):"mark"===schemaType?getMarkAttributes(state,typeOrName):{}}function getMarksBetween(from,to,doc){let marks=[];return from===to?doc.resolve(from).marks().forEach(mark=>{let $pos=doc.resolve(from-1),range=getMarkRange($pos,mark.type);range&&marks.push({mark,...range})}):doc.nodesBetween(from,to,(node,pos)=>{marks.push(...node.marks.map(mark=>({from:pos,to:pos+node.nodeSize,mark})))}),marks}function getSplittedAttributes(extensionAttributes,typeName,attributes){return Object.fromEntries(Object.entries(attributes).filter(([name])=>{let extensionAttribute=extensionAttributes.find(item=>item.type===typeName&&item.name===name);return!!extensionAttribute&&extensionAttribute.attribute.keepOnSplit}))}function isMarkActive(state,typeOrName,attributes={}){let{empty,ranges}=state.selection,type=typeOrName?getMarkType(typeOrName,state.schema):null;if(empty)return!!(state.storedMarks||state.selection.$from.marks()).filter(mark=>!type||type.name===mark.type.name).find(mark=>objectIncludes(mark.attrs,attributes,{strict:!1}));let selectionRange=0,markRanges=[];if(ranges.forEach(({$from,$to})=>{let from=$from.pos,to=$to.pos;state.doc.nodesBetween(from,to,(node,pos)=>{if(!node.isText&&!node.marks.length)return;let relativeFrom=Math.max(from,pos),relativeTo=Math.min(to,pos+node.nodeSize);selectionRange+=relativeTo-relativeFrom,markRanges.push(...node.marks.map(mark=>({mark,from:relativeFrom,to:relativeTo})))})}),0===selectionRange)return!1;let matchedRange=markRanges.filter(markRange=>!type||type.name===markRange.mark.type.name).filter(markRange=>objectIncludes(markRange.mark.attrs,attributes,{strict:!1})).reduce((sum,markRange)=>sum+markRange.to-markRange.from,0),excludedRange=markRanges.filter(markRange=>!type||markRange.mark.type!==type&&markRange.mark.type.excludes(type)).reduce((sum,markRange)=>sum+markRange.to-markRange.from,0);return(matchedRange>0?matchedRange+excludedRange:matchedRange)>=selectionRange}function isList(name,extensions){let{nodeExtensions}=splitExtensions(extensions),extension=nodeExtensions.find(item=>item.name===name);if(!extension)return!1;let context={name:extension.name,options:extension.options,storage:extension.storage},group=callOrReturn(getExtensionField(extension,"group",context));return"string"==typeof group&&group.split(" ").includes("list")}let setMark=(typeOrName,attributes={})=>({tr,state,dispatch})=>{let{selection}=tr,{empty,ranges}=selection,type=getMarkType(typeOrName,state.schema);if(dispatch){if(empty){let oldAttributes=getMarkAttributes(state,type);tr.addStoredMark(type.create({...oldAttributes,...attributes}))}else ranges.forEach(range=>{let from=range.$from.pos,to=range.$to.pos;state.doc.nodesBetween(from,to,(node,pos)=>{let trimmedFrom=Math.max(pos,from),trimmedTo=Math.min(pos+node.nodeSize,to),someHasMark=node.marks.find(mark=>mark.type===type);someHasMark?node.marks.forEach(mark=>{type===mark.type&&tr.addMark(trimmedFrom,trimmedTo,type.create({...mark.attrs,...attributes}))}):tr.addMark(trimmedFrom,trimmedTo,type.create(attributes))})})}return function(state,tr,newMarkType){var _a;let{selection}=tr,cursor=null;if(isTextSelection(selection)&&(cursor=selection.$cursor),cursor){let currentMarks=null!==(_a=state.storedMarks)&&void 0!==_a?_a:cursor.marks();return!!newMarkType.isInSet(currentMarks)||!currentMarks.some(mark=>mark.type.excludes(newMarkType))}let{ranges}=selection;return ranges.some(({$from,$to})=>{let someNodeSupportsMark=0===$from.depth&&state.doc.inlineContent&&state.doc.type.allowsMarkType(newMarkType);return state.doc.nodesBetween($from.pos,$to.pos,(node,_pos,parent)=>{if(someNodeSupportsMark)return!1;if(node.isInline){let parentAllowsMarkType=!parent||parent.type.allowsMarkType(newMarkType),currentMarksAllowMarkType=!!newMarkType.isInSet(node.marks)||!node.marks.some(otherMark=>otherMark.type.excludes(newMarkType));someNodeSupportsMark=parentAllowsMarkType&&currentMarksAllowMarkType}return!someNodeSupportsMark}),someNodeSupportsMark})}(state,tr,type)},setMeta=(key,value)=>({tr})=>(tr.setMeta(key,value),!0),setNode=(typeOrName,attributes={})=>({state,dispatch,chain})=>{let type=getNodeType(typeOrName,state.schema);return type.isTextblock?chain().command(({commands})=>{let canSetBlock=setBlockType(type,attributes)(state);return!!canSetBlock||commands.clearNodes()}).command(({state:updatedState})=>setBlockType(type,attributes)(updatedState,dispatch)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},setNodeSelection=position=>({tr,dispatch})=>{if(dispatch){let{doc}=tr,from=minMax(position,0,doc.content.size),selection=NodeSelection.create(doc,from);tr.setSelection(selection)}return!0},setTextSelection=position=>({tr,dispatch})=>{if(dispatch){let{doc}=tr,{from,to}="number"==typeof position?{from:position,to:position}:position,minPos=TextSelection.atStart(doc).from,maxPos=TextSelection.atEnd(doc).to,resolvedFrom=minMax(from,minPos,maxPos),resolvedEnd=minMax(to,minPos,maxPos),selection=TextSelection.create(doc,resolvedFrom,resolvedEnd);tr.setSelection(selection)}return!0},sinkListItem=typeOrName=>({state,dispatch})=>{let type=getNodeType(typeOrName,state.schema);return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to,node=>node.childCount>0&&node.firstChild.type==type);if(!range)return!1;let startIndex=range.startIndex;if(0==startIndex)return!1;let parent=range.parent,nodeBefore=parent.child(startIndex-1);if(nodeBefore.type!=type)return!1;if(dispatch){let nestedBefore=nodeBefore.lastChild&&nodeBefore.lastChild.type==parent.type,inner=Fragment$2.from(nestedBefore?type.create():null),slice=new Slice$2(Fragment$2.from(type.create(null,Fragment$2.from(parent.type.create(null,inner)))),nestedBefore?3:1,0),before=range.start,after=range.end;dispatch(state.tr.step(new ReplaceAroundStep(before-(nestedBefore?3:1),after,before,after,slice,1,!0)).scrollIntoView())}return!0}(state,dispatch)};function ensureMarks(state,splittableMarks){let marks=state.storedMarks||state.selection.$to.parentOffset&&state.selection.$from.marks();if(marks){let filteredMarks=marks.filter(mark=>null==splittableMarks?void 0:splittableMarks.includes(mark.type.name));state.tr.ensureMarks(filteredMarks)}}let splitBlock=({keepMarks=!0}={})=>({tr,state,dispatch,editor})=>{let{selection,doc}=tr,{$from,$to}=selection,extensionAttributes=editor.extensionManager.attributes,newAttributes=getSplittedAttributes(extensionAttributes,$from.node().type.name,$from.node().attrs);if(selection instanceof NodeSelection&&selection.node.isBlock)return!!($from.parentOffset&&canSplit(doc,$from.pos))&&(dispatch&&(keepMarks&&ensureMarks(state,editor.extensionManager.splittableMarks),tr.split($from.pos).scrollIntoView()),!0);if(!$from.parent.isBlock)return!1;if(dispatch){let atEnd=$to.parentOffset===$to.parent.content.size;selection instanceof TextSelection&&tr.deleteSelection();let deflt=0===$from.depth?void 0:function(match){for(let i=0;i<match.edgeCount;i+=1){let{type}=match.edge(i);if(type.isTextblock&&!type.hasRequiredAttrs())return type}return null}($from.node(-1).contentMatchAt($from.indexAfter(-1))),types=atEnd&&deflt?[{type:deflt,attrs:newAttributes}]:void 0,can=canSplit(tr.doc,tr.mapping.map($from.pos),1,types);if(!types&&!can&&canSplit(tr.doc,tr.mapping.map($from.pos),1,deflt?[{type:deflt}]:void 0)&&(can=!0,types=deflt?[{type:deflt,attrs:newAttributes}]:void 0),can&&(tr.split(tr.mapping.map($from.pos),1,types),deflt&&!atEnd&&!$from.parentOffset&&$from.parent.type!==deflt)){let first=tr.mapping.map($from.before()),$first=tr.doc.resolve(first);$from.node(-1).canReplaceWith($first.index(),$first.index()+1,deflt)&&tr.setNodeMarkup(tr.mapping.map($from.before()),deflt)}keepMarks&&ensureMarks(state,editor.extensionManager.splittableMarks),tr.scrollIntoView()}return!0},splitListItem=typeOrName=>({tr,state,dispatch,editor})=>{var _a;let type=getNodeType(typeOrName,state.schema),{$from,$to}=state.selection,node=state.selection.node;if(node&&node.isBlock||$from.depth<2||!$from.sameParent($to))return!1;let grandParent=$from.node(-1);if(grandParent.type!==type)return!1;let extensionAttributes=editor.extensionManager.attributes;if(0===$from.parent.content.size&&$from.node(-1).childCount===$from.indexAfter(-1)){if(2===$from.depth||$from.node(-3).type!==type||$from.index(-2)!==$from.node(-2).childCount-1)return!1;if(dispatch){let wrap=Fragment.empty,depthBefore=$from.index(-1)?1:$from.index(-2)?2:3;for(let d=$from.depth-depthBefore;d>=$from.depth-3;d-=1)wrap=Fragment.from($from.node(d).copy(wrap));let depthAfter=$from.indexAfter(-1)<$from.node(-2).childCount?1:$from.indexAfter(-2)<$from.node(-3).childCount?2:3,newNextTypeAttributes=getSplittedAttributes(extensionAttributes,$from.node().type.name,$from.node().attrs),nextType=(null===(_a=type.contentMatch.defaultType)||void 0===_a?void 0:_a.createAndFill(newNextTypeAttributes))||void 0;wrap=wrap.append(Fragment.from(type.createAndFill(null,nextType)||void 0));let start=$from.before($from.depth-(depthBefore-1));tr.replace(start,$from.after(-depthAfter),new Slice(wrap,4-depthBefore,0));let sel=-1;tr.doc.nodesBetween(start,tr.doc.content.size,(n,pos)=>{if(sel>-1)return!1;n.isTextblock&&0===n.content.size&&(sel=pos+1)}),sel>-1&&tr.setSelection(TextSelection.near(tr.doc.resolve(sel))),tr.scrollIntoView()}return!0}let nextType1=$to.pos===$from.end()?grandParent.contentMatchAt(0).defaultType:null,newTypeAttributes=getSplittedAttributes(extensionAttributes,grandParent.type.name,grandParent.attrs),newNextTypeAttributes1=getSplittedAttributes(extensionAttributes,$from.node().type.name,$from.node().attrs);if(tr.delete($from.pos,$to.pos),!canSplit(tr.doc,$from.pos,2))return!1;if(dispatch){let{selection,storedMarks}=state,{splittableMarks}=editor.extensionManager,marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();if(tr.split($from.pos,2,nextType1?[{type,attrs:newTypeAttributes},{type:nextType1,attrs:newNextTypeAttributes1}]:[{type,attrs:newTypeAttributes}]).scrollIntoView(),!marks||!dispatch)return!0;let filteredMarks=marks.filter(mark=>splittableMarks.includes(mark.type.name));tr.ensureMarks(filteredMarks)}return!0},joinListBackwards=(tr,listType)=>{let list=findParentNode(node=>node.type===listType)(tr.selection);if(!list)return!0;let before=tr.doc.resolve(Math.max(0,list.pos-1)).before(list.depth);if(void 0===before)return!0;let nodeBefore=tr.doc.nodeAt(before),canJoinBackwards=list.node.type===(null==nodeBefore?void 0:nodeBefore.type)&&canJoin(tr.doc,list.pos);return!canJoinBackwards||(tr.join(list.pos),!0)},joinListForwards=(tr,listType)=>{let list=findParentNode(node=>node.type===listType)(tr.selection);if(!list)return!0;let after=tr.doc.resolve(list.start).after(list.depth);if(void 0===after)return!0;let nodeAfter=tr.doc.nodeAt(after),canJoinForwards=list.node.type===(null==nodeAfter?void 0:nodeAfter.type)&&canJoin(tr.doc,after);return!canJoinForwards||(tr.join(after),!0)},toggleList=(listTypeOrName,itemTypeOrName,keepMarks,attributes={})=>({editor,tr,state,dispatch,chain,commands,can})=>{let{extensions,splittableMarks}=editor.extensionManager,listType=getNodeType(listTypeOrName,state.schema),itemType=getNodeType(itemTypeOrName,state.schema),{selection,storedMarks}=state,{$from,$to}=selection,range=$from.blockRange($to),marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();if(!range)return!1;let parentList=findParentNode(node=>isList(node.type.name,extensions))(selection);if(range.depth>=1&&parentList&&range.depth-parentList.depth<=1){if(parentList.node.type===listType)return commands.liftListItem(itemType);if(isList(parentList.node.type.name,extensions)&&listType.validContent(parentList.node.content)&&dispatch)return chain().command(()=>(tr.setNodeMarkup(parentList.pos,listType),!0)).command(()=>joinListBackwards(tr,listType)).command(()=>joinListForwards(tr,listType)).run()}return keepMarks&&marks&&dispatch?chain().command(()=>{let canWrapInList=can().wrapInList(listType,attributes),filteredMarks=marks.filter(mark=>splittableMarks.includes(mark.type.name));return tr.ensureMarks(filteredMarks),!!canWrapInList||commands.clearNodes()}).wrapInList(listType,attributes).command(()=>joinListBackwards(tr,listType)).command(()=>joinListForwards(tr,listType)).run():chain().command(()=>{let canWrapInList=can().wrapInList(listType,attributes);return!!canWrapInList||commands.clearNodes()}).wrapInList(listType,attributes).command(()=>joinListBackwards(tr,listType)).command(()=>joinListForwards(tr,listType)).run()},toggleMark=(typeOrName,attributes={},options={})=>({state,commands})=>{let{extendEmptyMarkRange=!1}=options,type=getMarkType(typeOrName,state.schema),isActive=isMarkActive(state,type,attributes);return isActive?commands.unsetMark(type,{extendEmptyMarkRange}):commands.setMark(type,attributes)},toggleNode=(typeOrName,toggleTypeOrName,attributes={})=>({state,commands})=>{let type=getNodeType(typeOrName,state.schema),toggleType=getNodeType(toggleTypeOrName,state.schema),isActive=isNodeActive(state,type,attributes);return isActive?commands.setNode(toggleType):commands.setNode(type,attributes)},toggleWrap=(typeOrName,attributes={})=>({state,commands})=>{let type=getNodeType(typeOrName,state.schema),isActive=isNodeActive(state,type,attributes);return isActive?commands.lift(type):commands.wrapIn(type,attributes)},undoInputRule=()=>({state,dispatch})=>{let plugins=state.plugins;for(let i=0;i<plugins.length;i+=1){let undoable;let plugin=plugins[i];if(plugin.spec.isInputRules&&(undoable=plugin.getState(state))){if(dispatch){let tr=state.tr,toUndo=undoable.transform;for(let j=toUndo.steps.length-1;j>=0;j-=1)tr.step(toUndo.steps[j].invert(toUndo.docs[j]));if(undoable.text){let marks=tr.doc.resolve(undoable.from).marks();tr.replaceWith(undoable.from,undoable.to,state.schema.text(undoable.text,marks))}else tr.delete(undoable.from,undoable.to)}return!0}}return!1},unsetAllMarks=()=>({tr,dispatch})=>{let{selection}=tr,{empty,ranges}=selection;return!!empty||(dispatch&&ranges.forEach(range=>{tr.removeMark(range.$from.pos,range.$to.pos)}),!0)},unsetMark=(typeOrName,options={})=>({tr,state,dispatch})=>{var _a;let{extendEmptyMarkRange=!1}=options,{selection}=tr,type=getMarkType(typeOrName,state.schema),{$from,empty,ranges}=selection;if(!dispatch)return!0;if(empty&&extendEmptyMarkRange){let{from,to}=selection,attrs=null===(_a=$from.marks().find(mark=>mark.type===type))||void 0===_a?void 0:_a.attrs,range=getMarkRange($from,type,attrs);range&&(from=range.from,to=range.to),tr.removeMark(from,to,type)}else ranges.forEach(range=>{tr.removeMark(range.$from.pos,range.$to.pos,type)});return tr.removeStoredMark(type),!0},updateAttributes=(typeOrName,attributes={})=>({tr,state,dispatch})=>{let nodeType=null,markType=null,schemaType=getSchemaTypeNameByName("string"==typeof typeOrName?typeOrName:typeOrName.name,state.schema);return!!schemaType&&("node"===schemaType&&(nodeType=getNodeType(typeOrName,state.schema)),"mark"===schemaType&&(markType=getMarkType(typeOrName,state.schema)),dispatch&&tr.selection.ranges.forEach(range=>{let from=range.$from.pos,to=range.$to.pos;state.doc.nodesBetween(from,to,(node,pos)=>{nodeType&&nodeType===node.type&&tr.setNodeMarkup(pos,void 0,{...node.attrs,...attributes}),markType&&node.marks.length&&node.marks.forEach(mark=>{if(markType===mark.type){let trimmedTo=Math.min(pos+node.nodeSize,to);tr.addMark(Math.max(pos,from),trimmedTo,markType.create({...mark.attrs,...attributes}))}})})}),!0)},wrapIn=(typeOrName,attributes={})=>({state,dispatch})=>{let type=getNodeType(typeOrName,state.schema);return(function(nodeType,attrs=null){return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to),wrapping=range&&findWrapping(range,nodeType,attrs);return!!wrapping&&(dispatch&&dispatch(state.tr.wrap(range,wrapping).scrollIntoView()),!0)}})(type,attributes)(state,dispatch)},wrapInList=(typeOrName,attributes={})=>({state,dispatch})=>{let type=getNodeType(typeOrName,state.schema);return(function(listType,attrs=null){return function(state,dispatch){let{$from,$to}=state.selection,range=$from.blockRange($to),doJoin=!1,outerRange=range;if(!range)return!1;if(range.depth>=2&&$from.node(range.depth-1).type.compatibleContent(listType)&&0==range.startIndex){if(0==$from.index(range.depth-1))return!1;let $insert=state.doc.resolve(range.start-2);outerRange=new NodeRange$1($insert,$insert,range.depth),range.endIndex<range.parent.childCount&&(range=new NodeRange$1($from,state.doc.resolve($to.end(range.depth)),range.depth)),doJoin=!0}let wrap=findWrapping(outerRange,listType,attrs,range);return!!wrap&&(dispatch&&dispatch((function(tr,range,wrappers,joinBefore,listType){let content=Fragment$2.empty;for(let i=wrappers.length-1;i>=0;i--)content=Fragment$2.from(wrappers[i].type.create(wrappers[i].attrs,content));tr.step(new ReplaceAroundStep(range.start-(joinBefore?2:0),range.end,range.start,range.end,new Slice$2(content,0,0),wrappers.length,!0));let found=0;for(let i1=0;i1<wrappers.length;i1++)wrappers[i1].type==listType&&(found=i1+1);let splitDepth=wrappers.length-found,splitPos=range.start+wrappers.length-(joinBefore?2:0),parent=range.parent;for(let i2=range.startIndex,e=range.endIndex,first=!0;i2<e;i2++,first=!1)!first&&canSplit(tr.doc,splitPos,splitDepth)&&(tr.split(splitPos,splitDepth),splitPos+=2*splitDepth),splitPos+=parent.child(i2).nodeSize;return tr})(state.tr,range,wrap,doJoin,listType).scrollIntoView()),!0)}})(type,attributes)(state,dispatch)};var commands=Object.freeze({__proto__:null,blur:blur,clearContent:clearContent,clearNodes:clearNodes,command:command,createParagraphNear:createParagraphNear,deleteCurrentNode:deleteCurrentNode,deleteNode:deleteNode,deleteRange:deleteRange,deleteSelection:deleteSelection,enter:enter,exitCode:exitCode,extendMarkRange:extendMarkRange,first:first,focus:focus,forEach:forEach,insertContent:insertContent,insertContentAt:insertContentAt,joinUp:joinUp,joinDown:joinDown,joinBackward:joinBackward,joinForward:joinForward,keyboardShortcut:keyboardShortcut,lift:lift,liftEmptyBlock:liftEmptyBlock,liftListItem:liftListItem,newlineInCode:newlineInCode,resetAttributes:resetAttributes,scrollIntoView:scrollIntoView,selectAll:selectAll,selectNodeBackward:selectNodeBackward,selectNodeForward:selectNodeForward,selectParentNode:selectParentNode,selectTextblockEnd:selectTextblockEnd,selectTextblockStart:selectTextblockStart,setContent:setContent,setMark:setMark,setMeta:setMeta,setNode:setNode,setNodeSelection:setNodeSelection,setTextSelection:setTextSelection,sinkListItem:sinkListItem,splitBlock:splitBlock,splitListItem:splitListItem,toggleList:toggleList,toggleMark:toggleMark,toggleNode:toggleNode,toggleWrap:toggleWrap,undoInputRule:undoInputRule,unsetAllMarks:unsetAllMarks,unsetMark:unsetMark,updateAttributes:updateAttributes,wrapIn:wrapIn,wrapInList:wrapInList});let Commands=Extension.create({name:"commands",addCommands:()=>({...commands})}),Editable=Extension.create({name:"editable",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("editable"),props:{editable:()=>this.editor.options.editable}})]}}),FocusEvents=Extension.create({name:"focusEvents",addProseMirrorPlugins(){let{editor}=this;return[new Plugin({key:new PluginKey("focusEvents"),props:{handleDOMEvents:{focus(view,event){editor.isFocused=!0;let transaction=editor.state.tr.setMeta("focus",{event}).setMeta("addToHistory",!1);return view.dispatch(transaction),!1},blur(view,event){editor.isFocused=!1;let transaction=editor.state.tr.setMeta("blur",{event}).setMeta("addToHistory",!1);return view.dispatch(transaction),!1}}}})]}}),Keymap=Extension.create({name:"keymap",addKeyboardShortcuts(){let handleBackspace=()=>this.editor.commands.first(({commands})=>[()=>commands.undoInputRule(),()=>commands.command(({tr})=>{let{selection,doc}=tr,{empty,$anchor}=selection,{pos,parent}=$anchor,isAtStart=Selection.atStart(doc).from===pos;return!!empty&&!!isAtStart&&!!parent.type.isTextblock&&!parent.textContent.length&&commands.clearNodes()}),()=>commands.deleteSelection(),()=>commands.joinBackward(),()=>commands.selectNodeBackward()]),handleDelete=()=>this.editor.commands.first(({commands})=>[()=>commands.deleteSelection(),()=>commands.deleteCurrentNode(),()=>commands.joinForward(),()=>commands.selectNodeForward()]),handleEnter=()=>this.editor.commands.first(({commands})=>[()=>commands.newlineInCode(),()=>commands.createParagraphNear(),()=>commands.liftEmptyBlock(),()=>commands.splitBlock()]),baseKeymap={Enter:handleEnter,"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:handleBackspace,"Mod-Backspace":handleBackspace,"Shift-Backspace":handleBackspace,Delete:handleDelete,"Mod-Delete":handleDelete,"Mod-a":()=>this.editor.commands.selectAll()},pcKeymap={...baseKeymap},macKeymap={...baseKeymap,"Ctrl-h":handleBackspace,"Alt-Backspace":handleBackspace,"Ctrl-d":handleDelete,"Ctrl-Alt-Backspace":handleDelete,"Alt-Delete":handleDelete,"Alt-d":handleDelete,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return isiOS()||isMacOS()?macKeymap:pcKeymap},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("clearDocument"),appendTransaction:(transactions,oldState,newState)=>{let docChanges=transactions.some(transaction=>transaction.docChanged)&&!oldState.doc.eq(newState.doc);if(!docChanges)return;let{empty,from,to}=oldState.selection,allFrom=Selection.atStart(oldState.doc).from,allEnd=Selection.atEnd(oldState.doc).to;if(empty||!(from===allFrom&&to===allEnd))return;let isEmpty=0===newState.doc.textBetween(0,newState.doc.content.size," "," ").length;if(!isEmpty)return;let tr=newState.tr,state=createChainableState({state:newState,transaction:tr}),{commands}=new CommandManager({editor:this.editor,state});if(commands.clearNodes(),tr.steps.length)return tr}})]}}),Tabindex=Extension.create({name:"tabindex",addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var extensions=Object.freeze({__proto__:null,ClipboardTextSerializer:ClipboardTextSerializer,Commands:Commands,Editable:Editable,FocusEvents:FocusEvents,Keymap:Keymap,Tabindex:Tabindex});let style=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;class Editor extends EventEmitter{constructor(options={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(options),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=function(style,nonce){let tiptapStyleTag=document.querySelector("style[data-tiptap-style]");if(null!==tiptapStyleTag)return tiptapStyleTag;let styleNode=document.createElement("style");return nonce&&styleNode.setAttribute("nonce",nonce),styleNode.setAttribute("data-tiptap-style",""),styleNode.innerHTML=style,document.getElementsByTagName("head")[0].appendChild(styleNode),styleNode}(style,this.options.injectNonce))}setOptions(options={}){this.options={...this.options,...options},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(editable,emitUpdate=!0){this.setOptions({editable}),emitUpdate&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(plugin,handlePlugins){let plugins=isFunction$1(handlePlugins)?handlePlugins(plugin,[...this.state.plugins]):[...this.state.plugins,plugin],state=this.state.reconfigure({plugins});this.view.updateState(state)}unregisterPlugin(nameOrPluginKey){if(this.isDestroyed)return;let name="string"==typeof nameOrPluginKey?`${nameOrPluginKey}$`:nameOrPluginKey.key,state=this.state.reconfigure({plugins:this.state.plugins.filter(plugin=>!plugin.key.startsWith(name))});this.view.updateState(state)}createExtensionManager(){let coreExtensions=this.options.enableCoreExtensions?Object.values(extensions):[],allExtensions=[...coreExtensions,...this.options.extensions].filter(extension=>["extension","node","mark"].includes(null==extension?void 0:extension.type));this.extensionManager=new ExtensionManager(allExtensions,this)}createCommandManager(){this.commandManager=new CommandManager({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){let doc=createDocument(this.options.content,this.schema,this.options.parseOptions),selection=resolveFocusPosition(doc,this.options.autofocus);this.view=new EditorView(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:EditorState.create({doc,selection:selection||void 0})});let newState=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(newState),this.createNodeViews();let dom=this.view.dom;dom.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(fn){this.isCapturingTransaction=!0,fn(),this.isCapturingTransaction=!1;let tr=this.capturedTransaction;return this.capturedTransaction=null,tr}dispatchTransaction(transaction){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=transaction;return}transaction.steps.forEach(step=>{var _a;return null===(_a=this.capturedTransaction)||void 0===_a?void 0:_a.step(step)});return}let state=this.state.apply(transaction),selectionHasChanged=!this.state.selection.eq(state.selection);this.view.updateState(state),this.emit("transaction",{editor:this,transaction}),selectionHasChanged&&this.emit("selectionUpdate",{editor:this,transaction});let focus=transaction.getMeta("focus"),blur=transaction.getMeta("blur");focus&&this.emit("focus",{editor:this,event:focus.event,transaction}),blur&&this.emit("blur",{editor:this,event:blur.event,transaction}),!transaction.docChanged||transaction.getMeta("preventUpdate")||this.emit("update",{editor:this,transaction})}getAttributes(nameOrType){return getAttributes(this.state,nameOrType)}isActive(nameOrAttributes,attributesOrUndefined){return function(state,name,attributes={}){if(!name)return isNodeActive(state,null,attributes)||isMarkActive(state,null,attributes);let schemaType=getSchemaTypeNameByName(name,state.schema);return"node"===schemaType?isNodeActive(state,name,attributes):"mark"===schemaType&&isMarkActive(state,name,attributes)}(this.state,"string"==typeof nameOrAttributes?nameOrAttributes:null,"string"==typeof nameOrAttributes?attributesOrUndefined:nameOrAttributes)}getJSON(){return this.state.doc.toJSON()}getHTML(){return function(fragment,schema){let documentFragment=DOMSerializer.fromSchema(schema).serializeFragment(fragment),temporaryDocument=document.implementation.createHTMLDocument(),container=temporaryDocument.createElement("div");return container.appendChild(documentFragment),container.innerHTML}(this.state.doc.content,this.schema)}getText(options){let{blockSeparator="\n\n",textSerializers={}}=options||{};return function(node,options){let range={from:0,to:node.content.size};return getTextBetween(node,range,options)}(this.state.doc,{blockSeparator,textSerializers:{...getTextSerializersFromSchema(this.schema),...textSerializers}})}get isEmpty(){return function(node){var _a;let defaultContent=null===(_a=node.type.createAndFill())||void 0===_a?void 0:_a.toJSON(),content=node.toJSON();return JSON.stringify(defaultContent)===JSON.stringify(content)}(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var _a;return!(null===(_a=this.view)||void 0===_a?void 0:_a.docView)}}function markInputRule(config){return new InputRule({find:config.find,handler({state,range,match}){let attributes=callOrReturn(config.getAttributes,void 0,match);if(!1===attributes||null===attributes)return null;let{tr}=state,captureGroup=match[match.length-1],fullMatch=match[0],markEnd=range.to;if(captureGroup){let startSpaces=fullMatch.search(/\S/),textStart=range.from+fullMatch.indexOf(captureGroup),textEnd=textStart+captureGroup.length,excludedMarks=getMarksBetween(range.from,range.to,state.doc).filter(item=>{let excluded=item.mark.type.excluded;return excluded.find(type=>type===config.type&&type!==item.mark.type)}).filter(item=>item.to>textStart);if(excludedMarks.length)return null;textEnd<range.to&&tr.delete(textEnd,range.to),textStart>range.from&&tr.delete(range.from+startSpaces,textStart),markEnd=range.from+startSpaces+captureGroup.length,tr.addMark(range.from+startSpaces,markEnd,config.type.create(attributes||{})),tr.removeStoredMark(config.type)}}})}function textblockTypeInputRule(config){return new InputRule({find:config.find,handler({state,range,match}){let $start=state.doc.resolve(range.from),attributes=callOrReturn(config.getAttributes,void 0,match)||{};if(!$start.node(-1).canReplaceWith($start.index(-1),$start.indexAfter(-1),config.type))return null;state.tr.delete(range.from,range.to).setBlockType(range.from,range.from,config.type,attributes)}})}function wrappingInputRule(config){return new InputRule({find:config.find,handler({state,range,match,chain}){let attributes=callOrReturn(config.getAttributes,void 0,match)||{},tr=state.tr.delete(range.from,range.to),$start=tr.doc.resolve(range.from),blockRange=$start.blockRange(),wrapping=blockRange&&findWrapping(blockRange,config.type,attributes);if(!wrapping)return null;if(tr.wrap(blockRange,wrapping),config.keepMarks&&config.editor){let{selection,storedMarks}=state,{splittableMarks}=config.editor.extensionManager,marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();if(marks){let filteredMarks=marks.filter(mark=>splittableMarks.includes(mark.type.name));tr.ensureMarks(filteredMarks)}}if(config.keepAttributes){let nodeType="bulletList"===config.type.name||"orderedList"===config.type.name?"listItem":"taskList";chain().updateAttributes(nodeType,attributes).run()}let before=tr.doc.resolve(range.from-1).nodeBefore;before&&before.type===config.type&&canJoin(tr.doc,range.from-1)&&(!config.joinPredicate||config.joinPredicate(match,before))&&tr.join(range.from-1)}})}class Mark{constructor(config={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...config},this.name=this.config.name,config.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(config={}){return new Mark(config)}configure(options={}){let extension=this.extend();return extension.options=mergeDeep(this.options,options),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}extend(extendedConfig={}){let extension=new Mark(extendedConfig);return extension.parent=this,this.child=extension,extension.name=extendedConfig.name?extendedConfig.name:extension.parent.name,extendedConfig.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${extension.name}".`),extension.options=callOrReturn(getExtensionField(extension,"addOptions",{name:extension.name})),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}static handleExit({editor,mark}){let{tr}=editor.state,currentPos=editor.state.selection.$from,isAtEnd=currentPos.pos===currentPos.end();if(isAtEnd){let currentMarks=currentPos.marks(),isInMark=!!currentMarks.find(m=>(null==m?void 0:m.type.name)===mark.name);if(!isInMark)return!1;let removeMark=currentMarks.find(m=>(null==m?void 0:m.type.name)===mark.name);return removeMark&&tr.removeStoredMark(removeMark),tr.insertText(" ",currentPos.pos),editor.view.dispatch(tr),!0}return!1}}class Node{constructor(config={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...config},this.name=this.config.name,config.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=callOrReturn(getExtensionField(this,"addOptions",{name:this.name}))),this.storage=callOrReturn(getExtensionField(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(config={}){return new Node(config)}configure(options={}){let extension=this.extend();return extension.options=mergeDeep(this.options,options),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}extend(extendedConfig={}){let extension=new Node(extendedConfig);return extension.parent=this,this.child=extension,extension.name=extendedConfig.name?extendedConfig.name:extension.parent.name,extendedConfig.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${extension.name}".`),extension.options=callOrReturn(getExtensionField(extension,"addOptions",{name:extension.name})),extension.storage=callOrReturn(getExtensionField(extension,"addStorage",{name:extension.name,options:extension.options})),extension}}function markPasteRule(config){return new PasteRule({find:config.find,handler({state,range,match}){let attributes=callOrReturn(config.getAttributes,void 0,match);if(!1===attributes||null===attributes)return null;let{tr}=state,captureGroup=match[match.length-1],fullMatch=match[0],markEnd=range.to;if(captureGroup){let startSpaces=fullMatch.search(/\S/),textStart=range.from+fullMatch.indexOf(captureGroup),textEnd=textStart+captureGroup.length,excludedMarks=getMarksBetween(range.from,range.to,state.doc).filter(item=>{let excluded=item.mark.type.excluded;return excluded.find(type=>type===config.type&&type!==item.mark.type)}).filter(item=>item.to>textStart);if(excludedMarks.length)return null;textEnd<range.to&&tr.delete(textEnd,range.to),textStart>range.from&&tr.delete(range.from+startSpaces,textStart),markEnd=range.from+startSpaces+captureGroup.length,tr.addMark(range.from+startSpaces,markEnd,config.type.create(attributes||{})),tr.removeStoredMark(config.type)}}})}let inputRegex$5=/^\s*>\s$/,Blockquote=Node.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes}){return["blockquote",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setBlockquote:()=>({commands})=>commands.wrapIn(this.name),toggleBlockquote:()=>({commands})=>commands.toggleWrap(this.name),unsetBlockquote:()=>({commands})=>commands.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[wrappingInputRule({find:inputRegex$5,type:this.type})]}}),starInputRegex$1=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,starPasteRegex$1=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,underscoreInputRegex$1=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,underscorePasteRegex$1=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,Bold=Mark.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"strong"},{tag:"b",getAttrs:node=>"normal"!==node.style.fontWeight&&null},{style:"font-weight",getAttrs:value=>/^(bold(er)?|[5-9]\d{2,})$/.test(value)&&null}],renderHTML({HTMLAttributes}){return["strong",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setBold:()=>({commands})=>commands.setMark(this.name),toggleBold:()=>({commands})=>commands.toggleMark(this.name),unsetBold:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[markInputRule({find:starInputRegex$1,type:this.type}),markInputRule({find:underscoreInputRegex$1,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex$1,type:this.type}),markPasteRule({find:underscorePasteRegex$1,type:this.type})]}}),ListItem$2=Node.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes}){return["li",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),TextStyle$1=Mark.create({name:"textStyle",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"span",getAttrs(element){let hasStyles=element.hasAttribute("style");return!!hasStyles&&{}}}],renderHTML({HTMLAttributes}){return["span",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{removeEmptyTextStyle:()=>({state,commands})=>{let attributes=getMarkAttributes(state,this.type),hasStyles=Object.entries(attributes).some(([,value])=>!!value);return!!hasStyles||commands.unsetMark(this.name)}}}}),inputRegex$4=/^\s*([-+*])\s$/,BulletList$1=Node.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes}){return["ul",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{toggleBulletList:()=>({commands,chain})=>this.options.keepAttributes?chain().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItem$2.name,this.editor.getAttributes(TextStyle$1.name)).run():commands.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let inputRule=wrappingInputRule({find:inputRegex$4,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(inputRule=wrappingInputRule({find:inputRegex$4,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(TextStyle$1.name),editor:this.editor})),[inputRule]}}),inputRegex$3=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,pasteRegex$1=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,Code=Mark.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes}){return["code",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setCode:()=>({commands})=>commands.setMark(this.name),toggleCode:()=>({commands})=>commands.toggleMark(this.name),unsetCode:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[markInputRule({find:inputRegex$3,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex$1,type:this.type})]}}),backtickInputRegex=/^```([a-z]+)?[\s\n]$/,tildeInputRegex=/^~~~([a-z]+)?[\s\n]$/,CodeBlock=Node.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:element=>{var _a;let{languageClassPrefix}=this.options,classNames=[...(null===(_a=element.firstElementChild)||void 0===_a?void 0:_a.classList)||[]],languages=classNames.filter(className=>className.startsWith(languageClassPrefix)).map(className=>className.replace(languageClassPrefix,"")),language=languages[0];return language||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node,HTMLAttributes}){return["pre",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),["code",{class:node.attrs.language?this.options.languageClassPrefix+node.attrs.language:null},0]]},addCommands(){return{setCodeBlock:attributes=>({commands})=>commands.setNode(this.name,attributes),toggleCodeBlock:attributes=>({commands})=>commands.toggleNode(this.name,"paragraph",attributes)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty,$anchor}=this.editor.state.selection,isAtStart=1===$anchor.pos;return!!empty&&$anchor.parent.type.name===this.name&&(!!isAtStart||!$anchor.parent.textContent.length)&&this.editor.commands.clearNodes()},Enter:({editor})=>{if(!this.options.exitOnTripleEnter)return!1;let{state}=editor,{selection}=state,{$from,empty}=selection;if(!empty||$from.parent.type!==this.type)return!1;let isAtEnd=$from.parentOffset===$from.parent.nodeSize-2,endsWithDoubleNewline=$from.parent.textContent.endsWith("\n\n");return!!isAtEnd&&!!endsWithDoubleNewline&&editor.chain().command(({tr})=>(tr.delete($from.pos-2,$from.pos),!0)).exitCode().run()},ArrowDown:({editor})=>{if(!this.options.exitOnArrowDown)return!1;let{state}=editor,{selection,doc}=state,{$from,empty}=selection;if(!empty||$from.parent.type!==this.type)return!1;let isAtEnd=$from.parentOffset===$from.parent.nodeSize-2;if(!isAtEnd)return!1;let after=$from.after();if(void 0===after)return!1;let nodeAfter=doc.nodeAt(after);return!nodeAfter&&editor.commands.exitCode()}}},addInputRules(){return[textblockTypeInputRule({find:backtickInputRegex,type:this.type,getAttributes:match=>({language:match[1]})}),textblockTypeInputRule({find:tildeInputRegex,type:this.type,getAttributes:match=>({language:match[1]})})]},addProseMirrorPlugins(){return[new Plugin({key:new PluginKey("codeBlockVSCodeHandler"),props:{handlePaste:(view,event)=>{if(!event.clipboardData||this.editor.isActive(this.type.name))return!1;let text=event.clipboardData.getData("text/plain"),vscode=event.clipboardData.getData("vscode-editor-data"),vscodeData=vscode?JSON.parse(vscode):void 0,language=null==vscodeData?void 0:vscodeData.mode;if(!text||!language)return!1;let{tr}=view.state;return tr.replaceSelectionWith(this.type.create({language})),tr.setSelection(TextSelection.near(tr.doc.resolve(Math.max(0,tr.selection.from-2)))),tr.insertText(text.replace(/\r\n?/g,"\n")),tr.setMeta("paste",!0),view.dispatch(tr),!0}}})]}}),Document=Node.create({name:"doc",topNode:!0,content:"block+"});class DropCursorView{constructor(editorView,options){var _a;this.editorView=editorView,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(_a=options.width)&&void 0!==_a?_a:1,this.color=!1===options.color?void 0:options.color||"black",this.class=options.class,this.handlers=["dragover","dragend","drop","dragleave"].map(name=>{let handler=e=>{this[name](e)};return editorView.dom.addEventListener(name,handler),{name,handler}})}destroy(){this.handlers.forEach(({name,handler})=>this.editorView.dom.removeEventListener(name,handler))}update(editorView,prevState){null!=this.cursorPos&&prevState.doc!=editorView.state.doc&&(this.cursorPos>editorView.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(pos){pos!=this.cursorPos&&(this.cursorPos=pos,null==pos?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let parentLeft,parentTop,$pos=this.editorView.state.doc.resolve(this.cursorPos),isBlock=!$pos.parent.inlineContent,rect;if(isBlock){let before=$pos.nodeBefore,after=$pos.nodeAfter;if(before||after){let node=this.editorView.nodeDOM(this.cursorPos-(before?before.nodeSize:0));if(node){let nodeRect=node.getBoundingClientRect(),top=before?nodeRect.bottom:nodeRect.top;before&&after&&(top=(top+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),rect={left:nodeRect.left,right:nodeRect.right,top:top-this.width/2,bottom:top+this.width/2}}}}if(!rect){let coords=this.editorView.coordsAtPos(this.cursorPos);rect={left:coords.left-this.width/2,right:coords.left+this.width/2,top:coords.top,bottom:coords.bottom}}let parent=this.editorView.dom.offsetParent;if(!this.element&&(this.element=parent.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",isBlock),this.element.classList.toggle("prosemirror-dropcursor-inline",!isBlock),parent&&(parent!=document.body||"static"!=getComputedStyle(parent).position)){let rect1=parent.getBoundingClientRect();parentLeft=rect1.left-parent.scrollLeft,parentTop=rect1.top-parent.scrollTop}else parentLeft=-pageXOffset,parentTop=-pageYOffset;this.element.style.left=rect.left-parentLeft+"px",this.element.style.top=rect.top-parentTop+"px",this.element.style.width=rect.right-rect.left+"px",this.element.style.height=rect.bottom-rect.top+"px"}scheduleRemoval(timeout){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),timeout)}dragover(event){if(!this.editorView.editable)return;let pos=this.editorView.posAtCoords({left:event.clientX,top:event.clientY}),node=pos&&pos.inside>=0&&this.editorView.state.doc.nodeAt(pos.inside),disableDropCursor=node&&node.type.spec.disableDropCursor,disabled="function"==typeof disableDropCursor?disableDropCursor(this.editorView,pos,event):disableDropCursor;if(pos&&!disabled){let target=pos.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let point=dropPoint(this.editorView.state.doc,target,this.editorView.dragging.slice);null!=point&&(target=point)}this.setCursor(target),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(event){event.target!=this.editorView.dom&&this.editorView.dom.contains(event.relatedTarget)||this.setCursor(null)}}let Dropcursor=Extension.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[function(options={}){return new Plugin({view:editorView=>new DropCursorView(editorView,options)})}(this.options)]}});class GapCursor extends Selection{constructor($pos){super($pos,$pos)}map(doc,mapping){let $pos=doc.resolve(mapping.map(this.head));return GapCursor.valid($pos)?new GapCursor($pos):Selection.near($pos)}content(){return Slice$2.empty}eq(other){return other instanceof GapCursor&&other.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(doc,json){if("number"!=typeof json.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new GapCursor(doc.resolve(json.pos))}getBookmark(){return new GapBookmark(this.anchor)}static valid($pos){let parent=$pos.parent;if(parent.isTextblock||!function($pos){for(let d=$pos.depth;d>=0;d--){let index=$pos.index(d),parent=$pos.node(d);if(0==index){if(parent.type.spec.isolating)return!0;continue}for(let before=parent.child(index-1);;before=before.lastChild){if(0==before.childCount&&!before.inlineContent||before.isAtom||before.type.spec.isolating)return!0;if(before.inlineContent)return!1}}return!0}($pos)||!function($pos){for(let d=$pos.depth;d>=0;d--){let index=$pos.indexAfter(d),parent=$pos.node(d);if(index==parent.childCount){if(parent.type.spec.isolating)return!0;continue}for(let after=parent.child(index);;after=after.firstChild){if(0==after.childCount&&!after.inlineContent||after.isAtom||after.type.spec.isolating)return!0;if(after.inlineContent)return!1}}return!0}($pos))return!1;let override=parent.type.spec.allowGapCursor;if(null!=override)return override;let deflt=parent.contentMatchAt($pos.index()).defaultType;return deflt&&deflt.isTextblock}static findGapCursorFrom($pos,dir,mustMove=!1){search:for(;;){if(!mustMove&&GapCursor.valid($pos))return $pos;let pos=$pos.pos,next=null;for(let d=$pos.depth;;d--){let parent=$pos.node(d);if(dir>0?$pos.indexAfter(d)<parent.childCount:$pos.index(d)>0){next=parent.child(dir>0?$pos.indexAfter(d):$pos.index(d)-1);break}if(0==d)return null;pos+=dir;let $cur=$pos.doc.resolve(pos);if(GapCursor.valid($cur))return $cur}for(;;){let inside=dir>0?next.firstChild:next.lastChild;if(!inside){if(next.isAtom&&!next.isText&&!NodeSelection.isSelectable(next)){$pos=$pos.doc.resolve(pos+next.nodeSize*dir),mustMove=!1;continue search}break}next=inside,pos+=dir;let $cur1=$pos.doc.resolve(pos);if(GapCursor.valid($cur1))return $cur1}return null}}}GapCursor.prototype.visible=!1,GapCursor.findFrom=GapCursor.findGapCursorFrom,Selection.jsonID("gapcursor",GapCursor);class GapBookmark{constructor(pos){this.pos=pos}map(mapping){return new GapBookmark(mapping.map(this.pos))}resolve(doc){let $pos=doc.resolve(this.pos);return GapCursor.valid($pos)?new GapCursor($pos):Selection.near($pos)}}let handleKeyDown=keydownHandler({ArrowLeft:arrow("horiz",-1),ArrowRight:arrow("horiz",1),ArrowUp:arrow("vert",-1),ArrowDown:arrow("vert",1)});function arrow(axis,dir){let dirStr="vert"==axis?dir>0?"down":"up":dir>0?"right":"left";return function(state,dispatch,view){let sel=state.selection,$start=dir>0?sel.$to:sel.$from,mustMove=sel.empty;if(sel instanceof TextSelection){if(!view.endOfTextblock(dirStr)||0==$start.depth)return!1;mustMove=!1,$start=state.doc.resolve(dir>0?$start.after():$start.before())}let $found=GapCursor.findGapCursorFrom($start,dir,mustMove);return!!$found&&(dispatch&&dispatch(state.tr.setSelection(new GapCursor($found))),!0)}}function handleClick(view,pos,event){if(!view||!view.editable)return!1;let $pos=view.state.doc.resolve(pos);if(!GapCursor.valid($pos))return!1;let clickPos=view.posAtCoords({left:event.clientX,top:event.clientY});return!(clickPos&&clickPos.inside>-1&&NodeSelection.isSelectable(view.state.doc.nodeAt(clickPos.inside)))&&(view.dispatch(view.state.tr.setSelection(new GapCursor($pos))),!0)}function beforeinput(view,event){if("insertCompositionText"!=event.inputType||!(view.state.selection instanceof GapCursor))return!1;let{$from}=view.state.selection,insert=$from.parent.contentMatchAt($from.index()).findWrapping(view.state.schema.nodes.text);if(!insert)return!1;let frag=Fragment$2.empty;for(let i=insert.length-1;i>=0;i--)frag=Fragment$2.from(insert[i].createAndFill(null,frag));let tr=view.state.tr.replace($from.pos,$from.pos,new Slice$2(frag,0,0));return tr.setSelection(TextSelection.near(tr.doc.resolve($from.pos+1))),view.dispatch(tr),!1}function drawGapCursor(state){if(!(state.selection instanceof GapCursor))return null;let node=document.createElement("div");return node.className="ProseMirror-gapcursor",DecorationSet.create(state.doc,[Decoration.widget(state.selection.head,node,{key:"gapcursor"})])}let Gapcursor=Extension.create({name:"gapCursor",addProseMirrorPlugins:()=>[new Plugin({props:{decorations:drawGapCursor,createSelectionBetween:(_view,$anchor,$head)=>$anchor.pos==$head.pos&&GapCursor.valid($head)?new GapCursor($head):null,handleClick,handleKeyDown,handleDOMEvents:{beforeinput:beforeinput}}})],extendNodeSchema(extension){var _a;let context={name:extension.name,options:extension.options,storage:extension.storage};return{allowGapCursor:null!==(_a=callOrReturn(getExtensionField(extension,"allowGapCursor",context)))&&void 0!==_a?_a:null}}}),HardBreak=Node.create({name:"hardBreak",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes}){return["br",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes)]},renderText:()=>"\n",addCommands(){return{setHardBreak:()=>({commands,chain,state,editor})=>commands.first([()=>commands.exitCode(),()=>commands.command(()=>{let{selection,storedMarks}=state;if(selection.$from.parent.type.spec.isolating)return!1;let{keepMarks}=this.options,{splittableMarks}=editor.extensionManager,marks=storedMarks||selection.$to.parentOffset&&selection.$from.marks();return chain().insertContent({type:this.name}).command(({tr,dispatch})=>{if(dispatch&&marks&&keepMarks){let filteredMarks=marks.filter(mark=>splittableMarks.includes(mark.type.name));tr.ensureMarks(filteredMarks)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Heading=Node.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(level=>({tag:`h${level}`,attrs:{level}}))},renderHTML({node,HTMLAttributes}){let hasLevel=this.options.levels.includes(node.attrs.level),level=hasLevel?node.attrs.level:this.options.levels[0];return[`h${level}`,mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setHeading:attributes=>({commands})=>!!this.options.levels.includes(attributes.level)&&commands.setNode(this.name,attributes),toggleHeading:attributes=>({commands})=>!!this.options.levels.includes(attributes.level)&&commands.toggleNode(this.name,"paragraph",attributes)}},addKeyboardShortcuts(){return this.options.levels.reduce((items,level)=>({...items,[`Mod-Alt-${level}`]:()=>this.editor.commands.toggleHeading({level})}),{})},addInputRules(){return this.options.levels.map(level=>textblockTypeInputRule({find:RegExp(`^(#{1,${level}})\\s$`),type:this.type,getAttributes:{level}}))}});var RopeSequence=function(){};RopeSequence.prototype.append=function(other){return other.length?(other=RopeSequence.from(other),!this.length&&other||other.length<200&&this.leafAppend(other)||this.length<200&&other.leafPrepend(this)||this.appendInner(other)):this},RopeSequence.prototype.prepend=function(other){return other.length?RopeSequence.from(other).append(this):this},RopeSequence.prototype.appendInner=function(other){return new Append(this,other)},RopeSequence.prototype.slice=function(from,to){return(void 0===from&&(from=0),void 0===to&&(to=this.length),from>=to)?RopeSequence.empty:this.sliceInner(Math.max(0,from),Math.min(this.length,to))},RopeSequence.prototype.get=function(i){if(!(i<0)&&!(i>=this.length))return this.getInner(i)},RopeSequence.prototype.forEach=function(f,from,to){void 0===from&&(from=0),void 0===to&&(to=this.length),from<=to?this.forEachInner(f,from,to,0):this.forEachInvertedInner(f,from,to,0)},RopeSequence.prototype.map=function(f,from,to){void 0===from&&(from=0),void 0===to&&(to=this.length);var result=[];return this.forEach(function(elt,i){return result.push(f(elt,i))},from,to),result},RopeSequence.from=function(values){return values instanceof RopeSequence?values:values&&values.length?new Leaf(values):RopeSequence.empty};var Leaf=function(RopeSequence){function Leaf(values){RopeSequence.call(this),this.values=values}RopeSequence&&(Leaf.__proto__=RopeSequence),Leaf.prototype=Object.create(RopeSequence&&RopeSequence.prototype),Leaf.prototype.constructor=Leaf;var prototypeAccessors={length:{configurable:!0},depth:{configurable:!0}};return Leaf.prototype.flatten=function(){return this.values},Leaf.prototype.sliceInner=function(from,to){return 0==from&&to==this.length?this:new Leaf(this.values.slice(from,to))},Leaf.prototype.getInner=function(i){return this.values[i]},Leaf.prototype.forEachInner=function(f,from,to,start){for(var i=from;i<to;i++)if(!1===f(this.values[i],start+i))return!1},Leaf.prototype.forEachInvertedInner=function(f,from,to,start){for(var i=from-1;i>=to;i--)if(!1===f(this.values[i],start+i))return!1},Leaf.prototype.leafAppend=function(other){if(this.length+other.length<=200)return new Leaf(this.values.concat(other.flatten()))},Leaf.prototype.leafPrepend=function(other){if(this.length+other.length<=200)return new Leaf(other.flatten().concat(this.values))},prototypeAccessors.length.get=function(){return this.values.length},prototypeAccessors.depth.get=function(){return 0},Object.defineProperties(Leaf.prototype,prototypeAccessors),Leaf}(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=function(RopeSequence){function Append(left,right){RopeSequence.call(this),this.left=left,this.right=right,this.length=left.length+right.length,this.depth=Math.max(left.depth,right.depth)+1}return RopeSequence&&(Append.__proto__=RopeSequence),Append.prototype=Object.create(RopeSequence&&RopeSequence.prototype),Append.prototype.constructor=Append,Append.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},Append.prototype.getInner=function(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},Append.prototype.forEachInner=function(f,from,to,start){var leftLen=this.left.length;if(from<leftLen&&!1===this.left.forEachInner(f,from,Math.min(to,leftLen),start)||to>leftLen&&!1===this.right.forEachInner(f,Math.max(from-leftLen,0),Math.min(this.length,to)-leftLen,start+leftLen))return!1},Append.prototype.forEachInvertedInner=function(f,from,to,start){var leftLen=this.left.length;if(from>leftLen&&!1===this.right.forEachInvertedInner(f,from-leftLen,Math.max(to,leftLen)-leftLen,start+leftLen)||to<leftLen&&!1===this.left.forEachInvertedInner(f,Math.min(from,leftLen),to,start))return!1},Append.prototype.sliceInner=function(from,to){if(0==from&&to==this.length)return this;var leftLen=this.left.length;return to<=leftLen?this.left.slice(from,to):from>=leftLen?this.right.slice(from-leftLen,to-leftLen):this.left.slice(from,leftLen).append(this.right.slice(0,to-leftLen))},Append.prototype.leafAppend=function(other){var inner=this.right.leafAppend(other);if(inner)return new Append(this.left,inner)},Append.prototype.leafPrepend=function(other){var inner=this.left.leafPrepend(other);if(inner)return new Append(inner,this.right)},Append.prototype.appendInner=function(other){return this.left.depth>=Math.max(this.right.depth,other.depth)+1?new Append(this.left,new Append(this.right,other)):new Append(this,other)},Append}(RopeSequence);class Branch{constructor(items,eventCount){this.items=items,this.eventCount=eventCount}popEvent(state,preserveItems){let remap,mapFrom,selection,remaining;if(0==this.eventCount)return null;let end=this.items.length;for(;;end--)if(this.items.get(end-1).selection){--end;break}preserveItems&&(mapFrom=(remap=this.remapping(end,this.items.length)).maps.length);let transform=state.tr,addAfter=[],addBefore=[];return this.items.forEach((item,i)=>{if(!item.step){remap||(mapFrom=(remap=this.remapping(end,i+1)).maps.length),mapFrom--,addBefore.push(item);return}if(remap){addBefore.push(new Item(item.map));let step=item.step.map(remap.slice(mapFrom)),map;step&&transform.maybeStep(step).doc&&(map=transform.mapping.maps[transform.mapping.maps.length-1],addAfter.push(new Item(map,void 0,void 0,addAfter.length+addBefore.length))),mapFrom--,map&&remap.appendMap(map,mapFrom)}else transform.maybeStep(item.step);if(item.selection)return selection=remap?item.selection.map(remap.slice(mapFrom)):item.selection,remaining=new Branch(this.items.slice(0,end).append(addBefore.reverse().concat(addAfter)),this.eventCount-1),!1},this.items.length,0),{remaining:remaining,transform,selection:selection}}addTransform(transform,selection,histOptions,preserveItems){var items,n;let cutPoint,newItems=[],eventCount=this.eventCount,oldItems=this.items,lastItem=!preserveItems&&oldItems.length?oldItems.get(oldItems.length-1):null;for(let i=0;i<transform.steps.length;i++){let step=transform.steps[i].invert(transform.docs[i]),item=new Item(transform.mapping.maps[i],step,selection),merged;(merged=lastItem&&lastItem.merge(item))&&(item=merged,i?newItems.pop():oldItems=oldItems.slice(0,oldItems.length-1)),newItems.push(item),selection&&(eventCount++,selection=void 0),preserveItems||(lastItem=item)}let overflow=eventCount-histOptions.depth;return overflow>DEPTH_OVERFLOW&&(items=oldItems,n=overflow,items.forEach((item,i)=>{if(item.selection&&0==n--)return cutPoint=i,!1}),oldItems=items.slice(cutPoint),eventCount-=overflow),new Branch(oldItems.append(newItems),eventCount)}remapping(from,to){let maps=new Mapping;return this.items.forEach((item,i)=>{let mirrorPos=null!=item.mirrorOffset&&i-item.mirrorOffset>=from?maps.maps.length-item.mirrorOffset:void 0;maps.appendMap(item.map,mirrorPos)},from,to),maps}addMaps(array){return 0==this.eventCount?this:new Branch(this.items.append(array.map(map=>new Item(map))),this.eventCount)}rebased(rebasedTransform,rebasedCount){if(!this.eventCount)return this;let rebasedItems=[],start=Math.max(0,this.items.length-rebasedCount),mapping=rebasedTransform.mapping,newUntil=rebasedTransform.steps.length,eventCount=this.eventCount;this.items.forEach(item=>{item.selection&&eventCount--},start);let iRebased=rebasedCount;this.items.forEach(item=>{let pos=mapping.getMirror(--iRebased);if(null==pos)return;newUntil=Math.min(newUntil,pos);let map=mapping.maps[pos];if(item.step){let step=rebasedTransform.steps[pos].invert(rebasedTransform.docs[pos]),selection=item.selection&&item.selection.map(mapping.slice(iRebased+1,pos));selection&&eventCount++,rebasedItems.push(new Item(map,step,selection))}else rebasedItems.push(new Item(map))},start);let newMaps=[];for(let i=rebasedCount;i<newUntil;i++)newMaps.push(new Item(mapping.maps[i]));let items=this.items.slice(0,start).append(newMaps).append(rebasedItems),branch=new Branch(items,eventCount);return branch.emptyItemCount()>500&&(branch=branch.compress(this.items.length-rebasedItems.length)),branch}emptyItemCount(){let count=0;return this.items.forEach(item=>{!item.step&&count++}),count}compress(upto=this.items.length){let remap=this.remapping(0,upto),mapFrom=remap.maps.length,items=[],events=0;return this.items.forEach((item,i)=>{if(i>=upto)items.push(item),item.selection&&events++;else if(item.step){let step=item.step.map(remap.slice(mapFrom)),map=step&&step.getMap();if(mapFrom--,map&&remap.appendMap(map,mapFrom),step){let selection=item.selection&&item.selection.map(remap.slice(mapFrom));selection&&events++;let newItem=new Item(map.invert(),step,selection),merged,last=items.length-1;(merged=items.length&&items[last].merge(newItem))?items[last]=merged:items.push(newItem)}}else item.map&&mapFrom--},this.items.length,0),new Branch(RopeSequence.from(items.reverse()),events)}}Branch.empty=new Branch(RopeSequence.empty,0);class Item{constructor(map,step,selection,mirrorOffset){this.map=map,this.step=step,this.selection=selection,this.mirrorOffset=mirrorOffset}merge(other){if(this.step&&other.step&&!other.selection){let step=other.step.merge(this.step);if(step)return new Item(step.getMap().invert(),step,this.selection)}}}class HistoryState{constructor(done,undone,prevRanges,prevTime,prevComposition){this.done=done,this.undone=undone,this.prevRanges=prevRanges,this.prevTime=prevTime,this.prevComposition=prevComposition}}let DEPTH_OVERFLOW=20;function rangesFor(map){let result=[];return map.forEach((_from,_to,from,to)=>result.push(from,to)),result}function mapRanges(ranges,mapping){if(!ranges)return null;let result=[];for(let i=0;i<ranges.length;i+=2){let from=mapping.map(ranges[i],1),to=mapping.map(ranges[i+1],-1);from<=to&&result.push(from,to)}return result}function histTransaction(history,state,dispatch,redo){let preserveItems=mustPreserveItems(state),histOptions=historyKey.get(state).spec.config,pop=(redo?history.undone:history.done).popEvent(state,preserveItems);if(!pop)return;let selection=pop.selection.resolve(pop.transform.doc),added=(redo?history.done:history.undone).addTransform(pop.transform,state.selection.getBookmark(),histOptions,preserveItems),newHist=new HistoryState(redo?added:pop.remaining,redo?pop.remaining:added,null,0,-1);dispatch(pop.transform.setSelection(selection).setMeta(historyKey,{redo,historyState:newHist}).scrollIntoView())}let cachedPreserveItems=!1,cachedPreserveItemsPlugins=null;function mustPreserveItems(state){let plugins=state.plugins;if(cachedPreserveItemsPlugins!=plugins){cachedPreserveItems=!1,cachedPreserveItemsPlugins=plugins;for(let i=0;i<plugins.length;i++)if(plugins[i].spec.historyPreserveItems){cachedPreserveItems=!0;break}}return cachedPreserveItems}let historyKey=new PluginKey("history"),closeHistoryKey=new PluginKey("closeHistory"),undo=(state,dispatch)=>{let hist=historyKey.getState(state);return!!hist&&0!=hist.done.eventCount&&(dispatch&&histTransaction(hist,state,dispatch,!1),!0)},redo=(state,dispatch)=>{let hist=historyKey.getState(state);return!!hist&&0!=hist.undone.eventCount&&(dispatch&&histTransaction(hist,state,dispatch,!0),!0)},History=Extension.create({name:"history",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state,dispatch})=>undo(state,dispatch),redo:()=>({state,dispatch})=>redo(state,dispatch)}),addProseMirrorPlugins(){return[function(config={}){return config={depth:config.depth||100,newGroupDelay:config.newGroupDelay||500},new Plugin({key:historyKey,state:{init:()=>new HistoryState(Branch.empty,Branch.empty,null,0,-1),apply:(tr,hist,state)=>(function(history,state,tr,options){let historyTr=tr.getMeta(historyKey),rebased;if(historyTr)return historyTr.historyState;tr.getMeta(closeHistoryKey)&&(history=new HistoryState(history.done,history.undone,null,0,-1));let appended=tr.getMeta("appendedTransaction");if(0==tr.steps.length)return history;if(appended&&appended.getMeta(historyKey))return appended.getMeta(historyKey).redo?new HistoryState(history.done.addTransform(tr,void 0,options,mustPreserveItems(state)),history.undone,rangesFor(tr.mapping.maps[tr.steps.length-1]),history.prevTime,history.prevComposition):new HistoryState(history.done,history.undone.addTransform(tr,void 0,options,mustPreserveItems(state)),null,history.prevTime,history.prevComposition);if(!1===tr.getMeta("addToHistory")||appended&&!1===appended.getMeta("addToHistory"))return(rebased=tr.getMeta("rebased"))?new HistoryState(history.done.rebased(tr,rebased),history.undone.rebased(tr,rebased),mapRanges(history.prevRanges,tr.mapping),history.prevTime,history.prevComposition):new HistoryState(history.done.addMaps(tr.mapping.maps),history.undone.addMaps(tr.mapping.maps),mapRanges(history.prevRanges,tr.mapping),history.prevTime,history.prevComposition);{let composition=tr.getMeta("composition"),newGroup=0==history.prevTime||!appended&&history.prevComposition!=composition&&(history.prevTime<(tr.time||0)-options.newGroupDelay||!function(transform,prevRanges){if(!prevRanges)return!1;if(!transform.docChanged)return!0;let adjacent=!1;return transform.mapping.maps[0].forEach((start,end)=>{for(let i=0;i<prevRanges.length;i+=2)start<=prevRanges[i+1]&&end>=prevRanges[i]&&(adjacent=!0)}),adjacent}(tr,history.prevRanges)),prevRanges=appended?mapRanges(history.prevRanges,tr.mapping):rangesFor(tr.mapping.maps[tr.steps.length-1]);return new HistoryState(history.done.addTransform(tr,newGroup?state.selection.getBookmark():void 0,options,mustPreserveItems(state)),Branch.empty,prevRanges,tr.time,null==composition?history.prevComposition:composition)}})(hist,state,tr,config)},config,props:{handleDOMEvents:{beforeinput(view,e){let inputType=e.inputType,command="historyUndo"==inputType?undo:"historyRedo"==inputType?redo:null;return!!command&&(e.preventDefault(),command(view.state,view.dispatch))}}}})}(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),HorizontalRule=Node.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{}}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes}){return["hr",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes)]},addCommands(){return{setHorizontalRule:()=>({chain})=>chain().insertContent({type:this.name}).command(({tr,dispatch})=>{var _a;if(dispatch){let{$to}=tr.selection,posAfter=$to.end();if($to.nodeAfter)tr.setSelection(TextSelection.create(tr.doc,$to.pos));else{let node=null===(_a=$to.parent.type.contentMatch.defaultType)||void 0===_a?void 0:_a.create();node&&(tr.insert(posAfter,node),tr.setSelection(TextSelection.create(tr.doc,posAfter)))}tr.scrollIntoView()}return!0}).run()}},addInputRules(){var config;return[(config={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type},new InputRule({find:config.find,handler({state,range,match}){let attributes=callOrReturn(config.getAttributes,void 0,match)||{},{tr}=state,start=range.from,end=range.to;if(match[1]){let offset=match[0].lastIndexOf(match[1]),matchStart=start+offset;matchStart>end?matchStart=end:end=matchStart+match[1].length;let lastChar=match[0][match[0].length-1];tr.insertText(lastChar,start+match[0].length-1),tr.replaceWith(matchStart,end,config.type.create(attributes))}else match[0]&&tr.replaceWith(start,end,config.type.create(attributes))}}))]}}),starInputRegex=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,starPasteRegex=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,underscoreInputRegex=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,underscorePasteRegex=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,Italic=Mark.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"em"},{tag:"i",getAttrs:node=>"normal"!==node.style.fontStyle&&null},{style:"font-style=italic"}],renderHTML({HTMLAttributes}){return["em",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setItalic:()=>({commands})=>commands.setMark(this.name),toggleItalic:()=>({commands})=>commands.toggleMark(this.name),unsetItalic:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[markInputRule({find:starInputRegex,type:this.type}),markInputRule({find:underscoreInputRegex,type:this.type})]},addPasteRules(){return[markPasteRule({find:starPasteRegex,type:this.type}),markPasteRule({find:underscorePasteRegex,type:this.type})]}}),ListItem$1=Node.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes}){return["li",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ListItem=Node.create({name:"listItem",addOptions:()=>({HTMLAttributes:{}}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes}){return["li",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),TextStyle=Mark.create({name:"textStyle",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"span",getAttrs(element){let hasStyles=element.hasAttribute("style");return!!hasStyles&&{}}}],renderHTML({HTMLAttributes}){return["span",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{removeEmptyTextStyle:()=>({state,commands})=>{let attributes=getMarkAttributes(state,this.type),hasStyles=Object.entries(attributes).some(([,value])=>!!value);return!!hasStyles||commands.unsetMark(this.name)}}}}),inputRegex$2=/^(\d+)\.\s$/,OrderedList=Node.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:element=>element.hasAttribute("start")?parseInt(element.getAttribute("start")||"",10):1}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes}){let{start,...attributesWithoutStart}=HTMLAttributes;return 1===start?["ol",mergeAttributes(this.options.HTMLAttributes,attributesWithoutStart),0]:["ol",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{toggleOrderedList:()=>({commands,chain})=>this.options.keepAttributes?chain().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(ListItem.name,this.editor.getAttributes(TextStyle.name)).run():commands.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let inputRule=wrappingInputRule({find:inputRegex$2,type:this.type,getAttributes:match=>({start:+match[1]}),joinPredicate:(match,node)=>node.childCount+node.attrs.start===+match[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(inputRule=wrappingInputRule({find:inputRegex$2,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:match=>({start:+match[1],...this.editor.getAttributes(TextStyle.name)}),joinPredicate:(match,node)=>node.childCount+node.attrs.start===+match[1],editor:this.editor})),[inputRule]}}),Paragraph=Node.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes}){return["p",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setParagraph:()=>({commands})=>commands.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),inputRegex$1=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,pasteRegex=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,Strike=Mark.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:style=>!!style.includes("line-through")&&{}}],renderHTML({HTMLAttributes}){return["s",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setStrike:()=>({commands})=>commands.setMark(this.name),toggleStrike:()=>({commands})=>commands.toggleMark(this.name),unsetStrike:()=>({commands})=>commands.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[markInputRule({find:inputRegex$1,type:this.type})]},addPasteRules(){return[markPasteRule({find:pasteRegex,type:this.type})]}}),Text$2=Node.create({name:"text",group:"inline"}),StarterKit=Extension.create({name:"starterKit",addExtensions(){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t;let extensions=[];return!1!==this.options.blockquote&&extensions.push(Blockquote.configure(null===(_a=this.options)||void 0===_a?void 0:_a.blockquote)),!1!==this.options.bold&&extensions.push(Bold.configure(null===(_b=this.options)||void 0===_b?void 0:_b.bold)),!1!==this.options.bulletList&&extensions.push(BulletList$1.configure(null===(_c=this.options)||void 0===_c?void 0:_c.bulletList)),!1!==this.options.code&&extensions.push(Code.configure(null===(_d=this.options)||void 0===_d?void 0:_d.code)),!1!==this.options.codeBlock&&extensions.push(CodeBlock.configure(null===(_e=this.options)||void 0===_e?void 0:_e.codeBlock)),!1!==this.options.document&&extensions.push(Document.configure(null===(_f=this.options)||void 0===_f?void 0:_f.document)),!1!==this.options.dropcursor&&extensions.push(Dropcursor.configure(null===(_g=this.options)||void 0===_g?void 0:_g.dropcursor)),!1!==this.options.gapcursor&&extensions.push(Gapcursor.configure(null===(_h=this.options)||void 0===_h?void 0:_h.gapcursor)),!1!==this.options.hardBreak&&extensions.push(HardBreak.configure(null===(_j=this.options)||void 0===_j?void 0:_j.hardBreak)),!1!==this.options.heading&&extensions.push(Heading.configure(null===(_k=this.options)||void 0===_k?void 0:_k.heading)),!1!==this.options.history&&extensions.push(History.configure(null===(_l=this.options)||void 0===_l?void 0:_l.history)),!1!==this.options.horizontalRule&&extensions.push(HorizontalRule.configure(null===(_m=this.options)||void 0===_m?void 0:_m.horizontalRule)),!1!==this.options.italic&&extensions.push(Italic.configure(null===(_o=this.options)||void 0===_o?void 0:_o.italic)),!1!==this.options.listItem&&extensions.push(ListItem$1.configure(null===(_p=this.options)||void 0===_p?void 0:_p.listItem)),!1!==this.options.orderedList&&extensions.push(OrderedList.configure(null===(_q=this.options)||void 0===_q?void 0:_q.orderedList)),!1!==this.options.paragraph&&extensions.push(Paragraph.configure(null===(_r=this.options)||void 0===_r?void 0:_r.paragraph)),!1!==this.options.strike&&extensions.push(Strike.configure(null===(_s=this.options)||void 0===_s?void 0:_s.strike)),!1!==this.options.text&&extensions.push(Text$2.configure(null===(_t=this.options)||void 0===_t?void 0:_t.text)),extensions}}),inputRegex=/^\s*(\[([( |x])?\])\s$/,TaskItem$1=Node.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{}}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:element=>"true"===element.getAttribute("data-checked"),renderHTML:attributes=>({"data-checked":attributes.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node,HTMLAttributes}){return["li",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:node.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){let shortcuts={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...shortcuts,Tab:()=>this.editor.commands.sinkListItem(this.name)}:shortcuts},addNodeView(){return({node,HTMLAttributes,getPos,editor})=>{let listItem=document.createElement("li"),checkboxWrapper=document.createElement("label"),checkboxStyler=document.createElement("span"),checkbox=document.createElement("input"),content=document.createElement("div");return checkboxWrapper.contentEditable="false",checkbox.type="checkbox",checkbox.addEventListener("change",event=>{if(!editor.isEditable&&!this.options.onReadOnlyChecked){checkbox.checked=!checkbox.checked;return}let{checked}=event.target;editor.isEditable&&"function"==typeof getPos&&editor.chain().focus(void 0,{scrollIntoView:!1}).command(({tr})=>{let position=getPos(),currentNode=tr.doc.nodeAt(position);return tr.setNodeMarkup(position,void 0,{...null==currentNode?void 0:currentNode.attrs,checked}),!0}).run(),editor.isEditable||!this.options.onReadOnlyChecked||this.options.onReadOnlyChecked(node,checked)||(checkbox.checked=!checkbox.checked)}),Object.entries(this.options.HTMLAttributes).forEach(([key,value])=>{listItem.setAttribute(key,value)}),listItem.dataset.checked=node.attrs.checked,node.attrs.checked&&checkbox.setAttribute("checked","checked"),checkboxWrapper.append(checkbox,checkboxStyler),listItem.append(checkboxWrapper,content),Object.entries(HTMLAttributes).forEach(([key,value])=>{listItem.setAttribute(key,value)}),{dom:listItem,contentDOM:content,update:updatedNode=>updatedNode.type===this.type&&(listItem.dataset.checked=updatedNode.attrs.checked,updatedNode.attrs.checked?checkbox.setAttribute("checked","checked"):checkbox.removeAttribute("checked"),!0)}}},addInputRules(){return[wrappingInputRule({find:inputRegex,type:this.type,getAttributes:match=>({checked:"x"===match[match.length-1]})})]}}),customInputRegex$1=/^\s*([-+*]\s\[([( |x])?])\s$/,TaskItem=TaskItem$1.extend({addOptions(){var _a;return Object.assign(Object.assign({},null===(_a=this.parent)||void 0===_a?void 0:_a.call(this)),{nested:!0})},addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML(element){let checkbox=element.querySelector("input[type=checkbox].task-list-item-checkbox");return null==checkbox?void 0:checkbox.checked},renderHTML:attributes=>({"data-checked":attributes.checked})}}),addNodeView(){return({node,HTMLAttributes,getPos,editor})=>{let listItem=document.createElement("li"),checkboxWrapper=document.createElement("label"),checkboxStyler=document.createElement("span"),checkbox=document.createElement("input"),content=document.createElement("div");return checkboxWrapper.contentEditable="false",checkbox.type="checkbox",checkbox.addEventListener("change",event=>{if(!editor.isEditable&&!this.options.onReadOnlyChecked){checkbox.checked=!checkbox.checked;return}let{checked}=event.target;editor.isEditable&&"function"==typeof getPos&&editor.chain().focus(void 0,{scrollIntoView:!1}).command(({tr})=>{let position=getPos(),currentNode=tr.doc.nodeAt(position);return tr.setNodeMarkup(position,void 0,Object.assign(Object.assign({},null==currentNode?void 0:currentNode.attrs),{checked})),!0}).run(),editor.isEditable||!this.options.onReadOnlyChecked||this.options.onReadOnlyChecked(node,checked)||(checkbox.checked=!checkbox.checked)}),Object.entries(this.options.HTMLAttributes).forEach(([key,value])=>{listItem.setAttribute(key,value)}),listItem.dataset.checked=node.attrs.checked,node.attrs.checked&&checkbox.setAttribute("checked","checked"),checkboxWrapper.append(checkbox,checkboxStyler),listItem.append(checkboxWrapper,content),Object.entries(HTMLAttributes).forEach(([key,value])=>{listItem.setAttribute(key,value)}),{dom:listItem,contentDOM:content,update:updatedNode=>updatedNode.type===this.type&&(listItem.dataset.checked=updatedNode.attrs.checked,updatedNode.attrs.checked?checkbox.setAttribute("checked","checked"):checkbox.removeAttribute("checked"),!0),ignoreMutation:mr=>"data-checked"!==mr.attributeName}}},parseHTML(){var _a;return[...null===(_a=this.parent)||void 0===_a?void 0:_a.call(this),{tag:"li.task-list-item",priority:100}]},addInputRules(){var _a;return[...null===(_a=this.parent)||void 0===_a?void 0:_a.call(this),wrappingInputRule({find:customInputRegex$1,type:this.type,getAttributes:match=>({checked:"x"===match[match.length-1]})})]}}),TaskList$1=Node.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes}){return["ul",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands})=>commands.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),TaskList=TaskList$1.extend({addAttributes:()=>({numeric:{default:!1,parseHTML:element=>"ol"===element.tagName.toLowerCase()}}),parseHTML:()=>[{tag:".contains-task-list",priority:100}],renderHTML(_a){var _b=_a.HTMLAttributes,{numeric}=_b;return[numeric?"ol":"ul",mergeAttributes(/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */ function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&0>e.indexOf(p)&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)0>e.indexOf(p[i])&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}(_b,["numeric"]),{"data-type":"taskList"}),0]}}),customInputRegex=/^\s*([-+*]\s[^\[])$/,BulletList=BulletList$1.extend({addInputRules(){return[wrappingInputRule({find:customInputRegex,type:this.type})]}});(ViewMode=ViewMode1||(ViewMode1={})).MARKDOWN="markdown",ViewMode.PREVIEW="preview",ViewMode.READONLY="readonly";var entities={Aacute:"\xc1",aacute:"\xe1",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"\xc2",acirc:"\xe2",acute:"\xb4",Acy:"А",acy:"а",AElig:"\xc6",aelig:"\xe6",af:"⁡",Afr:"\uD835\uDD04",afr:"\uD835\uDD1E",Agrave:"\xc0",agrave:"\xe0",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"\xc5",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"\uD835\uDD38",aopf:"\uD835\uDD52",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"\xc5",aring:"\xe5",Ascr:"\uD835\uDC9C",ascr:"\uD835\uDCB6",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"\xc3",atilde:"\xe3",Auml:"\xc4",auml:"\xe4",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"\uD835\uDD05",bfr:"\uD835\uDD1F",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"\uD835\uDD39",bopf:"\uD835\uDD53",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"\xa6",bscr:"\uD835\uDCB7",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"\xc7",ccedil:"\xe7",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"\xb8",Cedilla:"\xb8",cemptyv:"⦲",cent:"\xa2",centerdot:"\xb7",CenterDot:"\xb7",cfr:"\uD835\uDD20",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"\xae",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"\uD835\uDD54",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"\xa9",COPY:"\xa9",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"\uD835\uDC9E",cscr:"\uD835\uDCB8",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"\xa4",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"\xb0",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"\uD835\uDD07",dfr:"\uD835\uDD21",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"\xb4",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"\xa8",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"\xf7",divide:"\xf7",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"\uD835\uDD3B",dopf:"\uD835\uDD55",Dot:"\xa8",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"\xa8",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"\uD835\uDC9F",dscr:"\uD835\uDCB9",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"\xc9",eacute:"\xe9",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"\xca",ecirc:"\xea",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"\uD835\uDD08",efr:"\uD835\uDD22",eg:"⪚",Egrave:"\xc8",egrave:"\xe8",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"\uD835\uDD3C",eopf:"\uD835\uDD56",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"\xd0",eth:"\xf0",Euml:"\xcb",euml:"\xeb",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"\uD835\uDD09",ffr:"\uD835\uDD23",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"\uD835\uDD3D",fopf:"\uD835\uDD57",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"\xbd",frac13:"⅓",frac14:"\xbc",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"\xbe",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"\uD835\uDCBB",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"\uD835\uDD0A",gfr:"\uD835\uDD24",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"\uD835\uDD3E",gopf:"\uD835\uDD58",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"\uD835\uDCA2",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"\xbd",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"\uD835\uDD25",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"\uD835\uDD59",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"\uD835\uDCBD",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"\xcd",iacute:"\xed",ic:"⁣",Icirc:"\xce",icirc:"\xee",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"\xa1",iff:"⇔",ifr:"\uD835\uDD26",Ifr:"ℑ",Igrave:"\xcc",igrave:"\xec",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"\uD835\uDD40",iopf:"\uD835\uDD5A",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"\xbf",iscr:"\uD835\uDCBE",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"\xcf",iuml:"\xef",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"\uD835\uDD0D",jfr:"\uD835\uDD27",jmath:"ȷ",Jopf:"\uD835\uDD41",jopf:"\uD835\uDD5B",Jscr:"\uD835\uDCA5",jscr:"\uD835\uDCBF",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"\uD835\uDD0E",kfr:"\uD835\uDD28",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"\uD835\uDD42",kopf:"\uD835\uDD5C",Kscr:"\uD835\uDCA6",kscr:"\uD835\uDCC0",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"\xab",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"\uD835\uDD0F",lfr:"\uD835\uDD29",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"\uD835\uDD43",lopf:"\uD835\uDD5D",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"\uD835\uDCC1",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"\xaf",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"\uD835\uDD10",mfr:"\uD835\uDD2A",mho:"℧",micro:"\xb5",midast:"*",midcir:"⫰",mid:"∣",middot:"\xb7",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"\uD835\uDD44",mopf:"\uD835\uDD5E",mp:"∓",mscr:"\uD835\uDCC2",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:"\xa0",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"\uD835\uDD11",nfr:"\uD835\uDD2B",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:"\xa0",nopf:"\uD835\uDD5F",Nopf:"ℕ",Not:"⫬",not:"\xac",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"\uD835\uDCA9",nscr:"\uD835\uDCC3",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"\xd1",ntilde:"\xf1",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"\xd3",oacute:"\xf3",oast:"⊛",Ocirc:"\xd4",ocirc:"\xf4",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"\uD835\uDD12",ofr:"\uD835\uDD2C",ogon:"˛",Ograve:"\xd2",ograve:"\xf2",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"\uD835\uDD46",oopf:"\uD835\uDD60",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"\xaa",ordm:"\xba",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"\uD835\uDCAA",oscr:"ℴ",Oslash:"\xd8",oslash:"\xf8",osol:"⊘",Otilde:"\xd5",otilde:"\xf5",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"\xd6",ouml:"\xf6",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"\xb6",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"\uD835\uDD13",pfr:"\uD835\uDD2D",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"\xb1",plusmn:"\xb1",plussim:"⨦",plustwo:"⨧",pm:"\xb1",Poincareplane:"ℌ",pointint:"⨕",popf:"\uD835\uDD61",Popf:"ℙ",pound:"\xa3",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"\uD835\uDCAB",pscr:"\uD835\uDCC5",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"\uD835\uDD14",qfr:"\uD835\uDD2E",qint:"⨌",qopf:"\uD835\uDD62",Qopf:"ℚ",qprime:"⁗",Qscr:"\uD835\uDCAC",qscr:"\uD835\uDCC6",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"\xbb",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"\xae",REG:"\xae",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"\uD835\uDD2F",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"\uD835\uDD63",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"\uD835\uDCC7",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"\xa7",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"\uD835\uDD16",sfr:"\uD835\uDD30",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"\xad",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"\uD835\uDD4A",sopf:"\uD835\uDD64",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"\uD835\uDCAE",sscr:"\uD835\uDCC8",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"\xaf",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"\xb9",sup2:"\xb2",sup3:"\xb3",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"\xdf",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"\uD835\uDD17",tfr:"\uD835\uDD31",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"\xde",thorn:"\xfe",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"\xd7",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"\uD835\uDD4B",topf:"\uD835\uDD65",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"\uD835\uDCAF",tscr:"\uD835\uDCC9",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"\xda",uacute:"\xfa",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"\xdb",ucirc:"\xfb",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"\uD835\uDD18",ufr:"\uD835\uDD32",Ugrave:"\xd9",ugrave:"\xf9",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"\xa8",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"\uD835\uDD4C",uopf:"\uD835\uDD66",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"\uD835\uDCB0",uscr:"\uD835\uDCCA",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"\xdc",uuml:"\xfc",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"\uD835\uDD19",vfr:"\uD835\uDD33",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"\uD835\uDD4D",vopf:"\uD835\uDD67",vprop:"∝",vrtri:"⊳",Vscr:"\uD835\uDCB1",vscr:"\uD835\uDCCB",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"\uD835\uDD1A",wfr:"\uD835\uDD34",Wopf:"\uD835\uDD4E",wopf:"\uD835\uDD68",wp:"℘",wr:"≀",wreath:"≀",Wscr:"\uD835\uDCB2",wscr:"\uD835\uDCCC",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"\uD835\uDD1B",xfr:"\uD835\uDD35",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"\uD835\uDD4F",xopf:"\uD835\uDD69",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"\uD835\uDCB3",xscr:"\uD835\uDCCD",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"\xdd",yacute:"\xfd",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"\xa5",Yfr:"\uD835\uDD1C",yfr:"\uD835\uDD36",YIcy:"Ї",yicy:"ї",Yopf:"\uD835\uDD50",yopf:"\uD835\uDD6A",Yscr:"\uD835\uDCB4",yscr:"\uD835\uDCCE",YUcy:"Ю",yucy:"ю",yuml:"\xff",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"\uD835\uDD37",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"\uD835\uDD6B",Zopf:"ℤ",Zscr:"\uD835\uDCB5",zscr:"\uD835\uDCCF",zwj:"‍",zwnj:"‌"},regex$4=/[!-#%-\*,-\/:;\?@\[-\]_\{\}\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4E\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/,encodeCache={};function encode$2(string,exclude,keepEscaped){var i,l,code,nextCode,cache,result="";for("string"!=typeof exclude&&(keepEscaped=exclude,exclude=encode$2.defaultChars),void 0===keepEscaped&&(keepEscaped=!0),cache=function(exclude){var i,ch,cache=encodeCache[exclude];if(cache)return cache;for(i=0,cache=encodeCache[exclude]=[];i<128;i++)ch=String.fromCharCode(i),/^[0-9a-z]$/i.test(ch)?cache.push(ch):cache.push("%"+("0"+i.toString(16).toUpperCase()).slice(-2));for(i=0;i<exclude.length;i++)cache[exclude.charCodeAt(i)]=exclude[i];return cache}(exclude),i=0,l=string.length;i<l;i++){if(code=string.charCodeAt(i),keepEscaped&&37===code&&i+2<l&&/^[0-9a-f]{2}$/i.test(string.slice(i+1,i+3))){result+=string.slice(i,i+3),i+=2;continue}if(code<128){result+=cache[code];continue}if(code>=55296&&code<=57343){if(code>=55296&&code<=56319&&i+1<l&&(nextCode=string.charCodeAt(i+1))>=56320&&nextCode<=57343){result+=encodeURIComponent(string[i]+string[i+1]),i++;continue}result+="%EF%BF%BD";continue}result+=encodeURIComponent(string[i])}return result}encode$2.defaultChars=";/?:@&=+$,-_.!~*'()#",encode$2.componentChars="-_.!~*'()";var decodeCache={};function decode$2(string,exclude){var cache;return"string"!=typeof exclude&&(exclude=decode$2.defaultChars),cache=function(exclude){var i,ch,cache=decodeCache[exclude];if(cache)return cache;for(i=0,cache=decodeCache[exclude]=[];i<128;i++)ch=String.fromCharCode(i),cache.push(ch);for(i=0;i<exclude.length;i++)cache[ch=exclude.charCodeAt(i)]="%"+("0"+ch.toString(16).toUpperCase()).slice(-2);return cache}(exclude),string.replace(/(%[a-f0-9]{2})+/gi,function(seq){var i,l,b1,b2,b3,b4,chr,result="";for(i=0,l=seq.length;i<l;i+=3){if((b1=parseInt(seq.slice(i+1,i+3),16))<128){result+=cache[b1];continue}if((224&b1)==192&&i+3<l&&(192&(b2=parseInt(seq.slice(i+4,i+6),16)))==128){(chr=b1<<6&1984|63&b2)<128?result+="��":result+=String.fromCharCode(chr),i+=3;continue}if((240&b1)==224&&i+6<l&&(b2=parseInt(seq.slice(i+4,i+6),16),b3=parseInt(seq.slice(i+7,i+9),16),(192&b2)==128&&(192&b3)==128)){(chr=b1<<12&61440|b2<<6&4032|63&b3)<2048||chr>=55296&&chr<=57343?result+="���":result+=String.fromCharCode(chr),i+=6;continue}if((248&b1)==240&&i+9<l&&(b2=parseInt(seq.slice(i+4,i+6),16),b3=parseInt(seq.slice(i+7,i+9),16),b4=parseInt(seq.slice(i+10,i+12),16),(192&b2)==128&&(192&b3)==128&&(192&b4)==128)){(chr=b1<<18&1835008|b2<<12&258048|b3<<6&4032|63&b4)<65536||chr>1114111?result+="����":(chr-=65536,result+=String.fromCharCode(55296+(chr>>10),56320+(1023&chr))),i+=9;continue}result+="�"}return result})}function Url$1(){this.protocol=null,this.slashes=null,this.auth=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.pathname=null}decode$2.defaultChars=";/?:@&=+$,#",decode$2.componentChars="";var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,nonHostChars=["%","/","?",";","#"].concat(["'"].concat(["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","	"]))),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};Url$1.prototype.parse=function(url,slashesDenoteHost){var i,l,lowerProto,hec,slashes,rest=url;if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.pathname=simplePath[1],simplePath[2]&&(this.search=simplePath[2]),this}var proto=protocolPattern.exec(rest);if(proto&&(lowerProto=(proto=proto[0]).toLowerCase(),this.protocol=proto,rest=rest.substr(proto.length)),(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/))&&(slashes="//"===rest.substr(0,2))&&!(proto&&hostlessProtocol[proto])&&(rest=rest.substr(2),this.slashes=!0),!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var auth,atSign,hostEnd=-1;for(i=0;i<hostEndingChars.length;i++)-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec);for(-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=auth),hostEnd=-1,i=0;i<nonHostChars.length;i++)-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec);-1===hostEnd&&(hostEnd=rest.length),":"===rest[hostEnd-1]&&hostEnd--;var host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd),this.parseHost(host),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest=notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}}this.hostname.length>255&&(this.hostname=""),ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2))}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");return -1!==qm&&(this.search=rest.substr(qm),rest=rest.slice(0,qm)),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname=""),this},Url$1.prototype.parseHost=function(host){var port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)};var mdurl={encode:encode$2,decode:decode$2,format:function(url){var result="";return result=(url.protocol||"")+(url.slashes?"//":"")+(url.auth?url.auth+"@":""),url.hostname&&-1!==url.hostname.indexOf(":")?result+="["+url.hostname+"]":result+=url.hostname||"",result=(url.port?":"+url.port:"")+(url.pathname||"")+(url.search||"")+(url.hash||"")},parse:function(url,slashesDenoteHost){if(url&&url instanceof Url$1)return url;var u=new Url$1;return u.parse(url,slashesDenoteHost),u}},regex$3=/[\0-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,regex$2=/[\0-\x1F\x7F-\x9F]/,regex=/[ \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/,uc_micro={Any:regex$3,Cc:regex$2,Cf:/[\xAD\u0600-\u0605\u061C\u06DD\u070F\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F]/,P:regex$4,Z:regex},utils=(0,_commonjsHelpers_212d567a_js__WEBPACK_IMPORTED_MODULE_2__.c)(function(module,exports){var _hasOwnProperty=Object.prototype.hasOwnProperty;function has(object,key){return _hasOwnProperty.call(object,key)}function isValidEntityCode(c){return(!(c>=55296)||!(c<=57343))&&(!(c>=64976)||!(c<=65007))&&(65535&c)!=65535&&(65535&c)!=65534&&(!(c>=0)||!(c<=8))&&11!==c&&(!(c>=14)||!(c<=31))&&(!(c>=127)||!(c<=159))&&!(c>1114111)}function fromCodePoint(c){return c>65535?String.fromCharCode(55296+((c-=65536)>>10),56320+(1023&c)):String.fromCharCode(c)}var UNESCAPE_MD_RE=/\\([!"#$%&'()*+,\-.\/:;<=>?@[\\\]^_`{|}~])/g,UNESCAPE_ALL_RE=RegExp(UNESCAPE_MD_RE.source+"|"+/&([a-z#][a-z0-9]{1,31});/gi.source,"gi"),DIGITAL_ENTITY_TEST_RE=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i,HTML_ESCAPE_TEST_RE=/[&<>"]/,HTML_ESCAPE_REPLACE_RE=/[&<>"]/g,HTML_REPLACEMENTS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function replaceUnsafeChar(ch){return HTML_REPLACEMENTS[ch]}var REGEXP_ESCAPE_RE=/[.?*+^$[\]\\(){}|-]/g;exports.lib={},exports.lib.mdurl=mdurl,exports.lib.ucmicro=uc_micro,exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);return sources.forEach(function(source){if(source){if("object"!=typeof source)throw TypeError(source+"must be object");Object.keys(source).forEach(function(key){obj[key]=source[key]})}}),obj},exports.isString=function(obj){return"[object String]"===Object.prototype.toString.call(obj)},exports.has=has,exports.unescapeMd=function(str){return 0>str.indexOf("\\")?str:str.replace(UNESCAPE_MD_RE,"$1")},exports.unescapeAll=function(str){return 0>str.indexOf("\\")&&0>str.indexOf("&")?str:str.replace(UNESCAPE_ALL_RE,function(match,escaped,entity){var code;return escaped||(code=0,has(entities,entity)?entities[entity]:35===entity.charCodeAt(0)&&DIGITAL_ENTITY_TEST_RE.test(entity)&&isValidEntityCode(code="x"===entity[1].toLowerCase()?parseInt(entity.slice(2),16):parseInt(entity.slice(1),10))?fromCodePoint(code):match)})},exports.isValidEntityCode=isValidEntityCode,exports.fromCodePoint=fromCodePoint,exports.escapeHtml=function(str){return HTML_ESCAPE_TEST_RE.test(str)?str.replace(HTML_ESCAPE_REPLACE_RE,replaceUnsafeChar):str},exports.arrayReplaceAt=function(src,pos,newElements){return[].concat(src.slice(0,pos),newElements,src.slice(pos+1))},exports.isSpace=function(code){switch(code){case 9:case 32:return!0}return!1},exports.isWhiteSpace=function(code){if(code>=8192&&code<=8202)return!0;switch(code){case 9:case 10:case 11:case 12:case 13:case 32:case 160:case 5760:case 8239:case 8287:case 12288:return!0}return!1},exports.isMdAsciiPunct=function(ch){switch(ch){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 58:case 59:case 60:case 61:case 62:case 63:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 124:case 125:case 126:return!0;default:return!1}},exports.isPunctChar=function(ch){return regex$4.test(ch)},exports.escapeRE=function(str){return str.replace(REGEXP_ESCAPE_RE,"\\$&")},exports.normalizeReference=function(str){return(str=str.trim().replace(/\s+/g," ")).toLowerCase().toUpperCase()}}),unescapeAll$2=utils.unescapeAll,unescapeAll$1=utils.unescapeAll,helpers={parseLinkLabel:function(state,start,disableNested){var level,found,marker,prevPos,labelEnd=-1,max=state.posMax,oldPos=state.pos;for(state.pos=start+1,level=1;state.pos<max;){if(93===(marker=state.src.charCodeAt(state.pos))&&0==--level){found=!0;break}if(prevPos=state.pos,state.md.inline.skipToken(state),91===marker){if(prevPos===state.pos-1)level++;else if(disableNested)return state.pos=oldPos,-1}}return found&&(labelEnd=state.pos),state.pos=oldPos,labelEnd},parseLinkDestination:function(str,pos,max){var code,level,start=pos,result={ok:!1,pos:0,lines:0,str:""};if(60===str.charCodeAt(pos)){for(pos++;pos<max&&10!==(code=str.charCodeAt(pos))&&60!==code;){if(62===code){result.pos=pos+1,result.str=unescapeAll$2(str.slice(start+1,pos)),result.ok=!0;break}if(92===code&&pos+1<max){pos+=2;continue}pos++}return result}for(level=0;pos<max&&32!==(code=str.charCodeAt(pos))&&!(code<32)&&127!==code;){if(92===code&&pos+1<max){if(32===str.charCodeAt(pos+1))break;pos+=2;continue}if(40===code&&++level>32)return result;if(41===code){if(0===level)break;level--}pos++}return start===pos||0!==level||(result.str=unescapeAll$2(str.slice(start,pos)),result.lines=0,result.pos=pos,result.ok=!0),result},parseLinkTitle:function(str,pos,max){var code,marker,lines=0,start=pos,result={ok:!1,pos:0,lines:0,str:""};if(pos>=max||34!==(marker=str.charCodeAt(pos))&&39!==marker&&40!==marker)return result;for(pos++,40===marker&&(marker=41);pos<max;){if((code=str.charCodeAt(pos))===marker){result.pos=pos+1,result.lines=lines,result.str=unescapeAll$1(str.slice(start+1,pos)),result.ok=!0;break}if(40===code&&41===marker)break;10===code?lines++:92===code&&pos+1<max&&(pos++,10===str.charCodeAt(pos)&&lines++),pos++}return result}},assign$2=utils.assign,unescapeAll=utils.unescapeAll,escapeHtml=utils.escapeHtml,default_rules={};function Renderer(){this.rules=assign$2({},default_rules)}function Ruler(){this.__rules__=[],this.__cache__=null}default_rules.code_inline=function(tokens,idx,options,env,slf){var token=tokens[idx];return"<code"+slf.renderAttrs(token)+">"+escapeHtml(tokens[idx].content)+"</code>"},default_rules.code_block=function(tokens,idx,options,env,slf){var token=tokens[idx];return"<pre"+slf.renderAttrs(token)+"><code>"+escapeHtml(tokens[idx].content)+"</code></pre>\n"},default_rules.fence=function(tokens,idx,options,env,slf){var highlighted,i,arr,tmpAttrs,token=tokens[idx],info=token.info?unescapeAll(token.info).trim():"",langName="",langAttrs="";return(info&&(langName=(arr=info.split(/(\s+)/g))[0],langAttrs=arr.slice(2).join("")),0===(highlighted=options.highlight&&options.highlight(token.content,langName,langAttrs)||escapeHtml(token.content)).indexOf("<pre"))?highlighted+"\n":info?(i=token.attrIndex("class"),tmpAttrs=token.attrs?token.attrs.slice():[],i<0?tmpAttrs.push(["class",options.langPrefix+langName]):(tmpAttrs[i]=tmpAttrs[i].slice(),tmpAttrs[i][1]+=" "+options.langPrefix+langName),"<pre><code"+slf.renderAttrs({attrs:tmpAttrs})+">"+highlighted+"</code></pre>\n"):"<pre><code"+slf.renderAttrs(token)+">"+highlighted+"</code></pre>\n"},default_rules.image=function(tokens,idx,options,env,slf){var token=tokens[idx];return token.attrs[token.attrIndex("alt")][1]=slf.renderInlineAsText(token.children,options,env),slf.renderToken(tokens,idx,options)},default_rules.hardbreak=function(tokens,idx,options){return options.xhtmlOut?"<br />\n":"<br>\n"},default_rules.softbreak=function(tokens,idx,options){return options.breaks?options.xhtmlOut?"<br />\n":"<br>\n":"\n"},default_rules.text=function(tokens,idx){return escapeHtml(tokens[idx].content)},default_rules.html_block=function(tokens,idx){return tokens[idx].content},default_rules.html_inline=function(tokens,idx){return tokens[idx].content},Renderer.prototype.renderAttrs=function(token){var i,l,result;if(!token.attrs)return"";for(i=0,result="",l=token.attrs.length;i<l;i++)result+=" "+escapeHtml(token.attrs[i][0])+'="'+escapeHtml(token.attrs[i][1])+'"';return result},Renderer.prototype.renderToken=function(tokens,idx,options){var nextToken,result="",needLf=!1,token=tokens[idx];return token.hidden?"":(token.block&&-1!==token.nesting&&idx&&tokens[idx-1].hidden&&(result+="\n"),result=(-1===token.nesting?"</":"<")+token.tag+this.renderAttrs(token),0===token.nesting&&options.xhtmlOut&&(result+=" /"),token.block&&(needLf=!0,1===token.nesting&&idx+1<tokens.length&&("inline"===(nextToken=tokens[idx+1]).type||nextToken.hidden?needLf=!1:-1===nextToken.nesting&&nextToken.tag===token.tag&&(needLf=!1))),result+=needLf?">\n":">")},Renderer.prototype.renderInline=function(tokens,options,env){for(var type,result="",rules=this.rules,i=0,len=tokens.length;i<len;i++)void 0!==rules[type=tokens[i].type]?result+=rules[type](tokens,i,options,env,this):result+=this.renderToken(tokens,i,options);return result},Renderer.prototype.renderInlineAsText=function(tokens,options,env){for(var result="",i=0,len=tokens.length;i<len;i++)"text"===tokens[i].type?result+=tokens[i].content:"image"===tokens[i].type?result+=this.renderInlineAsText(tokens[i].children,options,env):"softbreak"===tokens[i].type&&(result+="\n");return result},Renderer.prototype.render=function(tokens,options,env){var i,len,type,result="",rules=this.rules;for(i=0,len=tokens.length;i<len;i++)"inline"===(type=tokens[i].type)?result+=this.renderInline(tokens[i].children,options,env):void 0!==rules[type]?result+=rules[tokens[i].type](tokens,i,options,env,this):result+=this.renderToken(tokens,i,options,env);return result},Ruler.prototype.__find__=function(name){for(var i=0;i<this.__rules__.length;i++)if(this.__rules__[i].name===name)return i;return -1},Ruler.prototype.__compile__=function(){var self1=this,chains=[""];self1.__rules__.forEach(function(rule){rule.enabled&&rule.alt.forEach(function(altName){0>chains.indexOf(altName)&&chains.push(altName)})}),self1.__cache__={},chains.forEach(function(chain){self1.__cache__[chain]=[],self1.__rules__.forEach(function(rule){!rule.enabled||chain&&0>rule.alt.indexOf(chain)||self1.__cache__[chain].push(rule.fn)})})},Ruler.prototype.at=function(name,fn,options){var index=this.__find__(name);if(-1===index)throw Error("Parser rule not found: "+name);this.__rules__[index].fn=fn,this.__rules__[index].alt=(options||{}).alt||[],this.__cache__=null},Ruler.prototype.before=function(beforeName,ruleName,fn,options){var index=this.__find__(beforeName);if(-1===index)throw Error("Parser rule not found: "+beforeName);this.__rules__.splice(index,0,{name:ruleName,enabled:!0,fn:fn,alt:(options||{}).alt||[]}),this.__cache__=null},Ruler.prototype.after=function(afterName,ruleName,fn,options){var index=this.__find__(afterName);if(-1===index)throw Error("Parser rule not found: "+afterName);this.__rules__.splice(index+1,0,{name:ruleName,enabled:!0,fn:fn,alt:(options||{}).alt||[]}),this.__cache__=null},Ruler.prototype.push=function(ruleName,fn,options){this.__rules__.push({name:ruleName,enabled:!0,fn:fn,alt:(options||{}).alt||[]}),this.__cache__=null},Ruler.prototype.enable=function(list,ignoreInvalid){Array.isArray(list)||(list=[list]);var result=[];return list.forEach(function(name){var idx=this.__find__(name);if(idx<0){if(ignoreInvalid)return;throw Error("Rules manager: invalid rule name "+name)}this.__rules__[idx].enabled=!0,result.push(name)},this),this.__cache__=null,result},Ruler.prototype.enableOnly=function(list,ignoreInvalid){Array.isArray(list)||(list=[list]),this.__rules__.forEach(function(rule){rule.enabled=!1}),this.enable(list,ignoreInvalid)},Ruler.prototype.disable=function(list,ignoreInvalid){Array.isArray(list)||(list=[list]);var result=[];return list.forEach(function(name){var idx=this.__find__(name);if(idx<0){if(ignoreInvalid)return;throw Error("Rules manager: invalid rule name "+name)}this.__rules__[idx].enabled=!1,result.push(name)},this),this.__cache__=null,result},Ruler.prototype.getRules=function(chainName){return null===this.__cache__&&this.__compile__(),this.__cache__[chainName]||[]};var NEWLINES_RE=/\r\n?|\n/g,NULL_RE=/\0/g,arrayReplaceAt=utils.arrayReplaceAt,RARE_RE=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,SCOPED_ABBR_TEST_RE=/\((c|tm|r)\)/i,SCOPED_ABBR_RE=/\((c|tm|r)\)/ig,SCOPED_ABBR={c:"\xa9",r:"\xae",tm:"™"};function replaceFn(match,name){return SCOPED_ABBR[name.toLowerCase()]}var isWhiteSpace$1=utils.isWhiteSpace,isPunctChar$1=utils.isPunctChar,isMdAsciiPunct$1=utils.isMdAsciiPunct,QUOTE_TEST_RE=/['"]/,QUOTE_RE=/['"]/g;function replaceAt(str,index,ch){return str.slice(0,index)+ch+str.slice(index+1)}function Token(type,tag,nesting){this.type=type,this.tag=tag,this.attrs=null,this.map=null,this.nesting=nesting,this.level=0,this.children=null,this.content="",this.markup="",this.info="",this.meta=null,this.block=!1,this.hidden=!1}function StateCore(src,md,env){this.src=src,this.env=env,this.tokens=[],this.inlineMode=!1,this.md=md}Token.prototype.attrIndex=function(name){var attrs,i,len;if(!this.attrs)return -1;for(i=0,len=(attrs=this.attrs).length;i<len;i++)if(attrs[i][0]===name)return i;return -1},Token.prototype.attrPush=function(attrData){this.attrs?this.attrs.push(attrData):this.attrs=[attrData]},Token.prototype.attrSet=function(name,value){var idx=this.attrIndex(name),attrData=[name,value];idx<0?this.attrPush(attrData):this.attrs[idx]=attrData},Token.prototype.attrGet=function(name){var idx=this.attrIndex(name),value=null;return idx>=0&&(value=this.attrs[idx][1]),value},Token.prototype.attrJoin=function(name,value){var idx=this.attrIndex(name);idx<0?this.attrPush([name,value]):this.attrs[idx][1]=this.attrs[idx][1]+" "+value},StateCore.prototype.Token=Token;var _rules$2=[["normalize",function(state){var str;str=(str=state.src.replace(NEWLINES_RE,"\n")).replace(NULL_RE,"�"),state.src=str}],["block",function(state){var token;state.inlineMode?((token=new state.Token("inline","",0)).content=state.src,token.map=[0,1],token.children=[],state.tokens.push(token)):state.md.block.parse(state.src,state.md,state.env,state.tokens)}],["inline",function(state){var tok,i,l,tokens=state.tokens;for(i=0,l=tokens.length;i<l;i++)"inline"===(tok=tokens[i]).type&&state.md.inline.parse(tok.content,state.md,state.env,tok.children)}],["linkify",function(state){var str,str1,i,j,l,tokens,token,currentToken,nodes,ln,text,pos,lastPos,level,htmlLinkLevel,url,fullUrl,urlText,links,blockTokens=state.tokens;if(state.md.options.linkify){for(j=0,l=blockTokens.length;j<l;j++)if("inline"===blockTokens[j].type&&state.md.linkify.pretest(blockTokens[j].content))for(tokens=blockTokens[j].children,htmlLinkLevel=0,i=tokens.length-1;i>=0;i--){if("link_close"===(currentToken=tokens[i]).type){for(i--;tokens[i].level!==currentToken.level&&"link_open"!==tokens[i].type;)i--;continue}if("html_inline"===currentToken.type&&(str=currentToken.content,/^<a[>\s]/i.test(str)&&htmlLinkLevel>0&&htmlLinkLevel--,str1=currentToken.content,/^<\/a\s*>/i.test(str1)&&htmlLinkLevel++),!(htmlLinkLevel>0)&&"text"===currentToken.type&&state.md.linkify.test(currentToken.content)){for(text=currentToken.content,links=state.md.linkify.match(text),nodes=[],level=currentToken.level,lastPos=0,links.length>0&&0===links[0].index&&i>0&&"text_special"===tokens[i-1].type&&(links=links.slice(1)),ln=0;ln<links.length;ln++)url=links[ln].url,fullUrl=state.md.normalizeLink(url),state.md.validateLink(fullUrl)&&(urlText=links[ln].text,urlText=links[ln].schema?"mailto:"!==links[ln].schema||/^mailto:/i.test(urlText)?state.md.normalizeLinkText(urlText):state.md.normalizeLinkText("mailto:"+urlText).replace(/^mailto:/,""):state.md.normalizeLinkText("http://"+urlText).replace(/^http:\/\//,""),(pos=links[ln].index)>lastPos&&((token=new state.Token("text","",0)).content=text.slice(lastPos,pos),token.level=level,nodes.push(token)),(token=new state.Token("link_open","a",1)).attrs=[["href",fullUrl]],token.level=level++,token.markup="linkify",token.info="auto",nodes.push(token),(token=new state.Token("text","",0)).content=urlText,token.level=level,nodes.push(token),(token=new state.Token("link_close","a",-1)).level=--level,token.markup="linkify",token.info="auto",nodes.push(token),lastPos=links[ln].lastIndex);lastPos<text.length&&((token=new state.Token("text","",0)).content=text.slice(lastPos),token.level=level,nodes.push(token)),blockTokens[j].children=tokens=arrayReplaceAt(tokens,i,nodes)}}}}],["replacements",function(state){var blkIdx;if(state.md.options.typographer)for(blkIdx=state.tokens.length-1;blkIdx>=0;blkIdx--)"inline"===state.tokens[blkIdx].type&&(SCOPED_ABBR_TEST_RE.test(state.tokens[blkIdx].content)&&function(inlineTokens){var i,token,inside_autolink=0;for(i=inlineTokens.length-1;i>=0;i--)"text"!==(token=inlineTokens[i]).type||inside_autolink||(token.content=token.content.replace(SCOPED_ABBR_RE,replaceFn)),"link_open"===token.type&&"auto"===token.info&&inside_autolink--,"link_close"===token.type&&"auto"===token.info&&inside_autolink++}(state.tokens[blkIdx].children),RARE_RE.test(state.tokens[blkIdx].content)&&function(inlineTokens){var i,token,inside_autolink=0;for(i=inlineTokens.length-1;i>=0;i--)"text"===(token=inlineTokens[i]).type&&!inside_autolink&&RARE_RE.test(token.content)&&(token.content=token.content.replace(/\+-/g,"\xb1").replace(/\.{2,}/g,"…").replace(/([?!])…/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---(?=[^-]|$)/mg,"$1—").replace(/(^|\s)--(?=\s|$)/mg,"$1–").replace(/(^|[^-\s])--(?=[^-\s]|$)/mg,"$1–")),"link_open"===token.type&&"auto"===token.info&&inside_autolink--,"link_close"===token.type&&"auto"===token.info&&inside_autolink++}(state.tokens[blkIdx].children))}],["smartquotes",function(state){var blkIdx;if(state.md.options.typographer)for(blkIdx=state.tokens.length-1;blkIdx>=0;blkIdx--)"inline"===state.tokens[blkIdx].type&&QUOTE_TEST_RE.test(state.tokens[blkIdx].content)&&function(tokens,state){var i,token,text,t,pos,max,thisLevel,item,lastChar,nextChar,isLastPunctChar,isNextPunctChar,isLastWhiteSpace,isNextWhiteSpace,canOpen,canClose,j,isSingle,stack,openQuote,closeQuote;for(i=0,stack=[];i<tokens.length;i++){for(token=tokens[i],thisLevel=tokens[i].level,j=stack.length-1;j>=0&&!(stack[j].level<=thisLevel);j--);if(stack.length=j+1,"text"===token.type){text=token.content,pos=0,max=text.length;OUTER:for(;pos<max&&(QUOTE_RE.lastIndex=pos,t=QUOTE_RE.exec(text));){if(canOpen=canClose=!0,pos=t.index+1,isSingle="'"===t[0],lastChar=32,t.index-1>=0)lastChar=text.charCodeAt(t.index-1);else for(j=i-1;j>=0&&"softbreak"!==tokens[j].type&&"hardbreak"!==tokens[j].type;j--)if(tokens[j].content){lastChar=tokens[j].content.charCodeAt(tokens[j].content.length-1);break}if(nextChar=32,pos<max)nextChar=text.charCodeAt(pos);else for(j=i+1;j<tokens.length&&"softbreak"!==tokens[j].type&&"hardbreak"!==tokens[j].type;j++)if(tokens[j].content){nextChar=tokens[j].content.charCodeAt(0);break}if(isLastPunctChar=isMdAsciiPunct$1(lastChar)||isPunctChar$1(String.fromCharCode(lastChar)),isNextPunctChar=isMdAsciiPunct$1(nextChar)||isPunctChar$1(String.fromCharCode(nextChar)),isLastWhiteSpace=isWhiteSpace$1(lastChar),(isNextWhiteSpace=isWhiteSpace$1(nextChar))?canOpen=!1:isNextPunctChar&&!(isLastWhiteSpace||isLastPunctChar)&&(canOpen=!1),isLastWhiteSpace?canClose=!1:isLastPunctChar&&!(isNextWhiteSpace||isNextPunctChar)&&(canClose=!1),34===nextChar&&'"'===t[0]&&lastChar>=48&&lastChar<=57&&(canClose=canOpen=!1),canOpen&&canClose&&(canOpen=isLastPunctChar,canClose=isNextPunctChar),!canOpen&&!canClose){isSingle&&(token.content=replaceAt(token.content,t.index,"’"));continue}if(canClose){for(j=stack.length-1;j>=0&&(item=stack[j],!(stack[j].level<thisLevel));j--)if(item.single===isSingle&&stack[j].level===thisLevel){item=stack[j],isSingle?(openQuote=state.md.options.quotes[2],closeQuote=state.md.options.quotes[3]):(openQuote=state.md.options.quotes[0],closeQuote=state.md.options.quotes[1]),token.content=replaceAt(token.content,t.index,closeQuote),tokens[item.token].content=replaceAt(tokens[item.token].content,item.pos,openQuote),pos+=closeQuote.length-1,item.token===i&&(pos+=openQuote.length-1),max=(text=token.content).length,stack.length=j;continue OUTER}}canOpen?stack.push({token:i,pos:t.index,single:isSingle,level:thisLevel}):canClose&&isSingle&&(token.content=replaceAt(token.content,t.index,"’"))}}}}(state.tokens[blkIdx].children,state)}],["text_join",function(state){var j,l,tokens,curr,max,last,blockTokens=state.tokens;for(j=0,l=blockTokens.length;j<l;j++)if("inline"===blockTokens[j].type){for(curr=0,max=(tokens=blockTokens[j].children).length;curr<max;curr++)"text_special"===tokens[curr].type&&(tokens[curr].type="text");for(curr=last=0;curr<max;curr++)"text"===tokens[curr].type&&curr+1<max&&"text"===tokens[curr+1].type?tokens[curr+1].content=tokens[curr].content+tokens[curr+1].content:(curr!==last&&(tokens[last]=tokens[curr]),last++);curr!==last&&(tokens.length=last)}}]];function Core(){this.ruler=new Ruler;for(var i=0;i<_rules$2.length;i++)this.ruler.push(_rules$2[i][0],_rules$2[i][1])}Core.prototype.process=function(state){var i,l,rules;for(i=0,l=(rules=this.ruler.getRules("")).length;i<l;i++)rules[i](state)},Core.prototype.State=StateCore;var isSpace$a=utils.isSpace;function getLine(state,line){var pos=state.bMarks[line]+state.tShift[line],max=state.eMarks[line];return state.src.slice(pos,max)}function escapedSplit(str){var ch,result=[],pos=0,max=str.length,isEscaped=!1,lastPos=0,current="";for(ch=str.charCodeAt(pos);pos<max;)124===ch&&(isEscaped?(current+=str.substring(lastPos,pos-1),lastPos=pos):(result.push(current+str.substring(lastPos,pos)),current="",lastPos=pos+1)),isEscaped=92===ch,pos++,ch=str.charCodeAt(pos);return result.push(current+str.substring(lastPos)),result}var isSpace$9=utils.isSpace,isSpace$8=utils.isSpace,isSpace$7=utils.isSpace;function skipBulletListMarker(state,startLine){var marker,pos,max;return(pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine],42!==(marker=state.src.charCodeAt(pos++))&&45!==marker&&43!==marker||pos<max&&!isSpace$7(state.src.charCodeAt(pos)))?-1:pos}function skipOrderedListMarker(state,startLine){var ch,start=state.bMarks[startLine]+state.tShift[startLine],pos=start,max=state.eMarks[startLine];if(pos+1>=max||(ch=state.src.charCodeAt(pos++))<48||ch>57)return -1;for(;;){if(pos>=max)return -1;if((ch=state.src.charCodeAt(pos++))>=48&&ch<=57){if(pos-start>=10)return -1;continue}if(41===ch||46===ch)break;return -1}return pos<max&&!isSpace$7(ch=state.src.charCodeAt(pos))?-1:pos}var normalizeReference$2=utils.normalizeReference,isSpace$6=utils.isSpace,open_tag="<[A-Za-z][A-Za-z0-9\\-]*(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*(?:[^\"'=<>`\\x00-\\x20]+|'[^']*'|\"[^\"]*\"))?)*\\s*\\/?>",close_tag="<\\/[A-Za-z][A-Za-z0-9\\-]*\\s*>",html_re={HTML_TAG_RE:RegExp("^(?:"+open_tag+"|"+close_tag+"|<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->|<[?][\\s\\S]*?[?]>|<![A-Z]+\\s+[^>]*>|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>)"),HTML_OPEN_CLOSE_TAG_RE:RegExp("^(?:"+open_tag+"|"+close_tag+")")},HTML_OPEN_CLOSE_TAG_RE=html_re.HTML_OPEN_CLOSE_TAG_RE,HTML_SEQUENCES=[[/^<(script|pre|style|textarea)(?=(\s|>|$))/i,/<\/(script|pre|style|textarea)>/i,!0],[/^<!--/,/-->/,!0],[/^<\?/,/\?>/,!0],[/^<![A-Z]/,/>/,!0],[/^<!\[CDATA\[/,/\]\]>/,!0],[RegExp("^</?(address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?=(\\s|/?>|$))","i"),/^$/,!0],[RegExp(HTML_OPEN_CLOSE_TAG_RE.source+"\\s*$"),/^$/,!1]],isSpace$5=utils.isSpace,isSpace$4=utils.isSpace;function StateBlock(src,md,env,tokens){var ch,s,start,pos,len,indent,offset,indent_found;for(this.src=src,this.md=md,this.env=env,this.tokens=tokens,this.bMarks=[],this.eMarks=[],this.tShift=[],this.sCount=[],this.bsCount=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.ddIndent=-1,this.listIndent=-1,this.parentType="root",this.level=0,this.result="",s=this.src,indent_found=!1,start=pos=indent=offset=0,len=s.length;pos<len;pos++){if(ch=s.charCodeAt(pos),!indent_found){if(isSpace$4(ch)){indent++,9===ch?offset+=4-offset%4:offset++;continue}indent_found=!0}(10===ch||pos===len-1)&&(10!==ch&&pos++,this.bMarks.push(start),this.eMarks.push(pos),this.tShift.push(indent),this.sCount.push(offset),this.bsCount.push(0),indent_found=!1,indent=0,offset=0,start=pos+1)}this.bMarks.push(s.length),this.eMarks.push(s.length),this.tShift.push(0),this.sCount.push(0),this.bsCount.push(0),this.lineMax=this.bMarks.length-1}StateBlock.prototype.push=function(type,tag,nesting){var token$1=new Token(type,tag,nesting);return token$1.block=!0,nesting<0&&this.level--,token$1.level=this.level,nesting>0&&this.level++,this.tokens.push(token$1),token$1},StateBlock.prototype.isEmpty=function(line){return this.bMarks[line]+this.tShift[line]>=this.eMarks[line]},StateBlock.prototype.skipEmptyLines=function(from){for(var max=this.lineMax;from<max&&!(this.bMarks[from]+this.tShift[from]<this.eMarks[from]);from++);return from},StateBlock.prototype.skipSpaces=function(pos){for(var max=this.src.length;pos<max&&isSpace$4(this.src.charCodeAt(pos));pos++);return pos},StateBlock.prototype.skipSpacesBack=function(pos,min){if(pos<=min)return pos;for(;pos>min;)if(!isSpace$4(this.src.charCodeAt(--pos)))return pos+1;return pos},StateBlock.prototype.skipChars=function(pos,code){for(var max=this.src.length;pos<max&&this.src.charCodeAt(pos)===code;pos++);return pos},StateBlock.prototype.skipCharsBack=function(pos,code,min){if(pos<=min)return pos;for(;pos>min;)if(code!==this.src.charCodeAt(--pos))return pos+1;return pos},StateBlock.prototype.getLines=function(begin,end,indent,keepLastLF){var i,lineIndent,ch,first,last,queue,lineStart,line=begin;if(begin>=end)return"";for(i=0,queue=Array(end-begin);line<end;line++,i++){for(lineIndent=0,lineStart=first=this.bMarks[line],last=line+1<end||keepLastLF?this.eMarks[line]+1:this.eMarks[line];first<last&&lineIndent<indent;){if(isSpace$4(ch=this.src.charCodeAt(first)))9===ch?lineIndent+=4-(lineIndent+this.bsCount[line])%4:lineIndent++;else if(first-lineStart<this.tShift[line])lineIndent++;else break;first++}lineIndent>indent?queue[i]=Array(lineIndent-indent+1).join(" ")+this.src.slice(first,last):queue[i]=this.src.slice(first,last)}return queue.join("")},StateBlock.prototype.Token=Token;var _rules$1=[["table",function(state,startLine,endLine,silent){var ch,lineText,pos,i,l,nextLine,columns,columnCount,token,aligns,t,tableLines,tbodyLines,oldParentType,terminate,terminatorRules,firstCh,secondCh;if(startLine+2>endLine||(nextLine=startLine+1,state.sCount[nextLine]<state.blkIndent||state.sCount[nextLine]-state.blkIndent>=4||(pos=state.bMarks[nextLine]+state.tShift[nextLine])>=state.eMarks[nextLine]||124!==(firstCh=state.src.charCodeAt(pos++))&&45!==firstCh&&58!==firstCh||pos>=state.eMarks[nextLine]||124!==(secondCh=state.src.charCodeAt(pos++))&&45!==secondCh&&58!==secondCh&&!isSpace$a(secondCh)||45===firstCh&&isSpace$a(secondCh)))return!1;for(;pos<state.eMarks[nextLine];){if(124!==(ch=state.src.charCodeAt(pos))&&45!==ch&&58!==ch&&!isSpace$a(ch))return!1;pos++}for(i=0,columns=(lineText=getLine(state,startLine+1)).split("|"),aligns=[];i<columns.length;i++){if(!(t=columns[i].trim())){if(0===i||i===columns.length-1)continue;return!1}if(!/^:?-+:?$/.test(t))return!1;58===t.charCodeAt(t.length-1)?aligns.push(58===t.charCodeAt(0)?"center":"right"):58===t.charCodeAt(0)?aligns.push("left"):aligns.push("")}if(-1===(lineText=getLine(state,startLine).trim()).indexOf("|")||state.sCount[startLine]-state.blkIndent>=4||((columns=escapedSplit(lineText)).length&&""===columns[0]&&columns.shift(),columns.length&&""===columns[columns.length-1]&&columns.pop(),0===(columnCount=columns.length)||columnCount!==aligns.length))return!1;if(silent)return!0;for(i=0,oldParentType=state.parentType,state.parentType="table",terminatorRules=state.md.block.ruler.getRules("blockquote"),(token=state.push("table_open","table",1)).map=tableLines=[startLine,0],(token=state.push("thead_open","thead",1)).map=[startLine,startLine+1],(token=state.push("tr_open","tr",1)).map=[startLine,startLine+1];i<columns.length;i++)token=state.push("th_open","th",1),aligns[i]&&(token.attrs=[["style","text-align:"+aligns[i]]]),(token=state.push("inline","",0)).content=columns[i].trim(),token.children=[],token=state.push("th_close","th",-1);for(token=state.push("tr_close","tr",-1),token=state.push("thead_close","thead",-1),nextLine=startLine+2;nextLine<endLine&&!(state.sCount[nextLine]<state.blkIndent);nextLine++){for(i=0,terminate=!1,l=terminatorRules.length;i<l;i++)if(terminatorRules[i](state,nextLine,endLine,!0)){terminate=!0;break}if(terminate||!(lineText=getLine(state,nextLine).trim())||state.sCount[nextLine]-state.blkIndent>=4)break;for((columns=escapedSplit(lineText)).length&&""===columns[0]&&columns.shift(),columns.length&&""===columns[columns.length-1]&&columns.pop(),nextLine===startLine+2&&((token=state.push("tbody_open","tbody",1)).map=tbodyLines=[startLine+2,0]),(token=state.push("tr_open","tr",1)).map=[nextLine,nextLine+1],i=0;i<columnCount;i++)token=state.push("td_open","td",1),aligns[i]&&(token.attrs=[["style","text-align:"+aligns[i]]]),(token=state.push("inline","",0)).content=columns[i]?columns[i].trim():"",token.children=[],token=state.push("td_close","td",-1);token=state.push("tr_close","tr",-1)}return tbodyLines&&(token=state.push("tbody_close","tbody",-1),tbodyLines[1]=nextLine),token=state.push("table_close","table",-1),tableLines[1]=nextLine,state.parentType=oldParentType,state.line=nextLine,!0},["paragraph","reference"]],["code",function(state,startLine,endLine){var nextLine,last,token;if(state.sCount[startLine]-state.blkIndent<4)return!1;for(last=nextLine=startLine+1;nextLine<endLine;){if(state.isEmpty(nextLine)){nextLine++;continue}if(state.sCount[nextLine]-state.blkIndent>=4){last=++nextLine;continue}break}return state.line=last,(token=state.push("code_block","code",0)).content=state.getLines(startLine,last,4+state.blkIndent,!1)+"\n",token.map=[startLine,state.line],!0}],["fence",function(state,startLine,endLine,silent){var marker,len,params,nextLine,mem,token,markup,haveEndMarker=!1,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(state.sCount[startLine]-state.blkIndent>=4||pos+3>max||126!==(marker=state.src.charCodeAt(pos))&&96!==marker||(mem=pos,(len=(pos=state.skipChars(pos,marker))-mem)<3)||(markup=state.src.slice(mem,pos),params=state.src.slice(pos,max),96===marker&&params.indexOf(String.fromCharCode(marker))>=0))return!1;if(silent)return!0;for(nextLine=startLine;!(++nextLine>=endLine)&&(!((pos=mem=state.bMarks[nextLine]+state.tShift[nextLine])<(max=state.eMarks[nextLine]))||!(state.sCount[nextLine]<state.blkIndent));)if(!(state.src.charCodeAt(pos)!==marker||state.sCount[nextLine]-state.blkIndent>=4||(pos=state.skipChars(pos,marker))-mem<len||(pos=state.skipSpaces(pos))<max)){haveEndMarker=!0;break}return len=state.sCount[startLine],state.line=nextLine+(haveEndMarker?1:0),(token=state.push("fence","code",0)).info=params,token.content=state.getLines(startLine+1,nextLine,len,!0),token.markup=markup,token.map=[startLine,state.line],!0},["paragraph","reference","blockquote","list"]],["blockquote",function(state,startLine,endLine,silent){var adjustTab,ch,i,initial,l,lastLineEmpty,lines,nextLine,offset,oldBMarks,oldBSCount,oldIndent,oldParentType,oldSCount,oldTShift,spaceAfterMarker,terminate,terminatorRules,token,isOutdented,oldLineMax=state.lineMax,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(state.sCount[startLine]-state.blkIndent>=4||62!==state.src.charCodeAt(pos++))return!1;if(silent)return!0;for(initial=offset=state.sCount[startLine]+1,32===state.src.charCodeAt(pos)?(pos++,initial++,offset++,adjustTab=!1,spaceAfterMarker=!0):9===state.src.charCodeAt(pos)?(spaceAfterMarker=!0,(state.bsCount[startLine]+offset)%4==3?(pos++,initial++,offset++,adjustTab=!1):adjustTab=!0):spaceAfterMarker=!1,oldBMarks=[state.bMarks[startLine]],state.bMarks[startLine]=pos;pos<max&&isSpace$9(ch=state.src.charCodeAt(pos));)9===ch?offset+=4-(offset+state.bsCount[startLine]+(adjustTab?1:0))%4:offset++,pos++;for(oldBSCount=[state.bsCount[startLine]],state.bsCount[startLine]=state.sCount[startLine]+1+(spaceAfterMarker?1:0),lastLineEmpty=pos>=max,oldSCount=[state.sCount[startLine]],state.sCount[startLine]=offset-initial,oldTShift=[state.tShift[startLine]],state.tShift[startLine]=pos-state.bMarks[startLine],terminatorRules=state.md.block.ruler.getRules("blockquote"),oldParentType=state.parentType,state.parentType="blockquote",nextLine=startLine+1;nextLine<endLine&&(isOutdented=state.sCount[nextLine]<state.blkIndent,pos=state.bMarks[nextLine]+state.tShift[nextLine],max=state.eMarks[nextLine],!(pos>=max));nextLine++){if(62===state.src.charCodeAt(pos++)&&!isOutdented){for(initial=offset=state.sCount[nextLine]+1,32===state.src.charCodeAt(pos)?(pos++,initial++,offset++,adjustTab=!1,spaceAfterMarker=!0):9===state.src.charCodeAt(pos)?(spaceAfterMarker=!0,(state.bsCount[nextLine]+offset)%4==3?(pos++,initial++,offset++,adjustTab=!1):adjustTab=!0):spaceAfterMarker=!1,oldBMarks.push(state.bMarks[nextLine]),state.bMarks[nextLine]=pos;pos<max&&isSpace$9(ch=state.src.charCodeAt(pos));)9===ch?offset+=4-(offset+state.bsCount[nextLine]+(adjustTab?1:0))%4:offset++,pos++;lastLineEmpty=pos>=max,oldBSCount.push(state.bsCount[nextLine]),state.bsCount[nextLine]=state.sCount[nextLine]+1+(spaceAfterMarker?1:0),oldSCount.push(state.sCount[nextLine]),state.sCount[nextLine]=offset-initial,oldTShift.push(state.tShift[nextLine]),state.tShift[nextLine]=pos-state.bMarks[nextLine];continue}if(lastLineEmpty)break;for(i=0,terminate=!1,l=terminatorRules.length;i<l;i++)if(terminatorRules[i](state,nextLine,endLine,!0)){terminate=!0;break}if(terminate){state.lineMax=nextLine,0!==state.blkIndent&&(oldBMarks.push(state.bMarks[nextLine]),oldBSCount.push(state.bsCount[nextLine]),oldTShift.push(state.tShift[nextLine]),oldSCount.push(state.sCount[nextLine]),state.sCount[nextLine]-=state.blkIndent);break}oldBMarks.push(state.bMarks[nextLine]),oldBSCount.push(state.bsCount[nextLine]),oldTShift.push(state.tShift[nextLine]),oldSCount.push(state.sCount[nextLine]),state.sCount[nextLine]=-1}for(oldIndent=state.blkIndent,state.blkIndent=0,(token=state.push("blockquote_open","blockquote",1)).markup=">",token.map=lines=[startLine,0],state.md.block.tokenize(state,startLine,nextLine),(token=state.push("blockquote_close","blockquote",-1)).markup=">",state.lineMax=oldLineMax,state.parentType=oldParentType,lines[1]=state.line,i=0;i<oldTShift.length;i++)state.bMarks[i+startLine]=oldBMarks[i],state.tShift[i+startLine]=oldTShift[i],state.sCount[i+startLine]=oldSCount[i],state.bsCount[i+startLine]=oldBSCount[i];return state.blkIndent=oldIndent,!0},["paragraph","reference","blockquote","list"]],["hr",function(state,startLine,endLine,silent){var marker,cnt,ch,token,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(state.sCount[startLine]-state.blkIndent>=4||42!==(marker=state.src.charCodeAt(pos++))&&45!==marker&&95!==marker)return!1;for(cnt=1;pos<max;){if((ch=state.src.charCodeAt(pos++))!==marker&&!isSpace$8(ch))return!1;ch===marker&&cnt++}return!(cnt<3)&&(!!silent||(state.line=startLine+1,(token=state.push("hr","hr",0)).map=[startLine,state.line],token.markup=Array(cnt+1).join(String.fromCharCode(marker)),!0))},["paragraph","reference","blockquote","list"]],["list",function(state,startLine,endLine,silent){var ch,contentStart,i,indent,indentAfterMarker,initial,isOrdered,itemLines,l,listLines,listTokIdx,markerCharCode,markerValue,max,nextLine,offset,oldListIndent,oldParentType,oldSCount,oldTShift,oldTight,pos,posAfterMarker,prevEmptyEnd,start,terminate,terminatorRules,token,isTerminatingParagraph=!1,tight=!0;if(state.sCount[startLine]-state.blkIndent>=4||state.listIndent>=0&&state.sCount[startLine]-state.listIndent>=4&&state.sCount[startLine]<state.blkIndent)return!1;if(silent&&"paragraph"===state.parentType&&state.sCount[startLine]>=state.blkIndent&&(isTerminatingParagraph=!0),(posAfterMarker=skipOrderedListMarker(state,startLine))>=0){if(isOrdered=!0,start=state.bMarks[startLine]+state.tShift[startLine],markerValue=Number(state.src.slice(start,posAfterMarker-1)),isTerminatingParagraph&&1!==markerValue)return!1}else{if(!((posAfterMarker=skipBulletListMarker(state,startLine))>=0))return!1;isOrdered=!1}if(isTerminatingParagraph&&state.skipSpaces(posAfterMarker)>=state.eMarks[startLine])return!1;if(markerCharCode=state.src.charCodeAt(posAfterMarker-1),silent)return!0;for(listTokIdx=state.tokens.length,isOrdered?(token=state.push("ordered_list_open","ol",1),1!==markerValue&&(token.attrs=[["start",markerValue]])):token=state.push("bullet_list_open","ul",1),token.map=listLines=[startLine,0],token.markup=String.fromCharCode(markerCharCode),nextLine=startLine,prevEmptyEnd=!1,terminatorRules=state.md.block.ruler.getRules("list"),oldParentType=state.parentType,state.parentType="list";nextLine<endLine;){for(pos=posAfterMarker,max=state.eMarks[nextLine],initial=offset=state.sCount[nextLine]+posAfterMarker-(state.bMarks[startLine]+state.tShift[startLine]);pos<max;){if(9===(ch=state.src.charCodeAt(pos)))offset+=4-(offset+state.bsCount[nextLine])%4;else if(32===ch)offset++;else break;pos++}if((indentAfterMarker=(contentStart=pos)>=max?1:offset-initial)>4&&(indentAfterMarker=1),indent=initial+indentAfterMarker,(token=state.push("list_item_open","li",1)).markup=String.fromCharCode(markerCharCode),token.map=itemLines=[startLine,0],isOrdered&&(token.info=state.src.slice(start,posAfterMarker-1)),oldTight=state.tight,oldTShift=state.tShift[startLine],oldSCount=state.sCount[startLine],oldListIndent=state.listIndent,state.listIndent=state.blkIndent,state.blkIndent=indent,state.tight=!0,state.tShift[startLine]=contentStart-state.bMarks[startLine],state.sCount[startLine]=offset,contentStart>=max&&state.isEmpty(startLine+1)?state.line=Math.min(state.line+2,endLine):state.md.block.tokenize(state,startLine,endLine,!0),(!state.tight||prevEmptyEnd)&&(tight=!1),prevEmptyEnd=state.line-startLine>1&&state.isEmpty(state.line-1),state.blkIndent=state.listIndent,state.listIndent=oldListIndent,state.tShift[startLine]=oldTShift,state.sCount[startLine]=oldSCount,state.tight=oldTight,(token=state.push("list_item_close","li",-1)).markup=String.fromCharCode(markerCharCode),nextLine=startLine=state.line,itemLines[1]=nextLine,contentStart=state.bMarks[startLine],nextLine>=endLine||state.sCount[nextLine]<state.blkIndent||state.sCount[startLine]-state.blkIndent>=4)break;for(i=0,terminate=!1,l=terminatorRules.length;i<l;i++)if(terminatorRules[i](state,nextLine,endLine,!0)){terminate=!0;break}if(terminate)break;if(isOrdered){if((posAfterMarker=skipOrderedListMarker(state,nextLine))<0)break;start=state.bMarks[nextLine]+state.tShift[nextLine]}else if((posAfterMarker=skipBulletListMarker(state,nextLine))<0)break;if(markerCharCode!==state.src.charCodeAt(posAfterMarker-1))break}return(token=isOrdered?state.push("ordered_list_close","ol",-1):state.push("bullet_list_close","ul",-1)).markup=String.fromCharCode(markerCharCode),listLines[1]=nextLine,state.line=nextLine,state.parentType=oldParentType,tight&&function(state,idx){var i,l,level=state.level+2;for(i=idx+2,l=state.tokens.length-2;i<l;i++)state.tokens[i].level===level&&"paragraph_open"===state.tokens[i].type&&(state.tokens[i+2].hidden=!0,state.tokens[i].hidden=!0,i+=2)}(state,listTokIdx),!0},["paragraph","reference","blockquote"]],["reference",function(state,startLine,_endLine,silent){var ch,destEndPos,destEndLineNo,endLine,href,i,l,label,labelEnd,oldParentType,res,start,str,terminate,terminatorRules,title,lines=0,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine],nextLine=startLine+1;if(state.sCount[startLine]-state.blkIndent>=4||91!==state.src.charCodeAt(pos))return!1;for(;++pos<max;)if(93===state.src.charCodeAt(pos)&&92!==state.src.charCodeAt(pos-1)){if(pos+1===max||58!==state.src.charCodeAt(pos+1))return!1;break}for(endLine=state.lineMax,terminatorRules=state.md.block.ruler.getRules("reference"),oldParentType=state.parentType,state.parentType="reference";nextLine<endLine&&!state.isEmpty(nextLine);nextLine++)if(!(state.sCount[nextLine]-state.blkIndent>3)&&!(state.sCount[nextLine]<0)){for(i=0,terminate=!1,l=terminatorRules.length;i<l;i++)if(terminatorRules[i](state,nextLine,endLine,!0)){terminate=!0;break}if(terminate)break}for(pos=1,max=(str=state.getLines(startLine,nextLine,state.blkIndent,!1).trim()).length;pos<max;pos++){if(91===(ch=str.charCodeAt(pos)))return!1;if(93===ch){labelEnd=pos;break}10===ch?lines++:92===ch&&++pos<max&&10===str.charCodeAt(pos)&&lines++}if(labelEnd<0||58!==str.charCodeAt(labelEnd+1))return!1;for(pos=labelEnd+2;pos<max;pos++)if(10===(ch=str.charCodeAt(pos)))lines++;else if(isSpace$6(ch));else break;if(!(res=state.md.helpers.parseLinkDestination(str,pos,max)).ok||(href=state.md.normalizeLink(res.str),!state.md.validateLink(href)))return!1;for(pos=res.pos,lines+=res.lines,destEndPos=pos,destEndLineNo=lines,start=pos;pos<max;pos++)if(10===(ch=str.charCodeAt(pos)))lines++;else if(isSpace$6(ch));else break;for(res=state.md.helpers.parseLinkTitle(str,pos,max),pos<max&&start!==pos&&res.ok?(title=res.str,pos=res.pos,lines+=res.lines):(title="",pos=destEndPos,lines=destEndLineNo);pos<max&&isSpace$6(ch=str.charCodeAt(pos));)pos++;if(pos<max&&10!==str.charCodeAt(pos)&&title)for(title="",pos=destEndPos,lines=destEndLineNo;pos<max&&isSpace$6(ch=str.charCodeAt(pos));)pos++;return!!((!(pos<max)||10===str.charCodeAt(pos))&&(label=normalizeReference$2(str.slice(1,labelEnd))))&&(!!silent||(void 0===state.env.references&&(state.env.references={}),void 0===state.env.references[label]&&(state.env.references[label]={title:title,href:href}),state.parentType=oldParentType,state.line=startLine+lines+1,!0))}],["html_block",function(state,startLine,endLine,silent){var i,nextLine,token,lineText,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(state.sCount[startLine]-state.blkIndent>=4||!state.md.options.html||60!==state.src.charCodeAt(pos))return!1;for(i=0,lineText=state.src.slice(pos,max);i<HTML_SEQUENCES.length&&!HTML_SEQUENCES[i][0].test(lineText);i++);if(i===HTML_SEQUENCES.length)return!1;if(silent)return HTML_SEQUENCES[i][2];if(nextLine=startLine+1,!HTML_SEQUENCES[i][1].test(lineText)){for(;nextLine<endLine&&!(state.sCount[nextLine]<state.blkIndent);nextLine++)if(pos=state.bMarks[nextLine]+state.tShift[nextLine],max=state.eMarks[nextLine],lineText=state.src.slice(pos,max),HTML_SEQUENCES[i][1].test(lineText)){0!==lineText.length&&nextLine++;break}}return state.line=nextLine,(token=state.push("html_block","",0)).map=[startLine,nextLine],token.content=state.getLines(startLine,nextLine,state.blkIndent,!0),!0},["paragraph","reference","blockquote"]],["heading",function(state,startLine,endLine,silent){var ch,level,tmp,token,pos=state.bMarks[startLine]+state.tShift[startLine],max=state.eMarks[startLine];if(state.sCount[startLine]-state.blkIndent>=4||35!==(ch=state.src.charCodeAt(pos))||pos>=max)return!1;for(level=1,ch=state.src.charCodeAt(++pos);35===ch&&pos<max&&level<=6;)level++,ch=state.src.charCodeAt(++pos);return!(level>6)&&(!(pos<max)||!!isSpace$5(ch))&&(!!silent||(max=state.skipSpacesBack(max,pos),(tmp=state.skipCharsBack(max,35,pos))>pos&&isSpace$5(state.src.charCodeAt(tmp-1))&&(max=tmp),state.line=startLine+1,(token=state.push("heading_open","h"+String(level),1)).markup="########".slice(0,level),token.map=[startLine,state.line],(token=state.push("inline","",0)).content=state.src.slice(pos,max).trim(),token.map=[startLine,state.line],token.children=[],(token=state.push("heading_close","h"+String(level),-1)).markup="########".slice(0,level),!0))},["paragraph","reference","blockquote"]],["lheading",function(state,startLine,endLine){var content,terminate,i,l,token,pos,max,level,marker,oldParentType,nextLine=startLine+1,terminatorRules=state.md.block.ruler.getRules("paragraph");if(state.sCount[startLine]-state.blkIndent>=4)return!1;for(oldParentType=state.parentType,state.parentType="paragraph";nextLine<endLine&&!state.isEmpty(nextLine);nextLine++)if(!(state.sCount[nextLine]-state.blkIndent>3)){if(state.sCount[nextLine]>=state.blkIndent&&(pos=state.bMarks[nextLine]+state.tShift[nextLine])<(max=state.eMarks[nextLine])&&(45===(marker=state.src.charCodeAt(pos))||61===marker)&&(pos=state.skipChars(pos,marker),(pos=state.skipSpaces(pos))>=max)){level=61===marker?1:2;break}if(!(state.sCount[nextLine]<0)){for(i=0,terminate=!1,l=terminatorRules.length;i<l;i++)if(terminatorRules[i](state,nextLine,endLine,!0)){terminate=!0;break}if(terminate)break}}return!!level&&(content=state.getLines(startLine,nextLine,state.blkIndent,!1).trim(),state.line=nextLine+1,(token=state.push("heading_open","h"+String(level),1)).markup=String.fromCharCode(marker),token.map=[startLine,state.line],(token=state.push("inline","",0)).content=content,token.map=[startLine,state.line-1],token.children=[],(token=state.push("heading_close","h"+String(level),-1)).markup=String.fromCharCode(marker),state.parentType=oldParentType,!0)}],["paragraph",function(state,startLine){var content,terminate,i,l,token,oldParentType,nextLine=startLine+1,terminatorRules=state.md.block.ruler.getRules("paragraph"),endLine=state.lineMax;for(oldParentType=state.parentType,state.parentType="paragraph";nextLine<endLine&&!state.isEmpty(nextLine);nextLine++)if(!(state.sCount[nextLine]-state.blkIndent>3)&&!(state.sCount[nextLine]<0)){for(i=0,terminate=!1,l=terminatorRules.length;i<l;i++)if(terminatorRules[i](state,nextLine,endLine,!0)){terminate=!0;break}if(terminate)break}return content=state.getLines(startLine,nextLine,state.blkIndent,!1).trim(),state.line=nextLine,(token=state.push("paragraph_open","p",1)).map=[startLine,state.line],(token=state.push("inline","",0)).content=content,token.map=[startLine,state.line],token.children=[],token=state.push("paragraph_close","p",-1),state.parentType=oldParentType,!0}]];function ParserBlock(){this.ruler=new Ruler;for(var i=0;i<_rules$1.length;i++)this.ruler.push(_rules$1[i][0],_rules$1[i][1],{alt:(_rules$1[i][2]||[]).slice()})}ParserBlock.prototype.tokenize=function(state,startLine,endLine){for(var i,rules=this.ruler.getRules(""),len=rules.length,line=startLine,hasEmptyLines=!1,maxNesting=state.md.options.maxNesting;line<endLine&&(state.line=line=state.skipEmptyLines(line),!(line>=endLine)&&!(state.sCount[line]<state.blkIndent));){if(state.level>=maxNesting){state.line=endLine;break}for(i=0;i<len&&!rules[i](state,line,endLine,!1);i++);state.tight=!hasEmptyLines,state.isEmpty(state.line-1)&&(hasEmptyLines=!0),(line=state.line)<endLine&&state.isEmpty(line)&&(hasEmptyLines=!0,line++,state.line=line)}},ParserBlock.prototype.parse=function(src,md,env,outTokens){var state;src&&(state=new this.State(src,md,env,outTokens),this.tokenize(state,state.line,state.lineMax))},ParserBlock.prototype.State=StateBlock;for(var SCHEME_RE=/(?:^|[^a-z0-9.+-])([a-z][a-z0-9.+-]*)$/i,isSpace$3=utils.isSpace,isSpace$2=utils.isSpace,ESCAPED=[],i=0;i<256;i++)ESCAPED.push(0);function postProcess$1(state,delimiters){var i,j,startDelim,endDelim,token,loneMarkers=[],max=delimiters.length;for(i=0;i<max;i++)126===(startDelim=delimiters[i]).marker&&-1!==startDelim.end&&(endDelim=delimiters[startDelim.end],(token=state.tokens[startDelim.token]).type="s_open",token.tag="s",token.nesting=1,token.markup="~~",token.content="",(token=state.tokens[endDelim.token]).type="s_close",token.tag="s",token.nesting=-1,token.markup="~~",token.content="","text"===state.tokens[endDelim.token-1].type&&"~"===state.tokens[endDelim.token-1].content&&loneMarkers.push(endDelim.token-1));for(;loneMarkers.length;){for(j=(i=loneMarkers.pop())+1;j<state.tokens.length&&"s_close"===state.tokens[j].type;)j++;i!==--j&&(token=state.tokens[j],state.tokens[j]=state.tokens[i],state.tokens[i]=token)}}"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(ch){ESCAPED[ch.charCodeAt(0)]=1});var strikethrough={tokenize:function(state,silent){var i,scanned,len,ch,start=state.pos,marker=state.src.charCodeAt(start);if(silent||126!==marker||(len=(scanned=state.scanDelims(state.pos,!0)).length,ch=String.fromCharCode(marker),len<2))return!1;for(len%2&&(state.push("text","",0).content=ch,len--),i=0;i<len;i+=2)state.push("text","",0).content=ch+ch,state.delimiters.push({marker:marker,length:0,token:state.tokens.length-1,end:-1,open:scanned.can_open,close:scanned.can_close});return state.pos+=scanned.length,!0},postProcess:function(state){var curr,tokens_meta=state.tokens_meta,max=state.tokens_meta.length;for(postProcess$1(state,state.delimiters),curr=0;curr<max;curr++)tokens_meta[curr]&&tokens_meta[curr].delimiters&&postProcess$1(state,tokens_meta[curr].delimiters)}};function postProcess(state,delimiters){var i,startDelim,endDelim,token,ch,isStrong;for(i=delimiters.length-1;i>=0;i--)(95===(startDelim=delimiters[i]).marker||42===startDelim.marker)&&-1!==startDelim.end&&(endDelim=delimiters[startDelim.end],isStrong=i>0&&delimiters[i-1].end===startDelim.end+1&&delimiters[i-1].marker===startDelim.marker&&delimiters[i-1].token===startDelim.token-1&&delimiters[startDelim.end+1].token===endDelim.token+1,ch=String.fromCharCode(startDelim.marker),(token=state.tokens[startDelim.token]).type=isStrong?"strong_open":"em_open",token.tag=isStrong?"strong":"em",token.nesting=1,token.markup=isStrong?ch+ch:ch,token.content="",(token=state.tokens[endDelim.token]).type=isStrong?"strong_close":"em_close",token.tag=isStrong?"strong":"em",token.nesting=-1,token.markup=isStrong?ch+ch:ch,token.content="",isStrong&&(state.tokens[delimiters[i-1].token].content="",state.tokens[delimiters[startDelim.end+1].token].content="",i--))}var emphasis={tokenize:function(state,silent){var i,scanned,start=state.pos,marker=state.src.charCodeAt(start);if(silent||95!==marker&&42!==marker)return!1;for(i=0,scanned=state.scanDelims(state.pos,42===marker);i<scanned.length;i++)state.push("text","",0).content=String.fromCharCode(marker),state.delimiters.push({marker:marker,length:scanned.length,token:state.tokens.length-1,end:-1,open:scanned.can_open,close:scanned.can_close});return state.pos+=scanned.length,!0},postProcess:function(state){var curr,tokens_meta=state.tokens_meta,max=state.tokens_meta.length;for(postProcess(state,state.delimiters),curr=0;curr<max;curr++)tokens_meta[curr]&&tokens_meta[curr].delimiters&&postProcess(state,tokens_meta[curr].delimiters)}},normalizeReference$1=utils.normalizeReference,isSpace$1=utils.isSpace,normalizeReference=utils.normalizeReference,isSpace=utils.isSpace,EMAIL_RE=/^([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)$/,AUTOLINK_RE=/^([a-zA-Z][a-zA-Z0-9+.\-]{1,31}):([^<>\x00-\x20]*)$/,HTML_TAG_RE=html_re.HTML_TAG_RE,has=utils.has,isValidEntityCode=utils.isValidEntityCode,fromCodePoint=utils.fromCodePoint,DIGITAL_RE=/^&#((?:x[a-f0-9]{1,6}|[0-9]{1,7}));/i,NAMED_RE=/^&([a-z][a-z0-9]{1,31});/i;function processDelimiters(state,delimiters){var closerIdx,openerIdx,closer,opener,minOpenerIdx,newMinOpenerIdx,isOddMatch,lastJump,openersBottom={},max=delimiters.length;if(max){var headerIdx=0,lastTokenIdx=-2,jumps=[];for(closerIdx=0;closerIdx<max;closerIdx++)if(closer=delimiters[closerIdx],jumps.push(0),(delimiters[headerIdx].marker!==closer.marker||lastTokenIdx!==closer.token-1)&&(headerIdx=closerIdx),lastTokenIdx=closer.token,closer.length=closer.length||0,closer.close){for(openersBottom.hasOwnProperty(closer.marker)||(openersBottom[closer.marker]=[-1,-1,-1,-1,-1,-1]),minOpenerIdx=openersBottom[closer.marker][(closer.open?3:0)+closer.length%3],newMinOpenerIdx=openerIdx=headerIdx-jumps[headerIdx]-1;openerIdx>minOpenerIdx;openerIdx-=jumps[openerIdx]+1)if((opener=delimiters[openerIdx]).marker===closer.marker&&opener.open&&opener.end<0&&(isOddMatch=!1,(opener.close||closer.open)&&(opener.length+closer.length)%3==0&&(opener.length%3!=0||closer.length%3!=0)&&(isOddMatch=!0),!isOddMatch)){lastJump=openerIdx>0&&!delimiters[openerIdx-1].open?jumps[openerIdx-1]+1:0,jumps[closerIdx]=closerIdx-openerIdx+lastJump,jumps[openerIdx]=lastJump,closer.open=!1,opener.end=closerIdx,opener.close=!1,newMinOpenerIdx=-1,lastTokenIdx=-2;break}-1!==newMinOpenerIdx&&(openersBottom[closer.marker][(closer.open?3:0)+(closer.length||0)%3]=newMinOpenerIdx)}}}var isWhiteSpace=utils.isWhiteSpace,isPunctChar=utils.isPunctChar,isMdAsciiPunct=utils.isMdAsciiPunct;function StateInline(src,md,env,outTokens){this.src=src,this.env=env,this.md=md,this.tokens=outTokens,this.tokens_meta=Array(outTokens.length),this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache={},this.delimiters=[],this._prev_delimiters=[],this.backticks={},this.backticksScanned=!1,this.linkLevel=0}StateInline.prototype.pushPending=function(){var token$1=new Token("text","",0);return token$1.content=this.pending,token$1.level=this.pendingLevel,this.tokens.push(token$1),this.pending="",token$1},StateInline.prototype.push=function(type,tag,nesting){this.pending&&this.pushPending();var token$1=new Token(type,tag,nesting),token_meta=null;return nesting<0&&(this.level--,this.delimiters=this._prev_delimiters.pop()),token$1.level=this.level,nesting>0&&(this.level++,this._prev_delimiters.push(this.delimiters),this.delimiters=[],token_meta={delimiters:this.delimiters}),this.pendingLevel=this.level,this.tokens.push(token$1),this.tokens_meta.push(token_meta),token$1},StateInline.prototype.scanDelims=function(start,canSplitWord){var lastChar,nextChar,count,can_open,can_close,isLastWhiteSpace,isLastPunctChar,isNextWhiteSpace,isNextPunctChar,pos=start,left_flanking=!0,right_flanking=!0,max=this.posMax,marker=this.src.charCodeAt(start);for(lastChar=start>0?this.src.charCodeAt(start-1):32;pos<max&&this.src.charCodeAt(pos)===marker;)pos++;return count=pos-start,nextChar=pos<max?this.src.charCodeAt(pos):32,isLastPunctChar=isMdAsciiPunct(lastChar)||isPunctChar(String.fromCharCode(lastChar)),isNextPunctChar=isMdAsciiPunct(nextChar)||isPunctChar(String.fromCharCode(nextChar)),isLastWhiteSpace=isWhiteSpace(lastChar),(isNextWhiteSpace=isWhiteSpace(nextChar))?left_flanking=!1:isNextPunctChar&&!(isLastWhiteSpace||isLastPunctChar)&&(left_flanking=!1),isLastWhiteSpace?right_flanking=!1:isLastPunctChar&&!(isNextWhiteSpace||isNextPunctChar)&&(right_flanking=!1),canSplitWord?(can_open=left_flanking,can_close=right_flanking):(can_open=left_flanking&&(!right_flanking||isLastPunctChar),can_close=right_flanking&&(!left_flanking||isNextPunctChar)),{can_open:can_open,can_close:can_close,length:count}},StateInline.prototype.Token=Token;var _rules=[["text",function(state,silent){for(var pos=state.pos;pos<state.posMax&&!function(ch){switch(ch){case 10:case 33:case 35:case 36:case 37:case 38:case 42:case 43:case 45:case 58:case 60:case 61:case 62:case 64:case 91:case 92:case 93:case 94:case 95:case 96:case 123:case 125:case 126:return!0;default:return!1}}(state.src.charCodeAt(pos));)pos++;return pos!==state.pos&&(silent||(state.pending+=state.src.slice(state.pos,pos)),state.pos=pos,!0)}],["linkify",function(state,silent){var pos,match,proto,link,url,fullUrl,token;return!!state.md.options.linkify&&!(state.linkLevel>0)&&!!(!((pos=state.pos)+3>state.posMax)&&58===state.src.charCodeAt(pos)&&47===state.src.charCodeAt(pos+1)&&47===state.src.charCodeAt(pos+2)&&(match=state.pending.match(SCHEME_RE)))&&(proto=match[1],!!(link=state.md.linkify.matchAtStart(state.src.slice(pos-proto.length)))&&(url=(url=link.url).replace(/\*+$/,""),fullUrl=state.md.normalizeLink(url),!!state.md.validateLink(fullUrl)&&(silent||(state.pending=state.pending.slice(0,-proto.length),(token=state.push("link_open","a",1)).attrs=[["href",fullUrl]],token.markup="linkify",token.info="auto",(token=state.push("text","",0)).content=state.md.normalizeLinkText(url),(token=state.push("link_close","a",-1)).markup="linkify",token.info="auto"),state.pos+=url.length-proto.length,!0)))}],["newline",function(state,silent){var pmax,max,ws,pos=state.pos;if(10!==state.src.charCodeAt(pos))return!1;if(pmax=state.pending.length-1,max=state.posMax,!silent){if(pmax>=0&&32===state.pending.charCodeAt(pmax)){if(pmax>=1&&32===state.pending.charCodeAt(pmax-1)){for(ws=pmax-1;ws>=1&&32===state.pending.charCodeAt(ws-1);)ws--;state.pending=state.pending.slice(0,ws),state.push("hardbreak","br",0)}else state.pending=state.pending.slice(0,-1),state.push("softbreak","br",0)}else state.push("softbreak","br",0)}for(pos++;pos<max&&isSpace$3(state.src.charCodeAt(pos));)pos++;return state.pos=pos,!0}],["escape",function(state,silent){var ch1,ch2,origStr,escapedStr,token,pos=state.pos,max=state.posMax;if(92!==state.src.charCodeAt(pos)||++pos>=max)return!1;if(10===(ch1=state.src.charCodeAt(pos))){for(silent||state.push("hardbreak","br",0),pos++;pos<max&&isSpace$2(ch1=state.src.charCodeAt(pos));)pos++;return state.pos=pos,!0}return escapedStr=state.src[pos],ch1>=55296&&ch1<=56319&&pos+1<max&&(ch2=state.src.charCodeAt(pos+1))>=56320&&ch2<=57343&&(escapedStr+=state.src[pos+1],pos++),origStr="\\"+escapedStr,silent||(token=state.push("text_special","",0),ch1<256&&0!==ESCAPED[ch1]?token.content=escapedStr:token.content=origStr,token.markup=origStr,token.info="escape"),state.pos=pos+1,!0}],["backticks",function(state,silent){var start,max,marker,token,matchStart,matchEnd,openerLength,closerLength,pos=state.pos;if(96!==state.src.charCodeAt(pos))return!1;for(start=pos,pos++,max=state.posMax;pos<max&&96===state.src.charCodeAt(pos);)pos++;if(openerLength=(marker=state.src.slice(start,pos)).length,state.backticksScanned&&(state.backticks[openerLength]||0)<=start)return silent||(state.pending+=marker),state.pos+=openerLength,!0;for(matchStart=matchEnd=pos;-1!==(matchStart=state.src.indexOf("`",matchEnd));){for(matchEnd=matchStart+1;matchEnd<max&&96===state.src.charCodeAt(matchEnd);)matchEnd++;if((closerLength=matchEnd-matchStart)===openerLength)return silent||((token=state.push("code_inline","code",0)).markup=marker,token.content=state.src.slice(pos,matchStart).replace(/\n/g," ").replace(/^ (.+) $/,"$1")),state.pos=matchEnd,!0;state.backticks[closerLength]=matchStart}return state.backticksScanned=!0,silent||(state.pending+=marker),state.pos+=openerLength,!0}],["strikethrough",strikethrough.tokenize],["emphasis",emphasis.tokenize],["link",function(state,silent){var attrs,code,label,labelEnd,labelStart,pos,res,ref,href="",title="",oldPos=state.pos,max=state.posMax,start=state.pos,parseReference=!0;if(91!==state.src.charCodeAt(state.pos)||(labelStart=state.pos+1,(labelEnd=state.md.helpers.parseLinkLabel(state,state.pos,!0))<0))return!1;if((pos=labelEnd+1)<max&&40===state.src.charCodeAt(pos)){for(parseReference=!1,pos++;pos<max&&(isSpace$1(code=state.src.charCodeAt(pos))||10===code);pos++);if(pos>=max)return!1;if(start=pos,(res=state.md.helpers.parseLinkDestination(state.src,pos,state.posMax)).ok){for(href=state.md.normalizeLink(res.str),state.md.validateLink(href)?pos=res.pos:href="",start=pos;pos<max&&(isSpace$1(code=state.src.charCodeAt(pos))||10===code);pos++);if(res=state.md.helpers.parseLinkTitle(state.src,pos,state.posMax),pos<max&&start!==pos&&res.ok)for(title=res.str,pos=res.pos;pos<max&&(isSpace$1(code=state.src.charCodeAt(pos))||10===code);pos++);}(pos>=max||41!==state.src.charCodeAt(pos))&&(parseReference=!0),pos++}if(parseReference){if(void 0===state.env.references)return!1;if(pos<max&&91===state.src.charCodeAt(pos)?(start=pos+1,(pos=state.md.helpers.parseLinkLabel(state,pos))>=0?label=state.src.slice(start,pos++):pos=labelEnd+1):pos=labelEnd+1,label||(label=state.src.slice(labelStart,labelEnd)),!(ref=state.env.references[normalizeReference$1(label)]))return state.pos=oldPos,!1;href=ref.href,title=ref.title}return silent||(state.pos=labelStart,state.posMax=labelEnd,state.push("link_open","a",1).attrs=attrs=[["href",href]],title&&attrs.push(["title",title]),state.linkLevel++,state.md.inline.tokenize(state),state.linkLevel--,state.push("link_close","a",-1)),state.pos=pos,state.posMax=max,!0}],["image",function(state,silent){var attrs,code,content,label,labelEnd,labelStart,pos,ref,res,title,token,tokens,start,href="",oldPos=state.pos,max=state.posMax;if(33!==state.src.charCodeAt(state.pos)||91!==state.src.charCodeAt(state.pos+1)||(labelStart=state.pos+2,(labelEnd=state.md.helpers.parseLinkLabel(state,state.pos+1,!1))<0))return!1;if((pos=labelEnd+1)<max&&40===state.src.charCodeAt(pos)){for(pos++;pos<max&&(isSpace(code=state.src.charCodeAt(pos))||10===code);pos++);if(pos>=max)return!1;for(start=pos,(res=state.md.helpers.parseLinkDestination(state.src,pos,state.posMax)).ok&&(href=state.md.normalizeLink(res.str),state.md.validateLink(href)?pos=res.pos:href=""),start=pos;pos<max&&(isSpace(code=state.src.charCodeAt(pos))||10===code);pos++);if(res=state.md.helpers.parseLinkTitle(state.src,pos,state.posMax),pos<max&&start!==pos&&res.ok)for(title=res.str,pos=res.pos;pos<max&&(isSpace(code=state.src.charCodeAt(pos))||10===code);pos++);else title="";if(pos>=max||41!==state.src.charCodeAt(pos))return state.pos=oldPos,!1;pos++}else{if(void 0===state.env.references)return!1;if(pos<max&&91===state.src.charCodeAt(pos)?(start=pos+1,(pos=state.md.helpers.parseLinkLabel(state,pos))>=0?label=state.src.slice(start,pos++):pos=labelEnd+1):pos=labelEnd+1,label||(label=state.src.slice(labelStart,labelEnd)),!(ref=state.env.references[normalizeReference(label)]))return state.pos=oldPos,!1;href=ref.href,title=ref.title}return!silent&&(content=state.src.slice(labelStart,labelEnd),state.md.inline.parse(content,state.md,state.env,tokens=[]),(token=state.push("image","img",0)).attrs=attrs=[["src",href],["alt",""]],token.children=tokens,token.content=content,title&&attrs.push(["title",title])),state.pos=pos,state.posMax=max,!0}],["autolink",function(state,silent){var url,fullUrl,token,ch,start,max,pos=state.pos;if(60!==state.src.charCodeAt(pos))return!1;for(start=state.pos,max=state.posMax;;){if(++pos>=max||60===(ch=state.src.charCodeAt(pos)))return!1;if(62===ch)break}return(url=state.src.slice(start+1,pos),AUTOLINK_RE.test(url))?(fullUrl=state.md.normalizeLink(url),!!state.md.validateLink(fullUrl)&&(silent||((token=state.push("link_open","a",1)).attrs=[["href",fullUrl]],token.markup="autolink",token.info="auto",(token=state.push("text","",0)).content=state.md.normalizeLinkText(url),(token=state.push("link_close","a",-1)).markup="autolink",token.info="auto"),state.pos+=url.length+2,!0)):!!EMAIL_RE.test(url)&&(fullUrl=state.md.normalizeLink("mailto:"+url),!!state.md.validateLink(fullUrl)&&(silent||((token=state.push("link_open","a",1)).attrs=[["href",fullUrl]],token.markup="autolink",token.info="auto",(token=state.push("text","",0)).content=state.md.normalizeLinkText(url),(token=state.push("link_close","a",-1)).markup="autolink",token.info="auto"),state.pos+=url.length+2,!0))}],["html_inline",function(state,silent){var lc,str,str1,ch,match,max,token,pos=state.pos;return!!(state.md.options.html&&(max=state.posMax,60===state.src.charCodeAt(pos)&&!(pos+2>=max))&&(33===(ch=state.src.charCodeAt(pos+1))||63===ch||47===ch||(lc=32|ch)>=97&&lc<=122)&&(match=state.src.slice(pos).match(HTML_TAG_RE)))&&(!silent&&((token=state.push("html_inline","",0)).content=state.src.slice(pos,pos+match[0].length),str=token.content,/^<a[>\s]/i.test(str)&&state.linkLevel++,str1=token.content,/^<\/a\s*>/i.test(str1)&&state.linkLevel--),state.pos+=match[0].length,!0)}],["entity",function(state,silent){var code,match,token,pos=state.pos,max=state.posMax;if(38!==state.src.charCodeAt(pos)||pos+1>=max)return!1;if(35===state.src.charCodeAt(pos+1)){if(match=state.src.slice(pos).match(DIGITAL_RE))return silent||(code="x"===match[1][0].toLowerCase()?parseInt(match[1].slice(1),16):parseInt(match[1],10),(token=state.push("text_special","",0)).content=isValidEntityCode(code)?fromCodePoint(code):fromCodePoint(65533),token.markup=match[0],token.info="entity"),state.pos+=match[0].length,!0}else if((match=state.src.slice(pos).match(NAMED_RE))&&has(entities,match[1]))return silent||((token=state.push("text_special","",0)).content=entities[match[1]],token.markup=match[0],token.info="entity"),state.pos+=match[0].length,!0;return!1}]],_rules2=[["balance_pairs",function(state){var curr,tokens_meta=state.tokens_meta,max=state.tokens_meta.length;for(processDelimiters(state,state.delimiters),curr=0;curr<max;curr++)tokens_meta[curr]&&tokens_meta[curr].delimiters&&processDelimiters(state,tokens_meta[curr].delimiters)}],["strikethrough",strikethrough.postProcess],["emphasis",emphasis.postProcess],["fragments_join",function(state){var curr,last,level=0,tokens=state.tokens,max=state.tokens.length;for(curr=last=0;curr<max;curr++)tokens[curr].nesting<0&&level--,tokens[curr].level=level,tokens[curr].nesting>0&&level++,"text"===tokens[curr].type&&curr+1<max&&"text"===tokens[curr+1].type?tokens[curr+1].content=tokens[curr].content+tokens[curr+1].content:(curr!==last&&(tokens[last]=tokens[curr]),last++);curr!==last&&(tokens.length=last)}]];function ParserInline(){var i;for(i=0,this.ruler=new Ruler;i<_rules.length;i++)this.ruler.push(_rules[i][0],_rules[i][1]);for(i=0,this.ruler2=new Ruler;i<_rules2.length;i++)this.ruler2.push(_rules2[i][0],_rules2[i][1])}ParserInline.prototype.skipToken=function(state){var ok,i,pos=state.pos,rules=this.ruler.getRules(""),len=rules.length,maxNesting=state.md.options.maxNesting,cache=state.cache;if(void 0!==cache[pos]){state.pos=cache[pos];return}if(state.level<maxNesting)for(i=0;i<len&&(state.level++,ok=rules[i](state,!0),state.level--,!ok);i++);else state.pos=state.posMax;!ok&&state.pos++,cache[pos]=state.pos},ParserInline.prototype.tokenize=function(state){for(var ok,i,rules=this.ruler.getRules(""),len=rules.length,end=state.posMax,maxNesting=state.md.options.maxNesting;state.pos<end;){if(state.level<maxNesting)for(i=0;i<len&&!(ok=rules[i](state,!1));i++);if(ok){if(state.pos>=end)break;continue}state.pending+=state.src[state.pos++]}state.pending&&state.pushPending()},ParserInline.prototype.parse=function(str,md,env,outTokens){var i,rules,len,state=new this.State(str,md,env,outTokens);for(this.tokenize(state),len=(rules=this.ruler2.getRules("")).length,i=0;i<len;i++)rules[i](state)},ParserInline.prototype.State=StateInline;var re=function(opts){var re={};opts=opts||{},re.src_Any=regex$3.source,re.src_Cc=regex$2.source,re.src_Z=regex.source,re.src_P=regex$4.source,re.src_ZPCc=[re.src_Z,re.src_P,re.src_Cc].join("|"),re.src_ZCc=[re.src_Z,re.src_Cc].join("|");var text_separators="[><｜]";return re.src_pseudo_letter="(?:(?!"+text_separators+"|"+re.src_ZPCc+")"+re.src_Any+")",re.src_ip4="(?:(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",re.src_auth="(?:(?:(?!"+re.src_ZCc+"|[@/\\[\\]()]).)+@)?",re.src_port="(?::(?:6(?:[0-4]\\d{3}|5(?:[0-4]\\d{2}|5(?:[0-2]\\d|3[0-5])))|[1-5]?\\d{1,4}))?",re.src_host_terminator="(?=$|"+text_separators+"|"+re.src_ZPCc+")(?!"+(opts["---"]?"-(?!--)|":"-|")+"_|:\\d|\\.-|\\.(?!$|"+re.src_ZPCc+"))",re.src_path="(?:[/?#](?:(?!"+re.src_ZCc+"|"+text_separators+"|[()[\\]{}.,\"'?!\\-;]).|\\[(?:(?!"+re.src_ZCc+"|\\]).)*\\]|\\((?:(?!"+re.src_ZCc+"|[)]).)*\\)|\\{(?:(?!"+re.src_ZCc+'|[}]).)*\\}|\\"(?:(?!'+re.src_ZCc+'|["]).)+\\"|\\\'(?:(?!'+re.src_ZCc+"|[']).)+\\'|\\'(?="+re.src_pseudo_letter+"|[-])|\\.{2,}[a-zA-Z0-9%/&]|\\.(?!"+re.src_ZCc+"|[.]|$)|"+(opts["---"]?"\\-(?!--(?:[^-]|$))(?:-*)|":"\\-+|")+",(?!"+re.src_ZCc+"|$)|;(?!"+re.src_ZCc+"|$)|\\!+(?!"+re.src_ZCc+"|[!]|$)|\\?(?!"+re.src_ZCc+"|[?]|$))+|\\/)?",re.src_email_name='[\\-;:&=\\+\\$,\\.a-zA-Z0-9_][\\-;:&=\\+\\$,\\"\\.a-zA-Z0-9_]*',re.src_xn="xn--[a-z0-9\\-]{1,59}",re.src_domain_root="(?:"+re.src_xn+"|"+re.src_pseudo_letter+"{1,63})",re.src_domain="(?:"+re.src_xn+"|(?:"+re.src_pseudo_letter+")|(?:"+re.src_pseudo_letter+"(?:-|"+re.src_pseudo_letter+"){0,61}"+re.src_pseudo_letter+"))",re.src_host="(?:(?:(?:(?:"+re.src_domain+")\\.)*"+re.src_domain+"))",re.tpl_host_fuzzy="(?:"+re.src_ip4+"|(?:(?:(?:"+re.src_domain+")\\.)+(?:%TLDS%)))",re.tpl_host_no_ip_fuzzy="(?:(?:(?:"+re.src_domain+")\\.)+(?:%TLDS%))",re.src_host_strict=re.src_host+re.src_host_terminator,re.tpl_host_fuzzy_strict=re.tpl_host_fuzzy+re.src_host_terminator,re.src_host_port_strict=re.src_host+re.src_port+re.src_host_terminator,re.tpl_host_port_fuzzy_strict=re.tpl_host_fuzzy+re.src_port+re.src_host_terminator,re.tpl_host_port_no_ip_fuzzy_strict=re.tpl_host_no_ip_fuzzy+re.src_port+re.src_host_terminator,re.tpl_host_fuzzy_test="localhost|www\\.|\\.\\d{1,3}\\.|(?:\\.(?:%TLDS%)(?:"+re.src_ZPCc+"|>|$))",re.tpl_email_fuzzy="(^|"+text_separators+'|"|\\(|'+re.src_ZCc+")("+re.src_email_name+"@"+re.tpl_host_fuzzy_strict+")",re.tpl_link_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+re.src_ZPCc+"))((?![$+<=>^`|｜])"+re.tpl_host_port_fuzzy_strict+re.src_path+")",re.tpl_link_no_ip_fuzzy="(^|(?![.:/\\-_@])(?:[$+<=>^`|｜]|"+re.src_ZPCc+"))((?![$+<=>^`|｜])"+re.tpl_host_port_no_ip_fuzzy_strict+re.src_path+")",re};function assign$1(obj){var sources=Array.prototype.slice.call(arguments,1);return sources.forEach(function(source){source&&Object.keys(source).forEach(function(key){obj[key]=source[key]})}),obj}function _class(obj){return Object.prototype.toString.call(obj)}function isFunction(obj){return"[object Function]"===_class(obj)}function escapeRE(str){return str.replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}var defaultOptions={fuzzyLink:!0,fuzzyEmail:!0,fuzzyIP:!1},defaultSchemas={"http:":{validate:function(text,pos,self1){var tail=text.slice(pos);return(self1.re.http||(self1.re.http=RegExp("^\\/\\/"+self1.re.src_auth+self1.re.src_host_port_strict+self1.re.src_path,"i")),self1.re.http.test(tail))?tail.match(self1.re.http)[0].length:0}},"https:":"http:","ftp:":"http:","//":{validate:function(text,pos,self1){var tail=text.slice(pos);return(self1.re.no_http||(self1.re.no_http=RegExp("^"+self1.re.src_auth+"(?:localhost|(?:(?:"+self1.re.src_domain+")\\.)+"+self1.re.src_domain_root+")"+self1.re.src_port+self1.re.src_host_terminator+self1.re.src_path,"i")),self1.re.no_http.test(tail))?pos>=3&&":"===text[pos-3]||pos>=3&&"/"===text[pos-3]?0:tail.match(self1.re.no_http)[0].length:0}},"mailto:":{validate:function(text,pos,self1){var tail=text.slice(pos);return(self1.re.mailto||(self1.re.mailto=RegExp("^"+self1.re.src_email_name+"@"+self1.re.src_host_strict,"i")),self1.re.mailto.test(tail))?tail.match(self1.re.mailto)[0].length:0}}},tlds_default="biz|com|edu|gov|net|org|pro|web|xxx|aero|asia|coop|info|museum|name|shop|рф".split("|");function createNormalizer(){return function(match,self1){self1.normalize(match)}}function compile(self1){var self2,re$1=self1.re=re(self1.__opts__),tlds=self1.__tlds__.slice();function untpl(tpl){return tpl.replace("%TLDS%",re$1.src_tlds)}self1.onCompile(),self1.__tlds_replaced__||tlds.push("a[cdefgilmnoqrstuwxz]|b[abdefghijmnorstvwyz]|c[acdfghiklmnoruvwxyz]|d[ejkmoz]|e[cegrstu]|f[ijkmor]|g[abdefghilmnpqrstuwy]|h[kmnrtu]|i[delmnoqrst]|j[emop]|k[eghimnprwyz]|l[abcikrstuvy]|m[acdeghklmnopqrstuvwxyz]|n[acefgilopruz]|om|p[aefghklmnrstwy]|qa|r[eosuw]|s[abcdeghijklmnortuvxyz]|t[cdfghjklmnortvwz]|u[agksyz]|v[aceginu]|w[fs]|y[et]|z[amw]"),tlds.push(re$1.src_xn),re$1.src_tlds=tlds.join("|"),re$1.email_fuzzy=RegExp(untpl(re$1.tpl_email_fuzzy),"i"),re$1.link_fuzzy=RegExp(untpl(re$1.tpl_link_fuzzy),"i"),re$1.link_no_ip_fuzzy=RegExp(untpl(re$1.tpl_link_no_ip_fuzzy),"i"),re$1.host_fuzzy_test=RegExp(untpl(re$1.tpl_host_fuzzy_test),"i");var aliases=[];function schemaError(name,val){throw Error('(LinkifyIt) Invalid schema "'+name+'": '+val)}self1.__compiled__={},Object.keys(self1.__schemas__).forEach(function(name){var re,val=self1.__schemas__[name];if(null!==val){var compiled={validate:null,link:null};if(self1.__compiled__[name]=compiled,"[object Object]"===_class(val)){"[object RegExp]"===_class(val.validate)?compiled.validate=(re=val.validate,function(text,pos){var tail=text.slice(pos);return re.test(tail)?tail.match(re)[0].length:0}):isFunction(val.validate)?compiled.validate=val.validate:schemaError(name,val),isFunction(val.normalize)?compiled.normalize=val.normalize:val.normalize?schemaError(name,val):compiled.normalize=createNormalizer();return}if("[object String]"===_class(val)){aliases.push(name);return}schemaError(name,val)}}),aliases.forEach(function(alias){self1.__compiled__[self1.__schemas__[alias]]&&(self1.__compiled__[alias].validate=self1.__compiled__[self1.__schemas__[alias]].validate,self1.__compiled__[alias].normalize=self1.__compiled__[self1.__schemas__[alias]].normalize)}),self1.__compiled__[""]={validate:null,normalize:createNormalizer()};var slist=Object.keys(self1.__compiled__).filter(function(name){return name.length>0&&self1.__compiled__[name]}).map(escapeRE).join("|");self1.re.schema_test=RegExp("(^|(?!_)(?:[><｜]|"+re$1.src_ZPCc+"))("+slist+")","i"),self1.re.schema_search=RegExp("(^|(?!_)(?:[><｜]|"+re$1.src_ZPCc+"))("+slist+")","ig"),self1.re.schema_at_start=RegExp("^"+self1.re.schema_search.source,"i"),self1.re.pretest=RegExp("("+self1.re.schema_test.source+")|("+self1.re.host_fuzzy_test.source+")|@","i"),(self2=self1).__index__=-1,self2.__text_cache__=""}function Match(self1,shift){var start=self1.__index__,end=self1.__last_index__,text=self1.__text_cache__.slice(start,end);this.schema=self1.__schema__.toLowerCase(),this.index=start+shift,this.lastIndex=end+shift,this.raw=text,this.text=text,this.url=text}function createMatch(self1,shift){var match=new Match(self1,shift);return self1.__compiled__[match.schema].normalize(match,self1),match}function LinkifyIt(schemas,options){if(!(this instanceof LinkifyIt))return new LinkifyIt(schemas,options);!options&&Object.keys(schemas||{}).reduce(function(acc,k){return acc||defaultOptions.hasOwnProperty(k)},!1)&&(options=schemas,schemas={}),this.__opts__=assign$1({},defaultOptions,options),this.__index__=-1,this.__last_index__=-1,this.__schema__="",this.__text_cache__="",this.__schemas__=assign$1({},defaultSchemas,schemas),this.__compiled__={},this.__tlds__=tlds_default,this.__tlds_replaced__=!1,this.re={},compile(this)}LinkifyIt.prototype.add=function(schema,definition){return this.__schemas__[schema]=definition,compile(this),this},LinkifyIt.prototype.set=function(options){return this.__opts__=assign$1(this.__opts__,options),this},LinkifyIt.prototype.test=function(text){var m,ml,me,len,shift,next,re,tld_pos;if(this.__text_cache__=text,this.__index__=-1,!text.length)return!1;if(this.re.schema_test.test(text)){for((re=this.re.schema_search).lastIndex=0;null!==(m=re.exec(text));)if(len=this.testSchemaAt(text,m[2],re.lastIndex)){this.__schema__=m[2],this.__index__=m.index+m[1].length,this.__last_index__=m.index+m[0].length+len;break}}return this.__opts__.fuzzyLink&&this.__compiled__["http:"]&&(tld_pos=text.search(this.re.host_fuzzy_test))>=0&&(this.__index__<0||tld_pos<this.__index__)&&null!==(ml=text.match(this.__opts__.fuzzyIP?this.re.link_fuzzy:this.re.link_no_ip_fuzzy))&&(shift=ml.index+ml[1].length,(this.__index__<0||shift<this.__index__)&&(this.__schema__="",this.__index__=shift,this.__last_index__=ml.index+ml[0].length)),this.__opts__.fuzzyEmail&&this.__compiled__["mailto:"]&&text.indexOf("@")>=0&&null!==(me=text.match(this.re.email_fuzzy))&&(shift=me.index+me[1].length,next=me.index+me[0].length,(this.__index__<0||shift<this.__index__||shift===this.__index__&&next>this.__last_index__)&&(this.__schema__="mailto:",this.__index__=shift,this.__last_index__=next)),this.__index__>=0},LinkifyIt.prototype.pretest=function(text){return this.re.pretest.test(text)},LinkifyIt.prototype.testSchemaAt=function(text,schema,pos){return this.__compiled__[schema.toLowerCase()]?this.__compiled__[schema.toLowerCase()].validate(text,pos,this):0},LinkifyIt.prototype.match=function(text){var shift=0,result=[];this.__index__>=0&&this.__text_cache__===text&&(result.push(createMatch(this,shift)),shift=this.__last_index__);for(var tail=shift?text.slice(shift):text;this.test(tail);)result.push(createMatch(this,shift)),tail=tail.slice(this.__last_index__),shift+=this.__last_index__;return result.length?result:null},LinkifyIt.prototype.matchAtStart=function(text){if(this.__text_cache__=text,this.__index__=-1,!text.length)return null;var m=this.re.schema_at_start.exec(text);if(!m)return null;var len=this.testSchemaAt(text,m[2],m[0].length);return len?(this.__schema__=m[2],this.__index__=m.index+m[1].length,this.__last_index__=m.index+m[0].length+len,createMatch(this,0)):null},LinkifyIt.prototype.tlds=function(list,keepOld){return(list=Array.isArray(list)?list:[list],keepOld)?(this.__tlds__=this.__tlds__.concat(list).sort().filter(function(el,idx,arr){return el!==arr[idx-1]}).reverse(),compile(this),this):(this.__tlds__=list.slice(),this.__tlds_replaced__=!0,compile(this),this)},LinkifyIt.prototype.normalize=function(match){match.schema||(match.url="http://"+match.url),"mailto:"!==match.schema||/^mailto:/i.test(match.url)||(match.url="mailto:"+match.url)},LinkifyIt.prototype.onCompile=function(){};let regexPunycode=/^xn--/,regexNonASCII=/[^\0-\x7F]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw RangeError(errors[type])}function mapDomain(domain,callback){let parts=domain.split("@"),result="";parts.length>1&&(result=parts[0]+"@",domain=parts[1]),domain=domain.replace(regexSeparators,".");let labels=domain.split("."),encoded=(function(array,callback){let result=[],length=array.length;for(;length--;)result[length]=callback(array[length]);return result})(labels,callback).join(".");return result+encoded}function ucs2decode(string){let output=[],counter=0,length=string.length;for(;counter<length;){let value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){let extra=string.charCodeAt(counter++);(64512&extra)==56320?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)}else output.push(value)}return output}let ucs2encode=codePoints=>String.fromCodePoint(...codePoints),digitToBasic=function(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)},adapt=function(delta,numPoints,firstTime){let k=0;for(delta=firstTime?floor(delta/700):delta>>1,delta+=floor(delta/numPoints);delta>455;k+=36)delta=floor(delta/35);return floor(k+36*delta/(delta+38))},decode=function(input){let output=[],inputLength=input.length,i=0,n=128,bias=72,basic=input.lastIndexOf("-");basic<0&&(basic=0);for(let j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(let index=basic>0?basic+1:0;index<inputLength;){let oldi=i;for(let w=1,k=36;;k+=36){var codePoint;index>=inputLength&&error("invalid-input");let digit=(codePoint=input.charCodeAt(index++))>=48&&codePoint<58?26+(codePoint-48):codePoint>=65&&codePoint<91?codePoint-65:codePoint>=97&&codePoint<123?codePoint-97:36;digit>=36&&error("invalid-input"),digit>floor((2147483647-i)/w)&&error("overflow"),i+=digit*w;let t=k<=bias?1:k>=bias+26?26:k-bias;if(digit<t)break;let baseMinusT=36-t;w>floor(2147483647/baseMinusT)&&error("overflow"),w*=baseMinusT}let out=output.length+1;bias=adapt(i-oldi,out,0==oldi),floor(i/out)>2147483647-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return String.fromCodePoint(...output)},encode=function(input){let output=[];input=ucs2decode(input);let inputLength=input.length,n=128,delta=0,bias=72;for(let currentValue of input)currentValue<128&&output.push(stringFromCharCode(currentValue));let basicLength=output.length,handledCPCount=basicLength;for(basicLength&&output.push("-");handledCPCount<inputLength;){let m=2147483647;for(let currentValue1 of input)currentValue1>=n&&currentValue1<m&&(m=currentValue1);let handledCPCountPlusOne=handledCPCount+1;for(let currentValue2 of(m-n>floor((2147483647-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,input))if(currentValue2<n&&++delta>2147483647&&error("overflow"),currentValue2===n){let q=delta;for(let k=36;;k+=36){let t=k<=bias?1:k>=bias+26?26:k-bias;if(q<t)break;let qMinusT=q-t,baseMinusT=36-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount===basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")};var punycode_1={version:"2.1.0",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},toUnicode:function(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}},config={default:{options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:100},components:{core:{},block:{},inline:{}}},zero:{options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["paragraph"]},inline:{rules:["text"],rules2:["balance_pairs","fragments_join"]}}},commonmark:{options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,quotes:"“”‘’",highlight:null,maxNesting:20},components:{core:{rules:["normalize","block","inline","text_join"]},block:{rules:["blockquote","code","fence","heading","hr","html_block","lheading","list","reference","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","html_inline","image","link","newline","text"],rules2:["balance_pairs","emphasis","fragments_join"]}}}},BAD_PROTO_RE=/^(vbscript|javascript|file|data):/,GOOD_DATA_RE=/^data:image\/(gif|png|jpeg|webp);/;function validateLink(url){var str=url.trim().toLowerCase();return!BAD_PROTO_RE.test(str)||!!GOOD_DATA_RE.test(str)}var RECODE_HOSTNAME_FOR=["http:","https:","mailto:"];function normalizeLink(url){var parsed=mdurl.parse(url,!0);if(parsed.hostname&&(!parsed.protocol||RECODE_HOSTNAME_FOR.indexOf(parsed.protocol)>=0))try{parsed.hostname=punycode_1.toASCII(parsed.hostname)}catch(er){}return mdurl.encode(mdurl.format(parsed))}function normalizeLinkText(url){var parsed=mdurl.parse(url,!0);if(parsed.hostname&&(!parsed.protocol||RECODE_HOSTNAME_FOR.indexOf(parsed.protocol)>=0))try{parsed.hostname=punycode_1.toUnicode(parsed.hostname)}catch(er){}return mdurl.decode(mdurl.format(parsed),mdurl.decode.defaultChars+"%")}function MarkdownIt(presetName,options){if(!(this instanceof MarkdownIt))return new MarkdownIt(presetName,options);options||utils.isString(presetName)||(options=presetName||{},presetName="default"),this.inline=new ParserInline,this.block=new ParserBlock,this.core=new Core,this.renderer=new Renderer,this.linkify=new LinkifyIt,this.validateLink=validateLink,this.normalizeLink=normalizeLink,this.normalizeLinkText=normalizeLinkText,this.utils=utils,this.helpers=utils.assign({},helpers),this.options={},this.configure(presetName),options&&this.set(options)}MarkdownIt.prototype.set=function(options){return utils.assign(this.options,options),this},MarkdownIt.prototype.configure=function(presets){var presetName,self1=this;if(utils.isString(presets)&&!(presets=config[presetName=presets]))throw Error('Wrong `markdown-it` preset "'+presetName+'", check name');if(!presets)throw Error("Wrong `markdown-it` preset, can't be empty");return presets.options&&self1.set(presets.options),presets.components&&Object.keys(presets.components).forEach(function(name){presets.components[name].rules&&self1[name].ruler.enableOnly(presets.components[name].rules),presets.components[name].rules2&&self1[name].ruler2.enableOnly(presets.components[name].rules2)}),this},MarkdownIt.prototype.enable=function(list,ignoreInvalid){var result=[];Array.isArray(list)||(list=[list]),["core","block","inline"].forEach(function(chain){result=result.concat(this[chain].ruler.enable(list,!0))},this),result=result.concat(this.inline.ruler2.enable(list,!0));var missed=list.filter(function(name){return 0>result.indexOf(name)});if(missed.length&&!ignoreInvalid)throw Error("MarkdownIt. Failed to enable unknown rule(s): "+missed);return this},MarkdownIt.prototype.disable=function(list,ignoreInvalid){var result=[];Array.isArray(list)||(list=[list]),["core","block","inline"].forEach(function(chain){result=result.concat(this[chain].ruler.disable(list,!0))},this),result=result.concat(this.inline.ruler2.disable(list,!0));var missed=list.filter(function(name){return 0>result.indexOf(name)});if(missed.length&&!ignoreInvalid)throw Error("MarkdownIt. Failed to disable unknown rule(s): "+missed);return this},MarkdownIt.prototype.use=function(plugin){var args=[this].concat(Array.prototype.slice.call(arguments,1));return plugin.apply(plugin,args),this},MarkdownIt.prototype.parse=function(src,env){if("string"!=typeof src)throw Error("Input data should be a String");var state=new this.core.State(src,this,env);return this.core.process(state),state.tokens},MarkdownIt.prototype.render=function(src,env){return env=env||{},this.renderer.render(this.parse(src,env),this.options,env)},MarkdownIt.prototype.parseInline=function(src,env){var state=new this.core.State(src,this,env);return state.inlineMode=!0,this.core.process(state),state.tokens},MarkdownIt.prototype.renderInline=function(src,env){return env=env||{},this.renderer.render(this.parseInline(src,env),this.options,env)};let schema=new class{constructor(spec){this.cached=Object.create(null);let instanceSpec=this.spec={};for(let prop in spec)instanceSpec[prop]=spec[prop];instanceSpec.nodes=OrderedMap.from(spec.nodes),instanceSpec.marks=OrderedMap.from(spec.marks||{}),this.nodes=NodeType$2.compile(this.spec.nodes,this),this.marks=MarkType$1.compile(this.spec.marks,this);let contentExprCache=Object.create(null);for(let prop1 in this.nodes){if(prop1 in this.marks)throw RangeError(prop1+" can not be both a node and a mark");let type=this.nodes[prop1],contentExpr=type.spec.content||"",markExpr=type.spec.marks;type.contentMatch=contentExprCache[contentExpr]||(contentExprCache[contentExpr]=ContentMatch$1.parse(contentExpr,this.nodes)),type.inlineContent=type.contentMatch.inlineContent,type.markSet="_"==markExpr?null:markExpr?gatherMarks$1(this,markExpr.split(" ")):""!=markExpr&&type.inlineContent?null:[]}for(let prop2 in this.marks){let type1=this.marks[prop2],excl=type1.spec.excludes;type1.excluded=null==excl?[type1]:""==excl?[]:gatherMarks$1(this,excl.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(type,attrs=null,content,marks){if("string"==typeof type)type=this.nodeType(type);else if(type instanceof NodeType$2){if(type.schema!=this)throw RangeError("Node type from different schema used ("+type.name+")")}else throw RangeError("Invalid node type: "+type);return type.createChecked(attrs,content,marks)}text(text,marks){let type=this.nodes.text;return new TextNode$1(type,type.defaultAttrs,text,Mark$3.setFrom(marks))}mark(type,attrs){return"string"==typeof type&&(type=this.marks[type]),type.create(attrs)}nodeFromJSON(json){return Node$2.fromJSON(this,json)}markFromJSON(json){return Mark$3.fromJSON(this,json)}nodeType(name){let found=this.nodes[name];if(!found)throw RangeError("Unknown node type: "+name);return found}}({nodes:{doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:()=>["p",0]},blockquote:{content:"block+",group:"block",parseDOM:[{tag:"blockquote"}],toDOM:()=>["blockquote",0]},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:()=>["div",["hr"]]},heading:{attrs:{level:{default:1}},content:"(text | image)*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:node=>["h"+node.attrs.level,0]},code_block:{content:"text*",group:"block",code:!0,defining:!0,marks:"",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:node=>({params:node.getAttribute("data-params")||""})}],toDOM:node=>["pre",node.attrs.params?{"data-params":node.attrs.params}:{},["code",0]]},ordered_list:{content:"list_item+",group:"block",attrs:{order:{default:1},tight:{default:!1}},parseDOM:[{tag:"ol",getAttrs:dom=>({order:dom.hasAttribute("start")?+dom.getAttribute("start"):1,tight:dom.hasAttribute("data-tight")})}],toDOM:node=>["ol",{start:1==node.attrs.order?null:node.attrs.order,"data-tight":node.attrs.tight?"true":null},0]},bullet_list:{content:"list_item+",group:"block",attrs:{tight:{default:!1}},parseDOM:[{tag:"ul",getAttrs:dom=>({tight:dom.hasAttribute("data-tight")})}],toDOM:node=>["ul",{"data-tight":node.attrs.tight?"true":null},0]},list_item:{content:"paragraph block*",defining:!0,parseDOM:[{tag:"li"}],toDOM:()=>["li",0]},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:dom=>({src:dom.getAttribute("src"),title:dom.getAttribute("title"),alt:dom.getAttribute("alt")})}],toDOM:node=>["img",node.attrs]},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:()=>["br"]}},marks:{em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:value=>"italic"==value&&null}],toDOM:()=>["em"]},strong:{parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-weight",getAttrs:value=>/^(bold(er)?|[5-9]\d{2,})$/.test(value)&&null}],toDOM:()=>["strong"]},link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:dom=>({href:dom.getAttribute("href"),title:dom.getAttribute("title")})}],toDOM:node=>["a",node.attrs]},code:{parseDOM:[{tag:"code"}],toDOM:()=>["code"]}}});class MarkdownParseState{constructor(schema,tokenHandlers){this.schema=schema,this.tokenHandlers=tokenHandlers,this.stack=[{type:schema.topNodeType,attrs:null,content:[],marks:Mark$3.none}]}top(){return this.stack[this.stack.length-1]}push(elt){this.stack.length&&this.top().content.push(elt)}addText(text){if(!text)return;let top=this.top(),nodes=top.content,last=nodes[nodes.length-1],node=this.schema.text(text,top.marks),merged;last&&(merged=function(a,b){if(a.isText&&b.isText&&Mark$3.sameSet(a.marks,b.marks))return a.withText(a.text+b.text)}(last,node))?nodes[nodes.length-1]=merged:nodes.push(node)}openMark(mark){let top=this.top();top.marks=mark.addToSet(top.marks)}closeMark(mark){let top=this.top();top.marks=mark.removeFromSet(top.marks)}parseTokens(toks){for(let i=0;i<toks.length;i++){let tok=toks[i],handler=this.tokenHandlers[tok.type];if(!handler)throw Error("Token type `"+tok.type+"` not supported by Markdown parser");handler(this,tok,toks,i)}}addNode(type,attrs,content){let top=this.top(),node=type.createAndFill(attrs,content,top?top.marks:[]);return node?(this.push(node),node):null}openNode(type,attrs){this.stack.push({type:type,attrs:attrs,content:[],marks:Mark$3.none})}closeNode(){let info=this.stack.pop();return this.addNode(info.type,info.attrs,info.content)}}function attrs(spec,token,tokens,i){return spec.getAttrs?spec.getAttrs(token,tokens,i):spec.attrs instanceof Function?spec.attrs(token):spec.attrs}function noCloseToken(spec,type){return spec.noCloseToken||"code_inline"==type||"code_block"==type||"fence"==type}function withoutTrailingNewline(str){return"\n"==str[str.length-1]?str.slice(0,str.length-1):str}function noOp(){}function listIsTight(tokens,i){for(;++i<tokens.length;)if("list_item_open"!=tokens[i].type)return tokens[i].hidden;return!1}let defaultMarkdownParser=new class{constructor(schema,tokenizer,tokens){this.schema=schema,this.tokenizer=tokenizer,this.tokens=tokens,this.tokenHandlers=function(schema,tokens){let handlers=Object.create(null);for(let type in tokens){let spec=tokens[type];if(spec.block){let nodeType=schema.nodeType(spec.block);noCloseToken(spec,type)?handlers[type]=(state,tok,tokens,i)=>{state.openNode(nodeType,attrs(spec,tok,tokens,i)),state.addText(withoutTrailingNewline(tok.content)),state.closeNode()}:(handlers[type+"_open"]=(state,tok,tokens,i)=>state.openNode(nodeType,attrs(spec,tok,tokens,i)),handlers[type+"_close"]=state=>state.closeNode())}else if(spec.node){let nodeType1=schema.nodeType(spec.node);handlers[type]=(state,tok,tokens,i)=>state.addNode(nodeType1,attrs(spec,tok,tokens,i))}else if(spec.mark){let markType=schema.marks[spec.mark];noCloseToken(spec,type)?handlers[type]=(state,tok,tokens,i)=>{state.openMark(markType.create(attrs(spec,tok,tokens,i))),state.addText(withoutTrailingNewline(tok.content)),state.closeMark(markType)}:(handlers[type+"_open"]=(state,tok,tokens,i)=>state.openMark(markType.create(attrs(spec,tok,tokens,i))),handlers[type+"_close"]=state=>state.closeMark(markType))}else if(spec.ignore)noCloseToken(spec,type)?handlers[type]=noOp:(handlers[type+"_open"]=noOp,handlers[type+"_close"]=noOp);else throw RangeError("Unrecognized parsing spec "+JSON.stringify(spec))}return handlers.text=(state,tok)=>state.addText(tok.content),handlers.inline=(state,tok)=>state.parseTokens(tok.children),handlers.softbreak=handlers.softbreak||(state=>state.addText(" ")),handlers}(schema,tokens)}parse(text,markdownEnv={}){let state=new MarkdownParseState(this.schema,this.tokenHandlers),doc;state.parseTokens(this.tokenizer.parse(text,markdownEnv));do doc=state.closeNode();while(state.stack.length);return doc||this.schema.topNodeType.createAndFill()}}(schema,MarkdownIt("commonmark",{html:!1}),{blockquote:{block:"blockquote"},paragraph:{block:"paragraph"},list_item:{block:"list_item"},bullet_list:{block:"bullet_list",getAttrs:(_,tokens,i)=>({tight:listIsTight(tokens,i)})},ordered_list:{block:"ordered_list",getAttrs:(tok,tokens,i)=>({order:+tok.attrGet("start")||1,tight:listIsTight(tokens,i)})},heading:{block:"heading",getAttrs:tok=>({level:+tok.tag.slice(1)})},code_block:{block:"code_block",noCloseToken:!0},fence:{block:"code_block",getAttrs:tok=>({params:tok.info||""}),noCloseToken:!0},hr:{node:"horizontal_rule"},image:{node:"image",getAttrs:tok=>({src:tok.attrGet("src"),title:tok.attrGet("title")||null,alt:tok.children[0]&&tok.children[0].content||null})},hardbreak:{node:"hard_break"},em:{mark:"em"},strong:{mark:"strong"},link:{mark:"link",getAttrs:tok=>({href:tok.attrGet("href"),title:tok.attrGet("title")||null})},code_inline:{mark:"code",noCloseToken:!0}});class MarkdownSerializer{constructor(nodes,marks,options={}){this.nodes=nodes,this.marks=marks,this.options=options}serialize(content,options={}){options=Object.assign({},this.options,options);let state=new MarkdownSerializerState(this.nodes,this.marks,options);return state.renderContent(content),state.out}}let defaultMarkdownSerializer=new MarkdownSerializer({blockquote(state,node){state.wrapBlock("> ",null,node,()=>state.renderContent(node))},code_block(state,node){let backticks=node.textContent.match(/`{3,}/gm),fence=backticks?backticks.sort().slice(-1)[0]+"`":"```";state.write(fence+(node.attrs.params||"")+"\n"),state.text(node.textContent,!1),state.write("\n"),state.write(fence),state.closeBlock(node)},heading(state,node){state.write(state.repeat("#",node.attrs.level)+" "),state.renderInline(node),state.closeBlock(node)},horizontal_rule(state,node){state.write(node.attrs.markup||"---"),state.closeBlock(node)},bullet_list(state,node){state.renderList(node,"  ",()=>(node.attrs.bullet||"*")+" ")},ordered_list(state,node){let start=node.attrs.order||1,maxW=String(start+node.childCount-1).length,space=state.repeat(" ",maxW+2);state.renderList(node,space,i=>{let nStr=String(start+i);return state.repeat(" ",maxW-nStr.length)+nStr+". "})},list_item(state,node){state.renderContent(node)},paragraph(state,node){state.renderInline(node),state.closeBlock(node)},image(state,node){state.write("!["+state.esc(node.attrs.alt||"")+"]("+node.attrs.src.replace(/[\(\)]/g,"\\$&")+(node.attrs.title?' "'+node.attrs.title.replace(/"/g,'\\"')+'"':"")+")")},hard_break(state,node,parent,index){for(let i=index+1;i<parent.childCount;i++)if(parent.child(i).type!=node.type){state.write("\\\n");return}},text(state,node){state.text(node.text,!state.inAutolink)}},{em:{open:"*",close:"*",mixable:!0,expelEnclosingWhitespace:!0},strong:{open:"**",close:"**",mixable:!0,expelEnclosingWhitespace:!0},link:{open:(state,mark,parent,index)=>(state.inAutolink=function(link,parent,index){if(link.attrs.title||!/^\w+:/.test(link.attrs.href))return!1;let content=parent.child(index);return!!content.isText&&content.text==link.attrs.href&&content.marks[content.marks.length-1]==link&&(index==parent.childCount-1||!link.isInSet(parent.child(index+1).marks))}(mark,parent,index),state.inAutolink?"<":"["),close(state,mark,parent,index){let{inAutolink}=state;return state.inAutolink=void 0,inAutolink?">":"]("+mark.attrs.href.replace(/[\(\)"]/g,"\\$&")+(mark.attrs.title?` "${mark.attrs.title.replace(/"/g,'\\"')}"`:"")+")"},mixable:!0},code:{open:(_state,_mark,parent,index)=>backticksFor(parent.child(index),-1),close:(_state,_mark,parent,index)=>backticksFor(parent.child(index-1),1),escape:!1}});function backticksFor(node,side){let ticks=/`+/g,m,len=0;if(node.isText)for(;m=ticks.exec(node.text);)len=Math.max(len,m[0].length);let result=len>0&&side>0?" `":"`";for(let i=0;i<len;i++)result+="`";return len>0&&side<0&&(result+=" "),result}class MarkdownSerializerState{constructor(nodes,marks,options){this.nodes=nodes,this.marks=marks,this.options=options,this.delim="",this.out="",this.closed=null,this.inAutolink=void 0,this.atBlockStart=!1,this.inTightList=!1,void 0===this.options.tightLists&&(this.options.tightLists=!1),void 0===this.options.hardBreakNodeName&&(this.options.hardBreakNodeName="hard_break")}flushClose(size=2){if(this.closed){if(this.atBlank()||(this.out+="\n"),size>1){let delimMin=this.delim,trim=/\s+$/.exec(delimMin);trim&&(delimMin=delimMin.slice(0,delimMin.length-trim[0].length));for(let i=1;i<size;i++)this.out+=delimMin+"\n"}this.closed=null}}wrapBlock(delim,firstDelim,node,f){let old=this.delim;this.write(null!=firstDelim?firstDelim:delim),this.delim+=delim,f(),this.delim=old,this.closeBlock(node)}atBlank(){return/(^|\n)$/.test(this.out)}ensureNewLine(){this.atBlank()||(this.out+="\n")}write(content){this.flushClose(),this.delim&&this.atBlank()&&(this.out+=this.delim),content&&(this.out+=content)}closeBlock(node){this.closed=node}text(text,escape=!0){let lines=text.split("\n");for(let i=0;i<lines.length;i++)this.write(),!escape&&"["==lines[i][0]&&/(^|[^\\])\!$/.test(this.out)&&(this.out=this.out.slice(0,this.out.length-1)+"\\!"),this.out+=escape?this.esc(lines[i],this.atBlockStart):lines[i],i!=lines.length-1&&(this.out+="\n")}render(node,parent,index){if("number"==typeof parent)throw Error("!");if(!this.nodes[node.type.name])throw Error("Token type `"+node.type.name+"` not supported by Markdown renderer");this.nodes[node.type.name](this,node,parent,index)}renderContent(parent){parent.forEach((node,_,i)=>this.render(node,parent,i))}renderInline(parent){this.atBlockStart=!0;let active=[],trailing="",progress=(node,offset,index)=>{let marks=node?node.marks:[];node&&node.type.name===this.options.hardBreakNodeName&&(marks=marks.filter(m=>{if(index+1==parent.childCount)return!1;let next=parent.child(index+1);return m.isInSet(next.marks)&&(!next.isText||/\S/.test(next.text))}));let leading=trailing;if(trailing="",node&&node.isText&&marks.some(mark=>{let info=this.marks[mark.type.name];return info&&info.expelEnclosingWhitespace&&!(mark.isInSet(active)||index<parent.childCount-1&&mark.isInSet(parent.child(index+1).marks))})){let[_,lead,inner,trail]=/^(\s*)(.*?)(\s*)$/m.exec(node.text);leading+=lead,trailing=trail,!lead&&!trail||(node=inner?node.withText(inner):null)||(marks=active)}let inner1=marks.length?marks[marks.length-1]:null,noEsc=inner1&&!1===this.marks[inner1.type.name].escape,len=marks.length-(noEsc?1:0);outer:for(let i=0;i<len;i++){let mark=marks[i];if(!this.marks[mark.type.name].mixable)break;for(let j=0;j<active.length;j++){let other=active[j];if(!this.marks[other.type.name].mixable)break;if(mark.eq(other)){i>j?marks=marks.slice(0,j).concat(mark).concat(marks.slice(j,i)).concat(marks.slice(i+1,len)):j>i&&(marks=marks.slice(0,i).concat(marks.slice(i+1,j)).concat(mark).concat(marks.slice(j,len)));continue outer}}}let keep=0;for(;keep<Math.min(active.length,len)&&marks[keep].eq(active[keep]);)++keep;for(;keep<active.length;)this.text(this.markString(active.pop(),!1,parent,index),!1);if(leading&&this.text(leading),node){for(;active.length<len;){let add=marks[active.length];active.push(add),this.text(this.markString(add,!0,parent,index),!1)}noEsc&&node.isText?this.text(this.markString(inner1,!0,parent,index)+node.text+this.markString(inner1,!1,parent,index+1),!1):this.render(node,parent,index)}};parent.forEach(progress),progress(null,0,parent.childCount),this.atBlockStart=!1}renderList(node,delim,firstDelim){this.closed&&this.closed.type==node.type?this.flushClose(3):this.inTightList&&this.flushClose(1);let isTight=void 0!==node.attrs.tight?node.attrs.tight:this.options.tightLists,prevTight=this.inTightList;this.inTightList=isTight,node.forEach((child,_,i)=>{i&&isTight&&this.flushClose(1),this.wrapBlock(delim,firstDelim(i),node,()=>this.render(child,node,i))}),this.inTightList=prevTight}esc(str,startOfLine=!1){return str=str.replace(/[`*\\~\[\]_]/g,(m,i)=>"_"==m&&i>0&&i+1<str.length&&str[i-1].match(/\w/)&&str[i+1].match(/\w/)?m:"\\"+m),startOfLine&&(str=str.replace(/^[#\-*+>]/,"\\$&").replace(/^(\s*\d+)\./,"$1\\.")),this.options.escapeExtraCharacters&&(str=str.replace(this.options.escapeExtraCharacters,"\\$&")),str}quote(str){let wrap=-1==str.indexOf('"')?'""':-1==str.indexOf("'")?"''":"()";return wrap[0]+str+wrap[1]}repeat(str,n){let out="";for(let i=0;i<n;i++)out+=str;return out}markString(mark,open,parent,index){let info=this.marks[mark.type.name],value=open?info.open:info.close;return"string"==typeof value?value:value(this,mark,parent,index)}getEnclosingWhitespace(text){return{leading:(text.match(/^(\s+)/)||[void 0])[0],trailing:(text.match(/(\s+)$/)||[void 0])[0]}}}var dist=(0,_commonjsHelpers_212d567a_js__WEBPACK_IMPORTED_MODULE_2__.c)(function(module,exports){var __importDefault=_commonjsHelpers_212d567a_js__WEBPACK_IMPORTED_MODULE_2__.a&&_commonjsHelpers_212d567a_js__WEBPACK_IMPORTED_MODULE_2__.a.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var token_1=__importDefault(Token),checkboxRegex=/^ *\[([\sx])] /i;exports.default=function(md,options){void 0===options&&(options={enabled:!1,label:!1,lineNumber:!1}),md.core.ruler.after("inline","task-lists",function(state){return function(state,options){for(var allTokens=state.tokens,i=2;i<allTokens.length;i++)if(function(tokens,index){var token;return"inline"===tokens[index].type&&"paragraph_open"===tokens[index-1].type&&"list_item_open"===tokens[index-2].type&&(token=tokens[index],checkboxRegex.test(token.content))}(allTokens,i)){(function(token,options){if(null!=token.children){var id=token.map?"task-item-".concat(token.map[0]):"task-item-".concat(Math.ceil(1e7*Math.random()-1e3));token.children.splice(0,0,function(token,enabled,id){var checkbox=new token_1.default("taskListItemCheckbox","",0);enabled||checkbox.attrSet("disabled","true"),token.map&&checkbox.attrSet("line",token.map[0].toString()),checkbox.attrSet("id",id);var checkboxRegexResult=checkboxRegex.exec(token.content);return(null==checkboxRegexResult?void 0:checkboxRegexResult[1].toLowerCase())==="x"&&checkbox.attrSet("checked","true"),checkbox}(token,options.enabled,id)),token.children[1].content=token.children[1].content.replace(checkboxRegex,""),options.label&&(token.children.splice(1,0,function(id){var labelBeginToken=new token_1.default("taskListItemLabel_open","",1);return labelBeginToken.attrSet("id",id),labelBeginToken}(id)),token.children.push(new token_1.default("taskListItemLabel_close","",-1)))}})(allTokens[i],options),allTokens[i-2].attrJoin("class","task-list-item ".concat(options.enabled?" enabled":""));var parentToken=function(tokens,index){for(var targetLevel=tokens[index].level-1,currentTokenIndex=index-1;currentTokenIndex>=0;currentTokenIndex--)if(tokens[currentTokenIndex].level===targetLevel)return tokens[currentTokenIndex]}(allTokens,i-2);parentToken&&parentToken.attrJoin("class","contains-task-list")}return!1}(state,options)}),md.renderer.rules.taskListItemCheckbox=function(tokens){var token=tokens[0],checkedAttribute=token.attrGet("checked")?'checked="" ':"",disabledAttribute=token.attrGet("disabled")?'disabled="" ':"",line=token.attrGet("line"),idAttribute='id="'.concat(token.attrGet("id"),'" '),dataLineAttribute=line&&options.lineNumber?'data-line="'.concat(line,'" '):"";return'<input class="task-list-item-checkbox" type="checkbox" '.concat(checkedAttribute).concat(disabledAttribute).concat(dataLineAttribute).concat(idAttribute,"/>")},md.renderer.rules.taskListItemLabel_close=function(){return"</label>"},md.renderer.rules.taskListItemLabel_open=function(tokens){var id=tokens[0].attrGet("id");return'<label for="'.concat(id,'">')}}});let taskLists=(0,_commonjsHelpers_212d567a_js__WEBPACK_IMPORTED_MODULE_2__.g)(dist),assign=(target,properties)=>{for(let key in properties)target[key]=properties[key];return target},numeric="numeric",ascii="ascii",alpha="alpha",asciinumeric="asciinumeric",alphanumeric="alphanumeric",domain="domain",emoji="emoji",whitespace="whitespace";function addToGroups(t,flags,groups){for(let k in flags[numeric]&&(flags[asciinumeric]=!0,flags[alphanumeric]=!0),flags[ascii]&&(flags[asciinumeric]=!0,flags[alpha]=!0),flags[asciinumeric]&&(flags[alphanumeric]=!0),flags[alpha]&&(flags[alphanumeric]=!0),flags[alphanumeric]&&(flags[domain]=!0),flags[emoji]&&(flags[domain]=!0),flags){var name,groups1;let group=((name=k)in(groups1=groups)||(groups1[name]=[]),groups1[name]);0>group.indexOf(t)&&group.push(t)}}function State(token){void 0===token&&(token=null),this.j={},this.jr=[],this.jd=null,this.t=token}State.groups={},State.prototype={accepts(){return!!this.t},go(input){let nextState=this.j[input];if(nextState)return nextState;for(let i=0;i<this.jr.length;i++){let regex=this.jr[i][0],nextState1=this.jr[i][1];if(nextState1&&regex.test(input))return nextState1}return this.jd},has(input,exactOnly){return void 0===exactOnly&&(exactOnly=!1),exactOnly?input in this.j:!!this.go(input)},ta(inputs,next,flags,groups){for(let i=0;i<inputs.length;i++)this.tt(inputs[i],next,flags,groups)},tr(regexp,next,flags,groups){let nextState;return groups=groups||State.groups,next&&next.j?nextState=next:(nextState=new State(next),flags&&groups&&addToGroups(next,flags,groups)),this.jr.push([regexp,nextState]),nextState},ts(input,next,flags,groups){let state=this,len=input.length;if(!len)return state;for(let i=0;i<len-1;i++)state=state.tt(input[i]);return state.tt(input[len-1],next,flags,groups)},tt(input,next,flags,groups){groups=groups||State.groups;let state=this;if(next&&next.j)return state.j[input]=next,next;let nextState,templateState=state.go(input);if(templateState?(assign((nextState=new State).j,templateState.j),nextState.jr.push.apply(nextState.jr,templateState.jr),nextState.jd=templateState.jd,nextState.t=templateState.t):nextState=new State,next){if(groups){if(nextState.t&&"string"==typeof nextState.t){let allFlags=assign(function(t,groups){let result={};for(let c in groups)groups[c].indexOf(t)>=0&&(result[c]=!0);return result}(nextState.t,groups),flags);addToGroups(next,allFlags,groups)}else flags&&addToGroups(next,flags,groups)}nextState.t=next}return state.j[input]=nextState,nextState}};let ta=(state,input,next,flags,groups)=>state.ta(input,next,flags,groups),tr=(state,regexp,next,flags,groups)=>state.tr(regexp,next,flags,groups),ts=(state,input,next,flags,groups)=>state.ts(input,next,flags,groups),tt=(state,input,next,flags,groups)=>state.tt(input,next,flags,groups),WORD="WORD",UWORD="UWORD",LOCALHOST="LOCALHOST",UTLD="UTLD",SCHEME="SCHEME",SLASH_SCHEME="SLASH_SCHEME",OPENBRACE="OPENBRACE",OPENBRACKET="OPENBRACKET",OPENANGLEBRACKET="OPENANGLEBRACKET",OPENPAREN="OPENPAREN",CLOSEBRACE="CLOSEBRACE",CLOSEBRACKET="CLOSEBRACKET",CLOSEANGLEBRACKET="CLOSEANGLEBRACKET",CLOSEPAREN="CLOSEPAREN",AMPERSAND="AMPERSAND",APOSTROPHE="APOSTROPHE",ASTERISK="ASTERISK",BACKSLASH="BACKSLASH",BACKTICK="BACKTICK",CARET="CARET",COLON="COLON",COMMA="COMMA",DOLLAR="DOLLAR",EQUALS="EQUALS",EXCLAMATION="EXCLAMATION",HYPHEN="HYPHEN",PERCENT="PERCENT",PIPE="PIPE",PLUS="PLUS",POUND="POUND",QUERY="QUERY",QUOTE="QUOTE",SEMI="SEMI",SLASH="SLASH",TILDE="TILDE",UNDERSCORE="UNDERSCORE",EMOJI$1="EMOJI";var tk=Object.freeze({__proto__:null,WORD:WORD,UWORD:UWORD,LOCALHOST:LOCALHOST,TLD:"TLD",UTLD:UTLD,SCHEME:SCHEME,SLASH_SCHEME:SLASH_SCHEME,NUM:"NUM",WS:"WS",NL:"NL",OPENBRACE:OPENBRACE,OPENBRACKET:OPENBRACKET,OPENANGLEBRACKET:OPENANGLEBRACKET,OPENPAREN:OPENPAREN,CLOSEBRACE:CLOSEBRACE,CLOSEBRACKET:CLOSEBRACKET,CLOSEANGLEBRACKET:CLOSEANGLEBRACKET,CLOSEPAREN:CLOSEPAREN,AMPERSAND:AMPERSAND,APOSTROPHE:APOSTROPHE,ASTERISK:ASTERISK,AT:"AT",BACKSLASH:BACKSLASH,BACKTICK:BACKTICK,CARET:CARET,COLON:COLON,COMMA:COMMA,DOLLAR:DOLLAR,DOT:"DOT",EQUALS:EQUALS,EXCLAMATION:EXCLAMATION,HYPHEN:HYPHEN,PERCENT:PERCENT,PIPE:PIPE,PLUS:PLUS,POUND:POUND,QUERY:QUERY,QUOTE:QUOTE,SEMI:SEMI,SLASH:SLASH,TILDE:TILDE,UNDERSCORE:UNDERSCORE,EMOJI:EMOJI$1,SYM:"SYM"});let ASCII_LETTER=/[a-z]/,LETTER=/\p{L}/u,EMOJI=/\p{Emoji}/u,DIGIT=/\d/,SPACE=/\s/,tlds=null,utlds=null;function fastts(state,input,t,defaultt,jr){let next;let len=input.length;for(let i=0;i<len-1;i++){let char=input[i];state.j[char]?next=state.j[char]:((next=new State(defaultt)).jr=jr.slice(),state.j[char]=next),state=next}return(next=new State(t)).jr=jr.slice(),state.j[input[len-1]]=next,next}function decodeTlds(encoded){let words=[],stack=[],i=0;for(;i<encoded.length;){let popDigitCount=0;for(;"0123456789".indexOf(encoded[i+popDigitCount])>=0;)popDigitCount++;if(popDigitCount>0){words.push(stack.join(""));let popCount=parseInt(encoded.substring(i,i+popDigitCount),10);for(;popCount>0;popCount--)stack.pop();i+=popDigitCount}else"_"===encoded[i]?(words.push(stack.join("")),i++):(stack.push(encoded[i]),i++)}return words}let defaults={defaultProtocol:"http",events:null,format:noop,formatHref:noop,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Options(opts,defaultRender){void 0===defaultRender&&(defaultRender=null);let o=assign({},defaults);opts&&(o=assign(o,opts instanceof Options?opts.o:opts));let ignoredTags=o.ignoreTags,uppercaseIgnoredTags=[];for(let i=0;i<ignoredTags.length;i++)uppercaseIgnoredTags.push(ignoredTags[i].toUpperCase());this.o=o,defaultRender&&(this.defaultRender=defaultRender),this.ignoreTags=uppercaseIgnoredTags}function noop(val){return val}function MultiToken(value,tokens){this.t="token",this.v=value,this.tk=tokens}function createTokenClass(type,props){class Token extends MultiToken{constructor(value,tokens){super(value,tokens),this.t=type}}for(let p in props)Token.prototype[p]=props[p];return Token.t=type,Token}Options.prototype={o:defaults,ignoreTags:[],defaultRender:ir=>ir,check(token){return this.get("validate",token.toString(),token)},get(key,operator,token){let isCallable=null!=operator,option=this.o[key];return option&&("object"==typeof option?"function"==typeof(option=token.t in option?option[token.t]:defaults[key])&&isCallable&&(option=option(operator,token)):"function"==typeof option&&isCallable&&(option=option(operator,token.t,token))),option},getObj(key,operator,token){let obj=this.o[key];return"function"==typeof obj&&null!=operator&&(obj=obj(operator,token.t,token)),obj},render(token){let ir=token.render(this),renderFn=this.get("render",null,token)||this.defaultRender;return renderFn(ir,token.t,token)}},MultiToken.prototype={isLink:!1,toString(){return this.v},toHref(scheme){return this.toString()},toFormattedString(options){let val=this.toString(),truncate=options.get("truncate",val,this),formatted=options.get("format",val,this);return truncate&&formatted.length>truncate?formatted.substring(0,truncate)+"…":formatted},toFormattedHref(options){return options.get("formatHref",this.toHref(options.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(protocol){return void 0===protocol&&(protocol=defaults.defaultProtocol),{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(protocol),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(options){return{type:this.t,value:this.toFormattedString(options),isLink:this.isLink,href:this.toFormattedHref(options),start:this.startIndex(),end:this.endIndex()}},validate(options){return options.get("validate",this.toString(),this)},render(options){let href=this.toFormattedHref(options),tagName=options.get("tagName",href,this),content=this.toFormattedString(options),attributes={},className=options.get("className",href,this),target=options.get("target",href,this),rel=options.get("rel",href,this),attrs=options.getObj("attributes",href,this),eventListeners=options.getObj("events",href,this);return attributes.href=href,className&&(attributes.class=className),target&&(attributes.target=target),rel&&(attributes.rel=rel),attrs&&assign(attributes,attrs),{tagName,attributes,content,eventListeners}}};let Email=createTokenClass("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Text$1=createTokenClass("text"),Nl=createTokenClass("nl"),Url=createTokenClass("url",{isLink:!0,toHref(scheme){return void 0===scheme&&(scheme=defaults.defaultProtocol),this.hasProtocol()?this.v:`${scheme}://${this.v}`},hasProtocol(){let tokens=this.tk;return tokens.length>=2&&tokens[0].t!==LOCALHOST&&tokens[1].t===COLON}}),makeState=arg=>new State(arg);function initMultiToken(Multi,input,tokens){let startIdx=tokens[0].s,endIdx=tokens[tokens.length-1].e,value=input.slice(startIdx,endIdx);return new Multi(value,tokens)}let warn="undefined"!=typeof console&&console&&console.warn||(()=>{}),INIT={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function registerCustomProtocol(scheme,optionalSlashSlash){if(void 0===optionalSlashSlash&&(optionalSlashSlash=!1),INIT.initialized&&warn(`linkifyjs: already initialized - will not register custom scheme "${scheme}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(scheme))throw Error('linkifyjs: incorrect scheme format.\n 1. Must only contain digits, lowercase ASCII letters or "-"\n 2. Cannot start or end with "-"\n 3. "-" cannot repeat');INIT.customSchemes.push([scheme,optionalSlashSlash])}function tokenize(str){return INIT.initialized||function(){INIT.scanner=function(customSchemes){void 0===customSchemes&&(customSchemes=[]);let groups={};State.groups=groups;let Start=new State;null==tlds&&(tlds=decodeTlds("aaa1rp3barth4b_ott3vie4c1le2ogado5udhabi7c_ademy5centure6ountant_s9o1tor4d_s1ult4e_g1ro2tna4f_l1rica5g_akhan5ency5i_g1rbus3force5tel5kdn3l_faromeo7ibaba4pay4lfinanz6state5y2sace3tom5m_azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o_l2partments8p_le4q_uarelle8r_ab1mco4chi3my2pa2t_e3s_da2ia2sociates9t_hleta5torney7u_ction5di_ble3o3spost5thor3o_s4vianca6w_s2x_a2z_ure5ba_by2idu3namex3narepublic11d1k2r_celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b_c1t1va3cg1n2d1e_ats2uty4er2ntley5rlin4st_buy5t2f1g1h_arti5i_ble3d1ke2ng_o3o1z2j1lack_friday9ockbuster8g1omberg7ue3m_s1w2n_pparibas9o_ats3ehringer8fa2m1nd2o_k_ing5sch2tik2on4t1utique6x2r_adesco6idgestone9oadway5ker3ther5ussels7s1t1uild_ers6siness6y1zz3v1w1y1z_h3ca_b1fe2l_l1vinklein9m_era3p2non3petown5ital_one8r_avan4ds2e_er_s4s2sa1e1h1ino4t_ering5holic7ba1n1re2s2c1d1enter4o1rn3f_a1d2g1h_anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i_priani6rcle4sco3tadel4i_c2y_eats7k1l_aims4eaning6ick2nic1que6othing5ud3ub_med6m1n1o_ach3des3ffee4llege4ogne5m_cast4mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking_channel11l1p2rsica5untry4pon_s4rses6pa2r_edit_card4union9icket5own3s1uise_s6u_isinella9v1w1x1y_mru3ou3z2dabur3d1nce3ta1e1ing3sun4y2clk3ds2e_al_er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si_gn4v2hl2iamonds6et2gital5rect_ory7scount3ver5h2y2j1k1m1np2o_cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c_o2deka3u_cation8e1g1mail3erck5nergy4gineer_ing9terprises10pson4quipment8r_icsson6ni3s_q1tate5t_isalat7u_rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n_s2rm_ers5shion4t3edex3edback6rrari3ero6i_at2delity5o2lm2nal1nce1ial7re_stone6mdale6sh_ing5t_ness6j1k1lickr3ghts4r2orist4wers5y2m1o_o_d_network8tball6rd1ex2sale4um3undation8x2r_ee1senius7l1ogans4ntdoor4ier7tr2ujitsu5n_d2rniture7tbol5yi3ga_l_lery3o1up4me_s3p1rden4y2b_iz3d_n2e_a1nt_ing5orge5f1g_ee3h1i_ft_s3ves2ing5l_ass3e1obal2o4m_ail3bh2o1x2n1odaddy5ld_point6f2o_dyear5g_le4p1t1v2p1q1r_ainger5phics5tis4een3ipe3ocery4up4s1t1u_ardian6cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc_bank7ealth_care8lp1sinki6re1mes5gtv3iphop4samitsu7tachi5v2k_t2m1n1ockey4ldings5iday5medepot5goods5s_ense7nda3rse3spital5t_ing5t_eles2s3mail5use3w2r1sbc3t1u_ghes5yatt3undai7ibm2cbc2e1u2d1e_ee3fm2kano4l1m_amat4db2mo_bilien9n_c1dustries8finiti5o2g1k1stitute6urance4e4t_ernational10uit4vestments10o1piranga7q1r_ish4s_maili5t_anbul7t_au2v3jaguar4va3cb2e_ep2tzt3welry6io2ll2m_p2nj2o_bs1urg4t1y2p_morgan6rs3uegos4niper7kaufen5ddi3e_rryhotels6logistics9properties14fh2g1h1i_a1ds2m1nder2le4tchen5wi3m1n1oeln3matsu5sher5p_mg2n2r_d1ed3uokgroup8w1y_oto4z2la_caixa5mborghini8er3ncaster5ia3d_rover6xess5salle5t_ino3robe5w_yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i_dl2fe_insurance9style7ghting6ke2lly3mited4o2ncoln4de2k2psy3ve1ing5k1lc1p2oan_s3cker3us3l1ndon4tte1o3ve3pl_financial11r1s1t_d_a3u_ndbeck6xe1ury5v1y2ma_cys3drid4if1son4keup4n_agement7go3p1rket_ing3s4riott5shalls7serati6ttel5ba2c_kinsey7d1e_d_ia3et2lbourne7me1orial6n_u2rckmsd7g1h1iami3crosoft7l1ni1t2t_subishi9k1l_b1s2m_a2n1o_bi_le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to_rcycles9v_ie4p1q1r1s_d2t_n1r2u_seum3ic3tual5v1w1x1y1z2na_b1goya4me2tura4vy3ba2c1e_c1t_bank4flix4work5ustar5w_s2xt_direct7us4f_l2g_o2hk2i_co2ke1on3nja3ssan1y5l1o_kia3rthwesternmutual14on4w_ruz3tv4p1r_a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan_group9dnavy5lo3m_ega4ne1g1l_ine5oo2pen3racle3nge4g_anic5igins6saka4tsuka4t2vh3pa_ge2nasonic7ris2s1tners4s1y3ssagens7y2ccw3e_t2f_izer5g1h_armacy6d1ilips5one2to_graphy6s4ysio5ics1tet2ures6d1n_g1k2oneer5zza4k1l_ace2y_station9umbing5s3m1n_c2ohl2ker3litie5rn2st3r_america6xi3ess3ime3o_d_uctions8f1gressive8mo2perties3y5tection8u_dential9s1t1ub2w_c2y2qa1pon3uebec3st5racing4dio4e_ad1lestate6tor2y4cipes5d_stone5umbrella9hab3ise_n3t2liance6n_t_als5pair3ort3ublican8st_aurant8view_s5xroth6ich_ardli6oh3l1o1p2o_cher3ks3deo3gers4om3s_vp3u_gby3hr2n2w_e2yukyu6sa_arland6fe_ty4kura4le1on3msclub4ung5ndvik_coromant12ofi4p1rl2s1ve2xo3b_i1s2c_a1b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e_arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x_y3fr2g1h_angrila6rp2w2ell3ia1ksha5oes2p_ping5uji3w_time7i_lk2na1gles5te3j1k_i_n2y_pe4l_ing4m_art3ile4n_cf3o_ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa_ce3ort2t3r_l2s1t_ada2ples4r1tebank4farm7c_group6ockholm6rage3e3ream4udio2y3yle4u_cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y_dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x_i3c_i2d_k2eam2ch_nology8l1masek5nnis4va3f1g1h_d1eater2re6iaa2ckets5enda4ffany5ps2res2ol4j_maxx4x2k_maxx5l1m_all4n1o_day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r_ade1ing4ining5vel_channel7ers_insurance16ust3v2t1ube2i1nes3shu4v_s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va_cations7na1guard7c1e_gas3ntures6risign5m\xf6gensberater2ung14sicherung10t2g1i_ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lkswagen7vo3te1ing3o2yage5u_elos6wales2mart4ter4ng_gou5tch_es6eather_channel12bcam3er2site5d_ding5ibo2r3f1hoswho6ien2ki2lliamhill9n_dows4e1ners6me2olterskluwer11odside6rk_s2ld3w2s1tc1f3xbox3erox4finity6ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u_tube6t1un3za_ppos4ra3ero3ip2m1one3uerich6w2")),null==utlds&&(utlds=decodeTlds("ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5تصالات6رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत_म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里_大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2")),tt(Start,"'",APOSTROPHE),tt(Start,"{",OPENBRACE),tt(Start,"[",OPENBRACKET),tt(Start,"<",OPENANGLEBRACKET),tt(Start,"(",OPENPAREN),tt(Start,"}",CLOSEBRACE),tt(Start,"]",CLOSEBRACKET),tt(Start,">",CLOSEANGLEBRACKET),tt(Start,")",CLOSEPAREN),tt(Start,"&",AMPERSAND),tt(Start,"*",ASTERISK),tt(Start,"@","AT"),tt(Start,"`",BACKTICK),tt(Start,"^",CARET),tt(Start,":",COLON),tt(Start,",",COMMA),tt(Start,"$",DOLLAR),tt(Start,".","DOT"),tt(Start,"=",EQUALS),tt(Start,"!",EXCLAMATION),tt(Start,"-",HYPHEN),tt(Start,"%",PERCENT),tt(Start,"|",PIPE),tt(Start,"+",PLUS),tt(Start,"#",POUND),tt(Start,"?",QUERY),tt(Start,'"',QUOTE),tt(Start,"/",SLASH),tt(Start,";",SEMI),tt(Start,"~",TILDE),tt(Start,"_",UNDERSCORE),tt(Start,"\\",BACKSLASH);let Num=tr(Start,DIGIT,"NUM",{[numeric]:!0});tr(Num,DIGIT,Num);let Word=tr(Start,ASCII_LETTER,WORD,{[ascii]:!0});tr(Word,ASCII_LETTER,Word);let UWord=tr(Start,LETTER,UWORD,{[alpha]:!0});tr(UWord,ASCII_LETTER),tr(UWord,LETTER,UWord);let Ws=tr(Start,SPACE,"WS",{[whitespace]:!0});tt(Start,"\n","NL",{[whitespace]:!0}),tt(Ws,"\n"),tr(Ws,SPACE,Ws);let Emoji=tr(Start,EMOJI,EMOJI$1,{[emoji]:!0});tr(Emoji,EMOJI,Emoji),tt(Emoji,"️",Emoji);let EmojiJoiner=tt(Emoji,"‍");tr(EmojiJoiner,EMOJI,Emoji);let wordjr=[[ASCII_LETTER,Word]],uwordjr=[[ASCII_LETTER,null],[LETTER,UWord]];for(let i=0;i<tlds.length;i++)fastts(Start,tlds[i],"TLD",WORD,wordjr);for(let i1=0;i1<utlds.length;i1++)fastts(Start,utlds[i1],UTLD,UWORD,uwordjr);addToGroups("TLD",{tld:!0,ascii:!0},groups),addToGroups(UTLD,{utld:!0,alpha:!0},groups),fastts(Start,"file",SCHEME,WORD,wordjr),fastts(Start,"mailto",SCHEME,WORD,wordjr),fastts(Start,"http",SLASH_SCHEME,WORD,wordjr),fastts(Start,"https",SLASH_SCHEME,WORD,wordjr),fastts(Start,"ftp",SLASH_SCHEME,WORD,wordjr),fastts(Start,"ftps",SLASH_SCHEME,WORD,wordjr),addToGroups(SCHEME,{scheme:!0,ascii:!0},groups),addToGroups(SLASH_SCHEME,{slashscheme:!0,ascii:!0},groups),customSchemes=customSchemes.sort((a,b)=>a[0]>b[0]?1:-1);for(let i2=0;i2<customSchemes.length;i2++){let sch=customSchemes[i2][0],optionalSlashSlash=customSchemes[i2][1],flags=optionalSlashSlash?{scheme:!0}:{slashscheme:!0};sch.indexOf("-")>=0?flags[domain]=!0:ASCII_LETTER.test(sch)?DIGIT.test(sch)?flags[asciinumeric]=!0:flags[ascii]=!0:flags[numeric]=!0,ts(Start,sch,sch,flags)}return ts(Start,"localhost",LOCALHOST,{ascii:!0}),Start.jd=new State("SYM"),{start:Start,tokens:assign({groups},tk)}}(INIT.customSchemes);for(let i=0;i<INIT.tokenQueue.length;i++)INIT.tokenQueue[i][1]({scanner:INIT.scanner});INIT.parser=function(_ref){let{groups}=_ref,qsAccepting=groups.domain.concat([AMPERSAND,ASTERISK,"AT",BACKSLASH,BACKTICK,CARET,DOLLAR,EQUALS,HYPHEN,"NUM",PERCENT,PIPE,PLUS,POUND,SLASH,"SYM",TILDE,UNDERSCORE]),qsNonAccepting=[APOSTROPHE,CLOSEANGLEBRACKET,CLOSEBRACE,CLOSEBRACKET,CLOSEPAREN,COLON,COMMA,"DOT",EXCLAMATION,OPENANGLEBRACKET,OPENBRACE,OPENBRACKET,OPENPAREN,QUERY,QUOTE,SEMI],localpartAccepting=[AMPERSAND,APOSTROPHE,ASTERISK,BACKSLASH,BACKTICK,CARET,CLOSEBRACE,DOLLAR,EQUALS,HYPHEN,"NUM",OPENBRACE,PERCENT,PIPE,PLUS,POUND,QUERY,SLASH,"SYM",TILDE,UNDERSCORE],Start=makeState(),Localpart=tt(Start,TILDE);ta(Localpart,localpartAccepting,Localpart),ta(Localpart,groups.domain,Localpart);let Domain=makeState(),Scheme=makeState(),SlashScheme=makeState();ta(Start,groups.domain,Domain),ta(Start,groups.scheme,Scheme),ta(Start,groups.slashscheme,SlashScheme),ta(Domain,localpartAccepting,Localpart),ta(Domain,groups.domain,Domain);let LocalpartAt=tt(Domain,"AT");tt(Localpart,"AT",LocalpartAt),tt(Scheme,"AT",LocalpartAt),tt(SlashScheme,"AT",LocalpartAt);let LocalpartDot=tt(Localpart,"DOT");ta(LocalpartDot,localpartAccepting,Localpart),ta(LocalpartDot,groups.domain,Localpart);let EmailDomain=makeState();ta(LocalpartAt,groups.domain,EmailDomain),ta(EmailDomain,groups.domain,EmailDomain);let EmailDomainDot=tt(EmailDomain,"DOT");ta(EmailDomainDot,groups.domain,EmailDomain);let Email$1=makeState(Email);ta(EmailDomainDot,groups.tld,Email$1),ta(EmailDomainDot,groups.utld,Email$1),tt(LocalpartAt,LOCALHOST,Email$1);let EmailDomainHyphen=tt(EmailDomain,HYPHEN);ta(EmailDomainHyphen,groups.domain,EmailDomain),ta(Email$1,groups.domain,EmailDomain),tt(Email$1,"DOT",EmailDomainDot),tt(Email$1,HYPHEN,EmailDomainHyphen);let EmailColon=tt(Email$1,COLON);ta(EmailColon,groups.numeric,Email);let DomainHyphen=tt(Domain,HYPHEN),DomainDot=tt(Domain,"DOT");ta(DomainHyphen,groups.domain,Domain),ta(DomainDot,localpartAccepting,Localpart),ta(DomainDot,groups.domain,Domain);let DomainDotTld=makeState(Url);ta(DomainDot,groups.tld,DomainDotTld),ta(DomainDot,groups.utld,DomainDotTld),ta(DomainDotTld,groups.domain,Domain),ta(DomainDotTld,localpartAccepting,Localpart),tt(DomainDotTld,"DOT",DomainDot),tt(DomainDotTld,HYPHEN,DomainHyphen),tt(DomainDotTld,"AT",LocalpartAt);let DomainDotTldColon=tt(DomainDotTld,COLON),DomainDotTldColonPort=makeState(Url);ta(DomainDotTldColon,groups.numeric,DomainDotTldColonPort);let Url$1=makeState(Url),UrlNonaccept=makeState();ta(Url$1,qsAccepting,Url$1),ta(Url$1,qsNonAccepting,UrlNonaccept),ta(UrlNonaccept,qsAccepting,Url$1),ta(UrlNonaccept,qsNonAccepting,UrlNonaccept),tt(DomainDotTld,SLASH,Url$1),tt(DomainDotTldColonPort,SLASH,Url$1);let UriPrefix=tt(Scheme,COLON),SlashSchemeColon=tt(SlashScheme,COLON),SlashSchemeColonSlash=tt(SlashSchemeColon,SLASH);tt(SlashSchemeColonSlash,SLASH,UriPrefix),ta(Scheme,groups.domain,Domain),tt(Scheme,"DOT",DomainDot),tt(Scheme,HYPHEN,DomainHyphen),ta(SlashScheme,groups.domain,Domain),tt(SlashScheme,"DOT",DomainDot),tt(SlashScheme,HYPHEN,DomainHyphen),ta(UriPrefix,groups.domain,Url$1),tt(UriPrefix,SLASH,Url$1);let UrlOpenbrace=tt(Url$1,OPENBRACE),UrlOpenbracket=tt(Url$1,OPENBRACKET),UrlOpenanglebracket=tt(Url$1,OPENANGLEBRACKET),UrlOpenparen=tt(Url$1,OPENPAREN);tt(UrlNonaccept,OPENBRACE,UrlOpenbrace),tt(UrlNonaccept,OPENBRACKET,UrlOpenbracket),tt(UrlNonaccept,OPENANGLEBRACKET,UrlOpenanglebracket),tt(UrlNonaccept,OPENPAREN,UrlOpenparen),tt(UrlOpenbrace,CLOSEBRACE,Url$1),tt(UrlOpenbracket,CLOSEBRACKET,Url$1),tt(UrlOpenanglebracket,CLOSEANGLEBRACKET,Url$1),tt(UrlOpenparen,CLOSEPAREN,Url$1),tt(UrlOpenbrace,CLOSEBRACE,Url$1);let UrlOpenbraceQ=makeState(Url),UrlOpenbracketQ=makeState(Url),UrlOpenanglebracketQ=makeState(Url),UrlOpenparenQ=makeState(Url);ta(UrlOpenbrace,qsAccepting,UrlOpenbraceQ),ta(UrlOpenbracket,qsAccepting,UrlOpenbracketQ),ta(UrlOpenanglebracket,qsAccepting,UrlOpenanglebracketQ),ta(UrlOpenparen,qsAccepting,UrlOpenparenQ);let UrlOpenbraceSyms=makeState(),UrlOpenbracketSyms=makeState(),UrlOpenanglebracketSyms=makeState(),UrlOpenparenSyms=makeState();return ta(UrlOpenbrace,qsNonAccepting),ta(UrlOpenbracket,qsNonAccepting),ta(UrlOpenanglebracket,qsNonAccepting),ta(UrlOpenparen,qsNonAccepting),ta(UrlOpenbraceQ,qsAccepting,UrlOpenbraceQ),ta(UrlOpenbracketQ,qsAccepting,UrlOpenbracketQ),ta(UrlOpenanglebracketQ,qsAccepting,UrlOpenanglebracketQ),ta(UrlOpenparenQ,qsAccepting,UrlOpenparenQ),ta(UrlOpenbraceQ,qsNonAccepting,UrlOpenbraceQ),ta(UrlOpenbracketQ,qsNonAccepting,UrlOpenbracketQ),ta(UrlOpenanglebracketQ,qsNonAccepting,UrlOpenanglebracketQ),ta(UrlOpenparenQ,qsNonAccepting,UrlOpenparenQ),ta(UrlOpenbraceSyms,qsAccepting,UrlOpenbraceSyms),ta(UrlOpenbracketSyms,qsAccepting,UrlOpenbracketQ),ta(UrlOpenanglebracketSyms,qsAccepting,UrlOpenanglebracketQ),ta(UrlOpenparenSyms,qsAccepting,UrlOpenparenQ),ta(UrlOpenbraceSyms,qsNonAccepting,UrlOpenbraceSyms),ta(UrlOpenbracketSyms,qsNonAccepting,UrlOpenbracketSyms),ta(UrlOpenanglebracketSyms,qsNonAccepting,UrlOpenanglebracketSyms),ta(UrlOpenparenSyms,qsNonAccepting,UrlOpenparenSyms),tt(UrlOpenbracketQ,CLOSEBRACKET,Url$1),tt(UrlOpenanglebracketQ,CLOSEANGLEBRACKET,Url$1),tt(UrlOpenparenQ,CLOSEPAREN,Url$1),tt(UrlOpenbraceQ,CLOSEBRACE,Url$1),tt(UrlOpenbracketSyms,CLOSEBRACKET,Url$1),tt(UrlOpenanglebracketSyms,CLOSEANGLEBRACKET,Url$1),tt(UrlOpenparenSyms,CLOSEPAREN,Url$1),tt(UrlOpenbraceSyms,CLOSEPAREN,Url$1),tt(Start,LOCALHOST,DomainDotTld),tt(Start,"NL",Nl),{start:Start,tokens:tk}}(INIT.scanner.tokens);for(let i1=0;i1<INIT.pluginQueue.length;i1++)INIT.pluginQueue[i1][1]({scanner:INIT.scanner,parser:INIT.parser});INIT.initialized=!0}(),function(start,input,tokens){let len=tokens.length,cursor=0,multis=[],textTokens=[];for(;cursor<len;){let state=start,secondState=null,nextState=null,multiLength=0,latestAccepting=null,sinceAccepts=-1;for(;cursor<len&&!(secondState=state.go(tokens[cursor].t));)textTokens.push(tokens[cursor++]);for(;cursor<len&&(nextState=secondState||state.go(tokens[cursor].t));)secondState=null,(state=nextState).accepts()?(sinceAccepts=0,latestAccepting=state):sinceAccepts>=0&&sinceAccepts++,cursor++,multiLength++;if(sinceAccepts<0)(cursor-=multiLength)<len&&(textTokens.push(tokens[cursor]),cursor++);else{textTokens.length>0&&(multis.push(initMultiToken(Text$1,input,textTokens)),textTokens=[]),cursor-=sinceAccepts,multiLength-=sinceAccepts;let Multi=latestAccepting.t,subtokens=tokens.slice(cursor-multiLength,cursor);multis.push(initMultiToken(Multi,input,subtokens))}}return textTokens.length>0&&multis.push(initMultiToken(Text$1,input,textTokens)),multis}(INIT.parser.start,str,function(start,str){let iterable=function(str){let result=[],len=str.length,index=0;for(;index<len;){let second,first=str.charCodeAt(index),char=first<55296||first>56319||index+1===len||(second=str.charCodeAt(index+1))<56320||second>57343?str[index]:str.slice(index,index+2);result.push(char),index+=char.length}return result}(str.replace(/[A-Z]/g,c=>c.toLowerCase())),charCount=iterable.length,tokens=[],cursor=0,charCursor=0;for(;charCursor<charCount;){let state=start,nextState=null,tokenLength=0,latestAccepting=null,sinceAccepts=-1,charsSinceAccepts=-1;for(;charCursor<charCount&&(nextState=state.go(iterable[charCursor]));)(state=nextState).accepts()?(sinceAccepts=0,charsSinceAccepts=0,latestAccepting=state):sinceAccepts>=0&&(sinceAccepts+=iterable[charCursor].length,charsSinceAccepts++),tokenLength+=iterable[charCursor].length,cursor+=iterable[charCursor].length,charCursor++;cursor-=sinceAccepts,charCursor-=charsSinceAccepts,tokenLength-=sinceAccepts,tokens.push({t:latestAccepting.t,v:str.slice(cursor-tokenLength,cursor),s:cursor-tokenLength,e:cursor})}return tokens}(INIT.scanner.start,str))}function find(str,type,opts){if(void 0===type&&(type=null),void 0===opts&&(opts=null),type&&"object"==typeof type){if(opts)throw Error(`linkifyjs: Invalid link type ${type}; must be a string`);opts=type,type=null}let options=new Options(opts),tokens=tokenize(str),filtered=[];for(let i=0;i<tokens.length;i++){let token=tokens[i];token.isLink&&(!type||token.t===type)&&filtered.push(token.toFormattedObject(options))}return filtered}function test(str,type){void 0===type&&(type=null);let tokens=tokenize(str);return 1===tokens.length&&tokens[0].isLink&&(!type||tokens[0].t===type)}let Link=Mark.create({name:"link",priority:1e3,keepOnSplit:!1,onCreate(){this.options.protocols.forEach(protocol=>{if("string"==typeof protocol){registerCustomProtocol(protocol);return}registerCustomProtocol(protocol.scheme,protocol.optionalSlashes)})},onDestroy(){State.groups={},INIT.scanner=null,INIT.parser=null,INIT.tokenQueue=[],INIT.pluginQueue=[],INIT.customSchemes=[],INIT.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:void 0}),addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},class:{default:this.options.HTMLAttributes.class}}},parseHTML:()=>[{tag:'a[href]:not([href *= "javascript:" i])'}],renderHTML({HTMLAttributes}){return["a",mergeAttributes(this.options.HTMLAttributes,HTMLAttributes),0]},addCommands(){return{setLink:attributes=>({chain})=>chain().setMark(this.name,attributes).setMeta("preventAutolink",!0).run(),toggleLink:attributes=>({chain})=>chain().toggleMark(this.name,attributes,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain})=>chain().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[markPasteRule({find:text=>find(text).filter(link=>!this.options.validate||this.options.validate(link.value)).filter(link=>link.isLink).map(link=>({text:link.value,index:link.start,data:link})),type:this.type,getAttributes(match){var _a;return{href:null===(_a=match.data)||void 0===_a?void 0:_a.href}}})]},addProseMirrorPlugins(){var options,options1,options2;let plugins=[];return this.options.autolink&&plugins.push((options={type:this.type,validate:this.options.validate},new Plugin({key:new PluginKey("autolink"),appendTransaction(transactions,oldState,newState){let docChanges=transactions.some(transaction=>transaction.docChanged)&&!oldState.doc.eq(newState.doc),preventAutolink=transactions.some(transaction=>transaction.getMeta("preventAutolink"));if(!docChanges||preventAutolink)return;let{tr}=newState,transform=function(oldDoc,transactions){let transform=new Transform(oldDoc);return transactions.forEach(transaction=>{transaction.steps.forEach(step=>{transform.step(step)})}),transform}(oldState.doc,[...transactions]),{mapping}=transform,changes=function(transform){let{mapping,steps}=transform,changes=[];return mapping.maps.forEach((stepMap,index)=>{let ranges=[];if(stepMap.ranges.length)stepMap.forEach((from,to)=>{ranges.push({from,to})});else{let{from,to}=steps[index];if(void 0===from||void 0===to)return;ranges.push({from,to})}ranges.forEach(({from,to})=>{let newStart=mapping.slice(index).map(from,-1),newEnd=mapping.slice(index).map(to),oldStart=mapping.invert().map(newStart,-1),oldEnd=mapping.invert().map(newEnd);changes.push({oldRange:{from:oldStart,to:oldEnd},newRange:{from:newStart,to:newEnd}})})}),function(changes){let uniqueChanges=function(array,by=JSON.stringify){let seen={};return array.filter(item=>{let key=by(item);return!Object.prototype.hasOwnProperty.call(seen,key)&&(seen[key]=!0)})}(changes);return 1===uniqueChanges.length?uniqueChanges:uniqueChanges.filter((change,index)=>{let rest=uniqueChanges.filter((_,i)=>i!==index);return!rest.some(otherChange=>change.oldRange.from>=otherChange.oldRange.from&&change.oldRange.to<=otherChange.oldRange.to&&change.newRange.from>=otherChange.newRange.from&&change.newRange.to<=otherChange.newRange.to)})}(changes)}(transform);if(changes.forEach(({oldRange,newRange})=>{let textBlock,textBeforeWhitespace;getMarksBetween(oldRange.from,oldRange.to,oldState.doc).filter(item=>item.mark.type===options.type).forEach(oldMark=>{let newFrom=mapping.map(oldMark.from),newTo=mapping.map(oldMark.to),newMarks=getMarksBetween(newFrom,newTo,newState.doc).filter(item=>item.mark.type===options.type);if(!newMarks.length)return;let newMark=newMarks[0],oldLinkText=oldState.doc.textBetween(oldMark.from,oldMark.to,void 0," "),newLinkText=newState.doc.textBetween(newMark.from,newMark.to,void 0," "),wasLink=test(oldLinkText),isLink=test(newLinkText);wasLink&&!isLink&&tr.removeMark(newMark.from,newMark.to,options.type)});let nodesInChangedRanges=function(node,range,predicate){let nodesWithPos=[];return node.nodesBetween(range.from,range.to,(child,pos)=>{predicate(child)&&nodesWithPos.push({node:child,pos})}),nodesWithPos}(newState.doc,newRange,node=>node.isTextblock);if(nodesInChangedRanges.length>1?(textBlock=nodesInChangedRanges[0],textBeforeWhitespace=newState.doc.textBetween(textBlock.pos,textBlock.pos+textBlock.node.nodeSize,void 0," ")):nodesInChangedRanges.length&&newState.doc.textBetween(newRange.from,newRange.to," "," ").endsWith(" ")&&(textBlock=nodesInChangedRanges[0],textBeforeWhitespace=newState.doc.textBetween(textBlock.pos,newRange.to,void 0," ")),textBlock&&textBeforeWhitespace){let wordsBeforeWhitespace=textBeforeWhitespace.split(" ").filter(s=>""!==s);if(wordsBeforeWhitespace.length<=0)return!1;let lastWordBeforeSpace=wordsBeforeWhitespace[wordsBeforeWhitespace.length-1],lastWordAndBlockOffset=textBlock.pos+textBeforeWhitespace.lastIndexOf(lastWordBeforeSpace);if(!lastWordBeforeSpace)return!1;find(lastWordBeforeSpace).filter(link=>link.isLink).filter(link=>!options.validate||options.validate(link.value)).map(link=>({...link,from:lastWordAndBlockOffset+link.start+1,to:lastWordAndBlockOffset+link.end+1})).forEach(link=>{tr.addMark(link.from,link.to,options.type.create({href:link.href}))})}}),tr.steps.length)return tr}}))),this.options.openOnClick&&plugins.push((options1={type:this.type},new Plugin({key:new PluginKey("handleClickLink"),props:{handleClick(view,pos,event){var _a,_b,_c;if(0!==event.button)return!1;let attrs=getAttributes(view.state,options1.type.name),link=null===(_a=event.target)||void 0===_a?void 0:_a.closest("a"),href=null!==(_b=null==link?void 0:link.href)&&void 0!==_b?_b:attrs.href,target=null!==(_c=null==link?void 0:link.target)&&void 0!==_c?_c:attrs.target;return!!link&&!!href&&(window.open(href,target),!0)}}}))),this.options.linkOnPaste&&plugins.push((options2={editor:this.editor,type:this.type},new Plugin({key:new PluginKey("handlePasteLink"),props:{handlePaste(view,event,slice){let{state}=view,{selection}=state,{empty}=selection;if(empty)return!1;let textContent="";slice.content.forEach(node=>{textContent+=node.textContent});let link=find(textContent).find(item=>item.isLink&&item.value===textContent);return!!textContent&&!!link&&(options2.editor.commands.setMark(options2.type,{href:link.href}),!0)}}}))),plugins}}),defaultSerializerConfig={marks:{em:defaultMarkdownSerializer.marks.em,[Bold.name]:defaultMarkdownSerializer.marks.strong,[Code.name]:defaultMarkdownSerializer.marks.code,[Italic.name]:{open:"_",close:"_",mixable:!0,expelEnclosingWhitespace:!0},[Link.name]:defaultMarkdownSerializer.marks.link,[Strike.name]:{open:"~~",close:"~~",mixable:!0,expelEnclosingWhitespace:!0}},nodes:Object.assign(Object.assign({},defaultMarkdownSerializer.nodes),{[Blockquote.name](state,node){node.attrs.multiline?(state.write(">>>"),state.ensureNewLine(),state.renderContent(node),state.ensureNewLine(),state.write(">>>"),state.closeBlock(node)):state.wrapBlock("> ",null,node,()=>state.renderContent(node))},[CodeBlock.name]:defaultMarkdownSerializer.nodes.code_block,[Heading.name]:defaultMarkdownSerializer.nodes.heading,[HardBreak.name]:defaultMarkdownSerializer.nodes.hard_break,[HorizontalRule.name]:defaultMarkdownSerializer.nodes.horizontal_rule,[BulletList.name]:defaultMarkdownSerializer.nodes.bullet_list,[OrderedList.name]:defaultMarkdownSerializer.nodes.ordered_list,[ListItem$1.name]:defaultMarkdownSerializer.nodes.list_item,[Paragraph.name]:defaultMarkdownSerializer.nodes.paragraph,[Text.name]:defaultMarkdownSerializer.nodes.text,[TaskItem.name](state,node){state.write(`[${node.attrs.checked?"x":" "}] `),state.renderContent(node)},[TaskList.name](state,node,parent,index){node.attrs.numeric?defaultMarkdownSerializer.nodes.ordered_list(state,node,parent,index):defaultMarkdownSerializer.nodes.bullet_list(state,node,parent,index)}})},markdownSerializer=new MarkdownSerializer(defaultSerializerConfig.nodes,defaultSerializerConfig.marks),markdownRenderer=null,markdownSerializer$1={serialize:content=>markdownSerializer.serialize(content,{tightLists:!0}),parse:markdownText=>(markdownRenderer||(markdownRenderer=defaultMarkdownParser.tokenizer.enable("strikethrough").use(taskLists,{enabled:!0,label:!0,labelAfter:!0})),markdownRenderer.render(markdownText))};(Actions=Actions1||(Actions1={}))[Actions.ITALIC=0]="ITALIC",Actions[Actions.BOLD=1]="BOLD",Actions[Actions.H1=2]="H1",Actions[Actions.H2=3]="H2",Actions[Actions.STRIKE=4]="STRIKE",Actions[Actions.OL=5]="OL",Actions[Actions.UL=6]="UL",Actions[Actions.LINK=7]="LINK",Actions[Actions.CODE_BLOCK=8]="CODE_BLOCK",Actions[Actions.BLOCKQUOTE=9]="BLOCKQUOTE",Actions[Actions.TASK_LIST=10]="TASK_LIST";let focusChain=editor=>editor.chain().focus(),MarkdownEditor=class{constructor(hostRef){(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.r)(this,hostRef),this.viewModeChange=(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.c)(this,"viewModeChange",7),this.valueChange=(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.c)(this,"valueChange",7),this.inoBlur=(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.c)(this,"inoBlur",3),this.viewMode="preview",this.toolbarActionsState=new Set,this.errorMessage="",this.handlePreviewBlur=()=>{let markdownText=this.htmlToMarkdown();this.errorMessage||this.valueChange.emit(markdownText),this.inoBlur.emit()},this.onEditorTransaction=()=>{this.toolbarActionsState=new Set(Object.values(Actions1).filter(action=>"number"==typeof action&&function(editor,action){if(!editor)return!1;switch(action){case Actions1.H1:return editor.isActive("heading",{level:1});case Actions1.H2:return editor.isActive("heading",{level:2});case Actions1.BOLD:return editor.isActive("bold");case Actions1.ITALIC:return editor.isActive("italic");case Actions1.STRIKE:return editor.isActive("strike");case Actions1.LINK:return editor.isActive("link");case Actions1.OL:return editor.isActive("orderedList");case Actions1.UL:return editor.isActive("bulletList");case Actions1.BLOCKQUOTE:return editor.isActive("blockquote");case Actions1.CODE_BLOCK:return editor.isActive("code");case Actions1.TASK_LIST:return editor.isActive("taskList");default:console.warn("case missing:",action)}}(this.editor,action)))},this.onTextareaChange=e=>{e.stopPropagation(),this.textareaRef.value=e.detail},this.handleMarkdownBlur=e=>{e.stopPropagation(),this.editor.commands.clearContent(),this.editor.commands.setContent(this.markdownToHtml(this.textareaRef.value)),this.errorMessage||this.valueChange.emit(this.textareaRef.value),this.inoBlur.emit()}}handleInitialValueChange(newInitialValue){this.initializeEditor(newInitialValue)}handleViewModeChange(newViewMode){var _a;newViewMode===ViewMode1.MARKDOWN&&this.textareaRef?(this.textareaRef.value=this.htmlToMarkdown(),this.textareaRef.rows=this.textareaRef.value.split("\n").length):null===(_a=this.editor)||void 0===_a||_a.setEditable(newViewMode!==ViewMode1.READONLY)}componentDidLoad(){this.createEditor(),this.initialValue&&this.initializeEditor(this.initialValue),this.textareaRef.addEventListener("valueChange",this.onTextareaChange),this.textareaRef.addEventListener("inoBlur",this.handleMarkdownBlur)}disconnectedCallback(){var _a;null===(_a=this.editor)||void 0===_a||_a.destroy(),this.textareaRef.removeEventListener("valueChange",this.onTextareaChange),this.textareaRef.removeEventListener("inoBlur",this.handleMarkdownBlur)}initializeEditor(initialValue){this.editor&&(this.editor.commands.setContent(this.markdownToHtml(initialValue),!0),this.textareaRef.value=this.htmlToMarkdown(),this.textareaRef.rows=this.textareaRef.value.split("\n").length)}createEditor(){this.editor=new Editor({element:this.editorRef,extensions:[StarterKit.configure({bulletList:!1}),BulletList,Link,TaskItem,TaskList],onBlur:this.handlePreviewBlur,onTransaction:this.onEditorTransaction,editable:this.viewMode!==ViewMode1.READONLY})}htmlToMarkdown(){return this.tryParse(()=>{let doc=this.editor.schema.nodeFromJSON(this.editor.getJSON());return markdownSerializer$1.serialize(doc)},this.textareaRef.value)}markdownToHtml(md=this.initialValue){return this.tryParse(()=>markdownSerializer$1.parse(md),this.editor.getHTML())}tryParse(parseCallback,fallbackValue){try{return this.errorMessage="",parseCallback()}catch(err){return this.errorMessage=err.message,console.error(err),fallbackValue}}handleViewModeBtnClick(viewMode){this.errorMessage||this.viewModeChange.emit(viewMode)}handleToolbarActionClick(action){!function(editor,action){switch(action){case Actions1.H1:focusChain(editor).toggleHeading({level:1}).run();break;case Actions1.H2:focusChain(editor).toggleHeading({level:2}).run();break;case Actions1.BOLD:focusChain(editor).toggleBold().run();break;case Actions1.ITALIC:focusChain(editor).toggleItalic().run();break;case Actions1.STRIKE:focusChain(editor).toggleStrike().run();break;case Actions1.LINK:focusChain(editor).unsetLink().run();break;case Actions1.OL:focusChain(editor).toggleOrderedList().run();break;case Actions1.UL:focusChain(editor).toggleBulletList().run();break;case Actions1.BLOCKQUOTE:focusChain(editor).toggleBlockquote().run();break;case Actions1.CODE_BLOCK:focusChain(editor).toggleCodeBlock().run();break;case Actions1.TASK_LIST:focusChain(editor).toggleTaskList().run();break;default:console.warn("case missing:",action)}}(this.editor,action)}render(){let isReadonlyMode=this.viewMode===ViewMode1.READONLY,isPreviewMode=isReadonlyMode||this.viewMode===ViewMode1.PREVIEW,isMarkdownMode=this.viewMode===ViewMode1.MARKDOWN,editorClasses=(0,_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__.c)({"markdown-editor":!0,"markdown-editor--readonly":isReadonlyMode}),previewModeEditorClasses=(0,_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__.c)({"markdown-editor__content__container":!0,"show-editor":isPreviewMode,"hide-editor":isMarkdownMode}),markdownModeEditorClasses=(0,_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__.c)({"show-editor":isMarkdownMode,"hide-editor":isPreviewMode}),getViewModeBtnClasses=viewMode=>(0,_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__.c)({"toolbar__action-button":!0,"toolbar__view-mode":!0,"toolbar__action-button--active":this.viewMode===viewMode}),textFormatToolbarClasses=(0,_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__.c)({"toolbar__text-format":!0,"toolbar__text-format--show":isPreviewMode,"toolbar__text-format--hide":isMarkdownMode}),getToolbarActionBtnClass=action=>(0,_index_796d4780_js__WEBPACK_IMPORTED_MODULE_1__.c)({"toolbar__action-button":!0,"toolbar__action-button--active":this.toolbarActionsState.has(action)});return(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{class:editorClasses},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{class:"markdown-editor__toolbar"},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",null,(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getViewModeBtnClasses(ViewMode1.PREVIEW),onClick:()=>this.handleViewModeBtnClick(ViewMode1.PREVIEW)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"edit_text"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getViewModeBtnClasses(ViewMode1.MARKDOWN),onClick:()=>this.handleViewModeBtnClick(ViewMode1.MARKDOWN)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"code"}))),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{class:textFormatToolbarClasses},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.H1),onClick:()=>this.handleToolbarActionClick(Actions1.H1)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"headline_one"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.H2),onClick:()=>this.handleToolbarActionClick(Actions1.H2)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"headline_two"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.BOLD),onClick:()=>this.handleToolbarActionClick(Actions1.BOLD)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"bold"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.ITALIC),onClick:()=>this.handleToolbarActionClick(Actions1.ITALIC)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"italic"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.STRIKE),onClick:()=>this.handleToolbarActionClick(Actions1.STRIKE)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"strikethrough"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.LINK),onClick:()=>this.handleToolbarActionClick(Actions1.LINK)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"link"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.UL),onClick:()=>this.handleToolbarActionClick(Actions1.UL)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"bullet_list"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.OL),onClick:()=>this.handleToolbarActionClick(Actions1.OL)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"numeric_list"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.TASK_LIST),onClick:()=>this.handleToolbarActionClick(Actions1.TASK_LIST)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"checkmark"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.BLOCKQUOTE),onClick:()=>this.handleToolbarActionClick(Actions1.BLOCKQUOTE)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"quote"})),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("button",{class:getToolbarActionBtnClass(Actions1.CODE_BLOCK),onClick:()=>this.handleToolbarActionClick(Actions1.CODE_BLOCK)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-icon",{icon:"code_block"}))),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-popover",{placement:"top-start",controlled:!0,"color-scheme":"transparent",visible:Boolean(this.errorMessage)},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("span",{class:"markdown-editor__error-text"},this.errorMessage))),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{class:"markdown-editor__content"},(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("div",{class:previewModeEditorClasses,ref:el=>this.editorRef=el}),(0,_index_871ffba6_js__WEBPACK_IMPORTED_MODULE_0__.h)("ino-textarea",{ref:el=>this.textareaRef=el,class:markdownModeEditorClasses,cols:100,autogrow:!0,outline:!0})))}static get watchers(){return{initialValue:["handleInitialValueChange"],viewMode:["handleViewModeChange"]}}};MarkdownEditor.style="ino-markdown-editor .markdown-editor{border-radius:10px}ino-markdown-editor .markdown-editor--readonly .markdown-editor__toolbar{display:none}ino-markdown-editor .markdown-editor--readonly .ProseMirror{padding:0;border:0}ino-markdown-editor .markdown-editor--readonly .ProseMirror-focused{outline:none}ino-markdown-editor .markdown-editor__error-text{display:block;padding:10px;color:#9f0028}ino-markdown-editor .markdown-editor__toolbar{display:grid;grid-template-columns:auto auto;justify-content:space-between;border-radius:10px;background-color:#f9f9f9;padding:10px 20px;margin-bottom:10px}ino-markdown-editor .toolbar__action-button{--ino-icon-color-primary:#9d9d9d;border:0;margin:0;padding:1px 2px;border-radius:10px;background-color:transparent;font-size:22px}ino-markdown-editor .toolbar__action-button:hover{--ino-icon-color-primary:#0d10f3;background-color:rgba(13, 16, 243, 0.1);color:#0d10f3;cursor:pointer}ino-markdown-editor .toolbar__action-button--active{--ino-icon-color-primary:#0d10f3;background-color:rgba(13, 16, 243, 0.1);color:#0d10f3;box-shadow:inset 0 3px 6px rgba(0, 0, 0, 0.16)}ino-markdown-editor .toolbar__action-button ino-icon{vertical-align:middle;padding:5px}ino-markdown-editor .toolbar__view-mode{border-radius:0;margin:0}ino-markdown-editor .toolbar__view-mode:first-of-type{border-radius:10px 0 0 10px}ino-markdown-editor .toolbar__view-mode:last-of-type{border-radius:0 10px 10px 0}ino-markdown-editor .toolbar__text-format--show{display:block}ino-markdown-editor .toolbar__text-format--hide{display:none}ino-markdown-editor .markdown-editor__content__container{height:100%;width:100%}ino-markdown-editor .markdown-editor__content{overflow:auto;max-height:var(--ino-markdown-editor-max-height, none)}ino-markdown-editor .markdown-editor__content ino-textarea{width:100%;height:100%}ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined{display:flex}ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:#e7e7e7}ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:#9b9b9b}ino-markdown-editor .markdown-editor__content ino-textarea .mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{min-height:var(--ino-markdown-editor-min-height, 100px);line-height:normal;letter-spacing:0}ino-markdown-editor .show-editor{display:block}ino-markdown-editor .hide-editor{display:none}ino-markdown-editor .ProseMirror{min-height:var(--ino-markdown-editor-min-height, 100px);padding:15px;border-radius:4px;border:1px solid #e7e7e7;color:rgba(0, 0, 0, 0.87)}ino-markdown-editor .ProseMirror:hover:not(ino-markdown-editor .ProseMirror-focused){border-color:#9b9b9b}ino-markdown-editor .ProseMirror-focused{outline:#3d40f5 auto 1px}ino-markdown-editor .ProseMirror *:first-child{margin-top:0;padding-top:0}ino-markdown-editor .ProseMirror *:last-child{margin-bottom:0;padding-bottom:0}ino-markdown-editor .ProseMirror blockquote{padding-left:10px;border-left:3px solid #c1c1c1}ino-markdown-editor .ProseMirror p{margin-top:0;margin-bottom:1.2em}ino-markdown-editor .ProseMirror pre code{display:block;background-color:rgba(193, 193, 193, 0.15);white-space:pre;-webkit-overflow-scrolling:touch;overflow-x:auto;max-width:100%;min-width:100px;padding:6px 8px}ino-markdown-editor .ProseMirror ul[data-type=taskList]{list-style:none}ino-markdown-editor .ProseMirror :is(ul,ol)[data-type=taskList]{padding-left:12px}ino-markdown-editor .ProseMirror :is(ul,ol)[data-type=taskList] p{margin:0}ino-markdown-editor .ProseMirror :is(ul,ol)[data-type=taskList] li{display:flex}ino-markdown-editor .ProseMirror :is(ul,ol)[data-type=taskList] li>label{flex:0 0 auto;margin-right:0.5rem;user-select:none}ino-markdown-editor .ProseMirror :is(ul,ol)[data-type=taskList] li>div{flex:1 1 auto;display:inline-block}ino-markdown-editor .ProseMirror :is(ul,ol)[data-type=taskList] li input[type=checkbox]{accent-color:#3d40f5}"}}]);