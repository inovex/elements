@use '../base/mdc-customize';
@use '@material/textfield/mdc-text-field';
@use '@material/textfield';
@use '@material/textfield/icon';
@use '@material/textfield/helper-text';
@use '@material/floating-label/mdc-floating-label';
@use '@material/floating-label';
@use '@material/notched-outline/mdc-notched-outline';
@use '@material/notched-outline/' as notched-outline;
@use '../base/new-theme' as theme;
@use '../base/typography';

// Tailwind CSS Preflight border-style countermeasures (https://tailwindcss.com/docs/preflight#border-styles-are-reset-globally)
ino-input * {
  border-style: none;
}

$default-text-field: 'not(.mdc-text-field--outlined):not(.mdc-text-field--textarea)';
$placeholder-color: rgba(0, 0, 0, 0.6);
$padding-top: 24px;
$padding-top-dense: 12px;
$font-size: 1rem; // 14px
$font-size-floating-label: 0.857rem; // 12px
$font-size-dense: 0.857rem; // 12px
$font-size-dense-floating-label: 0.714rem; // 10px

$icon-padding-to-text: 12px;
$icon-padding-to-border: 6px;
$icon-padding-to-text-dense: 5px;
$icon-padding-to-bottom-dense: 0px;
$icon-padding-to-border-dense: 2px;

$filled-input-height: 56px;
$filled-input-height-dense: fit-content;
$filled-input-padding-dense: 0 0 2px 1px;
$filled-selected-text-height-dense: 25px;

$outline-input-height: 40px;
$outline-input-height-dense: 30px;
$outline-shape-radius: calc($outline-input-height / 2);
$outline-shape-radius-corner: $outline-shape-radius $outline-shape-radius
$outline-shape-radius 0;

@mixin setIconColors($color) {
  .mdc-text-field__icon {
    ino-icon {
      --icon-color: #{$color};
    }
  }
}

@mixin setIconMargins($margin-leading, $margin-trailing: $margin-leading) {
  .mdc-text-field__icon.mdc-text-field__icon--leading {
    margin: $margin-leading;
  }

  .mdc-text-field__icon.mdc-text-field__icon--trailing {
    margin: $margin-trailing;
  }
}

@mixin hideNativeNumberInputArrows() {
  /* Chrome, Safari, Edge, Opera */
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* Firefox */
  input[type='number'] {
    -moz-appearance: textfield;
  }
}

/* Shared Styles */
ino-input {
  /**
   * @prop --ino-input-color: text color of the input
   * @prop --ino-input-caret-color: color of the caret
   * @prop --ino-input-label-color: color of the label
   * @prop --ino-input-line-color: line color
   * @prop --ino-input-icon-color: icon color
   */
  --input-color: var(--ino-input-color, #{textfield.$ink-color});
  --input-caret-color: var(--ino-input-caret-color, #{theme.$p-5});
  --input-label-color: var(--ino-input-label-color, #{theme.$p-5});
  --input-line-color: var(--ino-input-line-color, #{theme.$p-5});
  --input-icon-color: var(--ino-input-icon-color, #{theme.$p-5});

  display: block;
  @include icon.icon-core-styles;
  @include typography.font(sans-serif, m, regular);
  @include textfield.caret-color(var(--input-caret-color));

  .mdc-text-field {
    @include textfield.ink-color(var(--input-color));
    @include textfield.height($filled-input-height);
  }

  & * {
    box-sizing: initial;
  }

  & > .ino-input__composer {
    text-align: left;
    width: 100%;
    box-sizing: border-box;
  }

  .mdc-text-field__icon,
  .mdc-text-field__icon:not([tabindex]) {
    cursor: auto;
    pointer-events: auto;
    padding: 0;
  }

  @include setIconColors($placeholder-color);

  .mdc-text-field--focused {
    @include textfield.label-color(var(--input-label-color));
    @include setIconColors(var(--input-icon-color));

    & .mdc-floating-label.mdc-floating-label--float-above {
      font-weight: bold;
    }
  }

  .mdc-text-field--invalid {
    @include textfield.label-color(theme.$error);
    @include setIconColors(theme.$error);
  }

  :not(.mdc-text-field--disabled) {
    @include textfield.placeholder-color($placeholder-color);
  }

  .mdc-text-field__affix.mdc-text-field__affix--suffix {
    margin-right: 12px;
  }
}

// Filled textfield specific
ino-input .mdc-text-field--filled {
  @include textfield.fill-color(transparent);
  @include textfield.disabled-fill-color(transparent);
  @include textfield.line-ripple-color(var(--input-line-color));
  &.mdc-text-field--invalid {
    @include textfield.line-ripple-color(theme.$error);
  }

  &:not([class*='--with-leading-icon']) {
    padding-left: 0;
    padding-right: 0;
  }

  &[class*='--with-leading-icon'] {
    $padding-to-left: 32px;

    .mdc-floating-label,
    .mdc-floating-label--float-above {
      left: $padding-to-left;
    }
  }

  .mdc-text-field__input {
    padding-bottom: 0;
    padding-top: $padding-top;
  }

  &.mdc-text-field--no-label .mdc-text-field__input {
    padding-top: 10px;
  }

  .mdc-text-field__icon {
    padding: $padding-top 0 0 0;

    ino-icon {
      --icon-height: 1em;
      --icon-width: 1em;
    }
  }

  @include setIconMargins(
    (0 $icon-padding-to-text 0 $icon-padding-to-border),
    (0 $icon-padding-to-border 0 $icon-padding-to-text)
  );
}

// filled dense
ino-input .mdc-text-field--filled.ino-input--dense {
  @include textfield.density(-1);
  align-items: end;
  overflow: visible;
  height: $filled-input-height-dense;

  .mdc-text-field__input {
    padding: $filled-input-padding-dense;
    height: $filled-selected-text-height-dense;
    font-size: $font-size-dense;
    box-sizing: border-box;
  }

  .mdc-floating-label {
    display: unset;
    padding-bottom: 2px;
    font-size: $font-size-dense;
  }

  .mdc-floating-label.mdc-floating-label--float-above {
    margin-top: 3px;
    font-size: $font-size-dense-floating-label;
    letter-spacing: 0.043rem;
  }

  .mdc-text-field__icon {
    padding: $padding-top-dense 0 0 0;

    ino-icon {
      --icon-height: 0.8em;
      --icon-width: 0.8em;
    }
  }

  &:has(.mdc-text-field__icon.mdc-text-field__icon--leading) {
    @include setIconMargins(
      (
        0 $icon-padding-to-text-dense $icon-padding-to-bottom-dense
          $icon-padding-to-border-dense
      ),
      (
        0 $icon-padding-to-border-dense $icon-padding-to-bottom-dense
          $icon-padding-to-text-dense
      )
    );
    .mdc-floating-label,
    .mdc-floating-label--float-above {
      left: 21px;
    }
  }
}

// Outlined textfield specific
ino-input .mdc-text-field--outlined {
  @include textfield.focused-outline-color(var(--input-line-color));
  @include textfield.outline-shape-radius(20px);
  @include textfield.outlined-height($outline-input-height);
  @include setIconMargins((0 $icon-padding-to-text 0 $icon-padding-to-text));

  border-style: none !important;

  // style outline with corner for helpertext
  &.mdc-text-field--has-helpertext.mdc-text-field--focused,
  &.mdc-text-field--has-helpertext.mdc-text-field--has-helpertext-persistent {
    @include textfield.outline-shape-radius($outline-shape-radius-corner);

    & + .mdc-text-field-helper-line {
      padding-left: 0;
    }
  }

  &.mdc-text-field--disabled {
    @include textfield.outline-shape-radius($outline-shape-radius);
  }

  &.mdc-text-field--invalid {
    @include textfield.focused-outline-color(theme.$error);
  }

  &[class*='--with-leading-icon']
    .mdc-floating-label:not(.mdc-floating-label--float-above) {
    left: 24px;
  }

  .mdc-text-field__icon {
    height: 16px;
    width: 16px;
  }

  // & .mdc-notched-outline--upgraded .mdc-floating-label--float-above {
  //   max-width: 160%;
  // }
}

// outlined dense
ino-input .mdc-text-field--outlined.ino-input--dense {
  @include textfield.outlined-height($outline-input-height-dense);
  @include notched-outline.floating-label-float-position(115%, 0%, 0.65);

  // .mdc-text-field__input, 
  // .mdc-floating-label {
  //   font-size: 0.857rem;
  // }

  .mdc-floating-label {
    background-color: aqua;
  }

  & .mdc-notched-outline--upgraded .mdc-floating-label--float-above {
    //max-width: 160%;
    //font-size: 0.714rem;
  }

  & .mdc-notched-outline__notch {
    background-color: rgba(green, 0.5);
  }

  & .mdc-notched-outline--upgraded .mdc-notched-outline__notch {
    width: 100%;
  }

  &[class*='--with-leading-icon'] .mdc-floating-label {
    left: 21px;
  }

  &[class*='--with-leading-icon']
    .mdc-floating-label.mdc-floating-label--float-above {
    left: 5px;
    // width: 100%;
  }
}

ino-input .mdc-text-field + .mdc-text-field-helper-line {
  padding-left: 0;
}

// Custom number arrows
ino-input[type='number'] {
  @include hideNativeNumberInputArrows();

  .arrow-container {
    align-self: flex-end;
    position: relative;
    display: flex;
    flex-direction: column;
    right: 5px;
    height: 45%;

    .ino-num-arrows {
      --ino-icon-height: 5px;
      --icon-color: #{$placeholder-color};

      padding: 2px 0;
      cursor: pointer;

      &.up {
        transform: scaleY(-1);
      }
    }
  }

  .ino-input--dense .arrow-container {
    bottom: 5px;
    .ino-num-arrows {
      --ino-icon-height: 4px;
      padding: 1px 0;
    }
  } 

  .mdc-text-field--outlined .arrow-container {
    justify-content: center;
    height: 100%;
    bottom: 0px;
    top: 0;
    right: -5px;
  } 

  .mdc-text-field--outlined.ino-input--dense .arrow-container {
    right: -10px;

    .ino-num-arrows {
      --ino-icon-height: 4px;
      padding: 1px 0;
    }
  } 
}
